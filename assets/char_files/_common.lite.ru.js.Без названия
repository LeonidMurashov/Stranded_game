!function(t){function e(t){var e=r(t);if(l)for(var i,n=0;i=p[n++];)t.hasOwnProperty(i)&&e.push(i);return e}function i(i,n,s){function o(e,s){var o=function(){var t=this.__base;this.__base=o.__base;var e=s.apply(this,arguments);return this.__base=t,e};return o.__base=i[e]?i[e]:"__constructor"===e?n.__self.__parent:t.noop,o}for(var r,a,c=e(s),l=0,u=c.length;u>l;)"__self"!==(r=c[l++])&&(a=s[r],n[r]=h(a)&&a.toString().indexOf(".__base")>-1?o(r,a):a)}function n(e,i){for(var n,s=1;n=e[s++];)i?h(n)?t.inheritSelf(i,n.prototype,n):t.inheritSelf(i,n):i=h(n)?t.inherit(e[0],n.prototype,n):t.inherit(e[0],n);return i||e[0]}var s=function(){},o=Object.create||function(t){var e=function(){};return e.prototype=t,new e},r=Object.keys,a=t.extend,c=Array.isArray,h=t.isFunction,l=!0,u={toString:""};for(var d in u)u.hasOwnProperty(d)&&(l=!1);var p=l?["toString","valueOf"]:null;t.inherit=function(){var t=arguments,e=c(t[0]),r=e||h(t[0]),l=r?e?n(t[0]):t[0]:s,u=t[r?1:0]||{},d=t[r?2:1],p=u.__constructor||r&&l.prototype.__constructor?function(){return this.__constructor.apply(this,arguments)}:r?function(){return l.apply(this,arguments)}:function(){};if(!r)return p.prototype=u,p.prototype.__self=p.prototype.constructor=p,a(p,d);a(p,l),p.__parent=l;var m=l.prototype,f=p.prototype=o(m);return f.__self=f.constructor=p,u&&i(m,f,u),d&&i(l,p,d),p},t.inheritSelf=function(){var t=arguments,e=c(t[0]),s=e?n(t[0],t[0][0]):t[0],o=t[1],r=t[2],a=s.prototype;return o&&i(a,a,o),r&&i(s,s,r),s},t.inherit.self=t.inheritSelf}(jQuery),function(t){var e=0,i="__"+Number(new Date),n=function(){return"uniq"+ ++e};t.identify=function(t,e){if(!t)return n();var s="uniqueID"in t?"uniqueID":i;return e||s in t?t[s]:t[s]=n()}}(jQuery),function(t){var e="__"+Number(new Date)+"storage",i=function(e,i){return t.identify(e)+(i?t.identify(i):"")},n={buildEventName:function(t){return t},on:function(n,s,o,r,a){if("string"==typeof n){t.isFunction(s)&&(r=o,o=s,s=void 0);for(var c,h=i(o,r),l=this[e]||(this[e]={}),u=n.split(" "),d=0;n=u[d++];)if(n=this.buildEventName(n),c=l[n]||(l[n]={ids:{},list:{}}),!(h in c.ids)){var p=c.list,m={fn:o,data:s,ctx:r,special:a};p.last?(p.last.next=m,m.prev=p.last):p.first=m,c.ids[h]=p.last=m}}else{var f=this;t.each(n,function(t,e){f.on(t,e,s,a)})}return this},onFirst:function(t,e,i,n){return this.on(t,e,i,n,{one:!0})},un:function(n,s,o){if("string"==typeof n||"undefined"==typeof n){var r=this[e];if(r)if(n){for(var a,c=n.split(" "),h=0;n=c[h++];)if(n=this.buildEventName(n),a=r[n])if(s){var l=i(s,o),u=a.ids;if(l in u){var d=a.list,p=u[l],m=p.prev,f=p.next;m?m.next=f:p===d.first&&(d.first=f),f?f.prev=m:p===d.last&&(d.last=m),delete u[l]}}else delete this[e][n]}else delete this[e]}else{var _=this;o=s,t.each(n,function(t,e){_.un(t,e,o)})}return this},trigger:function(i,n){var s=this[e],o="string"==typeof i,r=o?i:i.type,a=this.buildEventName(r);if(o||(i.type=a,i.target||(i.target=this)),s&&(s=s[a])){var c,h=s.list.first;for(h&&o&&(i=t.Event(a),i.target=this);h;)i.data=h.data,c=h.fn.call(h.ctx||this,i,n),"undefined"!=typeof c&&(i.result=c,c===!1&&(i.preventDefault(),i.stopPropagation())),h.special&&h.special.one&&this.un(r,h.fn,h.ctx),h=h.next}return this}};t.observable=t.inherit(n,n)}(jQuery),function(){var t=Array.prototype.slice;Function.prototype.bind||(Function.prototype.bind=function(e){var i=this,n=t.call(arguments,1);return function(){return i.apply(e,n.concat(t.call(arguments)))}})}(),function(t,e){function i(t,e,i){return(t?"__elem_"+t:"")+"__mod"+(e?"_"+e:"")+(i?"_"+i:"")}function n(t,e,n){if(c(t))return void(e[i(n,"*","*")]=t);var s,o,r;for(s in t)if(h(t,s))if(r=t[s],c(r))e[i(n,s,"*")]=r;else for(o in r)h(r,o)&&(e[i(n,s,o)]=r[o])}function s(t,e){return e?Array.isArray(e)?function(i){for(var n=0,s=e.length;s>n;)if(i.hasMod(t,e[n++]))return!0;return!1}:function(i){return i.hasMod(t,e)}:function(e){return e.hasMod(t)}}function o(t){t.onSetMod&&(n(t.onSetMod,t),delete t.onSetMod);var e,i;if(t.onElemSetMod){for(e in t.onElemSetMod)h(t.onElemSetMod,e)&&(i=t.onElemSetMod[e],n(i,t,e));delete t.onElemSetMod}}var r=[],a=t.inherit,c=t.isFunction,h=Function.prototype.call.bind(Object.prototype.hasOwnProperty),l={},u="_",d="__",p={};this.BEM=a(t.observable,{__constructor:function(t,e,i){var n=this;n._modCache=t||{},n._processingMods={},n._params=e,n.params=null,i!==!1?n._init():n.afterCurrentEvent(function(){n._init()})},_init:function(){return this._initing||this.hasMod("js","inited")||(this._initing=!0,this.params||(this.params=t.extend(this.getDefaultParams(),this._params),delete this._params),this.setMod("js","inited"),delete this._initing,this.hasMod("js","inited")&&this.trigger("init")),this},changeThis:function(t,e){return t.bind(e||this)},afterCurrentEvent:function(t,e){this.__self.afterCurrentEvent(t.bind(e||this))},on:function(e,i,n,s){return"object"==typeof e&&(t.isFunction(i)||t.isFunction(n))&&(e=this.__self._buildModEventName(e)),this.__base.apply(this,arguments)},un:function(e,i,n){return"object"==typeof e&&t.isFunction(i)&&(e=this.__self._buildModEventName(e)),this.__base.apply(this,arguments)},trigger:function(e,i){var n=!0;return"object"!=typeof e||e instanceof t.Event||(n="js"===e.modName||this.hasMod("js"),e=this.__self._buildModEventName(e)),n&&(this.__base(e=this.buildEvent(e),i),this._trigger(e,i)),this},_trigger:function(t,e){this.__self.trigger(t,e)},buildEvent:function(e){return"string"==typeof e&&(e=t.Event(e)),e.block=this,e},hasMod:function(t,i,n){var s=arguments.length,o=!1;1==s?(n="",i=t,t=e,o=!0):2==s&&("string"==typeof t?(n=i,i=t,t=e):(n="",o=!0));var r=this.getMod(t,i)===n;return o?!r:r},getMod:function(t,e){var i=typeof t;if("string"===i||"undefined"===i){e=t||e;var n=this._modCache,s=e in n?n[e]:n[e]=this._extractModVal(e);return s}return this._getElemMod(e,t)},_getElemMod:function(t,e,i){return this._extractModVal(t,e,i)},getMods:function(t){var e=t&&"string"!=typeof t,i=this._modCache,n=[].slice.call(arguments,e?1:0);return n.length?n.reduce(function(t,e){return e in i&&(t[e]=i[e]),t},{}):i},setMod:function(i,n,s){"undefined"==typeof s&&("string"==typeof i?(s="undefined"==typeof n?!0:n,n=i,i=e):s=!0);var o=this;if(!i||i[0]){s===!1||null===s?s="":s!==!0&&(s=s.toString());var r=(i&&i[0]?t.identify(i[0]):"")+"_"+n;if(this._processingMods[r])return o;var a,c=i?o._getElemMod(n,i,a=o.__self._extractElemNameFrom(i)):o.getMod(n);if(c===s)return o;this._processingMods[r]=!0;var h=!0,l=[n,s,c];i&&l.unshift(i),[["*","*"],[n,"*"],[n,s]].forEach(function(t){h=o._callModFn(a,t[0],t[1],l)!==!1&&h}),!i&&h&&(o._modCache[n]=s),h&&o._afterSetMod(n,s,c,i,a),delete this._processingMods[r]}return o},_afterSetMod:function(t,e,i,n,s){var o={modName:t,modVal:e,oldModVal:i};n&&(o.elem=n),this.trigger({modName:t,modVal:"*",elem:s},o).trigger({modName:t,modVal:e,elem:s},o)},toggleMod:function(t,i,n,s,o){"string"==typeof t&&(o=s,s=n,n=i,i=t,t=e),"undefined"==typeof s?s="":"boolean"==typeof s&&(o=s,s="");var r=this.getMod(t,i);return(r==n||r==s)&&this.setMod(t,i,"boolean"==typeof o?o?n:s:this.hasMod(t,i,n)?s:n),this},delMod:function(t,i){return i||(i=t,t=e),this.setMod(t,i,"")},_callModFn:function(t,n,s,o){var r=i(t,n,s);return this[r]?this[r].apply(this,o):e},_extractModVal:function(t,e){return""},channel:function(t,e){return this.__self.channel(t,e)},getDefaultParams:function(){return{}},del:function(t){var e=[].slice.call(arguments);return"string"==typeof t&&e.unshift(this),this.__self.del.apply(this.__self,e),this},destruct:function(){var t={modName:"js",modVal:"",oldModVal:"inited"};this.trigger({modName:t.modName,modVal:t.modVal},t)}},t.extend(this.BEM,{_name:"i-bem",blocks:l,decl:function(i,n,r){"string"==typeof i?i={block:i}:i.name&&(i.block=i.name),o(n||(n={}));var h=l[i.baseBlock||i.block]||this;if(i.modName){var u=s(i.modName,i.modVal);t.each(n,function(t,i){c(i)&&(n[t]=function(){var s;if(u(this))s=i;else{var o=h.prototype[t];o&&o!==n[t]&&(s=this.__base)}return s?s.apply(this,arguments):e})})}if(r&&"boolean"==typeof r.live){var d=r.live;r.live=function(){return d}}var p,m=h;return i.baseMix&&(m=[m],i.baseMix.forEach(function(t){m.push(l[t])})),i.block==h._name?(p=a.self(m,n,r))._processLive(!0):((p=l[i.block]=a(m,n,r))._name=i.block,delete p._liveInitable),p},declMix:function(t,e,i){return o(e||(e={})),t=l[t]=a(e,i)},_processLive:function(t){return!1},create:function(t,e){return"string"==typeof t&&(t={block:t}),new l[t.block](t.mods,e)},getName:function(){return this._name},on:function(e,i,n,s){return"object"==typeof e&&(t.isFunction(i)||t.isFunction(n))&&(e=this._buildModEventName(e)),this.__base.apply(this,arguments)},un:function(e,i,n){return"object"==typeof e&&t.isFunction(i)&&(e=this._buildModEventName(e)),this.__base.apply(this,arguments)},_buildModEventName:function(t){var e=u+t.modName+u+(t.modVal===!1?"":t.modVal);return t.elem&&(e=d+t.elem+e),e},_extractElemNameFrom:function(t){},afterCurrentEvent:function(t,e){1==r.push({fn:t,ctx:e})&&setTimeout(this._runAfterCurrentEventFns,0)},_runAfterCurrentEventFns:function(){var t=r.length;t&&r.splice(0,t).forEach(function(t){t.fn.call(t.ctx||this)},this)},changeThis:function(t,e){return t.bind(e||this)},del:function(t){var e="string"==typeof t,i=e?0:1,n=arguments.length;for(e&&(t=this);n>i;)delete t[arguments[i++]];return this},channel:function(i,n){return"boolean"==typeof i&&(n=i,i=e),i||(i="default"),n?void(p[i]&&(p[i].un(),delete p[i])):p[i]||(p[i]=new t.observable)}}))}(jQuery),function(t,e,i){function n(t){var e=typeof t;return"string"===e||"number"===e||"boolean"===e}function s(t,e,i){null!=e&&e!==!1&&(i.push(c,t),e!==!0&&i.push(c,e))}function o(t,e,i,n){n.push(t),s(e,i,n)}function r(t,e,i,n,r){o(t,a,a,r),r.push(h,e),s(i,n,r)}var a,c="_",h="__",l="[a-zA-Z0-9-]+";t.INTERNAL={NAME_PATTERN:l,MOD_DELIM:c,ELEM_DELIM:h,buildModPostfix:function(t,e,i){var n=i||[];return s(t,e,n),i?n:n.join("")},buildClass:function(t,e,i,s,c){if(n(i)?n(s)||(c=s,s=i,i=e,e=a):"undefined"!=typeof i?(c=i,i=a):e&&"string"!=typeof e&&(c=e,e=a),!e&&"undefined"==typeof i&&!c)return t;var h=c||[];return e?r(t,e,i,s,h):o(t,i,s,h),c?h:h.join("")},buildClasses:function(t,n,s,a){n&&"string"!=typeof n&&(a=s,s=n,n=i);var c=a||[];return n?r(t,n,i,i,c):o(t,i,i,c),s&&e.each(s,function(e,i){i&&(c.push(" "),n?r(t,n,e,i,c):o(t,e,i,c))}),a?c:c.join("")}}}(BEM,jQuery),function(t,e,i){function n(t,i){var n=t[0];e.each(a(n),function(r,a){o(a,n,r,i);var c=m[a.uniqId];c?c.domElem.index(n)<0&&(c.domElem=c.domElem.add(t),e.extend(c._params,a)):s(r,t,a)})}function s(t,n,s,r,c){"boolean"==typeof s&&(c=r,r=s,s=i);var h=n[0];s=o(s||a(h)[t],h,t);var l=s.uniqId;if(m[l])return m[l]._init();p[l]=p[l]?p[l].add(n):n;var u=h.parentNode;u&&11!==u.nodeType||e.unique(p[l]);var d=b[t]||C.decl(t,{},{live:!0});if(!(d._liveInitable=Boolean(d._processLive()))||r||s.live===!1){r&&n.addClass("i-bem");var f=new d(p[l],s,Boolean(r));return delete p[l],c&&c.apply(f,x.call(arguments,4)),f}}function o(t,i,n,s){(t||(t={})).uniqId||(t.uniqId=(t.id?n+"-id-"+t.id:e.identify())+(s||e.identify()));var o=e.identify(i),r=f[o]||(f[o]={});return r[n]||(r[n]=t),t}function r(t,e,i){var n=t.find(e);return i?n:n.add(t.filter(e))}function a(t){var i=e.identify(t);return f[i]||(f[i]=c(t))}function c(t){var e,i=t.getAttribute("data-bem");return i?JSON.parse(i):e?e():{}}function h(t){delete f[e.identify(t)]}function l(t,e){1===t.domElem.length?t.destruct(!0):t.domElem=t.domElem.not(e)}var u=e(window),d=e(document),p={},m={},f={},_={},g={},b=t.blocks,v=t.INTERNAL,y=v.NAME_PATTERN,k=v.MOD_DELIM,M=v.ELEM_DELIM,E=RegExp("[^"+k+"]"+k+"("+y+")(?:"+k+"("+y+"))?$"),w=v.buildModPostfix,B=v.buildClass,x=Array.prototype.slice,S=Array.prototype.reverse;e.fn.bem=function(t,e){return s(t,this,e,!0)};var C=t.DOM=t.decl("i-bem__dom",{__constructor:function(t,i,n){var s=this;s.domElem=t,s._eventNameCache={},s._elemCache={},s._blockInsideCache={},m[s._uniqId=i.uniqId||e.identify(s)]=s,s._needSpecialUnbind=!1,s.__base(null,i,n)},findBlocksInside:function(t,e){return this._findBlocks("find",t,e)},findBlockInside:function(t,e){var i=this._buildBlockCacheKey(t,e),n=this._findBlocks("find",t,e,!0);return this._blockInsideCache[i]=n,n},blockInside:function(t,e){var i=this._buildBlockCacheKey(t,e),n=this._blockInsideCache[i];return n||(n=this.findBlockInside(t,e)),n},dropBlockInsideCache:function(t,e){t||e?this._blockInsideCache[this._buildBlockCacheKey(t,e)]=null:this._blockInsideCache={}},_buildBlockCacheKey:function(t,e){e||(e=t,t="");var i="string"==typeof e?e:B(e.block,e.modName,e.modVal),n="string"==typeof t?t:t.__bemElemName;return n+":"+i},findBlocksOutside:function(t,e){return this._findBlocks("parents",t,e)},findBlockOutside:function(t,e){return this._findBlocks("closest",t,e)[0]||null},findBlocksOn:function(t,e){return this._findBlocks("",t,e)},findBlockOn:function(t,e){return this._findBlocks("",t,e,!0)},_findBlocks:function(t,n,o,r){if(!this.domElem)return r?null:[];o||(o=n,n=i);var a=n?"string"==typeof n?this.findElem(n):n:this.domElem,c="string"==typeof o,h=c?o:o.block||o.blockName,l="."+(c?h:B(h,o.modName,o.modVal))+(r?":first":""),u=a.filter(l);if(t&&(u=u.add(a[t](l))),r)return u[0]?s(h,u.eq(0),!0):null;var d=[],p={};return e.each(u,function(t,i){var n=s(h,e(i),!0);p[n._uniqId]||(p[n._uniqId]=!0,d.push(n))}),d},bindToDomElem:function(t,n,s,o){e.isFunction(s)&&(o=s,s=i);var r=this,a=function(t){return(t.data||(t.data={})).domElem=e(this),o.apply(r,arguments)};return o?t.bind(r._buildEventName(n),s,(a.guid=o.guid=o.guid||e.guid++,a)):e.each(n,function(e,i){r.bindToDomElem(t,e,s,i)}),r},bindToDoc:function(t,e,i){return this._needSpecialUnbind=!0,this.bindToDomElem(d,t,e,i)},bindToWin:function(t,n,s){e.isFunction(n)&&(s=n,n=i);var o,r,a=s;return"resize"===t&&(s=function(){var t=window.innerHeight|0+u.outerHeight(),e=window.innerWidth|0+u.outerWidth();r===e&&o===t||(o=t,r=e,a.apply(this,arguments))},s.guid=a.guid=a.guid||e.guid++),this._needSpecialUnbind=!0,this.bindToDomElem(u,t,n,s)},bindTo:function(t,i,n,s){var o=arguments.length;switch(o){case 3:e.isFunction(n)&&(s=n,"object"==typeof i&&(n=i,i=t,t=this.domElem));break;case 2:e.isFunction(i)?(s=i,i=t,t=this.domElem):"string"==typeof t||t instanceof e||(n=i,i=t,t=this.domElem);break;case 1:i=t,t=this.domElem}return"string"==typeof t&&(t=this.elem(t)),this.bindToDomElem(t,i,n,s)},unbindFromDomElem:function(t,e,i){return t.unbind(this._buildEventName(e),i),this},unbindFromDoc:function(t,e){return this.unbindFromDomElem(d,t,e)},unbindFromWin:function(t,e){return this.unbindFromDomElem(u,t,e)},unbindFrom:function(t,i,n){var s=arguments.length;return 1===s?(i=t,t=this.domElem):2===s&&e.isFunction(i)?(n=i,i=t,t=this.domElem):"string"==typeof t&&(t=this.elem(t)),this.unbindFromDomElem(t,i,n)},_buildEventName:function(t){var e=this;return t.indexOf(" ")>1?t.split(" ").map(function(t){return e._buildOneEventName(t)}).join(" "):e._buildOneEventName(t)},_buildOneEventName:function(t){var e=this._eventNameCache;if(t in e)return e[t];var i="."+this._uniqId;if(-1===t.indexOf("."))return e[t]=t+i,e[t];var n=".bem_"+this.__self._name;return e[t]=t.split(".").map(function(t,e){return 0===e?t+n:n+"_"+t}).join("")+i,e[t]},_trigger:function(t,e){this.__base.apply(this,arguments),this._ctxTrigger(t,e)},_ctxTrigger:function(t,i){var n=this,s=_[n.__self._buildCtxEventName(t.type)],o={};s&&n.domElem.each(function(){for(var r=this,a=s.counter;r&&a;){var c=e.identify(r,!0);if(c){if(o[c])break;var h=s.ctxs[c];h&&(e.each(h,function(e,s){s.fn.call(s.ctx||n,t,i)}),a--),o[c]=!0}r=r.parentNode}})},getMods:function(t){var e=t&&"string"!=typeof t,n=this._modCache,s=[].slice.call(arguments,e?1:0),o=this._extractMods(s,e?t:i);return e||(s.length?s.forEach(function(t){n[t]=o[t]}):n=o),o},setMod:function(t,i,n){if(t&&"undefined"!=typeof n&&t.length>1){var s=this;return t.each(function(){var o=e(this);o.__bemElemName=t.__bemElemName,s.setMod(o,i,n)}),s}return this.__base(t,i,n)},_extractModVal:function(t,e,i){var n,s=(e||this.domElem).eq(0);return s.length&&(n=s.attr("class").match(this.__self._buildModValRE(t,i||e))),n?n[2]||!0:""},_extractMods:function(t,e){var i={},n=!t.length,s=0;return((e||this.domElem).eq(0).attr("class").match(this.__self._buildModValRE("("+(n?y:t.join("|"))+")",e,"g"))||[]).forEach(function(t){var e=t.match(E);i[e[1]]=e[2]||!0,++s}),s<t.length&&t.forEach(function(t){t in i||(i[t]="")}),i},_afterSetMod:function(t,i,n,s,o){if(this._isDestructing)return this.__base.apply(this,arguments);var r=this.__self,a=r._buildModClassPrefix(t,o),c=r._buildModValRE(t,o,"g"),h=""===i||i===!1;(s||this.domElem).each(function(){var t=e(this),s=t.attr("class"),o=a;i!==!0&&(o+=k+i),(n===!0?c.test(s):(" "+s).indexOf(" "+a+k)>-1)?t.attr("class",s.replace(c,h?"":"$1"+o)):h||t.addClass(o)}),o&&this.dropElemCache(o,t,n).dropElemCache(o,t,i),this.__base.apply(this,arguments)},findElem:function(t,e,i,n){arguments.length%2?(n=i,i=e,e=t,t=this.domElem):"string"==typeof t&&(t=this.findElem(t)),e=e.split(" ");var s=this.__self.getName(),o=w(i,n),a=[],c=e.map(function(t){return a.push("."+B(s,t,i,n)),t+o}),h=1===c.length,l=r(t,a.join(","));return t===this.domElem&&a.forEach(function(t,i){(this._elemCache[c[i]]=h?l:l.filter(t)).__bemElemName=e[i]},this),l},_elem:function(t,e,i){return this._elemCache[t+w(e,i)]||this.findElem(t,e,i)},elem:function(t,i,n){if(2===arguments.length&&(n=!0),i&&"string"!=typeof i)return i.__bemElemName=t,i;if(t.indexOf(" ")<0)return this._elem(t,i,n);var s=e([]);return t.split(" ").forEach(function(t){s=s.add(this._elem(t,i,n))},this),s},dropElemCache:function(t,e,i){if(t){var n=w(e,i);t.indexOf(" ")<0?delete this._elemCache[t+n]:t.split(" ").forEach(function(t){delete this._elemCache[t+n]},this)}else this._elemCache={};return this},elemParams:function(t){var e;return"string"==typeof t?(e=t,t=this.elem(t)):e=this.__self._extractElemNameFrom(t),c(t[0])[B(this.__self.getName(),e)]||{}},elemify:function(t,i){return(t=e(t)).__bemElemName=i,t},containsDomElem:function(t){var e=!1;return this.domElem.each(function(){return!(e=t.parents().andSelf().index(this)>-1)}),e},buildSelector:function(t,e,i){return this.__self.buildSelector(t,e,i)},destruct:function(t){var i=this,n=i.__self;i._isDestructing||(i._isDestructing=!0,i._needSpecialUnbind&&n.doc.add(n.win).unbind("."+i._uniqId),i.dropElemCache().domElem.each(function(t,i){var n=a(i);e.each(n,function(t,e){var n=m[e.uniqId];n?n._isDestructing||l(n,i):delete p[e.uniqId]}),h(i)}),t||i.domElem.remove(),i.__base(),delete m[i.un()._uniqId],delete i.domElem,delete i._elemCache)}},{scope:null,doc:d,win:u,html:e(document.documentElement),_processLive:function(t){var e=this._liveInitable;if("live"in this){var i="undefined"==typeof e;if(i^t){e=this.live()!==!1;var n=this.getName(),s=this.live;this.live=function(){return this.getName()===n?e:s.apply(this,arguments)}}}return e},init:function(t,i,s){!t||e.isFunction(t)?(s=i,i=t,t=d):"string"==typeof t&&(t=e(t));var o=e.identify();return r(t,".i-bem").each(function(){n(e(this),o)}),i&&this.afterCurrentEvent(function(){i.call(s||this,t)}),this._runAfterCurrentEventFns(),t},destruct:function(t,n,s){"boolean"!=typeof t&&(s=n,n=t,t=i),n&&(S.call(r(n,".i-bem",s)).each(function(t,i){var n=a(this);e.each(n,function(t,e){if(e.uniqId){var n=m[e.uniqId];n?l(n,i):delete p[e.uniqId]}}),h(this)}),t||(s?n.empty():n.remove()))},update:function(t,e,i,n){return this.destruct(t,!0),this.init(t.html(e),i,n)},replace:function(t,i){return this.destruct(!0,t),this.init(e(i).replaceAll(t))},append:function(t,i){return this.init(e(i).appendTo(t))},prepend:function(t,i){return this.init(e(i).prependTo(t))},before:function(t,i){return this.init(e(i).insertBefore(t))},after:function(t,i){return this.init(e(i).insertAfter(t))},_buildCtxEventName:function(t){return this._name+":"+t},_liveClassBind:function(t,i,n,s){var o=this;if(i.indexOf(" ")>-1)i.split(" ").forEach(function(e){o._liveClassBind(t,e,n,s)});else{var r=g[i],a=e.identify(n);r||(r=g[i]={},d.bind(i,o._liveClassTrigger.bind(o))),r=r[t]||(r[t]={uniqIds:{},fns:[]}),a in r.uniqIds||(r.fns.push({uniqId:a,fn:o._buildLiveEventFn(n,s)}),r.uniqIds[a]=r.fns.length-1)}return this},_liveClassUnbind:function(t,i,n){var s=g[i];if(s)if(n){if(s=s[t]){var o=e.identify(n);if(o in s.uniqIds){var r=s.uniqIds[o],a=s.fns.length-1;for(s.fns.splice(r,1);a>r;)s.uniqIds[s.fns[r++].uniqId]=r-1;delete s.uniqIds[o]}}}else delete s[t];return this},_liveClassTrigger:function(t){var i=g[t.type];if(i){var n=t.target,s=Object.keys(i);do for(var o,r=" "+n.className+" ",a=0;o=s[a++];)if(-1!==r.indexOf(" "+o+" ")){var c=!1;if(i[o].fns.forEach(function(i){i.fn.call(e(n),t)===!1&&(c=!0)}),c&&t.preventDefault(),c||t.isPropagationStopped())return;s.splice(--a,1)}while(s.length&&(n=n.parentNode))}},_buildLiveEventFn:function(t,i){var n=this;return function(o){var r=[n._name,((o.data||(o.data={})).domElem=e(this)).closest(n.buildSelector()),!0],a=s.apply(null,i?r.concat([t,o]):r);return a&&!i&&t?t.apply(a,arguments):void 0}},liveInitOnEvent:function(t,e,i){return this.liveBindTo(t,e,i,!0)},liveBindTo:function(t,n,s,o){n&&!e.isFunction(n)||(s=n,n=t,t=i),t&&"string"!=typeof t||(t={elem:t}),t.elemName&&(t.elem=t.elemName);var r=this;return t.elem&&t.elem.indexOf(" ")>0?(t.elem.split(" ").forEach(function(e){r._liveClassBind(B(r._name,e,t.modName,t.modVal),n,s,o)}),r):r._liveClassBind(B(r._name,t.elem,t.modName,t.modVal),n,s,o)},liveUnbindFrom:function(t,n,s){n&&!e.isFunction(n)||(s=n,n=t,t=i);var o=this;return t&&t.indexOf(" ")>1?(t.split(" ").forEach(function(t){o._liveClassUnbind(B(o._name,t),n,s)}),o):o._liveClassUnbind(B(o._name,t),n,s)},_liveInitOnBlockEvent:function(t,e,i,n){var s=this._name;return b[e].on(t,function(t){if(t.block.domElem){var e=arguments,o=t.block[n](s);i&&o.forEach(function(t){i.apply(t,e)})}}),this},liveInitOnBlockEvent:function(t,e,i){return this._liveInitOnBlockEvent(t,e,i,"findBlocksOn")},liveInitOnBlockInsideEvent:function(t,e,i){return this._liveInitOnBlockEvent(t,e,i,"findBlocksOutside")},on:function(t,e,i,n,s){return t.jquery?this._liveCtxBind(t,e,i,n,s):this.__base(t,e,i,n)},un:function(t,e,i,n){return t.jquery?this._liveCtxUnbind(t,e,i,n):this.__base(t,e,i)},liveCtxBind:function(t,e,i,n,s){return this._liveCtxBind(t,e,i,n,s)},_liveCtxBind:function(t,n,s,o,r){var a=this;if("object"==typeof n&&(e.isFunction(s)||e.isFunction(o))&&(n=this._buildModEventName(n)),"string"==typeof n)if(e.isFunction(s)&&(r=o,o=s,s=i),n.indexOf(" ")>-1)n.split(" ").forEach(function(e){a._liveCtxBind(t,e,s,o,r)});else{var c=a._buildCtxEventName(n),h=_[c]||(_[c]={counter:0,ctxs:{}});t.each(function(){var t=e.identify(this),i=h.ctxs[t];i||(i=h.ctxs[t]={},++h.counter),i[e.identify(o)+(r?e.identify(r):"")]={fn:o,data:s,ctx:r}})}else e.each(n,function(e,i){a._liveCtxBind(t,e,i,s)});return a},liveCtxUnbind:function(t,e,i,n){return this._liveCtxUnbind(t,e,i,n)},_liveCtxUnbind:function(t,i,n,s){"object"==typeof i&&e.isFunction(n)&&(i=this._buildModEventName(i));var o=this,r=_[i=o._buildCtxEventName(i)];return r&&(t.each(function(){var t,i=e.identify(this,!0);i&&(t=r.ctxs[i])&&(n&&delete t[e.identify(n)+(s?e.identify(s):"")],n&&!e.isEmptyObject(t)||(r.counter--,delete r.ctxs[i]))}),r.counter||delete _[i]),o},_extractElemNameFrom:function(t){if(t.__bemElemName)return t.__bemElemName;var e=t.eq(0).attr("class").match(this._buildElemNameRE());return e?e[1]:i},extractParams:c,_buildModClassPrefix:function(t,e){return this._name+(e?M+("string"==typeof e?e:this._extractElemNameFrom(e)):"")+k+t},_buildModValRE:function(t,e,i){return new RegExp("(\\s|^)"+this._buildModClassPrefix(t,e)+"(?:"+k+"("+y+"))?(?=\\s|$)",i)},_buildElemNameRE:function(){return new RegExp(this._name+M+"("+y+")(?:\\s|$)")},buildSelector:function(t,e,i){return"."+B(this._name,t,e,i)},getBlockByUniqId:function(t){return m[t]},getWindowSize:function(){return{width:u.width(),height:u.height()}}});e(function(){t.DOM.scope=e("body")})}(BEM,jQuery),BEM.decl("i-bem__dom",{},{liveInitOnBlockInit:function(t,e){return this.liveInitOnBlockEvent("init",t,e)},liveInitOnBlockOutsideEvent:function(t,e,i){return this._liveInitOnBlockEvent(t,e,i,"findBlocksInside")},liveInitOnChannelEvent:function(t,e,i){return this._liveInitOnEmitterEvent(BEM.channel(t),e,i)},liveInitOnDomlessBlockEvent:function(t,e,i){return this._liveInitOnEmitterEvent(BEM.blocks[t],e,i)},_liveInitOnEmitterEvent:function(t,e,i){return t.on(e,function(){var t=$(this.buildSelector());if(t.length){var e=arguments,n=this.getName();t.each(function(t,s){var o=$(s).bem(n);"function"==typeof i&&i.apply(o,e)})}},this),this},liveInitOnBlockInsideElemEvent:function(t,e,i,n){var s=this.buildSelector(t);return this.liveInitOnBlockInsideEvent(e,i,function(t){"function"==typeof n&&t.target.domElem.parents(s).length>0&&n.apply(this,arguments)})},liveInitOnBlockElemEvent:function(t,e,i,n){var s=this.buildSelector(t);return this.liveInitOnBlockInsideEvent(e,i,function(t){"function"==typeof n&&t.target.domElem.is(s)&&n.apply(this,arguments)})}}),function(){var t=!1,e=[];BEM.channel("i-bem").on("init",function(){t=!0;for(var i=0;i<e.length;i++)e[i]()}),BEM.decl("i-bem__dom",{},{decl:function(t,e,i){var n=this.__base.apply(this,arguments);if("string"==typeof t)return n;if(i&&i.liveMod===!1){var s=t.block||t.name;t.modVal?this._liveModList.push({block:s,selector:".i-bem."+BEM.INTERNAL.buildClass(s,t.modName,t.modVal)}):this._liveModList.unshift({block:s,selector:'.i-bem[class*="'+BEM.INTERNAL.buildClass(s,t.modName,!0)+'"]'})}return n},_liveModList:[],ready:function(i){t?i():e.push(i)},_initAdvanced:function(){BEM.channel("i-bem").trigger("start-init"),this.init();for(var t=this._liveModList,e=0;e<t.length;e++){var i=t[e],n=$(i.selector);n.length&&n.each(function(t,e){$(e).bem(i.block)})}BEM.channel("i-bem").trigger("init")}})}(),$(function(){BEM.afterCurrentEvent(function(){BEM.DOM._initAdvanced()})}),jQuery.cookie=function(t,e,i){if("undefined"==typeof e){var n=null;if(document.cookie&&""!=document.cookie)for(var s=document.cookie.split(";"),o=0;o<s.length;o++){var r=jQuery.trim(s[o]);if(r.substring(0,t.length+1)==t+"="){n=decodeURIComponent(r.substring(t.length+1));break}}return n}i=i||{},null===e&&(e="",i.expires=-1);var a="";if(i.expires&&("number"==typeof i.expires||i.expires.toUTCString)){var c;"number"==typeof i.expires?(c=new Date,c.setTime(c.getTime()+24*i.expires*60*60*1e3)):c=i.expires,a="; expires="+c.toUTCString()}var h=i.path?"; path="+i.path:"",l=i.domain?"; domain="+i.domain:"",u=i.secure?"; secure":"";document.cookie=[t,"=",encodeURIComponent(e),a,h,l,u].join("")},function(t){function e(t){return t.replace(/%.{2}/g,function(t){return n[t]||t})}function i(t,i){var n="";try{n=t(i)}catch(s){try{n=t(e(i))}catch(o){n=i}}return n}var n={"%D0":"%D0%A0","%C0":"%D0%90","%C1":"%D0%91","%C2":"%D0%92","%C3":"%D0%93","%C4":"%D0%94","%C5":"%D0%95","%A8":"%D0%81","%C6":"%D0%96","%C7":"%D0%97","%C8":"%D0%98","%C9":"%D0%99","%CA":"%D0%9A","%CB":"%D0%9B","%CC":"%D0%9C","%CD":"%D0%9D","%CE":"%D0%9E","%CF":"%D0%9F","%D1":"%D0%A1","%D2":"%D0%A2","%D3":"%D0%A3","%D4":"%D0%A4","%D5":"%D0%A5","%D6":"%D0%A6","%D7":"%D0%A7","%D8":"%D0%A8","%D9":"%D0%A9","%DA":"%D0%AA","%DB":"%D0%AB","%DC":"%D0%AC","%DD":"%D0%AD","%DE":"%D0%AE","%DF":"%D0%AF","%E0":"%D0%B0","%E1":"%D0%B1","%E2":"%D0%B2","%E3":"%D0%B3","%E4":"%D0%B4","%E5":"%D0%B5","%B8":"%D1%91","%E6":"%D0%B6","%E7":"%D0%B7","%E8":"%D0%B8","%E9":"%D0%B9","%EA":"%D0%BA","%EB":"%D0%BB","%EC":"%D0%BC","%ED":"%D0%BD","%EE":"%D0%BE","%EF":"%D0%BF","%F0":"%D1%80","%F1":"%D1%81","%F2":"%D1%82","%F3":"%D1%83","%F4":"%D1%84","%F5":"%D1%85","%F6":"%D1%86","%F7":"%D1%87","%F8":"%D1%88","%F9":"%D1%89","%FA":"%D1%8A","%FB":"%D1%8B","%FC":"%D1%8C","%FD":"%D1%8D","%FE":"%D1%8E","%FF":"%D1%8F"};t.extend({decodeURI:function(t){return i(decodeURI,t)},decodeURIComponent:function(t){return i(decodeURIComponent,t)}})}(jQuery),function(t){function e(t){return t.replace(/%[0-9a-f]{2}/gi,function(t){return n[t]||t})}function i(t,i){var n=i;try{n=t(i)}catch(s){try{n=t(e(i))}catch(s){}}return n}var n={"%D0":"%D0%A0","%C0":"%D0%90","%C1":"%D0%91","%C2":"%D0%92","%C3":"%D0%93","%C4":"%D0%94","%C5":"%D0%95","%A8":"%D0%81","%C6":"%D0%96","%C7":"%D0%97","%C8":"%D0%98","%C9":"%D0%99","%CA":"%D0%9A","%CB":"%D0%9B","%CC":"%D0%9C","%CD":"%D0%9D","%CE":"%D0%9E","%CF":"%D0%9F","%D1":"%D0%A1","%D2":"%D0%A2","%D3":"%D0%A3","%D4":"%D0%A4","%D5":"%D0%A5","%D6":"%D0%A6","%D7":"%D0%A7","%D8":"%D0%A8","%D9":"%D0%A9","%DA":"%D0%AA","%DB":"%D0%AB","%DC":"%D0%AC","%DD":"%D0%AD","%DE":"%D0%AE","%DF":"%D0%AF","%E0":"%D0%B0","%E1":"%D0%B1","%E2":"%D0%B2","%E3":"%D0%B3","%E4":"%D0%B4","%E5":"%D0%B5","%B8":"%D1%91","%E6":"%D0%B6","%E7":"%D0%B7","%E8":"%D0%B8","%E9":"%D0%B9","%EA":"%D0%BA","%EB":"%D0%BB","%EC":"%D0%BC","%ED":"%D0%BD","%EE":"%D0%BE","%EF":"%D0%BF","%F0":"%D1%80","%F1":"%D1%81","%F2":"%D1%82","%F3":"%D1%83","%F4":"%D1%84","%F5":"%D1%85","%F6":"%D1%86","%F7":"%D1%87","%F8":"%D1%88","%F9":"%D1%89","%FA":"%D1%8A","%FB":"%D1%8B","%FC":"%D1%8C","%FD":"%D1%8D","%FE":"%D1%8E","%FF":"%D1%8F"};t.extend({decodeURI:function(t){return i(decodeURI,t)},decodeURIComponent:function(t){return i(decodeURIComponent,t)}})}(jQuery),function(){function t(t,e){return t.set(e[0],e[1]),t}function e(t,e){return t.add(e),t}function i(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}function n(t,e){for(var i=-1,n=null==t?0:t.length;++i<n&&e(t[i],i,t)!==!1;);return t}function s(t,e){for(var i=-1,n=null==t?0:t.length;++i<n;)if(!e(t[i],i,t))return!1;return!0}function o(t,e){for(var i=-1,n=null==t?0:t.length,s=0,o=[];++i<n;){var r=t[i];e(r,i,t)&&(o[s++]=r)}return o}function r(t,e){var i=null==t?0:t.length;return!!i&&f(t,e,0)>-1}function a(t,e,i){for(var n=-1,s=null==t?0:t.length;++n<s;)if(i(e,t[n]))return!0;return!1}function c(t,e){for(var i=-1,n=null==t?0:t.length,s=Array(n);++i<n;)s[i]=e(t[i],i,t);return s}function h(t,e){for(var i=-1,n=e.length,s=t.length;++i<n;)t[s+i]=e[i];return t}function l(t,e,i,n){var s=-1,o=null==t?0:t.length;for(n&&o&&(i=t[++s]);++s<o;)i=e(i,t[s],s,t);return i}function u(t,e){for(var i=-1,n=null==t?0:t.length;++i<n;)if(e(t[i],i,t))return!0;return!1}function d(t){return t.split("")}function p(t,e,i){var n;return i(t,function(t,i,s){return e(t,i,s)?(n=i,!1):void 0}),n}function m(t,e,i,n){for(var s=t.length,o=i+(n?1:-1);n?o--:++o<s;)if(e(t[o],o,t))return o;return-1}function f(t,e,i){return e===e?P(t,e,i):m(t,_,i)}function _(t){return t!==t}function g(t){return function(e){return null==e?fn:e[t]}}function b(t){return function(e){return null==t?fn:t[e]}}function v(t,e,i,n,s){return s(t,function(t,s,o){i=n?(n=!1,t):e(i,t,s,o)}),i}function y(t,e){var i=t.length;for(t.sort(e);i--;)t[i]=t[i].value;return t}function k(t,e){for(var i=-1,n=Array(t);++i<t;)n[i]=e(i);return n}function M(t){return function(e){return t(e)}}function E(t,e){return c(e,function(e){return t[e]})}function w(t,e){return t.has(e)}function B(t,e){return null==t?fn:t[e]}function x(t){return Qs.test(t)}function S(t){var e=-1,i=Array(t.size);return t.forEach(function(t,n){i[++e]=[n,t]}),i}function C(t,e){return function(i){return t(e(i))}}function I(t){var e=-1,i=Array(t.size);return t.forEach(function(t){i[++e]=t}),i}function P(t,e,i){for(var n=i-1,s=t.length;++n<s;)if(t[n]===e)return n;return-1}function D(t){return x(t)?O(t):po(t)}function T(t){return x(t)?R(t):d(t)}function O(t){for(var e=Gs.lastIndex=0;Gs.test(t);)++e;return e}function R(t){return t.match(Gs)||[]}function N(t){if(Ni(t)&&!Mr(t)&&!(t instanceof j)){if(t instanceof A)return t;if(ko.call(t,"__wrapped__"))return ai(t)}return new A(t)}function L(){}function A(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=fn}function j(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Rn,this.__views__=[]}function F(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function z(){this.__data__=Qo?Qo(null):{},this.size=0}function q(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,
e}function U(t){var e=this.__data__;if(Qo){var i=e[t];return i===vn?fn:i}return ko.call(e,t)?e[t]:fn}function V(t){var e=this.__data__;return Qo?e[t]!==fn:ko.call(e,t)}function H(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=Qo&&e===fn?vn:e,this}function $(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function W(){this.__data__=[],this.size=0}function K(t){var e=this.__data__,i=ft(e,t);if(0>i)return!1;var n=e.length-1;return i==n?e.pop():Oo.call(e,i,1),--this.size,!0}function Y(t){var e=this.__data__,i=ft(e,t);return 0>i?fn:e[i][1]}function G(t){return ft(this.__data__,t)>-1}function Q(t,e){var i=this.__data__,n=ft(i,t);return 0>n?(++this.size,i.push([t,e])):i[n][1]=e,this}function X(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function J(){this.size=0,this.__data__={hash:new F,map:new(Wo||$),string:new F}}function Z(t){var e=Ae(this,t)["delete"](t);return this.size-=e?1:0,e}function tt(t){return Ae(this,t).get(t)}function et(t){return Ae(this,t).has(t)}function it(t,e){var i=Ae(this,t),n=i.size;return i.set(t,e),this.size+=i.size==n?0:1,this}function nt(t){var e=-1,i=null==t?0:t.length;for(this.__data__=new X;++e<i;)this.add(t[e])}function st(t){return this.__data__.set(t,vn),this}function ot(t){return this.__data__.has(t)}function rt(t){var e=this.__data__=new $(t);this.size=e.size}function at(){this.__data__=new $,this.size=0}function ct(t){var e=this.__data__,i=e["delete"](t);return this.size=e.size,i}function ht(t){return this.__data__.get(t)}function lt(t){return this.__data__.has(t)}function ut(t,e){var i=this.__data__;if(i instanceof $){var n=i.__data__;if(!Wo||n.length<gn-1)return n.push([t,e]),this.size=++i.size,this;i=this.__data__=new X(n)}return i.set(t,e),this.size=i.size,this}function dt(t,e){var i=Mr(t),n=!i&&kr(t),s=!i&&!n&&Er(t),o=!i&&!n&&!s&&Br(t),r=i||n||s||o,a=r?k(t.length,String):[],c=a.length;for(var h in t)!e&&!ko.call(t,h)||r&&("length"==h||s&&("offset"==h||"parent"==h)||o&&("buffer"==h||"byteLength"==h||"byteOffset"==h)||We(h,c))||a.push(h);return a}function pt(t,e,i){(i===fn||Ci(t[e],i))&&(i!==fn||e in t)||bt(t,e,i)}function mt(t,e,i){var n=t[e];ko.call(t,e)&&Ci(n,i)&&(i!==fn||e in t)||bt(t,e,i)}function ft(t,e){for(var i=t.length;i--;)if(Ci(t[i][0],e))return i;return-1}function _t(t,e){return t&&ye(e,Xi(e),t)}function gt(t,e){return t&&ye(e,Ji(e),t)}function bt(t,e,i){"__proto__"==e&&Lo?Lo(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}function vt(t,e,i){return t===t&&(i!==fn&&(t=i>=t?t:i),e!==fn&&(t=t>=e?t:e)),t}function yt(t,e,i,s,o,r){var a,c=e&kn,h=e&Mn,l=e&En;if(i&&(a=o?i(t,s,o,r):i(t)),a!==fn)return a;if(!Ri(t))return t;var u=Mr(t);if(u){if(a=Ue(t),!c)return ve(t,a)}else{var d=dr(t),p=d==qn||d==Un;if(Er(t))return he(t,c);if(d==Wn||d==Nn||p&&!o){if(a=h||p?{}:Ve(t),!c)return h?Me(t,gt(a,t)):ke(t,_t(a,t))}else{if(!Js[d])return o?t:{};a=He(t,d,yt,c)}}r||(r=new rt);var m=r.get(t);if(m)return m;r.set(t,a);var f=l?h?Ne:Re:h?Ji:Xi,_=u?fn:f(t);return n(_||t,function(n,s){_&&(s=n,n=t[s]),mt(a,s,yt(n,e,i,s,t,r))}),a}function kt(t,e,i,n){var s=-1,o=r,h=!0,l=t.length,u=[],d=e.length;if(!l)return u;i&&(e=c(e,M(i))),n?(o=a,h=!1):e.length>=gn&&(o=w,h=!1,e=new nt(e));t:for(;++s<l;){var p=t[s],m=null==i?p:i(p);if(p=n||0!==p?p:0,h&&m===m){for(var f=d;f--;)if(e[f]===m)continue t;u.push(p)}else o(e,m,n)||u.push(p)}return u}function Mt(t,e){var i=!0;return rr(t,function(t,n,s){return i=!!e(t,n,s)}),i}function Et(t,e,i,n){var s=t.length;for(i=qi(i),0>i&&(i=-i>s?0:s+i),n=n===fn||n>s?s:qi(n),0>n&&(n+=s),n=i>n?0:Ui(n);n>i;)t[i++]=e;return t}function wt(t,e){var i=[];return rr(t,function(t,n,s){e(t,n,s)&&i.push(t)}),i}function Bt(t,e,i,n,s){var o=-1,r=t.length;for(i||(i=$e),s||(s=[]);++o<r;){var a=t[o];e>0&&i(a)?e>1?Bt(a,e-1,i,n,s):h(s,a):n||(s[s.length]=a)}return s}function xt(t,e){return t&&ar(t,e,Xi)}function St(t,e){return o(e,function(e){return Ti(t[e])})}function Ct(t,e){e=ae(e,t);for(var i=0,n=e.length;null!=t&&n>i;)t=t[oi(e[i++])];return i&&i==n?t:fn}function It(t,e,i){var n=e(t);return Mr(t)?n:h(n,i(t))}function Pt(t){return null==t?t===fn?Zn:$n:No&&No in Object(t)?ze(t):ii(t)}function Dt(t,e){return null!=t&&ko.call(t,e)}function Tt(t,e){return null!=t&&e in Object(t)}function Ot(t,e,i){for(var n=i?a:r,s=t[0].length,o=t.length,h=o,l=Array(o),u=1/0,d=[];h--;){var p=t[h];h&&e&&(p=c(p,M(e))),u=Uo(p.length,u),l[h]=!i&&(e||s>=120&&p.length>=120)?new nt(h&&p):fn}p=t[0];var m=-1,f=l[0];t:for(;++m<s&&d.length<u;){var _=p[m],g=e?e(_):_;if(_=i||0!==_?_:0,!(f?w(f,g):n(d,g,i))){for(h=o;--h;){var b=l[h];if(!(b?w(b,g):n(t[h],g,i)))continue t}f&&f.push(g),d.push(_)}}return d}function Rt(t,e,i,n){return xt(t,function(t,s,o){e(n,i(t),s,o)}),n}function Nt(t){return Ni(t)&&Pt(t)==Nn}function Lt(t,e,i,n,s){return t===e?!0:null==t||null==e||!Ni(t)&&!Ni(e)?t!==t&&e!==e:At(t,e,i,n,Lt,s)}function At(t,e,i,n,s,o){var r=Mr(t),a=Mr(e),c=r?Ln:dr(t),h=a?Ln:dr(e);c=c==Nn?Wn:c,h=h==Nn?Wn:h;var l=c==Wn,u=h==Wn,d=c==h;if(d&&Er(t)){if(!Er(e))return!1;r=!0,l=!1}if(d&&!l)return o||(o=new rt),r||Br(t)?Pe(t,e,i,n,s,o):De(t,e,c,i,n,s,o);if(!(i&wn)){var p=l&&ko.call(t,"__wrapped__"),m=u&&ko.call(e,"__wrapped__");if(p||m){var f=p?t.value():t,_=m?e.value():e;return o||(o=new rt),s(f,_,i,n,o)}}return d?(o||(o=new rt),Te(t,e,i,n,s,o)):!1}function jt(t,e,i,n){var s=i.length,o=s,r=!n;if(null==t)return!o;for(t=Object(t);s--;){var a=i[s];if(r&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++s<o;){a=i[s];var c=a[0],h=t[c],l=a[1];if(r&&a[2]){if(h===fn&&!(c in t))return!1}else{var u=new rt;if(n)var d=n(h,l,c,t,e,u);if(!(d===fn?Lt(l,h,wn|Bn,n,u):d))return!1}}return!0}function Ft(t){if(!Ri(t)||Qe(t))return!1;var e=Ti(t)?Bo:Ss;return e.test(ri(t))}function zt(t){return Ni(t)&&Pt(t)==Gn}function qt(t){return Ni(t)&&Oi(t.length)&&!!Xs[Pt(t)]}function Ut(t){return"function"==typeof t?t:null==t?an:"object"==typeof t?Mr(t)?Kt(t[0],t[1]):Wt(t):un(t)}function Vt(t){if(!Xe(t))return zo(t);var e=[];for(var i in Object(t))ko.call(t,i)&&"constructor"!=i&&e.push(i);return e}function Ht(t){if(!Ri(t))return ei(t);var e=Xe(t),i=[];for(var n in t)("constructor"!=n||!e&&ko.call(t,n))&&i.push(n);return i}function $t(t,e){var i=-1,n=Ii(t)?Array(t.length):[];return rr(t,function(t,s,o){n[++i]=e(t,s,o)}),n}function Wt(t){var e=je(t);return 1==e.length&&e[0][2]?Ze(e[0][0],e[0][1]):function(i){return i===t||jt(i,t,e)}}function Kt(t,e){return Ye(t)&&Je(e)?Ze(oi(t),e):function(i){var n=Yi(i,t);return n===fn&&n===e?Qi(i,t):Lt(e,n,wn|Bn)}}function Yt(t,e,i,n,s){t!==e&&ar(e,function(o,r){if(Ri(o))s||(s=new rt),Gt(t,e,r,i,Yt,n,s);else{var a=n?n(t[r],o,r+"",t,e,s):fn;a===fn&&(a=o),pt(t,r,a)}},Ji)}function Gt(t,e,i,n,s,o,r){var a=t[i],c=e[i],h=r.get(c);if(h)return void pt(t,i,h);var l=o?o(a,c,i+"",t,e,r):fn,u=l===fn;if(u){var d=Mr(c),p=!d&&Er(c),m=!d&&!p&&Br(c);l=c,d||p||m?Mr(a)?l=a:Pi(a)?l=ve(a):p?(u=!1,l=he(c,!0)):m?(u=!1,l=_e(c,!0)):l=[]:Ai(c)||kr(c)?(l=a,kr(a)?l=Hi(a):(!Ri(a)||n&&Ti(a))&&(l=Ve(c))):u=!1}u&&(r.set(c,l),s(l,c,n,o,r),r["delete"](c)),pt(t,i,l)}function Qt(t,e,i){var n=-1;e=c(e.length?e:[an],M(Le()));var s=$t(t,function(t,i,s){var o=c(e,function(e){return e(t)});return{criteria:o,index:++n,value:t}});return y(s,function(t,e){return be(t,e,i)})}function Xt(t,e){return Jt(t,e,function(e,i){return Qi(t,i)})}function Jt(t,e,i){for(var n=-1,s=e.length,o={};++n<s;){var r=e[n],a=Ct(t,r);i(a,r)&&ie(o,ae(r,t),a)}return o}function Zt(t){return function(e){return Ct(e,t)}}function te(t,e,i,n){for(var s=-1,o=qo(Ao((e-t)/(i||1)),0),r=Array(o);o--;)r[n?o:++s]=t,t+=i;return r}function ee(t,e){return pr(ni(t,e,an),t+"")}function ie(t,e,i,n){if(!Ri(t))return t;e=ae(e,t);for(var s=-1,o=e.length,r=o-1,a=t;null!=a&&++s<o;){var c=oi(e[s]),h=i;if(s!=r){var l=a[c];h=n?n(l,c,a):fn,h===fn&&(h=Ri(l)?l:We(e[s+1])?[]:{})}mt(a,c,h),a=a[c]}return t}function ne(t,e,i){var n=-1,s=t.length;0>e&&(e=-e>s?0:s+e),i=i>s?s:i,0>i&&(i+=s),s=e>i?0:i-e>>>0,e>>>=0;for(var o=Array(s);++n<s;)o[n]=t[n+e];return o}function se(t){if("string"==typeof t)return t;if(Mr(t))return c(t,se)+"";if(Fi(t))return sr?sr.call(t):"";var e=t+"";return"0"==e&&1/t==-Pn?"-0":e}function oe(t,e,i){var n=-1,s=r,o=t.length,c=!0,h=[],l=h;if(i)c=!1,s=a;else if(o>=gn){var u=e?null:hr(t);if(u)return I(u);c=!1,s=w,l=new nt}else l=e?[]:h;t:for(;++n<o;){var d=t[n],p=e?e(d):d;if(d=i||0!==d?d:0,c&&p===p){for(var m=l.length;m--;)if(l[m]===p)continue t;e&&l.push(p),h.push(d)}else s(l,p,i)||(l!==h&&l.push(p),h.push(d))}return h}function re(t){return Pi(t)?t:[]}function ae(t,e){return Mr(t)?t:Ye(t,e)?[t]:mr($i(t))}function ce(t,e,i){var n=t.length;return i=i===fn?n:i,!e&&i>=n?t:ne(t,e,i)}function he(t,e){if(e)return t.slice();var i=t.length,n=Io?Io(i):new t.constructor(i);return t.copy(n),n}function le(t){var e=new t.constructor(t.byteLength);return new Co(e).set(new Co(t)),e}function ue(t,e){var i=e?le(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.byteLength)}function de(e,i,n){var s=i?n(S(e),kn):S(e);return l(s,t,new e.constructor)}function pe(t){var e=new t.constructor(t.source,ws.exec(t));return e.lastIndex=t.lastIndex,e}function me(t,i,n){var s=i?n(I(t),kn):I(t);return l(s,e,new t.constructor)}function fe(t){return nr?Object(nr.call(t)):{}}function _e(t,e){var i=e?le(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}function ge(t,e){if(t!==e){var i=t!==fn,n=null===t,s=t===t,o=Fi(t),r=e!==fn,a=null===e,c=e===e,h=Fi(e);if(!a&&!h&&!o&&t>e||o&&r&&c&&!a&&!h||n&&r&&c||!i&&c||!s)return 1;if(!n&&!o&&!h&&e>t||h&&i&&s&&!n&&!o||a&&i&&s||!r&&s||!c)return-1}return 0}function be(t,e,i){for(var n=-1,s=t.criteria,o=e.criteria,r=s.length,a=i.length;++n<r;){var c=ge(s[n],o[n]);if(c){if(n>=a)return c;var h=i[n];return c*("desc"==h?-1:1)}}return t.index-e.index}function ve(t,e){var i=-1,n=t.length;for(e||(e=Array(n));++i<n;)e[i]=t[i];return e}function ye(t,e,i,n){var s=!i;i||(i={});for(var o=-1,r=e.length;++o<r;){var a=e[o],c=n?n(i[a],t[a],a,i,t):fn;c===fn&&(c=t[a]),s?bt(i,a,c):mt(i,a,c)}return i}function ke(t,e){return ye(t,lr(t),e)}function Me(t,e){return ye(t,ur(t),e)}function Ee(t){return ee(function(e,i){var n=-1,s=i.length,o=s>1?i[s-1]:fn,r=s>2?i[2]:fn;for(o=t.length>3&&"function"==typeof o?(s--,o):fn,r&&Ke(i[0],i[1],r)&&(o=3>s?fn:o,s=1),e=Object(e);++n<s;){var a=i[n];a&&t(e,a,n,o)}return e})}function we(t,e){return function(i,n){if(null==i)return i;if(!Ii(i))return t(i,n);for(var s=i.length,o=e?s:-1,r=Object(i);(e?o--:++o<s)&&n(r[o],o,r)!==!1;);return i}}function Be(t){return function(e,i,n){for(var s=-1,o=Object(e),r=n(e),a=r.length;a--;){var c=r[t?a:++s];if(i(o[c],c,o)===!1)break}return e}}function xe(t){return function(e,i,n){var s=Object(e);if(!Ii(e)){var o=Le(i,3);e=Xi(e),i=function(t){return o(s[t],t,s)}}var r=t(e,i,n);return r>-1?s[o?e[r]:r]:fn}}function Se(t,e){return function(i,n){return Rt(i,t,e(n),{})}}function Ce(t){return function(e,i,n){return n&&"number"!=typeof n&&Ke(e,i,n)&&(i=n=fn),e=zi(e),i===fn?(i=e,e=0):i=zi(i),n=n===fn?i>e?1:-1:zi(n),te(e,i,n,t)}}function Ie(t,e,i,n){return t===fn||Ci(t,bo[i])&&!ko.call(n,i)?e:t}function Pe(t,e,i,n,s,o){var r=i&wn,a=t.length,c=e.length;if(a!=c&&!(r&&c>a))return!1;var h=o.get(t);if(h&&o.get(e))return h==e;var l=-1,d=!0,p=i&Bn?new nt:fn;for(o.set(t,e),o.set(e,t);++l<a;){var m=t[l],f=e[l];if(n)var _=r?n(f,m,l,e,t,o):n(m,f,l,t,e,o);if(_!==fn){if(_)continue;d=!1;break}if(p){if(!u(e,function(t,e){return w(p,e)||m!==t&&!s(m,t,i,n,o)?void 0:p.push(e)})){d=!1;break}}else if(m!==f&&!s(m,f,i,n,o)){d=!1;break}}return o["delete"](t),o["delete"](e),d}function De(t,e,i,n,s,o,r){switch(i){case is:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case es:return!(t.byteLength!=e.byteLength||!o(new Co(t),new Co(e)));case jn:case Fn:case Hn:return Ci(+t,+e);case zn:return t.name==e.name&&t.message==e.message;case Gn:case Xn:return t==e+"";case Vn:var a=S;case Qn:var c=n&wn;if(a||(a=I),t.size!=e.size&&!c)return!1;var h=r.get(t);if(h)return h==e;n|=Bn,r.set(t,e);var l=Pe(a(t),a(e),n,s,o,r);return r["delete"](t),l;case Jn:if(nr)return nr.call(t)==nr.call(e)}return!1}function Te(t,e,i,n,s,o){var r=i&wn,a=Re(t),c=a.length,h=Re(e),l=h.length;if(c!=l&&!r)return!1;for(var u=c;u--;){var d=a[u];if(!(r?d in e:ko.call(e,d)))return!1}var p=o.get(t);if(p&&o.get(e))return p==e;var m=!0;o.set(t,e),o.set(e,t);for(var f=r;++u<c;){d=a[u];var _=t[d],g=e[d];if(n)var b=r?n(g,_,d,e,t,o):n(_,g,d,t,e,o);if(!(b===fn?_===g||s(_,g,i,n,o):b)){m=!1;break}f||(f="constructor"==d)}if(m&&!f){var v=t.constructor,y=e.constructor;v!=y&&"constructor"in t&&"constructor"in e&&!("function"==typeof v&&v instanceof v&&"function"==typeof y&&y instanceof y)&&(m=!1)}return o["delete"](t),o["delete"](e),m}function Oe(t){return pr(ni(t,fn,pi),t+"")}function Re(t){return It(t,Xi,lr)}function Ne(t){return It(t,Ji,ur)}function Le(){var t=N.iteratee||cn;return t=t===cn?Ut:t,arguments.length?t(arguments[0],arguments[1]):t}function Ae(t,e){var i=t.__data__;return Ge(e)?i["string"==typeof e?"string":"hash"]:i.map}function je(t){for(var e=Xi(t),i=e.length;i--;){var n=e[i],s=t[n];e[i]=[n,s,Je(s)]}return e}function Fe(t,e){var i=B(t,e);return Ft(i)?i:fn}function ze(t){var e=ko.call(t,No),i=t[No];try{t[No]=fn;var n=!0}catch(s){}var o=Eo.call(t);return n&&(e?t[No]=i:delete t[No]),o}function qe(t,e,i){e=ae(e,t);for(var n=-1,s=e.length,o=!1;++n<s;){var r=oi(e[n]);if(!(o=null!=t&&i(t,r)))break;t=t[r]}return o||++n!=s?o:(s=null==t?0:t.length,!!s&&Oi(s)&&We(r,s)&&(Mr(t)||kr(t)))}function Ue(t){var e=t.length,i=t.constructor(e);return e&&"string"==typeof t[0]&&ko.call(t,"index")&&(i.index=t.index,i.input=t.input),i}function Ve(t){return"function"!=typeof t.constructor||Xe(t)?{}:or(Po(t))}function He(t,e,i,n){var s=t.constructor;switch(e){case es:return le(t);case jn:case Fn:return new s(+t);case is:return ue(t,n);case ns:case ss:case os:case rs:case as:case cs:case hs:case ls:case us:return _e(t,n);case Vn:return de(t,n,i);case Hn:case Xn:return new s(t);case Gn:return pe(t);case Qn:return me(t,n,i);case Jn:return fe(t)}}function $e(t){return Mr(t)||kr(t)||!!(Ro&&t&&t[Ro])}function We(t,e){return e=null==e?Dn:e,!!e&&("number"==typeof t||Is.test(t))&&t>-1&&t%1==0&&e>t}function Ke(t,e,i){if(!Ri(i))return!1;var n=typeof e;return("number"==n?Ii(i)&&We(e,i.length):"string"==n&&e in i)?Ci(i[e],t):!1}function Ye(t,e){if(Mr(t))return!1;var i=typeof t;return"number"==i||"symbol"==i||"boolean"==i||null==t||Fi(t)?!0:gs.test(t)||!_s.test(t)||null!=e&&t in Object(e)}function Ge(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}function Qe(t){return!!Mo&&Mo in t}function Xe(t){var e=t&&t.constructor,i="function"==typeof e&&e.prototype||bo;return t===i}function Je(t){return t===t&&!Ri(t)}function Ze(t,e){return function(i){return null==i?!1:i[t]===e&&(e!==fn||t in Object(i))}}function ti(t){var e=Bi(t,function(t){return i.size===yn&&i.clear(),t}),i=e.cache;return e}function ei(t){var e=[];if(null!=t)for(var i in Object(t))e.push(i);return e}function ii(t){return Eo.call(t)}function ni(t,e,n){return e=qo(e===fn?t.length-1:e,0),function(){for(var s=arguments,o=-1,r=qo(s.length-e,0),a=Array(r);++o<r;)a[o]=s[e+o];o=-1;for(var c=Array(e+1);++o<e;)c[o]=s[o];return c[e]=n(a),i(t,this,c)}}function si(t){var e=0,i=0;return function(){var n=Vo(),s=In-(n-i);if(i=n,s>0){if(++e>=Cn)return arguments[0]}else e=0;return t.apply(fn,arguments)}}function oi(t){if("string"==typeof t||Fi(t))return t;var e=t+"";return"0"==e&&1/t==-Pn?"-0":e}function ri(t){if(null!=t){try{return yo.call(t)}catch(e){}try{return t+""}catch(e){}}return""}function ai(t){if(t instanceof j)return t.clone();var e=new A(t.__wrapped__,t.__chain__);return e.__actions__=ve(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}function ci(t){for(var e=-1,i=null==t?0:t.length,n=0,s=[];++e<i;){var o=t[e];o&&(s[n++]=o)}return s}function hi(t,e,i){var n=null==t?0:t.length;return n?(e=i||e===fn?1:qi(e),e=n-e,ne(t,0,0>e?0:e)):[]}function li(t,e,i,n){var s=null==t?0:t.length;return s?(i&&"number"!=typeof i&&Ke(t,e,i)&&(i=0,n=s),Et(t,e,i,n)):[]}function ui(t,e,i){var n=null==t?0:t.length;if(!n)return-1;var s=null==i?0:qi(i);return 0>s&&(s=qo(n+s,0)),m(t,Le(e,3),s)}function di(t,e,i){var n=null==t?0:t.length;if(!n)return-1;var s=n-1;return i!==fn&&(s=qi(i),s=0>i?qo(n+s,0):Uo(s,n-1)),m(t,Le(e,3),s,!0)}function pi(t){var e=null==t?0:t.length;return e?Bt(t,1):[]}function mi(t,e,i){var n=null==t?0:t.length;if(!n)return-1;var s=null==i?0:qi(i);return 0>s&&(s=qo(n+s,0)),f(t,e,s)}function fi(t){var e=null==t?0:t.length;return e?t[e-1]:fn}function _i(t,e,i){return t&&t.length?(e=i||e===fn?1:qi(e),ne(t,0,0>e?0:e)):[]}function gi(t){return t&&t.length?oe(t):[]}function bi(t,e,i){var n=Mr(t)?s:Mt;return i&&Ke(t,e,i)&&(e=fn),n(t,Le(e,3))}function vi(t,e){var i=Mr(t)?o:wt;return i(t,Le(e,3))}function yi(t,e){var i=Mr(t)?n:rr;return i(t,Le(e,3))}function ki(t,e,i,n){t=Ii(t)?t:tn(t),i=i&&!n?qi(i):0;var s=t.length;return 0>i&&(i=qo(s+i,0)),ji(t)?s>=i&&t.indexOf(e,i)>-1:!!s&&f(t,e,i)>-1}function Mi(t,e){var i=Mr(t)?c:$t;return i(t,Le(e,3))}function Ei(t,e,i){var n=Mr(t)?l:v,s=arguments.length<3;return n(t,Le(e,4),i,s,rr)}function wi(t){if(null==t)return 0;if(Ii(t))return ji(t)?D(t):t.length;var e=dr(t);return e==Vn||e==Qn?t.size:Vt(t).length}function Bi(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(bn);var i=function(){var n=arguments,s=e?e.apply(this,n):n[0],o=i.cache;if(o.has(s))return o.get(s);var r=t.apply(this,n);return i.cache=o.set(s,r)||o,r};return i.cache=new(Bi.Cache||X),i}function xi(t){return yt(t,En)}function Si(t){return yt(t,kn|En)}function Ci(t,e){return t===e||t!==t&&e!==e}function Ii(t){return null!=t&&Oi(t.length)&&!Ti(t)}function Pi(t){return Ni(t)&&Ii(t)}function Di(t){if(null==t)return!0;if(Ii(t)&&(Mr(t)||"string"==typeof t||"function"==typeof t.splice||Er(t)||Br(t)||kr(t)))return!t.length;var e=dr(t);if(e==Vn||e==Qn)return!t.size;if(Xe(t))return!Vt(t).length;for(var i in t)if(ko.call(t,i))return!1;return!0}function Ti(t){if(!Ri(t))return!1;var e=Pt(t);return e==qn||e==Un||e==An||e==Yn}function Oi(t){return"number"==typeof t&&t>-1&&t%1==0&&Dn>=t}function Ri(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function Ni(t){return null!=t&&"object"==typeof t}function Li(t){return"number"==typeof t||Ni(t)&&Pt(t)==Hn}function Ai(t){if(!Ni(t)||Pt(t)!=Wn)return!1;var e=Po(t);if(null===e)return!0;var i=ko.call(e,"constructor")&&e.constructor;return"function"==typeof i&&i instanceof i&&yo.call(i)==wo}function ji(t){return"string"==typeof t||!Mr(t)&&Ni(t)&&Pt(t)==Xn}function Fi(t){return"symbol"==typeof t||Ni(t)&&Pt(t)==Jn}function zi(t){if(!t)return 0===t?t:0;if(t=Vi(t),t===Pn||t===-Pn){var e=0>t?-1:1;return e*Tn}return t===t?t:0}function qi(t){var e=zi(t),i=e%1;return e===e?i?e-i:e:0}function Ui(t){return t?vt(qi(t),0,Rn):0}function Vi(t){if("number"==typeof t)return t;if(Fi(t))return On;if(Ri(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=Ri(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(ks,"");var i=xs.test(t);return i||Cs.test(t)?eo(t.slice(2),i?2:8):Bs.test(t)?On:+t}function Hi(t){return ye(t,Ji(t))}function $i(t){return null==t?"":se(t)}function Wi(t,e){return p(t,Le(e,3),xt)}function Ki(t,e){return t&&xt(t,Le(e,3))}function Yi(t,e,i){var n=null==t?fn:Ct(t,e);return n===fn?i:n}function Gi(t,e){return null!=t&&qe(t,e,Dt)}function Qi(t,e){return null!=t&&qe(t,e,Tt)}function Xi(t){return Ii(t)?dt(t):Vt(t)}function Ji(t){return Ii(t)?dt(t,!0):Ht(t)}function Zi(t,e,i){var s=Mr(t),o=s||Er(t)||Br(t);if(e=Le(e,4),null==i){var r=t&&t.constructor;i=o?s?new r:[]:Ri(t)&&Ti(r)?or(Po(t)):{}}return(o?n:xt)(t,function(t,n,s){return e(i,t,n,s)}),i}function tn(t){return null==t?[]:E(t,Xi(t))}function en(t){return t=$i(t),t&&fs.test(t)?t.replace(ps,mo):t}function nn(t,e,i){return i||null==e?e=0:e&&(e=+e),Ho($i(t).replace(Ms,""),e||0)}function sn(t,e){var i=xn,n=Sn;if(Ri(e)){var s="separator"in e?e.separator:s;i="length"in e?qi(e.length):i,n="omission"in e?se(e.omission):n}t=$i(t);var o=t.length;if(x(t)){var r=T(t);o=r.length}if(i>=o)return t;var a=i-D(n);if(1>a)return n;var c=r?ce(r,0,a).join(""):t.slice(0,a);if(s===fn)return c+n;if(r&&(a+=c.length-a),wr(s)){if(t.slice(a).search(s)){var h,l=c;for(s.global||(s=RegExp(s.source,$i(ws.exec(s))+"g")),s.lastIndex=0;h=s.exec(l);)var u=h.index;c=c.slice(0,u===fn?a:u)}}else if(t.indexOf(se(s),a)!=a){var d=c.lastIndexOf(s);d>-1&&(c=c.slice(0,d))}return c+n}function on(t){return t=$i(t),t&&ms.test(t)?t.replace(ds,fo):t}function rn(t){return function(){return t}}function an(t){return t}function cn(t){return Ut("function"==typeof t?t:yt(t,kn))}function hn(t,e,i){var s=Xi(e),o=St(e,s);null!=i||Ri(e)&&(o.length||!s.length)||(i=e,e=t,t=this,o=St(e,Xi(e)));var r=!(Ri(i)&&"chain"in i&&!i.chain),a=Ti(t);return n(o,function(i){var n=e[i];t[i]=n,a&&(t.prototype[i]=function(){var e=this.__chain__;if(r||e){var i=t(this.__wrapped__),s=i.__actions__=ve(this.__actions__);return s.push({func:n,args:arguments,thisArg:t}),i.__chain__=e,i}return n.apply(t,h([this.value()],arguments))})}),t}function ln(){}function un(t){return Ye(t)?g(oi(t)):Zt(t)}function dn(){return[]}function pn(){return!1}function mn(t,e){if(t=qi(t),1>t||t>Dn)return[];var i=Rn,n=Uo(t,Rn);e=Le(e),t-=Rn;for(var s=k(n,e);++i<t;)e(i);return s}var fn,_n="4.17.4",gn=200,bn="Expected a function",vn="__lodash_hash_undefined__",yn=500,kn=1,Mn=2,En=4,wn=1,Bn=2,xn=30,Sn="...",Cn=800,In=16,Pn=1/0,Dn=9007199254740991,Tn=1.7976931348623157e308,On=NaN,Rn=4294967295,Nn="[object Arguments]",Ln="[object Array]",An="[object AsyncFunction]",jn="[object Boolean]",Fn="[object Date]",zn="[object Error]",qn="[object Function]",Un="[object GeneratorFunction]",Vn="[object Map]",Hn="[object Number]",$n="[object Null]",Wn="[object Object]",Kn="[object Promise]",Yn="[object Proxy]",Gn="[object RegExp]",Qn="[object Set]",Xn="[object String]",Jn="[object Symbol]",Zn="[object Undefined]",ts="[object WeakMap]",es="[object ArrayBuffer]",is="[object DataView]",ns="[object Float32Array]",ss="[object Float64Array]",os="[object Int8Array]",rs="[object Int16Array]",as="[object Int32Array]",cs="[object Uint8Array]",hs="[object Uint8ClampedArray]",ls="[object Uint16Array]",us="[object Uint32Array]",ds=/&(?:amp|lt|gt|quot|#39);/g,ps=/[&<>"']/g,ms=RegExp(ds.source),fs=RegExp(ps.source),_s=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,gs=/^\w*$/,bs=/^\./,vs=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ys=/[\\^$.*+?()[\]{}|]/g,ks=/^\s+|\s+$/g,Ms=/^\s+/,Es=/\\(\\)?/g,ws=/\w*$/,Bs=/^[-+]0x[0-9a-f]+$/i,xs=/^0b[01]+$/i,Ss=/^\[object .+?Constructor\]$/,Cs=/^0o[0-7]+$/i,Is=/^(?:0|[1-9]\d*)$/,Ps="\\ud800-\\udfff",Ds="\\u0300-\\u036f",Ts="\\ufe20-\\ufe2f",Os="\\u20d0-\\u20ff",Rs=Ds+Ts+Os,Ns="\\ufe0e\\ufe0f",Ls="["+Ps+"]",As="["+Rs+"]",js="\\ud83c[\\udffb-\\udfff]",Fs="(?:"+As+"|"+js+")",zs="[^"+Ps+"]",qs="(?:\\ud83c[\\udde6-\\uddff]){2}",Us="[\\ud800-\\udbff][\\udc00-\\udfff]",Vs="\\u200d",Hs=Fs+"?",$s="["+Ns+"]?",Ws="(?:"+Vs+"(?:"+[zs,qs,Us].join("|")+")"+$s+Hs+")*",Ks=$s+Hs+Ws,Ys="(?:"+[zs+As+"?",As,qs,Us,Ls].join("|")+")",Gs=RegExp(js+"(?="+js+")|"+Ys+Ks,"g"),Qs=RegExp("["+Vs+Ps+Rs+Ns+"]"),Xs={};Xs[ns]=Xs[ss]=Xs[os]=Xs[rs]=Xs[as]=Xs[cs]=Xs[hs]=Xs[ls]=Xs[us]=!0,Xs[Nn]=Xs[Ln]=Xs[es]=Xs[jn]=Xs[is]=Xs[Fn]=Xs[zn]=Xs[qn]=Xs[Vn]=Xs[Hn]=Xs[Wn]=Xs[Gn]=Xs[Qn]=Xs[Xn]=Xs[ts]=!1;var Js={};Js[Nn]=Js[Ln]=Js[es]=Js[is]=Js[jn]=Js[Fn]=Js[ns]=Js[ss]=Js[os]=Js[rs]=Js[as]=Js[Vn]=Js[Hn]=Js[Wn]=Js[Gn]=Js[Qn]=Js[Xn]=Js[Jn]=Js[cs]=Js[hs]=Js[ls]=Js[us]=!0,Js[zn]=Js[qn]=Js[ts]=!1;var Zs={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},to={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},eo=nn,io="object"==typeof global&&global&&global.Object===Object&&global,no="object"==typeof self&&self&&self.Object===Object&&self,so=io||no||Function("return this")(),oo="object"==typeof exports&&exports&&!exports.nodeType&&exports,ro=oo&&"object"==typeof module&&module&&!module.nodeType&&module,ao=ro&&ro.exports===oo,co=ao&&io.process,ho=function(){try{return co&&co.binding&&co.binding("util")}catch(t){}}(),lo=ho&&ho.isRegExp,uo=ho&&ho.isTypedArray,po=g("length"),mo=b(Zs),fo=b(to),_o=Array.prototype,go=Function.prototype,bo=Object.prototype,vo=so["__core-js_shared__"],yo=go.toString,ko=bo.hasOwnProperty,Mo=function(){var t=/[^.]+$/.exec(vo&&vo.keys&&vo.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Eo=bo.toString,wo=yo.call(Object),Bo=RegExp("^"+yo.call(ko).replace(ys,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),xo=ao?so.Buffer:fn,So=so.Symbol,Co=so.Uint8Array,Io=xo?xo.allocUnsafe:fn,Po=C(Object.getPrototypeOf,Object),Do=Object.create,To=bo.propertyIsEnumerable,Oo=_o.splice,Ro=So?So.isConcatSpreadable:fn,No=So?So.toStringTag:fn,Lo=function(){try{var t=Fe(Object,"defineProperty");return t({},"",{}),t}catch(e){}}(),Ao=Math.ceil,jo=Object.getOwnPropertySymbols,Fo=xo?xo.isBuffer:fn,zo=C(Object.keys,Object),qo=Math.max,Uo=Math.min,Vo=Date.now,Ho=so.parseInt,$o=Fe(so,"DataView"),Wo=Fe(so,"Map"),Ko=Fe(so,"Promise"),Yo=Fe(so,"Set"),Go=Fe(so,"WeakMap"),Qo=Fe(Object,"create"),Xo=ri($o),Jo=ri(Wo),Zo=ri(Ko),tr=ri(Yo),er=ri(Go),ir=So?So.prototype:fn,nr=ir?ir.valueOf:fn,sr=ir?ir.toString:fn,or=function(){function t(){}return function(e){if(!Ri(e))return{};if(Do)return Do(e);t.prototype=e;var i=new t;return t.prototype=fn,i}}();N.prototype=L.prototype,N.prototype.constructor=N,A.prototype=or(L.prototype),A.prototype.constructor=A,j.prototype=or(L.prototype),j.prototype.constructor=j,F.prototype.clear=z,F.prototype["delete"]=q,F.prototype.get=U,F.prototype.has=V,F.prototype.set=H,$.prototype.clear=W,$.prototype["delete"]=K,$.prototype.get=Y,$.prototype.has=G,$.prototype.set=Q,X.prototype.clear=J,X.prototype["delete"]=Z,X.prototype.get=tt,X.prototype.has=et,X.prototype.set=it,nt.prototype.add=nt.prototype.push=st,nt.prototype.has=ot,rt.prototype.clear=at,rt.prototype["delete"]=ct,rt.prototype.get=ht,rt.prototype.has=lt,rt.prototype.set=ut;var rr=we(xt),ar=Be(),cr=Lo?function(t,e){return Lo(t,"toString",{configurable:!0,enumerable:!1,value:rn(e),writable:!0})}:an,hr=Yo&&1/I(new Yo([,-0]))[1]==Pn?function(t){return new Yo(t)}:ln,lr=jo?function(t){return null==t?[]:(t=Object(t),o(jo(t),function(e){return To.call(t,e)}))}:dn,ur=jo?function(t){for(var e=[];t;)h(e,lr(t)),t=Po(t);return e}:dn,dr=Pt;($o&&dr(new $o(new ArrayBuffer(1)))!=is||Wo&&dr(new Wo)!=Vn||Ko&&dr(Ko.resolve())!=Kn||Yo&&dr(new Yo)!=Qn||Go&&dr(new Go)!=ts)&&(dr=function(t){var e=Pt(t),i=e==Wn?t.constructor:fn,n=i?ri(i):"";if(n)switch(n){case Xo:return is;case Jo:return Vn;case Zo:return Kn;case tr:return Qn;case er:return ts}return e});var pr=si(cr),mr=ti(function(t){var e=[];return bs.test(t)&&e.push(""),t.replace(vs,function(t,i,n,s){e.push(n?s.replace(Es,"$1"):i||t)}),e}),fr=ee(function(t,e){return Pi(t)?kt(t,Bt(e,1,Pi,!0)):[]}),_r=ee(function(t){var e=c(t,re);return e.length&&e[0]===t[0]?Ot(e):[]}),gr=ee(function(t,e){return Pi(t)?kt(t,e):[]}),br=xe(ui),vr=xe(di),yr=ee(function(t,e){if(null==t)return[];var i=e.length;return i>1&&Ke(t,e[0],e[1])?e=[]:i>2&&Ke(e[0],e[1],e[2])&&(e=[e[0]]),Qt(t,Bt(e,1),[])});Bi.Cache=X;var kr=Nt(function(){return arguments}())?Nt:function(t){return Ni(t)&&ko.call(t,"callee")&&!To.call(t,"callee")},Mr=Array.isArray,Er=Fo||pn,wr=lo?M(lo):zt,Br=uo?M(uo):qt,xr=Ee(function(t,e){if(Xe(e)||Ii(e))return void ye(e,Xi(e),t);for(var i in e)ko.call(e,i)&&mt(t,i,e[i])}),Sr=Ee(function(t,e){ye(e,Ji(e),t)}),Cr=Ee(function(t,e,i,n){ye(e,Ji(e),t,n)}),Ir=ee(function(t){return t.push(fn,Ie),i(Cr,fn,t)}),Pr=Se(function(t,e,i){t[e]=i},rn(an)),Dr=Ee(function(t,e,i){Yt(t,e,i)}),Tr=Oe(function(t,e){return null==t?{}:Xt(t,e)}),Or=Ce();N.assign=xr,N.assignIn=Sr,N.assignInWith=Cr,N.compact=ci,N.constant=rn,N.defaults=Ir,N.difference=fr,N.dropRight=hi,N.fill=li,N.filter=vi,N.flatten=pi,N.intersection=_r,N.invert=Pr,N.iteratee=cn,N.keys=Xi,N.keysIn=Ji,N.map=Mi,N.memoize=Bi,N.merge=Dr,N.mixin=hn,N.pick=Tr,N.property=un,N.range=Or,N.sortBy=yr,N.take=_i,N.toPlainObject=Hi,N.transform=Zi,N.uniq=gi,N.values=tn,N.without=gr,N.extend=Sr,N.extendWith=Cr,N.clone=xi,N.cloneDeep=Si,N.eq=Ci,N.escape=en,N.every=bi,N.find=br,N.findIndex=ui,N.findKey=Wi,N.findLast=vr,N.findLastIndex=di,N.forEach=yi,N.forOwn=Ki,N.get=Yi,N.has=Gi,N.hasIn=Qi,N.identity=an,N.includes=ki,N.indexOf=mi,N.isArguments=kr,N.isArray=Mr,N.isArrayLike=Ii,N.isArrayLikeObject=Pi,N.isBuffer=Er,N.isEmpty=Di,N.isFunction=Ti,N.isLength=Oi,N.isNumber=Li,N.isObject=Ri,N.isObjectLike=Ni,N.isPlainObject=Ai,N.isRegExp=wr,N.isString=ji,N.isSymbol=Fi,N.isTypedArray=Br,N.last=fi,N.stubArray=dn,N.stubFalse=pn,N.noop=ln,N.parseInt=nn,N.reduce=Ei,N.size=wi,N.times=mn,N.toFinite=zi,N.toInteger=qi,N.toLength=Ui,N.toNumber=Vi,N.toString=$i,N.truncate=sn,N.unescape=on,N.each=yi,N.VERSION=_n,"function"==typeof define&&"object"==typeof define.amd&&define.amd?(so._=N,define(function(){return N})):ro?((ro.exports=N)._=N,oo._=N):so._=N}.call(this),BEM.DOM.decl("i-global",{onSetMod:{js:{inited:function(){this.del(this.__self._params=$.extend({},this.params),"uniqId","name");var t=this.__self._params;t["passport-msg"]||(t["passport-msg"]=t.id),void 0===t["show-counters"]&&(t["show-counters"]=Math.round(100*Math.random())<=t["show-counters-percent"]),t.locale=t.lang,window.BEMHTML&&BEMHTML.apply({block:"i-global",params:t})}}},getDefaultParams:function(){return{id:"",login:Lego.isSessionValid()?$.cookie("yandex_login")||"":"",yandexuid:$.cookie("yandexuid"),lang:"ru",tld:"ru",retpath:encodeURI($.decodeURI(location.href)),"passport-host":"https://passport.yandex.ru","pass-host":"https://pass.yandex.ru","social-host":"https://social.yandex.ru","lego-path":"/lego","show-counters-percent":100}}},{param:function(t,e){return"undefined"==typeof e?(this._params||{})[t]:void(this._params&&(this._params[t]=e))}}),BEM.DOM.decl("i-global",{},{setParams:function(t){this._params=this._params||{},$.extend(!0,this._params,t)},getBlockParams:function(t,e){var i=$(t).data("bem");return i?i[e]:!1}}),function(t){t||(t=window.Lego={}),t.getCookie=function(t){var e=document.cookie;if(e.length<1)return!1;var i=e.indexOf(t+"=");if(-1===i)return!1;i+=t.length+1;var n=e.indexOf(";",i);return decodeURIComponent(-1===n?e.substring(i):e.substring(i,n))}}(window.Lego),function(t,e){e||(e=window.Lego={}),e.init||(e.init=function(i){return(i=e.params=t.extend({id:"",login:e.isSessionValid()?e.getCookie("yandex_login")||"":"",yandexuid:e.getCookie("yandexuid"),locale:"ru",retpath:window.location.toString(),"passport-host":"https://passport.yandex.ru","pass-host":"https://pass.yandex.ru","passport-msg":i.id,"social-host":"https://social.yandex.ru","lego-path":"/lego","show-counters-percent":100},i,e.params))["show-counters"]=Math.round(100*Math.random())<=i["show-counters-percent"],BEM.blocks["i-global"]._params||t.extend(BEM.blocks["i-global"]._params={},i),i}),e.block||(e.block={}),e.blockInit||(e.blockInit=function(i,n){i=i||document,n=n||".g-js",t(i).find(n).each(function(){var i=t(this),n=i.data("bem")||(this.onclick?this.onclick():{}),s=n.name||"",o=e.block[s];o&&!i.data(s)&&(o.call(i,n),i.data(s,!0).addClass(s+"_js_inited"))})}),e.blockInitBinded||(e.blockInitBinded=Boolean(t(document).ready(function(){e.blockInit()})))}(jQuery,window.Lego),function(t){t||(t=window.Lego={}),t.isSessionValid=function(){return Boolean(t.getCookie("yandex_login"))}}(window.Lego),BEM.decl("i-global__utils",{},{_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",base64Encode:function(t,e){e=e||1e6;var i,n,s,o,r,a,c,h="",l=0;for(t=this._utf8_encode(t,3*e/4|0);l<t.length;)i=t.charCodeAt(l++),n=t.charCodeAt(l++),s=t.charCodeAt(l++),o=i>>2,r=(3&i)<<4|n>>4,a=(15&n)<<2|s>>6,c=63&s,isNaN(n)?a=c=64:isNaN(s)&&(c=64),h=h+this._keyStr.charAt(o)+this._keyStr.charAt(r)+this._keyStr.charAt(a)+this._keyStr.charAt(c);return h},_utf8_encode:function(t,e){t=t.replace(/\r\n/g,"\n");for(var i,n="",s=0;s<t.length;s++){var o=t.charCodeAt(s);if(128>o?i=String.fromCharCode(o):o>127&&2048>o?(i=String.fromCharCode(o>>6|192),
i+=String.fromCharCode(63&o|128)):(i=String.fromCharCode(o>>12|224),i+=String.fromCharCode(o>>6&63|128),i+=String.fromCharCode(63&o|128)),n.length+i.length>e)break;n+=i}return n},decodeEntities:function(t){return t.replace(/&(lt|gt|quot|apos|amp);/g,function(t,e){return{lt:"<",gt:">",quot:'"',apos:"'",amp:"&"}[e]})},ampUnescape:function(t){return"string"==typeof t?t.replace(/\&amp;/g,"&"):""},ampUnescapeInHTMLContent:function(t){return"string"==typeof t?t.replace(/(>[^<]+&amp;[^>]+<)/g,this.ampUnescape):""}}),BEM.DOM.decl("i-global",{},{getFlag:function(t){var e=this.param("expFlags");return e||(e=this.getBlockParams(this.buildSelector(),this.getName()).expFlags||{},this.setParams({expFlags:e})),e[t]}}),BEM.decl("offline-request",{_initOffline:function(){this.__self._isOnlineDetectAllowed&&this.bindEvents()},bindEvents:function(){this._onChangeNetworkStatus=this._onChangeNetworkStatus.bind(this),window.addEventListener("online",this._onChangeNetworkStatus),window.addEventListener("offline",this._onChangeNetworkStatus)},unbindEvents:function(){window.removeEventListener("online",this._onChangeNetworkStatus),window.removeEventListener("offline",this._onChangeNetworkStatus)},_onChangeNetworkStatus:$.noop},{_isOnlineDetectAllowed:"undefined"!=typeof window.navigator.onLine,isOnline:function(){return this._isOnlineDetectAllowed?window.navigator.onLine:!0}}),BEM.decl({block:"counter",baseBlock:"offline-request"},{_dict:{}}),function(){var t={all:"136",auto:"227",any:"146",big:"148",bing:"568",black:"201",blue:"198",bottom:"668",bw:"666",cbir:"1031",ces:"1057",clear:"477",click:"882",clipart:"758",close:"486",color:"169",commercial:"2043",copyright:"1305",collections:"2177",customize:"178",cyan:"197",demotivator:"760",duplicates:"269",face:"276",facebook:"520",fade:"1059",filter:"220",filters:"618",format:"675",fotki:"174",fresh:"598",fullscreen:"665",gif:"677",google:"66",gray:"733",green:"196",horizontal:"672",image:"8",images:"277",imgclick:"835",index:"629",iorient:"671",isize:"145",jpg:"676",keyboard:"492",large:"157",lineart:"759",list:"436",medium:"149",message:"1304",moderate:"681",more:"75",mouse:"491",navig:"208","new":"228",next:"407",normal:"141",nps:"1056",odnoklassniki:"526",off:"11",on:"10",open:"842",orange:"194",othersize:"924",p0:"85",p1:"86",p10:"95",p11:"96",p12:"97",p13:"98",p14:"99",p15:"100",p16:"101",p17:"102",p18:"103",p19:"104",p2:"87",p20:"105",p3:"88",p4:"89",p5:"90",p6:"91",p7:"92",p8:"93",p9:"94",page:"143",photo:"275",picsearch:"173",pinterest:"1009",play:"331",png:"679",prev:"406",preview:"670",promo:"714",red:"193",related_query:"391",result:"884",results:"241",save:"691",scroll:"768",search:"153","search-by-image":"1277",serp:"471",share:"599",shop:"1055",show:"487",similar:"469",site:"202",slideshow:"479",small:"150",soo:"65",square:"674",stop:"529",tags:"2092",thumb:"184",top:"77",twitter:"521",type:"76",url:"13",user:"538",vertical:"673",violet:"199",visiblefresh:"639",vkontakte:"496",wallpaper:"158",wallpaper_category:"1129",week:"796",white:"200",yellow:"195",video:"231",maps:"23",market:"4",music:"56",loaded:"1007",ads:"991",categories:"1429",px500:"1224",submit:"297",width:"1473",height:"1474",time:"207",hover:"858",abuse:"1436",sticky:"1578",pad:"1667",footer:"295",default_search:"1620",popup_close:"1781",porno:"1499",error:"1030",install:"705",inline_home_set:"1918",incut:"1073",behavioral:"1999",context:"60",item:"22",title:"82",link:"513",button:"440",direct:"155",browser_yandex:"935",disk:"1032",discard:"2737",disclaimer:"2538",radio:"1079",mobile:"1006",mobile_browsers_ipad:"1013",mobile_browsers_android:"1014",thmb_speed:"1045",wp:"895",element:"1518",set:"1920",inline_set:"1651",home:"1319",inline_home:"1870",vb:"1921",inline_vb:"1652",middle:"2028",head:"175",login:"290",login_input:"2343",suggest:"695",mail:"176",drag:"778",size:"506",crop:"2754",cancel:"1478",related:"1108",rim:"2593",point:"849",is_visible:"397",onboarding:"2045",querysearch:"955"};"undefined"!=typeof BEM&&BEM.decl({block:"counter",baseBlock:"offline-request"},{_dict:t}),"undefined"!=typeof exports&&(exports.dict=t)}(),BEM.decl("counter",{HIT_DELAY:200,onSetMod:{js:function(){window.Ya=window.Ya||{},window.Ya.counter=this,window.c=this,window.w=this.w,window.cp=this.cp,window.rc=this.redir,this._handleDeferredQueue()}},_onChangeNetworkStatus:function(){var t;if(this.__self.isOnline()&&this._countersCache)for(var e in this._countersCache)this._countersCache.hasOwnProperty(e)&&"error"===this._countersCache[e].status&&(t=this._countersCache[e],t.status="pending",this._req(t.params))},_handleDeferredQueue:function(){var t,e=window.Ya.DeferredCounters;if(e)for(;!e.isEmpty();)t=e.getNext(),c.hitDelayed.apply(c,t)},_getExtParams:function(t){var e=BEM.blocks.location.getInstance().getState(),i={};return BEM.blocks["i-global"].param("isYandexApp")&&(i.uuid=_.get(e,"params.uuid[0]")),i},redir:function(t,e){var i=t.href;e=e.replace(/=8(?=&|$)/,"=0"),t.href=e,setTimeout(function(){t.href=i},500)},w:function(t,e,i){var n=window.Ya.counter;e&&n.hit({path:e,vars:n._getVars(i),dtype:"iweb"},t)},wHitDelayed:function(t,e,i){setTimeout(function(){c.w(t,e,i)},this.HIT_DELAY)},cp:function(t,e){t.path&&(t.dtype="stred",window.Ya.counter.hit(t,e))},cpHitDelayed:function(t,e){setTimeout(function(){c.cp(t,e)},this.HIT_DELAY)},hit:function(t,e){var i=e&&(e.onclick||e.ondblclick);i&&$.extend(t,i().counter__params),$.extend(t,this._getExtParams(t)),t.path&&(t.path=this.getPath(t.path),this.log(t,e),this.makeReq(this.getUrl(t,e)))},hitDelayed:function(t,e){setTimeout(function(){c.hit(t,e)},this.HIT_DELAY)},log:function(t,e){BEM.blocks.counter.debug("counter",{pid:t.pid,cid:t.cid,reqid:t.reqid||this.getReqId(e),referer:location.href,path:t.path,decoded:this.getHumanText(t.path),vars:t.vars,href:e&&e.href})},makeReq:function(t){var e={id:this.__self._reqNum++,status:"pending",params:{url:location.protocol+t,cache:!0,dataType:"script"}};this._req(e.params)},_req:function(t){$.ajax(t)},getUrl:function(t,e){var i=$.extend({rnd:BEM.blocks.utils.getRnd(2),yuid:this.getUid(),reqid:t.reqid||this.getReqId(e),serpid:t.serpid||this.getSerpId()},t),n=this.stringifyParams(i,"/");return["//",this.getClickHost(),"/jclck/",n,"/*",this._getAsterixData(e)].join("")},_getVars:function(t){return"object"==typeof t?this.stringifyParams(t,","):t},getReqId:function(t){var e,i,n=BEM.blocks["i-global"],s=n.param("reqid")||n.param("serpid")||"";return t?(e=$(t).closest(".counter__reqid"),i=e.length?BEM.DOM.extractParams(e[0]).counter__reqid:{},i.reqid||s):s},getSerpId:function(){return BEM.blocks["i-global"].param("serpid")},getUid:function(){return BEM.blocks["i-global"].param("yandexuid")},getClickHost:function(){return BEM.blocks["i-global"].param("click-host")},_getAsterixData:function(t){return t&&t.href?t.href:location.href},stringifyParams:function(t,e){var i,n=[];return Object.keys(t).forEach(function(e){i=t[e],"undefined"!=typeof i&&""!==i&&n.push(e+"="+i)}),n.join(e||"&")},getPath:function(t){var e="/"===t[0];return e&&this._dict&&this._decodePath(t)||t},_decodePath:function(t){var e=t.split("/").slice(1),i=this._dict;return i&&e.length&&e.map(function(t){return i[t]||t}).join(".")},decodeBlockstatKey:function(t){return _.findKey(this._dict,function(e){return e===t})||t},getHumanText:function(t){return"/"+t.split(".").map(this.decodeBlockstatKey.bind(this)).join("/")}},{_reqNum:0,debug:function(t,e){BEM.blocks["i-global"].param("counterDebug")&&(e=e||"","undefined"!=typeof console&&"function"==typeof console.info&&(console.group(" "+t),e.pid?console.info("pid:	"+e.pid+",	cid:	"+e.cid+"\npath:	"+e.path+",	decoded:	"+e.decoded+"\nreqid:	"+e.reqid+", \nvars:	"+e.vars+", 	href:	"+e.href):console.info("params: ",e),console.groupEnd(" "+t)),window.mm||(window.mm={}),window.mm.counters||(window.mm.counters=[]),window.mm.counters.push({name:t,params:e}))}}),BEM.create("counter"),BEM.decl("counter",{_getExtParams:function(t){var e=BEM.blocks["i-global"],i=e.param("page"),n=this.__base.apply(this,arguments);switch(i){case"index":n.service="portal.yandex";break;case"search":n.service="images.yandex";break;case"vertical-search-by-image":case"search-by-image":case"similar":n.service="cbir.yandex";break;default:n.service="yandex"}return e.param("isYandexApp")?n.ui="webmobileapp.yandex":e.param("tablet")?n.ui=encodeURIComponent("images.yandex/pad"):e.param("mobile")?n.ui=encodeURIComponent("images.yandex/touch"):n.ui="images.yandex",n.cts=t&&t.cts?t.cts:Number(new Date),n},getReqId:function(t){var e=this.__base.apply(this,arguments),i=_.get(t,"0.className"),n=i&&BEM.DOM.extractParams(t[0])[i.split(" ")[0]].reqid;return n||e}},{convertVarsToString:function(t){t||(t={});for(var e=Object.keys(t),i="",n=0,s=e.length;s>n;n++)n>0&&(i+=","),i+="-"+e[n]+"="+t[e[n]];return i}}),BEM.blocks.utils=function(){throw new Error("This is static block")},BEM.blocks.utils.getRnd=function(t){return(new Date).getTime()+Math.floor(Math.random()*Math.pow(10,t))},BEM.blocks.utils.memoize=function(t){var e;return function(){return e||(e=t.apply(this)),e}},BEM.blocks.utils.getPassportUrl=function(t){var e=BEM.blocks["i-global"].param("passport-host")+(BEM.blocks["i-global"].param("login")?"/passport?mode=passport":"/auth"),i=Math.floor(1e4*Math.random()),n=BEM.blocks.location.getInstance().getUri().replaceParam("ncrnd",i).toString();return BEM.blocks.uri.setParams(e,$.extend({retpath:n},t))},function(){function t(t){return encodeURIComponent(t).replace(/[!'()*]/g,function(t){return"%"+t.charCodeAt(0).toString(16)})}function e(t){return decodeURIComponent(t)}var i;BEM.decl("i-cookie",{defaultExpires:Math.round(new Date/1e3)+604800,getExpirationDate:function(t){return Math.round(Date.now()/1e3+24*t*60*60)},getDefaultParams:function(){return{yp:{expires:new Date("Tue Jan 1 00:00:00 2038"),domain:".yandex."+BEM.blocks["i-global"].param("tld"),path:"/"},ys:{domain:".yandex."+BEM.blocks["i-global"].param("tld"),path:"/"}}},ypRead:function(){for(var t=$.cookie("yp"),i=t?t.split("#"):[],n=new Date/1e3,s={},o=0,r=i.length;r>o;o++){var a=i[o].split("."),c=a[0],h=a[1],l=a.slice(2).join(".");c>n&&(s[h]={value:e(l),expires:c})}return s},ypWrite:function(e){for(var i,n=[],s=0,o=Object.keys(e),r=o.length;r>s;s++)i=e[o[s]],n.push([i.expires,o[s],i.encode===!1?i.value:t(i.value)].join("."));$.cookie.set("yp",n.join("#"),this.params.yp)},ypRemove:function(t){var e=this.ypRead();t&&e[t]&&(delete e[t],this.ypWrite(e))},yp:function(t,e,i){var n={};"object"==typeof t&&(n=t,t=n.name,e=n.value,i=n.expires);var s=this.ypRead(),o=s[t];return"undefined"==typeof e?o&&o.value:(o||(o={}),o.value=e,o.expires=i||o.expires||this.defaultExpires,o.encode=n.encode,s[t]=o,this.ypWrite(s))},ysRead:function(){var t=$.cookie("ys"),i=t?t.split("#"):[],n={};return i.forEach(function(t){var i=t.split("."),s=i[0],o=i.slice(1).join(".");n[s]=e(o)}),n},ysWrite:function(e){for(var i=[],n=0,s=Object.keys(e),o=s.length;o>n;n++)i.push([s[n],t(e[s[n]])].join("."));$.cookie.set("ys",i.join("#"),this.params.ys)},ys:function(t,e){var i=this.ysRead();return e?(i[t]=e,this.ysWrite(i)):i[t]}},{get:function(){return i||(i=BEM.create("i-cookie"))}})}(),jQuery.cookie=function(){var t=function(e,i,n){if(void 0===i){var s=t.get(e);return s?decodeURIComponent(s):null}t.set(e,encodeURIComponent(i),n)};return $.extend(t,{get:function(t){var e=this.getAll();return e[t]},getAll:function(){for(var t=this.readCookie(),e=t?t.split("; "):[],i={},n=0;n<e.length;n++){var s=e[n].split("="),o=s[0],r=s.slice(1).join("=");'"'===r.charAt(0)&&(r=r.slice(1,-1)),i[o]=r}return i},set:function(t,e,i){var n,s;i||(i={}),n=i.expires,"number"==typeof n&&(n=new Date(Date.now()+24*n*60*60*1e3)),s=[t,"=",e,n&&"; expires="+n.toUTCString(),i.path&&"; path="+i.path,i.domain&&"; domain="+i.domain,i.secure?"; secure":""].join(""),this.writeCookie(s)},remove:function(t){this.set(t,"",{expires:-1})},readCookie:function(){return document.cookie},writeCookie:function(t){document.cookie=t}}),t}(),function(t,e){var i={};/msie|trident/i.test(e)?i.ie=parseInt(e.split(/msie|rv:/i)[1],10):-1!==e.indexOf("Opera")&&(i.opera=parseInt(e.split(/Version\//i)[1],10));var n,s={},o={};(n=e.match(/Windows\sPhone[^\d]*\s([\d.]+)/))?s.wp=n[1]:(n=e.match(/Android\s+([\d.]+)/))?s.android=n[1]:e.match(/\sHTC[\s_].*AppleWebKit/)?s.android="2.3":(n=e.match(/iPhone\sOS\s([\d_]+)/))?(s.ios=n[1].replace(/_/g,"."),o.iphone=!0):(n=e.match(/iPad.*OS\s([\d_]+)/))?(s.ios=n[1].replace(/_/g,"."),o.ipad=!0):(n=e.match(/Bada\/([\d.]+)/))?s.bada=n[1]:(n=e.match(/MSIE\s9/))?s.wp="7.5":s.other=!0,BEM.DOM.decl("i-ua",{onSetMod:{js:{inited:function(){var t=this.__self,e="other";["ios","android","bada","wp","opera"].some(function(i){return t[i]&&(e=i)}),this.setMod("platform",e)}}},setVersion:function(){var t=this.parseVersion();t&&(this.setMod(t.platform,t.major),this.setMod(t.platform+"-subversion",t.subversion))},parseVersion:function(){if(this.__self.ios||this.__self.android){var t=this.__self.ios||this.__self.android,e=t.split("."),i=e.shift(),n=e.join("-"),s=this.getMod("platform");return{platform:s,major:i,subversion:n}}}},{ios:s.ios,iphone:o.iphone,ipad:o.ipad,android:s.android,bada:s.bada,wp:s.wp,other:s.other,ua:e,ie:i.ie,opera:i.opera})}(window,navigator.userAgent),function(){var t,e;BEM.decl("i-ua",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.__self.wp&&this.afterCurrentEvent(function(){var t=document.querySelector("html"),e=t.getAttribute("class").replace("i-ua_inlinesvg_no","i-ua_inlinesvg_yes");t.setAttribute("class",e)})}}}},{canUseCSSAnimation:function(){var t=document.createElement("div"),e="Webkit Moz O ms Khtml".split(" ");if(void 0!==t.style.animationName)return!0;for(var i=0;i<e.length;i++)if(void 0!==t.style[e[i]+"AnimationName"])return!0;return!1},hasHistoryAPI:Boolean(window.history&&history.pushState),canUseAjax:function(){return"undefined"==typeof t&&(t="function"==typeof(window.History||window.history||{}).replaceState&&this.isCookieEnabled()),t},isCookieEnabled:function(){if("undefined"==typeof e){var t=Math.random().toString(16).slice(2);document.cookie=t+"=1",e=document.cookie.indexOf(t)>=0,document.cookie=t+"=;expires="+new Date(0).toGMTString()}return e},getTransitionEndEvent:BEM.blocks.utils.memoize(function(){var t="transitionend",e={webkitTransition:"webkitTransitionEnd",OTransition:"otransitionend",mozTransition:t,transition:t};for(var i in e)if(e.hasOwnProperty(i)&&void 0!==document.body.style[i])return e[i];return t}),isPointerEventsAvailable:BEM.blocks.utils.memoize(function(){return void 0!==document.body.style.pointerEvents}),getConnectionType:function(){var t=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return t?t.type:""},isYandexAppIos:function(){return/YaApp_iOS/.test(navigator.userAgent)},isFirefox:"undefined"!=typeof InstallTrigger})}(),BEM.DOM.decl("i-ua",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._detectYaBro()}}},_detectYaBro:function(){navigator.userAgent.match("YaBro")&&(this.__self.yaBro=!0)}},{canUseCSSCalc:function(){var t=document.createElement("div");return t.style.cssText="width: calc(10px);",Boolean(t.style.length)}}),function(t,e){var i,n={},s={},o={},r={},a=t.innerWidth>t.innerHeight;e.match(/Android\s+([\d.]+)/)?(i=e.match(/Android\s+([\d.]+)/),n.android=i[1]):e.match(/\sHTC[\s_].*AppleWebKit/)?n.android="2.3":e.match(/iPhone\sOS\s([\d_]+)/)?(i=e.match(/iPhone\sOS\s([\d_]+)/),n.ios=i[1].replace(/_/g,"."),o.iphone=!0):e.match(/iPad.*OS\s([\d_]+)/)?(i=e.match(/iPad.*OS\s([\d_]+)/),n.ios=i[1].replace(/_/g,"."),o.ipad=!0):e.match(/Bada\/([\d.]+)/)?(i=e.match(/Bada\/([\d.]+)/),n.bada=i[1]):e.match(/Windows\sPhone[^\d]*\s([\d.]+)/)?(i=e.match(/Windows\sPhone[^\d]*\s([\d.]+)/),n.wp=i[1]):e.match(/MSIE\s9/)?n.wp="7.5":n.other=!0,e.match(/\s(CrMo|Chrome)\/([\d.]+)/)&&(i=e.match(/\s(CrMo|Chrome)\/([\d.]+)/),s.chrome=i[2]),BEM.decl("i-ua",{onSetMod:{js:function(){this.__base.apply(this,arguments);var t=this.__self;this.setMod("platform",t.ios?"ios":t.android?"android":t.bada?"bada":t.wp?"wp":t.opera?"opera":"other").setMod("ios",t.ios?parseInt(t.ios,10):"").setMod("android",t.android?parseInt(t.android,10):"")}}},{_hasFlexBox:!1,hasFlexbox:function(){if(this._hasFlexbox)return this._hasFlexbox;var t,e,i=["","webkit-","-moz-","ms-","o-"],n="flex-wrap",s=document.body.style;for(t=0,e=i.length;e>t;t++){var o=$.camelCase(i[t]+n);if(s.hasOwnProperty&&s.hasOwnProperty(o)||void 0!==s[o])return this._hasFlexBox=!0,this._hasFlexBox}return this._hasFlexBox},ua:e,ios:n.ios,iphone:o.iphone,ipad:o.ipad,android:n.android,bada:n.bada,wp:n.wp,other:n.other,chrome:s.chrome,screenSize:screen.width>320?"large":screen.width<320?"small":"normal",connection:r.connection,flash:r.flash,video:r.video,svg:r.svg,width:t.innerWidth,height:t.innerHeight,landscape:a})}(window,navigator.userAgent),function(t){var e=t.documentElement.style;BEM.DOM.decl("i-ua",{},{objectFit:"objectFit"in e||"OObjectFit"in e})}(document),function(t){var e=1,i=!1;if("deviceXDPI"in screen&&"logicalXDPI"in screen?e=screen.deviceXDPI/screen.logicalXDPI:"devicePixelRatio"in t&&(e=t.devicePixelRatio),"function"==typeof t.matchMedia){var n="only screen and (-webkit-min-device-pixel-ratio: 1.3), only screen and (min-resolution: 1.3dppx), only screen and (min-resolution: 124dpi)";i=t.matchMedia(n).matches}else i=e>=1.3;BEM.DOM.decl("i-ua",{},{dpr:e,hiDpi:i})}(window),BEM.DOM.decl("b-page",{onSetMod:{js:{inited:function(){this.findBlocks(),this.bindEvents()}}},findBlocks:$.noop,bindEvents:$.noop,getSeo:function(){return this.params.seo},updateTitle:function(t){var e=document.createElement("i");e.innerHTML=t,document.title=e.firstChild.nodeValue},_getFilterParams:$.noop},{getInstance:function(){return this._instance||(this._instance=BEM.DOM.scope.bem("b-page")),this._instance}}),BEM.DOM.decl("b-page",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.findBlocks(),BEM.blocks["i-global"].setParams({hasHistoryAPI:Boolean(window.history&&history.pushState)}),BEM.blocks["i-global"].param("isPumpkin")&&BEM.blocks.header.getSearch().fill(BEM.blocks.uri.getParamValue("text"))}}},findBlocks:function(){return this._header=this.findBlockInside("header"),this._headerHeight=0,this._header&&(this._headerHeight=this._header.getHeight()),this},bindEvents:function(){return this.bindToWin("resize orientationchange",$.throttle(this._onResize,200,this)),this.bindToWin("scroll",$.throttle(this._onDomScroll,200,this)),BEM.blocks["i-global"].param("mobile")&&this.bindToWin("touchmove",$.throttle(this._onTouchMove,200,this)),this},_onResize:function(){this.trigger("resize")},_onTouchMove:function(){this.trigger("touchmove")},_onDomScroll:function(){var t=this;window.requestAnimationFrame(function(){t.trigger("scroll")})},_getCachedTabs:function(){return this.tabsNavigation||this._getTabs()},_getTabs:function(){return this.tabsNavigation=this.findBlockInside("tabs-navigation"),this.tabsNavigation}}),BEM.DOM.decl("b-page",{bindEvents:function(){return this.__base.apply(this,arguments),BEM.blocks["pane2-api"].on("pane:beforeOpen",this._beforePaneOpen,this).on("pane:beforeClose",this._beforePaneClose,this),BEM.channel("b-501px-popup").on({"before-open":this._on501pxPopupOpened,closed:this._on501pxPopupClosed},this),this},unbindEvents:function(){return this.__base.apply(this,arguments),BEM.blocks["pane2-api"].un("pane:beforeOpen",this._beforePaneOpen,this).un("pane:beforeClose",this._beforePaneClose,this),BEM.channel("b-501px-popup").un({"before-open":this._on501pxPopupOpened,closed:this._on501pxPopupClosed},this),this},_beforePaneOpen:function(){var t=this._getCachedTabs(),e=this.blockInside({block:"fade",modName:"region",modVal:"main"});return t&&t.hide(),e&&(e.coverTabs(),e.coverHeader()),this},_beforePaneClose:function(){var t=this._getCachedTabs(),e=this.blockInside({block:"fade",modName:"region",modVal:"main"});return t&&this._getCachedTabs().show(),e&&e.coverPageLayout(),this},_on501pxPopupOpened:function(){window.opera||this.disableScroll()},_on501pxPopupClosed:function(){window.opera||this.enableScroll()},_getFilterParams:function(){var t=this.__base.apply(this,arguments)||[];return t.concat("img_url","pos","rpt")},findBlocks:function(){return this.__base.apply(this,arguments),this.cbirIntent=this.findBlockInside("cbir-intent"),this}},{forceOperaRepaint:function(){var t=document.body.style;t.position="static",setTimeout(function(){t.position="relative"},1)}}),function(t){"use strict";function e(t){return Math.round(1e3*t)/1e3}function i(t){if(!t)throw new Error("Invalid counterId");var e=h.commonVars||[];return e.concat(["1701="+t,"143.2129="+u,"143.2112="+m,"143.2119="+p,"1042="+encodeURIComponent(navigator.userAgent)])}function n(){for(var t=h.__defRes;t.length;){var e=t.shift();h.sendResTiming(e[0],e[1])}for(var i=h.__defTimes;i.length;){var n=i.shift();h.sendTimeMark(n[0],n[1])}}function s(t,e){o(["","reqid="+c("reqid","empty"),"dtype=stred/pid=1/cid=73017","path="+t,"vars="+e.join(","),"*"].join("/"))}function o(t){null!==f&&clearTimeout(f),C.push(t),C.length<k?f=setTimeout(r,y):r(),h.savedCounters&&h.savedCounters.push(a()+t)}function r(){var e=a(),i=C.join("\r\n");if(l&&!navigator.sendBeacon(e,i)||!l){var n=new XMLHttpRequest;n.open("POST",e),n.send(i)}C=[],f=null,BEM.blocks["i-global"].param("counterDebug")&&(t.mm=t.mm||{},t.mm.perfCounters=t.mm.perfCounters||[],t.mm.perfCounters.push(e+i))}function a(){return c("clck","//yandex.ru/clck/click")}function c(e,i){var n;try{n=BEM.blocks["i-global"].param(e)}catch(s){t.logJsError&&(s.catchType="i-global:param",t.logJsError(s))}return null===n||"undefined"==typeof n?i:n}t.Ya=t.Ya||{},Ya.PerfCounters=Ya.PerfCounters||{},$(".i-global").length&&$(".i-global").bem("i-global");var h=Ya.PerfCounters,l=Boolean(navigator.sendBeacon&&-1===navigator.userAgent.indexOf("Chrome/"));h.__cacheEvents=h.__cacheEvents||[];var u,d,p,m,f,_="690.2096.207",g="690.2096.2044",b="690.2096.2369",v=10,y=5,k=42,M={transferSize:2323,duration:2136,startTime:2322,workerStart:2137,fetchStart:2111,domainLookupStart:2112,domainLookupEnd:2113,connectStart:2114,secureConnectionStart:2115,connectEnd:2116,requestStart:2117,responseStart:2119,responseEnd:2120},E=Object.keys(M),w=t.performance||{},B=w.timing,x=document.createElement("link"),S=!1,C=[];B&&(u=B.navigationStart,d=B.responseStart,p=d-u,m=B.domainLookupStart-u,S=u&&Date.now()-u<18e5),h.__hasDeferred&&$(function(){setTimeout(n,0)}),w&&w.now?h.getTime=function(){return w.now()}:h.getTime=function(){return Date.now()-u},h.sendTimeMark=function(t,n){if(S){"undefined"==typeof n&&(n=h.getTime());var o=i(t);o.push("207="+e(n)),s(_,o)}},h.sendResTiming=function(t,n){function o(){var n=w.getEntriesByName(r);if(!n.length)return void(a++<v&&setTimeout(o,100));var c=n[0],h=E.reduce(function(t,i){return i in c&&t.push(M[i]+"="+e(c[i])),t},i(t));h.push("2428="+a),s(g,h)}if(S&&"function"==typeof w.getEntriesByName){x.href=n;var r=x.href,a=0;setTimeout(o,0)}},h.addCacheEvent=function(t,e){this.__cacheEvents.push([t,e])},h.sendCacheEvents=function(){var i=h.__cacheEvents;if(i.length){var n;try{n=t.localStorage}catch(o){}n&&"remainingSpace"in n&&h.addCacheEvent("745.506",n.remainingSpace);for(var r=["1042="+encodeURIComponent(navigator.userAgent)].concat(h.commonVars||[]);i.length;){var a=i.shift(),c=a[0],l=a[1];"number"==typeof l&&(l=e(l)),r.push(c+"="+encodeURIComponent(l))}s(b,r)}}}(window),BEM.DOM.decl("i-global-post",{onSetMod:{js:function(){BEM.blocks["i-global"].setParams(this.params)}}}),BEM.decl("i-url-controller",{},{passedParams:["ncrnd","rdrnd","nojs","numdoc","i-m-a-hacker","l10n","family","yandex_login","yandexuid","time","noredirect","noredirect_com","lr","nocache","waitall","sbh","dbgwzr","srcskip","srcask","srcrwr","metahost","relev","rearr","pron","snip","no-tests","test-id","test-tag","exp_confs","exp_flags","flag","category","popular_category","promo","rdpass","suggest-uri","disable","qa-project","qa-field","qa-functionality","qa-element","qa-test-id","qa-run-id","videoapp","counterDebug","patch","cache_whitelist","login","distr_source","distr_path","distr_vars","timeout","waitall","ui","uuid"],rejectedParams:["uinfo","viewport","suggest_reqid","json_dump","parent-reqid","photo-upload"],setCurrent:function(t){return this._current=t,this},setNext:function(t){return this._next=t,this},build:function(){return this.fillNextParams().fillCurrentParams().buildURL()},fillNextParams:function(){var t=this._next,e=t.url||location.href,i=this.rejectedParams;return t.path=t.path||BEM.blocks.uri.getPath(BEM.blocks.uri.clearHashSymbol(e)),t.params=$.extend({},BEM.blocks.uri.parseParams(e),t.params),t.params=_.transform(t.params,function(t,e,n){_.includes(i,n)||null===e||(t[n]=e)}),this},fillCurrentParams:function(){var t,e=this._next.params,i=this._current.params;return this.passedParams.forEach(function(n){e[n]||(t=i[n],t&&(e[n]=t))}),this},buildURL:function(){var t=this._next;return t.url=BEM.blocks.uri.buildRelativeUrl(t.path,t.params),this},mergePassedUrlParams:function(){var t=[].slice.call(arguments),e=_.pick(BEM.blocks.location.getInstance().getState().params,this.passedParams);return BEM.blocks["i-global"].param("isYandexApp")&&(e.service=BEM.blocks["i-global"].param("id")+".yandex"),_.assign.apply(_,[e].concat(t)),e}}),BEM.decl("location",{onSetMod:{js:function(){this._history=BEM.blocks.history.getInstance(),this._syncState(),this._history.on("statechange",this.changeThis(this._onStateChange))}},_onStateChange:function(){this._syncState(),this._state.referer!==BEM.blocks.uri.normalize(window.location.href)&&this._state.trigger!==!1&&(this.trigger("change",this._state),this._state.block&&this.channel(this._state.block).trigger("change"))},_syncState:function(){var t=this._history.state,e=BEM.blocks.uri.parse(t.url);return this._state=$.extend({},t.data,{referer:this._state&&this._state.url,url:e.build(),hostname:e.host(),path:e.path(),params:e.queryParams}),this},change:function(t){var e=BEM.blocks.uri.parse(t.url);if(t.url&&delete t.params,t.url=e.build(),t.params){var i=BEM.blocks.uri.parse(),n=t.forceParams?t.params:$.extend({},this._state.params,t.params);Object.keys(n).forEach(function(t){i.addParam(t,n[t])}),t.url=i.build()}t.trigger===!1||(t.trigger=!0);try{this._history.changeState(t.history===!1?"replace":"push",{data:t,url:t.url})}catch(s){if("SecurityError"===s.name)throw s;"undefined"!=typeof console&&console.error&&0,window.location.assign(t.url)}},getState:function(){return $.extend(!0,{},this._state)},getUri:function(){return BEM.blocks.uri.parse(this._state.url)},getReferer:function(){return this._state.referer}},{_instance:null,getInstance:function(){return this._instance||(this._instance=BEM.create("location"))}}),BEM.decl("location",{CHANGE_DEBOUNCE:600,onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.changeDebounced=$.debounce(this.change,this.CHANGE_DEBOUNCE,this),this.fillBlock(this.getOriginalState())}}},_onStateChange:function(){this.__base.apply(this,arguments),this._state.trigger!==!1&&this._state.block&&this.trigger(this._state.block,this._state)},_syncState:function(){this.__base.apply(this,arguments),this.fillBlock(this.getOriginalState())},getOriginalState:function(){return this._state},change:function(t,e){return e&&e.preventDefault&&e.preventDefault(),this.fillURL(t),this._isChangeByAssign(t)?void window.location.assign(t.url):void this.__base.apply(this,arguments)},_isChangeByAssign:function(t){var e,i;return t.reload?!0:(i=BEM.blocks["i-global"].param("isPumpkin"),e=t.trigger!==!1,!(!i||!e))},fillURL:function(t){BEM.blocks["i-url-controller"].setCurrent(this.getState()).setNext(t).build()},fillBlock:function(t){return t.block||(t.block=this.detectBlock(t)),this},getParamValue:function(t){var e=this._state.params[t];return e&&e[0]},hasParam:function(t,e){var i=this._state.params[t];return i?e?-1!==i.indexOf(e):Boolean(i[0]):!1}}),BEM.decl("location",{detectBlock:function(t){var e,i,n=t.path;return i=$(".i-global").bem("i-global").params.router.index,!t.params.rpt||"imageinfo"!==t.params.rpt[0]&&"imageview"!==t.params.rpt[0]?t.params.rpt&&"imagelike"===t.params.rpt[0]||t.params.like?e="b-page_type_similar":-1!==n.indexOf("search")?e="b-page_type_search":"/"!==n&&n!==i||(e="b-page_type_index"):e="b-page_type_search-by-image",e}}),BEM.decl("history",{onSetMod:{js:function(){if(!this.hasMod("provider"))throw new Error("Use BEM.blocks['history'].getInstance() instead of BEM.create('history')");this._resetUrl().bindEvents().syncState()}},destruct:function(){this.unbindEvents(),this.__base.apply(this,arguments)},pushState:function(t,e,i){return this.changeState("push",this.normalizeState(t,e,i))},replaceState:function(t,e,i){return this.changeState("replace",this.normalizeState(t,e,i))},bindEvents:function(){return this},_resetUrl:function(){return this},_removeHashbang:function(t){var e=BEM.blocks.uri,i=e.parse(t);if(""===i.anchor())return t;var n=e.parse(i.anchor().replace(/^!/,""));return i.anchor(""),i.query(n.query()),i.build()},unbindEvents:function(){return this},syncState:function(){return this.state=this.normalizeState(void 0,document.title,window.location.href),this},normalizeState:function(t,e,i){return{data:null===t?void 0:t,title:e,url:i}},changeState:function(t,e){try{window.location.assign(e.url)}catch(i){}}},{hasNativeAPI:function(){return window.history&&"pushState"in window.history},_instance:null,getInstance:function(){return this._instance||(this._instance=BEM.create({block:"history",mods:{provider:this.hasNativeAPI()?"history-api":"hashchange"}}))}}),BEM.decl("uri",{onSetMod:{js:function(){var t=this;["protocol","host","port","path","anchor"].forEach(function(e){t[e]=function(t){return"undefined"!=typeof t?(this.uriParts[e]=t,this):this.uriParts[e]}})}},encode:function(t){return encodeURIComponent(t)},decode:function(t){try{t=decodeURIComponent(t)}catch(e){try{t=decodeURIComponent(this.convert(t))}catch(i){}}return t},convert:function(t){var e={"%D0":"%D0%A0","%C0":"%D0%90","%C1":"%D0%91","%C2":"%D0%92","%C3":"%D0%93","%C4":"%D0%94","%C5":"%D0%95","%A8":"%D0%81","%C6":"%D0%96","%C7":"%D0%97","%C8":"%D0%98","%C9":"%D0%99","%CA":"%D0%9A","%CB":"%D0%9B","%CC":"%D0%9C","%CD":"%D0%9D","%CE":"%D0%9E","%CF":"%D0%9F","%D1":"%D0%A1","%D2":"%D0%A2","%D3":"%D0%A3","%D4":"%D0%A4","%D5":"%D0%A5","%D6":"%D0%A6","%D7":"%D0%A7","%D8":"%D0%A8","%D9":"%D0%A9","%DA":"%D0%AA","%DB":"%D0%AB","%DC":"%D0%AC","%DD":"%D0%AD","%DE":"%D0%AE","%DF":"%D0%AF","%E0":"%D0%B0","%E1":"%D0%B1","%E2":"%D0%B2","%E3":"%D0%B3","%E4":"%D0%B4","%E5":"%D0%B5","%B8":"%D1%91","%E6":"%D0%B6","%E7":"%D0%B7","%E8":"%D0%B8","%E9":"%D0%B9","%EA":"%D0%BA","%EB":"%D0%BB","%EC":"%D0%BC","%ED":"%D0%BD","%EE":"%D0%BE","%EF":"%D0%BF","%F0":"%D1%80","%F1":"%D1%81","%F2":"%D1%82","%F3":"%D1%83","%F4":"%D1%84","%F5":"%D1%85","%F6":"%D1%86","%F7":"%D1%87","%F8":"%D1%88","%F9":"%D1%89","%FA":"%D1%8A","%FB":"%D1%8B","%FC":"%D1%8C","%FD":"%D1%8D","%FE":"%D1%8E","%FF":"%D1%8F"};return t=t.replace(/%.{2}/g,function(t){return e[t]||t})},normalize:function(t){return(t||"").replace(/\+/g,"%20")},parseUri:function(t){var e=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*)(?::([^:@\/]*))?)?@)?(\[[0-9a-fA-F:.]+\]|[^:\/?#]*)(?::(\d+|(?=:)))?:?)((((?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],n=e.exec(t||""),s={};return i.forEach(function(t,e){s[t]=n[e]||""}),s},parseQuery:function(t){var e,i,n,s,o,r={};if("string"!=typeof t||""===t)return r;for(i=t.replace("?","").split("&"),e=0;e<i.length;e++)n=i[e].split("="),n=[n.shift(),void 0!==n[0]?n.join("="):null],s=this.decode(n[0]),o=n[1]||""===n[1]?this.decode(n[1]):null,r[s]?(o||""===o)&&r[s].push(o):r[s]=null===o?[]:[o];return r},query:function(t){var e="";"undefined"!=typeof t&&(this.queryParams=this.parseQuery(t));var i=this.queryParams,n=Object.keys(i),s=this;return n.forEach(function(t,n){n>0&&(e+="&"),
"object"!=typeof i[t]||i[t].length?i[t].forEach(function(i,n){n>0&&(e+="&"),e+=s.encode(t)+"="+s.encode(i)}):e+=t}),e.length>0?"?"+e:e},getParam:function(t){return this.queryParams[t]},deleteParam:function(t,e){var i=[];return"undefined"!=typeof e&&((this.queryParams[t]||[]).forEach(function(t){t!==e&&i.push(t)}),this.queryParams[t]=i),"undefined"!=typeof e&&0!==i.length||delete this.queryParams[t],this},addParam:function(t,e){return this.queryParams[t]=(this.queryParams[t]||[]).concat(e),this},replaceParam:function(t,e,i){return this.deleteParam(t,i).addParam(t,e)},scheme:function(){var t="";return this.protocol()?(t+=this.protocol(),this.protocol().indexOf(":")!==this.protocol().length-1&&(t+=":"),t+="//"):this.host()&&(t+="//"),t},origin:function(){var t=this.scheme();return this.host()&&(t+=this.host(),this.port()&&(t+=":"+this.port())),t},getRoot:function(){var t=this.origin();return this.path()&&(t+=this.path().replace(/\/[^\/]*$/,"")),t},pathParts:function(){return this.path().split("/")},toString:function(){var t=this.origin();return this.path()?t+=0!==this.path().indexOf("/")&&"/"!==t[t.length-1]?"/"+this.path():this.path():this.host()&&(this.query().toString()||this.anchor())&&(t+="/"),this.query().toString()&&(0!==this.query().toString().indexOf("?")&&(t+="?"),t+=this.query().toString()),this.anchor()&&(0!==this.anchor().indexOf("#")&&(t+="#"),t+=this.anchor()),t},build:function(){var t="";return t+=this.protocol()?this.protocol():window.location.protocol,t+=t.indexOf(":")!==t.length-1?"://":"//",t+=this.host()?this.host():window.location.hostname,this.port()?t+=":"+this.port():!this.host()&&window.location.hostname&&(t+=":"+window.location.port),t+=this.path()?this.path():this.host()?"/":window.location.pathname,this.query()&&(0!==this.query().indexOf("?")&&(t+="?"),t+=this.query()),this.anchor()&&(0!==this.anchor().indexOf("#")&&(t+="#"),t+=this.anchor()),t}},{parse:function(t){var e=BEM.create({block:"uri"});return e.uriParts=e.parseUri(e.normalize(t)),e.queryParams=e.parseQuery(e.uriParts.query),e},normalize:function(t){return this.parse(t).toString()}}),BEM.decl("uri",{},{_validUrlRegEx:new RegExp("^(?:(?:https?|ftp)://)(?:(?:(?:xn--)?(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:xn--)?(:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:xn--)?(?:[a-z\\u00a1-\\uffff]{2,})))(?::\\d{2,5})?(?:/[^\\s]*)?"),_acceptableUrlRegEx:/\S+\.\S{2,}/,setParam:function(t,e,i){"undefined"==typeof i&&(i=e,e=t,t=BEM.blocks.location.getInstance().getState().url);var n=this.parse(t);return _.isEmpty(i)?n.deleteParam(e).toString():n.queryParams[e]?n.replaceParam(e,i).toString():n.addParam(e,i).toString()},setParams:function(t,e){_.isObject(t)&&(e=t,t=BEM.blocks.location.getInstance().getState().url);var i=this.parse(t);return _.each(e,function(t,e){"undefined"==typeof t?i.deleteParam(e):i.queryParams[e]?i.replaceParam(e,t):i.addParam(e,t)}),i.toString()},delParams:function(t,e){"undefined"==typeof e&&Array.isArray(t)&&(e=t,t=BEM.blocks.location.getInstance().getState().url);var i=this.parse(t);return"string"==typeof e&&i.deleteParam(e),Array.isArray(e)&&_.each(e,function(t){i.deleteParam(t)}),i.toString()},filterParams:function(t,e){"undefined"==typeof e&&(e=t,t=BEM.blocks.location.getInstance().getState().url);var i=this.parseParams(t);for(var n in i)i.hasOwnProperty(n)&&(e.call(this,n,i[n],t)||(t=this.delParams(t,n)));return t},buildRelativeUrl:function(t,e){return"undefined"==typeof e&&_.isObject(t)&&(e=t,t=BEM.blocks.location.getInstance().getState().url),!e||_.isEmpty(e)?t:(e=Array.isArray(e)?[].concat(e):$.extend({},e),e=$.param(e,!0),BEM.blocks.uri.normalize(t+"?"+e))},parseParams:function(t){"undefined"==typeof t&&(t=BEM.blocks.location.getInstance().getState().url);var e=this.parse(this.clearHashSymbol(t));return e.queryParams},getFlatParams:function(t){var e=this.parseParams(t),i={};return _.forEach(e,function(t,e){i[e]=1===t.length?t[0]:t}),i},clearHashSymbol:function(t){return _.isEmpty(t)&&(t=BEM.blocks.location.getInstance().getState().url),t.replace(/[^\/]*\/?#!\//,"")},getPath:function(t){return this.parse(t).path()},isValid:function(t){return this._validUrlRegEx.test(t)},isAcceptable:function(t){return this._acceptableUrlRegEx.test(t)},getParamValue:function(t,e){"undefined"==typeof e&&(e=t,t=BEM.blocks.location.getInstance().getState().url);var i=this.parse(t).getParam(e);return"string"==typeof i?i:Array.isArray(i)?i[0]:void 0}}),BEM.decl({block:"history",modName:"provider",modVal:"history-api"},{_onPopState:function(t){var e=t.originalEvent.state;null!==e&&(this.state=this.normalizeState(e,document.title,window.location.href),this.state.data&&delete this.state.data.trigger,this.trigger("statechange",this.state))},bindEvents:function(){return this.__base.apply(this,arguments),BEM.DOM.win.on("popstate",this.changeThis(this._onPopState)),this},unbindEvents:function(){return this.__base.apply(this,arguments),BEM.DOM.win.off("popstate",this._onPopState),this},_resetUrl:function(){var t=BEM.blocks.uri.parse(window.location.href);return t.anchor()&&window.history.replaceState({},document.title,this._removeHashbang(window.location.href)),this},syncState:function(){var t=window.history.state;return null!==t&&void 0!==t||window.history.replaceState({},document.title,window.location.href),null!==this.state&&void 0!==this.state||(this.state=this.normalizeState(void 0,document.title,window.location.href)),this},changeState:function(t,e){return window.history[t+"State"](e.data,e.title||document.title,e.url),this.state=e,this.trigger("statechange",{state:e,nativeApi:!0}),this}}),BEM.DOM.decl({block:"b-page",modName:"ajax",modVal:"yes"},{bindEvents:function(){this.__base.apply(this,arguments),this.on("contentLoad",this._onContentLoad).on("change",this._onChange),BEM.DOM.blocks["suggest2-counter"].on("submit",this._onSuggest2CounterSubmit,this)},unbindEvents:function(){this.__base.apply(this,arguments),BEM.DOM.blocks["suggest2-counter"].un("submit",this._onSuggest2CounterSubmit,this)},_onContentLoad:function(t,e){this.__base.apply(this,arguments),BEM.DOM.update(this.findElem("content"),e.html),this.trigger("contentLoaded",e)},_addPushbundleTestViewToReq:function(t){var e=BEM.blocks["i-global"];return e.param("pushbundle")&&e.getFlag("pushbundle_test_view")&&t.push({name:"pushbundle__get-pushbundle-test-view-ajax",callback:this._onPushbundleTestViewLoaded}),t},_onPushbundleTestViewLoaded:function(t){BEM.DOM.append(this.domElem,t.html)},load:function(){return this.trigger("load:start"),this},_onChange:function(){},buildCacheKey:function(){var t=this._location.getState();return[t.block?t.block:"",t.type?t.type:"",BEM.blocks.uri.delParams(t.url,this._getFilterParams())].join("_")},updateGlobalParams:function(t){BEM.blocks["i-global"].setParams(t.params),this.updateSeoInformation(t.params.seo)},_onSuggest2CounterSubmit:function(t,e){this.suggestReqID=e.suggest_reqid},prepareParams:function(t){return t.suggest_reqid=this.suggestReqID,t},updateSerpParams:function(t){var e,i=BEM.blocks["serp-controller"].get(),n=t.params.mods;$.extend(i.params,t.params);for(e in n)n.hasOwnProperty(e)&&i.setMod(e,n[e])}}),BEM.DOM.decl({block:"b-page",modName:"ajax",modVal:"yes"},{onSetMod:{js:{inited:function(){this.findBlockOn("i-global"),this._location=BEM.blocks.location.getInstance(),this.__base.apply(this,arguments),this._cacheKey=this.buildCacheKey()}},type:function(t,e){this.__base.apply(this,arguments),this.findBlockInside("page-layout").setMod("page",e)}},checkCacheKey:function(){var t=this.buildCacheKey();return this._cacheKey===t?!1:(this._cacheKey=t,!0)},load:function(t){this.__base.apply(this,arguments);var e=BEM.create("i-request_type_bem",{url:t.url,cache:t.cache,ctx:this}),i=[{name:"i-global__params:ajax",callback:this.updateGlobalParams},{name:"cookies_ajax",callback:this.updateCookies}];return Array.isArray(t.blocks)&&(i=i.concat(t.blocks)),i.push({name:"content_type_"+t.type,callback:function(e){e.page=t.type,this.trigger("contentLoad",e),this._getTabs()}},{name:"serp-controller",callback:this.updateSerpParams}),i=this._addPushbundleTestViewToReq(i),i.forEach(function(t){e.block(t.name,t.callback)}),e.on("beforeCallback",function(){this.setMod("type",t.type)},this),this.showFade(),e.get(this.prepareParams(t.params),this._requestCallback.bind(this,t.type)),this},_requestCallback:function(t){this.trigger("change",{type:t}),this.hideFade()},updateSeoInformation:function(t){this.updateTitle(t.title),$("meta[name=keywords]").attr("content",t.keywords),$("meta[name=description]").attr("content",t.description),this.params.seo.shareTitle=t.shareTitle},updateCookies:function(t){BEM.blocks.cookies.save(t.params.cookies)},_selectFade:function(){return this._fade||(this._fade=this.findBlockInside({block:"fade",modName:"region",modVal:"main"})),this._fade},showFade:function(){this._startedFade||(this._startedFade=this._selectFade()),this._startedFade.setMod("progress","yes")},hideFade:function(){this._startedFade&&(this._startedFade.delMod("progress"),this._startedFade=null)}}),BEM.DOM.decl({block:"b-page",modName:"ajax",modVal:"yes"},{prepareParams:function(){var t=this.__base.apply(this,arguments);return t.uinfo=BEM.blocks["i-userinfo"].get().getUserInfo(),t["source-serpid"]=BEM.blocks["i-global"].param("serpid"),t}}),BEM.DOM.decl({block:"b-page",modName:"ajax",modVal:"yes"},{findBlocks:function(){return this.headFilter=this.findBlockInside("head-filter"),this.__base.apply(this,arguments)},bindEvents:function(){return this.headFilter&&this.headFilter.on("saved",this._onHeadFilterSaved,this),BEM.blocks["i-cbir-controller"].on("fade",this.showFade,this).on("unfade",this.hideFade,this),BEM.channel("b-501px").on("updateUrl",function(){this._cacheKey=this.buildCacheKey()},this),this.__base.apply(this,arguments)},unbindEvents:function(){return this.headFilter&&this.headFilter.un("saved",this._onHeadFilterSaved,this),BEM.blocks["i-cbir-controller"].un("fade",this.showFade,this).un("unfade",this.hideFade,this),BEM.channel("b-501px").un("updateUrl"),this.__base.apply(this,arguments)},_onHeadFilterSaved:function(){this.showFade()},updateGlobalParams:function(t){this.__base.apply(this,arguments),this.trigger("warning",t.params)},_delayMethod:function(t,e){var i=BEM.blocks["i-global"].param("lags"),n=i&&i.delay;n?setTimeout(function(){t.apply(this,e)}.bind(this),n):t.apply(this,e)},_onContentLoad:function(){this._delayMethod(this.__base,arguments)},_requestCallback:function(){this._delayMethod(this.__base,arguments)},_onChange:function(t,e){this.__base.apply(this,arguments);var i="index"===e.type&&BEM.blocks["i-global"].param("is500pxAvailable");this.setMod("501px",i?"yes":"")},loadPage:function(t,e){this.load({type:e,url:BEM.blocks["i-global"].param("router").search,params:t.params,blocks:[{name:"cbir-intent__image-link",callback:function(t){this.trigger("cbir-intent:loaded",t)}}]})}}),function(t,e,i){function n(t,e){var i={},n=t.originalEvent||{};e||(e={});for(var s,o=0;c>o;o++)s=r[o],i[s]=e[s]||t[s]||n[s]||a[o];return i.x=i.clientX,i.y=i.clientY,i.pressure=i.pressure||(i.buttons?.5:0),i.buttons||h||(i.buttons=l[i.which]||0),i.originalEvent=t.originalEvent||null,e.preventDefault?i.preventDefault=function(){e.preventDefault(),t.preventDefault()}:(i.preventDefault=function(){t.preventDefault()},i._preventScroll=function(){}),i}function s(t,e){var n=i.Event(t),s=e.preventDefault,o=n.preventDefault.bind(n);return jQuery.extend(n,e),n.preventDefault=function(){s(),o()},n}var o={bubbles:!1,cancelable:!1,view:null,detail:null,screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:null,buttons:0,pointerId:0,width:0,height:0,pressure:0,tiltX:0,tiltY:0,pointerType:"",hwTimestamp:0,isPrimary:!1,target:null,currentTarget:null,which:0,pageX:0,pageY:0,timeStamp:0},r=Object.keys(o),a=r.map(function(t){return o[t]}),c=r.length,h=!1,l=[0,1,4,2];try{h=1===new MouseEvent("test",{buttons:1}).buttons}catch(u){}var d=t.Map&&t.Map.prototype.forEach,p=d?new t.Map:{array:[],size:0,set:function(t,e){return void 0===e?this["delete"](t):(this.has(t)||this.size++,void(this.array[t]=e))},has:function(t){return void 0!==this.array[t]},"delete":function(t){this.has(t)&&(delete this.array[t],this.size--)},get:function(t){return this.array[t]},clear:function(){this.array.length=0,this.size=0},forEach:function(t,e){return this.array.forEach(function(i,n){t.call(e,i,n,this)},this)}},m={eventMap:{},captureInfo:{},eventSourceList:[],registerSource:function(t,e){var i=e.events;i&&(i.forEach(function(t){e[t]&&(this.eventMap[t]=e[t].bind(e))},this),this.eventSourceList.push(e))},register:function(t){for(var e,i=this.eventSourceList.length,n=0;i>n&&(e=this.eventSourceList[n]);n++)e.register.call(e,t)},unregister:function(t){for(var e,i=this.eventSourceList.length,n=0;i>n&&(e=this.eventSourceList[n]);n++)e.unregister.call(e,t)},contains:function(t,e){return t.contains?t.contains(e):!1},getCommonAncestor:function(t,i){for(;t&&t!==e.documentElement;){if(t.contains&&t.contains(i))return t;t=t.parentNode}return null},down:function(t){t.bubbles=!0,this.fireEvent("pointerdown",t)},move:function(t){t.bubbles=!0,this.fireEvent("pointermove",t)},up:function(t){t.bubbles=!0,this.fireEvent("pointerup",t)},enter:function(t){var e=[],i=t.target,n=this.getCommonAncestor(i,t.relatedTarget);for(t.bubbles=!1;i&&i!==n;)e.push(i),i=i.parentNode;for(;e.length;)t.target=e.pop(),this.fireEvent("pointerenter",t)},leave:function(t){var e=[],i=t.target,n=this.getCommonAncestor(i,t.relatedTarget);for(t.bubbles=!1;i&&i!==n;)e.push(i),i=i.parentNode;for(;e.length;)t.target=e.shift(),this.fireEvent("pointerleave",t)},over:function(t){t.bubbles=!0,this.fireEvent("pointerover",t)},out:function(t){t.bubbles=!0,this.fireEvent("pointerout",t)},cancel:function(t){t.bubbles=!0,this.fireEvent("pointercancel",t)},leaveOut:function(t){this.out(t),this.contains(t.target,t.relatedTarget)||this.leave(t)},enterOver:function(t){this.over(t),this.contains(t.target,t.relatedTarget)||this.enter(t)},listen:function(t,e){e.forEach(function(e){this.addEvent(t,e)},this)},unlisten:function(t,e){e.forEach(function(e){this.removeEvent(t,e)},this)},addEvent:function(t,e){i(t).on(e,this.boundHandler)},removeEvent:function(t,e){i(t).off(e,this.boundHandler)},eventHandler:function(t){var e=this.eventMap[t.type];e&&e(t,t.originalEvent)},makeEvent:function(t,e){this.captureInfo[e.pointerId]&&(e.relatedTarget=null);var i=s(t,e);return i._target=i._target||e.target,i},fireEvent:function(t,e){var i=this.makeEvent(t,e);return this.dispatchEvent(i)},getTarget:function(t){return this.captureInfo[t.pointerId]||t._target},setCapture:function(t,n){this.captureInfo[t]&&this.releaseCapture(t),this.captureInfo[t]=n,this.implicitRelease=this.releaseCapture.bind(this,t),i(e).on("pointerup pointercancel",this.implicitRelease),this.asyncDispatchEvent(i.Event("gotpointercapture",{bubbles:!0,cancelable:!1,pointerId:t,_target:n}))},releaseCapture:function(t){var n=this.captureInfo[t];n&&(this.captureInfo[t]=void 0,i(e).off("pointerup pointercancel",this.implicitRelease),this.asyncDispatchEvent(i.Event("lostpointercapture",{bubbles:!0,cancelable:!1,pointerId:t,_target:n})))},dispatchEvent:function(t){var e=this.getTarget(t);return e?i.event.trigger(t,null,e,!t.bubbles):void 0},asyncDispatchEvent:function(e){(t.requestAnimationFrame||setTimeout)(this.dispatchEvent.bind(this,e))}};m.boundHandler=m.eventHandler.bind(m);var f,_,g={POINTER_ID:1,POINTER_TYPE:"mouse",DEDUP_DIST:25,events:["mousedown","mousemove","mouseup","mouseover","mouseout"],register:function(t){m.listen(t,this.events)},unregister:function(t){m.unlisten(t,this.events)},lastTouches:[],isEventSimulatedFromTouch:function(t){for(var e,i=this.lastTouches,n=t.clientX,s=t.clientY,o=0,r=i.length;r>o&&(e=i[o]);o++){var a=Math.abs(n-e.x),c=Math.abs(s-e.y);if(a<=this.DEDUP_DIST&&c<=this.DEDUP_DIST)return!0}},prepareEvent:function(t){return n(t,{pointerId:this.POINTER_ID,isPrimary:!0,pointerType:this.POINTER_TYPE})},mousedown:function(t){this.isEventSimulatedFromTouch(t)||(p.has(this.POINTER_ID)&&this.cancel(t),p.set(this.POINTER_ID,t),m.down(this.prepareEvent(t)))},mousemove:function(t){this.isEventSimulatedFromTouch(t)||m.move(this.prepareEvent(t))},mouseup:function(t){if(!this.isEventSimulatedFromTouch(t)){var e=p.get(this.POINTER_ID);e&&e.button===t.button&&(m.up(this.prepareEvent(t)),this.cleanupMouse())}},mouseover:function(t){this.isEventSimulatedFromTouch(t)||m.enterOver(this.prepareEvent(t))},mouseout:function(t){this.isEventSimulatedFromTouch(t)||m.leaveOut(this.prepareEvent(t))},cancel:function(t){m.cancel(this.prepareEvent(t)),this.cleanupMouse()},cleanupMouse:function(){p["delete"](this.POINTER_ID)}},b={POINTER_TYPE:"touch",DEDUP_TIMEOUT:2500,CLICK_COUNT_TIMEOUT:200,events:["touchstart","touchmove","touchend","touchcancel"],register:function(t){m.listen(t,this.events)},unregister:function(t){m.unlisten(t,this.events)},firstTouch:null,isPrimaryTouch:function(t){return this.firstTouch===t.identifier},setPrimaryTouch:function(t){(0===p.size||1===p.size&&p.has(1))&&(this.firstTouch=t.identifier,this.firstTouchTarget=t.target,this.scrolling=!1,this.firstXY={X:t.clientX,Y:t.clientY},this.cancelResetClickCount())},removePrimaryPointer:function(t){t.isPrimary&&(this.firstTouch=null,this.firstTouchTarget=null,this.firstXY=null,this.shouldScrollCache=void 0,this.resetClickCount())},clickCount:0,resetId:null,resetClickCount:function(){var t=function(){this.clickCount=0,this.resetId=null}.bind(this);this.resetId=setTimeout(t,this.CLICK_COUNT_TIMEOUT)},cancelResetClickCount:function(){this.resetId&&clearTimeout(this.resetId)},typeToButtons:function(t){return"touchstart"===t||"touchmove"===t?1:0},findTarget:function(t){return e.elementFromPoint(t.clientX,t.clientY)},touchToPointer:function(t){var e=this,s=this.currentTouchEvent,o=t.identifier+2;return n(s,i.extend({},t,{pointerId:o,target:m.captureInfo[o]||this.findTarget(t),bubbles:!0,cancelable:!0,detail:this.clickCount,button:0,buttons:this.typeToButtons(s.type),width:t.webkitRadiusX||t.radiusX||0,height:t.webkitRadiusY||t.radiusY||0,pressure:t.webkitForce||t.force||.5,isPrimary:this.isPrimaryTouch(t),pointerType:this.POINTER_TYPE,preventDefault:function(){e.scrolling=!1,e.shouldScrollCache=!1,e.firstXY=null}}))},processTouches:function(t,e){var i=t.originalEvent.changedTouches;this.currentTouchEvent=t;for(var n,s=0;s<i.length;s++)n=i[s],e.call(this,this.touchToPointer(n))},scrollTypes:{EMITTER:"none",XSCROLLER:"pan-x",YSCROLLER:"pan-y",SCROLLER:/^(?:pan-x pan-y)|(?:pan-y pan-x)|auto$/},touchActionToScrollType:function(t){var e,i=this.scrollTypes;return t===i.EMITTER?e="none":t===i.XSCROLLER?e="X":t===i.YSCROLLER?e="Y":i.SCROLLER.exec(t)&&(e="XY"),e},shouldScroll:function(t){if(void 0!==this.shouldScrollCache)return this.shouldScrollCache;if(!this.firstXY)return!0;var e,i,n=this.firstTouchTarget;do{if(e=n.getAttribute("touch-action"),null!==e)break;n=n.parentNode}while(n!==document);var s=this.touchActionToScrollType(e);if("none"===s)i=!1;else if("XY"===s||void 0===s)i=!0;else{var o=t.originalEvent.changedTouches[0],r=s,a="Y"===s?"X":"Y",c=Math.abs(o["client"+r]-this.firstXY[r]),h=Math.abs(o["client"+a]-this.firstXY[a]);i=c>=h}return this.shouldScrollCache=i,this.firstXY=null,this.firstTouchTarget=null,this.shouldScrollCache},findTouch:function(t,e){for(var i,n=0,s=t.length;s>n&&(i=t[n]);n++)if(i.identifier===e)return!0},vacuumTouches:function(t){var e=t.originalEvent.touches;if(p.size>=e.length){var i=[];p.forEach(function(t,n){if(1!==n&&!this.findTouch(e,n-2)){var s=t.out;i.push(s)}},this),i.forEach(this.cancelOut,this)}},touchstart:function(t){var e=t.originalEvent.changedTouches[0];this.vacuumTouches(t),this.setPrimaryTouch(e),this.dedupSynthMouse(e),this.scrolling||(this.clickCount++,this.processTouches(t,this.overDown))},overDown:function(t){p.set(t.pointerId,{target:t.target,out:t,outTarget:t.target}),m.over(t),m.enter(t),m.down(t)},touchmove:function(t){this.scrolling||(this.shouldScroll(t)?(this.scrolling=!0,this.touchcancel(t)):(t.preventDefault(),this.processTouches(t,this.moveOverOut)))},moveOverOut:function(t){var e=p.get(t.pointerId);if(e){var i=e.out,n=e.outTarget;m.move(t),i&&n!==t.target&&(i.relatedTarget=t.target,t.relatedTarget=n,i.target=n,t.target?(m.leaveOut(i),m.enterOver(t)):(t.target=n,t.relatedTarget=null,this.cancelOut(t))),e.out=t,e.outTarget=t.target}},touchend:function(t){this.dedupSynthMouse(t.originalEvent.changedTouches[0]),this.processTouches(t,this.upOut)},upOut:function(t){this.scrolling||(m.up(t),m.out(t),m.leave(t)),this.cleanUpPointer(t)},touchcancel:function(t){this.processTouches(t,this.cancelOut)},cancelOut:function(t){m.cancel(t),m.out(t),m.leave(t),this.cleanUpPointer(t)},cleanUpPointer:function(t){p["delete"](t.pointerId),this.removePrimaryPointer(t)},dedupSynthMouse:function(t){var e=g.lastTouches;if(this.isPrimaryTouch(t)){var i={x:t.clientX,y:t.clientY};e.push(i);var n=function(t,e){var i=t.indexOf(e);i>-1&&t.splice(i,1)}.bind(null,e,i);setTimeout(n,this.DEDUP_TIMEOUT)}}},v={POINTER_TYPES:["","unavailable","touch","pen","mouse"],HAS_BITMAP_TYPE:t.MSPointerEvent&&"number"==typeof t.MSPointerEvent.MSPOINTER_TYPE_MOUSE,events:["MSPointerDown","MSPointerMove","MSPointerUp","MSPointerOut","MSPointerOver","MSPointerCancel","MSGotPointerCapture","MSLostPointerCapture"],register:function(t){m.listen(t,this.events)},unregister:function(t){m.unlisten(t,this.events)},prepareEvent:function(t){var e=n(t);return this.HAS_BITMAP_TYPE&&(e.pointerType=this.POINTER_TYPES[e.pointerType]),e},cleanup:function(t){p["delete"](t)},MSPointerDown:function(t){p.set(t.originalEvent.pointerId,t),m.down(this.prepareEvent(t))},MSPointerMove:function(t){m.move(this.prepareEvent(t))},MSPointerUp:function(t){m.up(this.prepareEvent(t)),this.cleanup(t.originalEvent.pointerId)},MSPointerOut:function(t){m.leaveOut(this.prepareEvent(t))},MSPointerOver:function(t){m.enterOver(this.prepareEvent(t))},MSPointerCancel:function(t){m.cancel(this.prepareEvent(t)),this.cleanup(t.originalEvent.pointerId)},MSGotPointerCapture:function(t){m.fireEvent("gotpointercapture",this.prepareEvent(t))},MSLostPointerCapture:function(t){m.fireEvent("lostpointercapture",this.prepareEvent(t))}},y=function(t){if(!p.has(t))throw new Error("InvalidPointerId")};t.Element&&Element.prototype.setPointerCapture?(f=function(t,e){t.setPointerCapture(e)},_=function(t,e){t.releasePointerCapture(e)}):t.navigator.msPointerEnabled?(f=function(t,e){y(e),t.msSetPointerCapture(e)},_=function(t,e){y(e),t.msReleasePointerCapture(e)}):(f=function(t,e){y(e),m.setCapture(e,t)},_=function(t,e){y(e),m.releaseCapture(e,t)}),i.fn.extend({setPointerCapture:function(t){f(this[0],t)},releasePointerCapture:function(t){_(this[0],t)}}),t._pointerPolyfillInited||(t._pointerPolyfillInited=!0,t.PointerEvent?["move","down","up","over","out","enter","leave","cancel"].forEach(function(t){var e=jQuery.event.fixHooks,i="pointer"+t;e[i]||(e[i]={}),e[i].props=r.concat(e[i].props||[])}):(delete i.event.special.pointerenter,delete i.event.special.pointerleave,t.navigator.msPointerEnabled?m.registerSource("ms",v):(m.registerSource("mouse",g),void 0!==t.ontouchstart&&m.registerSource("touch",b)),m.register(document)))}(window,document,jQuery),function(t){t.event.special.pointerpress||t.each({pointerpress:"pointerdown",pointerrelease:"pointerup pointercancel"},function(e,i){function n(i){var n,s=i.type;return"mouse"===i.pointerType&&1!==i.which||(i.type=e,n=t.event.dispatch.apply(this,arguments),i.type=s),n}t.event.special[e]={setup:function(){t(this).on(i,n)},teardown:function(){t(this).off(i,n)}}})}(jQuery),$.extend({util:{}}),function(){function t(t){return"[object Object]"===n.call(t)}function e(i,n,s){var o,r;i=Object(i),n=Object(n);for(o in n)r=s&&s(i[o],n[o],o),void 0!==r?i[o]=r:t(i[o])&&t(n[o])?i[o]=e(i[o],n[o],s):i[o]=n[o];return i}function i(t,i){return e(t,i,function(t,e,i){return"mix"===i?[].concat(t,e):void 0})}var n=Object.prototype.toString;$.extend($.util,{merge:e,mergeBemjson:i})}(),BEM.DOM.decl("control",{onSetMod:{focused:{yes:function(){return this.hasMod("disabled")?!1:void(this._focused||(this._focus(),this.trigger("focus")))},"":function(){this._focused&&(this._blur(),this.trigger("blur"))}},disabled:{"*":function(t,e){var i=this._getControl();i.prop("disabled",Boolean(e)).attr("aria-disabled",Boolean(e)),i.attr("tabindex",e?null:this.params._tabindex)},yes:function(){this.delMod("focused")}}},_focus:function(){this._getControl().focus()},_blur:function(){this._getControl().blur()},_getControl:function(){var t=this.elem("control");return t.length>0?t:this.domElem},_onFocusin:function(){this._focused=!0,this.trigger("focus").setMod("focused","yes").bindTo("focusout",this._onFocusout)},_onFocusout:function(){this._focused=!1,this.trigger("blur").delMod("focused").unbindFrom("focusout")},getDefaultParams:function(){return{_tabindex:this._getControl().attr("tabindex")}}},{live:function(){this.liveBindTo("focusin",function(t){this._onFocusin(t)}),parseInt(BEM.blocks["i-ua"].ios,10)>=8&&this.liveBindTo("control","focusin",function(t){t.preventDefault()})}}),BEM.DOM.decl({block:"link",baseBlock:"control"},{onSetMod:{hovered:{yes:function(){return!this.hasMod("disabled")}},pressed:{yes:function(){return!this.hasMod("disabled")}},disabled:{"":function(){this.__base.apply(this,arguments),this.domElem.attr("tabindex",this.params._tabindex).attr("href",this._url||this.params._url)},yes:function(){this.__base.apply(this,arguments),this._url=this.domElem.attr("href")||this.params._url,void 0!==this._url&&this.domElem.attr("tabindex",-1),this.domElem.removeAttr("href"),this.delMod("pressed")}}},_onPointerpress:function(t){this.setMod("pressed","yes").bindToDoc("pointerrelease",this._onPointerrelease)},_onPointerrelease:function(t){this.delMod("pressed").unbindFromDoc("pointerrelease")}},{live:function(){return this.liveBindTo("pointerpress",function(t){this.hasMod("disabled")||this._onPointerpress(t)}),this.__base()}}),BEM.DOM.decl("link",{onSetMod:{hovered:{yes:function(){return!this.hasMod("disabled")}},disabled:{yes:function(){this.__base.apply(this,arguments),this.delMod("hovered")}}},_onPointerenter:function(t){this.setMod("hovered","yes")},_onPointerleave:function(t){this.delMod("hovered")}},{live:function(){return this.liveBindTo("pointerover pointerout",function(t){this.hasMod("disabled")||this.domElem[0].contains(t.relatedTarget)||("pointerover"===t.type?this._onPointerenter(t):this._onPointerleave(t))}),this.__base.apply(this,arguments)}}),function(){function t(){i.hasClass("pointerfocus")&&(s=!0,setTimeout(function(){s=!1}))}var e=$(window),i=$(document.documentElement),n=0,s=!1;document.documentMode<=11?i.on("focusin",function(e){var i=e.originalEvent;!i||i.fromElement||i.relatedTarget||t()}):e.on("blur",function(){e.one("focus",t)}),i.addClass("utilityfocus").on({focusin:function(){i.toggleClass("pointerfocus",s).toggleClass("utilityfocus",!s)},keydown:function(){clearTimeout(n),s=!1},"pointerdown pointerup click":function(t){s=!0,clearTimeout(n),n=setTimeout(function(){s=!1},600)}})}(),BEM.DOM.decl({block:"link",modName:"ajax",modVal:"yes"},{_onClick:function(t){this.__base.apply(this,arguments);var e=this.domElem.attr("href");e&&(this.trigger("click",{domEvent:t}),this.isMouseDownTriggered||this.domElem.trigger("onmousedown"),BEM.blocks.location.getInstance().change($.extend({url:e},this.params),t))},_onMouseDown:function(){this.isMouseDownTriggered=!0}},{live:function(){this.__base.apply(this,arguments),this.liveBindTo({block:"link",modName:"ajax",modVal:"yes"},"pointerclick",function(t){this._onClick(t)}),this.liveBindTo({block:"link",modName:"ajax",modVal:"yes"},"mousedown",function(){this._onMouseDown()})}}),function(){var t={};BEM.decl("i-request",{onSetMod:{js:{inited:function(){this._preventCache=!1}}},get:function(t,e,i,n){return $.isFunction(i)||(n=i,i=this.params.onError),this._get(t,e,i,$.extend({},this.params,n)),this},_get:function(e,i,n,s){var o=this._buildCacheKey(e,s),r=t[s.cacheGroup];s.cache&&r&&o in r.data?this.afterCurrentEvent(function(){i.call(this.params.callbackCtx,r.data[o])},this):this._do(e,i,n,s)},_do:function(t,e,i,n){},_onSuccess:function(t,e,i,n){n.cache&&!this._preventCache&&this.putToCache(n,t,i),this._preventCache=!1},_buildCacheKey:function(t,e){return"string"==typeof t?t:$.param(t)},putToCache:function(e,i,n){var s=t[e.cacheGroup]||(t[e.cacheGroup]={keys:[],data:{}});s.keys.length>=e.cacheSize&&delete s.data[s.keys.shift()];var o=this._buildCacheKey(i,e);return s.data[o]=n,s.keys.push(o),this},dropCache:function(){return delete t[this.params.cacheGroup],this},getDefaultParams:function(){return{cache:!1,cacheGroup:"default",cacheSize:100,callbackCtx:this}}},{_cache:t})}(),BEM.decl({block:"i-request_type_bem",baseBlock:"offline-request"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.blocks=[],BEM.blocks["i-global"].param("isYandexNet")&&this.blocks.push({decl:"i-console",error:$.noop,success:function(t){$("body").append(t.html)},params:{isAjax:!0}});var t=this._prepareRequestUrl();this._req=BEM.create("i-request_type_ajax",{dataType:this.params.dataType,url:t,cache:this.params.cache,callbackCtx:this,traditional:!0,paramsToSettings:["traditional"]}),this._initOffline()}},_prepareRequestUrl:function(){var t,e=this.params.url;if(BEM.blocks["i-global"].param("pushbundle")){var i=BEM.blocks.location.getInstance().getParamValue("exp_flags");i&&-1===e.indexOf("exp_flags")&&(t=_.isEmpty(BEM.blocks.uri.parseParams(e))?"?":"&",e+=t+"exp_flags="+i)}return e},_initOffline:function(){this.__base.apply(this,arguments),this._requestArgsCache=null},block:function(t,e,i,n){var s=Array.isArray(t)?t:"string"==typeof t?t.split(" "):[t];if(arguments.length<2)throw new Error("success callback is required");for(var o=0,r=s.length;r>o;o++)this.blocks.push({decl:s[o],success:e,error:"function"===$.type(i)?i:$.noop,params:n||"object"===$.type(i)?i:{},ctx:this.params.ctx});return this},get:function(t,e,i){var n=this.params;return"function"===$.type(t)?(n.success=t,n.error=e||$.noop,t=void 0):(n.success=e||$.noop,n.error=i||$.noop),BEM.blocks["i-global"].param("isPumpkin")?(this._onError(),this):(this._get(t),this)},_get:function(t){return this.afterCurrentEvent(function(){this.trigger("beforeRequest"),this._requestArgsCache||(this._requestArgsCache=$.extend({},this._getArgs(),t)),this.__self.isOnline()&&this._req.get(this._requestArgsCache,this._onSuccess,this._onError)}),this},abort:function(){return this._req.abort(),this.blocks.length=0,this},_onSuccess:function(t){return t&&"captcha"===t.type?(c.hit({dtype:"stred",pid:40,cid:72952,path:BEM.blocks["i-global"].param("project").replace("/",".")}),void window.location.assign(t.captcha["captcha-page"])):(this._requestArgsCache=null,this.unbindEvents(),BEM.blocks["i-global"].param("pushbundle")&&(this._updateAssets(t),this._updateBundleParams(t)),void this._callback("success",t))},_onError:function(t){this.__self.isOnline()&&(this._requestArgsCache=null,this.unbindEvents()),this._callback("error",t)},_updateAssets:function(t){if("object"!=typeof t||null===t)return this;var e=this._getNodesFragment(t);e&&this._appendNodesFromFragment(e),delete t.assets},_getNodesFragment:function(t){var e=t.assets&&t.assets.assets;if(e&&e.length){var i=document.createDocumentFragment();return e.forEach(function(e){var n;n="style"===e.type&&e.url?this._createStyleLinkNode(e):this._createNode(t,e),i.appendChild(n)},this),i}},_appendNodesFromFragment:function(t){return document.head.appendChild(t),this},_createNode:function(t,e){var i=e.type,n=document.createElement(i);return e.content&&(n.textContent=e.content),e.url&&(n.src=e.url,n.async="async",Ya.PerfCounters.sendResTiming(2778,n.src)),"script"===i&&e.bundleName&&this._setBundleWaitEvents(t,n,e.bundleName),e.attrs&&Object.keys(e.attrs).forEach(function(t){n.setAttribute(t,e.attrs[t])}),n},_setBundleWaitEvents:function(t,e,i){this.__self._waitJSBundles[i]=1,e.onload=function(){delete this.__self._waitJSBundles[i],
this._callBlockWithSuccessCB(t)}.bind(this),e.onerror=function(){c.hitDelayed({dtype:"iweb",reqid:BEM.blocks["i-global"].param("reqid"),path:BEM.blocks["i-global"].param("project").replace("/",".")+"/bundles/load-error",vars:window.Ya.counter.stringifyParams({17:i},",")})}},_createStyleLinkNode:function(t){var e=document.createElement("link");return e.rel="stylesheet",e.href=t.url,e},_updateBundleParams:function(t){if(t&&t.metadata){var e=t.metadata;BEM.blocks["i-global"].setParams({bundlesMetadata:e.bundlesMetadata,assetsMetadata:e.assetsMetadata})}},_callback:function(t,e){return this.trigger("beforeCallback"),"success"===t?void this._callBlockWithSuccessCB(e):void this._blocksCallback(t,e)},_callBlockWithSuccessCB:function(t){var e={};this.blocks.forEach(function(i,n){if(!this.blocks[n].called){var s=this._getBlockName(i.decl),o=t.blocks?t.blocks[n]:t[i.decl];this._isBlockWaitBundle(o)||(i.success.call(i.ctx,o,i.decl),this.blocks[n].called=!0,this._setSuccessData(e,t,{decl:i.decl,blockName:s,index:n}))}}.bind(this)),this.__self._requestCallbackEnabled(this.blocks)&&this.params.success.call(this.params.ctx,e)},_isBlockWaitBundle:function(t){if(!BEM.blocks["i-global"].param("pushbundle")||!t||!t.params)return!1;var e,i,n=Array.isArray(t.params.bundles)&&t.params.bundles.length;if(n)for(i=0;n>i;i++)if(e=t.params.bundles[i],this.__self._waitJSBundles[e])return!0;return!1},_blocksCallback:function(t,e){this.blocks.forEach(function(i){i[t].call(i.ctx,e,i.decl)}),this.params[t].call(this.params.ctx,e)},_setSuccessData:function(t,e,i){var n=i.blockName,s=i.index;"string"==typeof i.decl?t[n]=e.blocks[s]:(Array.isArray(t[n])||(t[n]=[]),t[n].push(e.blocks[s]))},_getBlockName:function(t){return"string"==typeof t?t:t.block},_getRequestString:function(){var t=BEM.blocks["i-global"],e={blocks:this.blocks.map(function(t){return{block:t.decl,params:t.params,version:2}})};return BEM.blocks["i-global"].param("pushbundle")&&(e.bmt=t.param("bundlesMetadata"),e.amt=t.param("assetsMetadata")),JSON.stringify(e)},_getArgs:function(){return $.extend({format:"json",request:this._getRequestString()},"jsonp"===this.params.dataType?{yu:BEM.blocks["i-global"].param("yandexuid")}:{})},_onChangeNetworkStatus:function(){this.__self.isOnline()&&this._requestArgsCache&&this._get()},getDefaultParams:function(){return{url:"/",dataType:"jsonp",ctx:this}}},{_waitJSBundles:{},isWaitBundles:function(){return BEM.blocks["i-global"].param("pushbundle")&&Boolean(Object.keys(this._waitJSBundles).length)},_requestCallbackEnabled:function(t){return this.isWaitBundles()?t.every(function(t){return Boolean(t.called)}):!0}}),BEM.decl("i-request_type_bem",{_onSuccess:function(){var t=BEM.blocks["i-global"].param("lags"),e=t&&t.load,i=this.__base,n=arguments;e?setTimeout(function(){i.apply(this,n)}.bind(this),e):i.apply(this,n)}}),function(t){t.decl({block:"i-request_type_ajax",baseBlock:"i-request"},{onSetMod:{js:{inited:function(){this.__base(),this._requestNumber=this._number=this._preventNumber=this._retryCount=0}}},_get:function(t,e,i,n){this._number++,this._requestNumber++,this._retryCount=n.retryCount,this.__base.apply(this,arguments)},_do:function(t,e,i,n){var s=this;if(s._number>s._preventNumber){var o=arguments,r={data:n.data?$.extend({},n.data,t):t},a=s._wrapCallback(function(i,o,r){s._onSuccess(s._buildCacheKey(t,n),t,i[0],n),s._allowCallback(o,r)&&e.apply(n.callbackCtx,i)}),c=s._wrapCallback(function(t,e,r){s._allowCallback(e,r)&&(s._retryCount-- >0?setTimeout(function(){s._do.apply(s,o)},n.retryInterval):i&&i.apply(n.callbackCtx,t))});$.each(["url","dataType","timeout","type","jsonp","jsonpCallback","xhrFields"].concat(n.paramsToSettings||[]),function(t,e){r[e]=n[e]}),$.ajax(r).done(a).fail(c)}},_wrapCallback:function(t){var e=this._requestNumber,i=this._number;return function(n){null!==n&&t(arguments,e,i)}},_allowCallback:function(t,e){return e>this._preventNumber&&this._requestNumber===t},_buildCacheKey:function(t,e){return"string"==typeof t?t:this.__base(t)+e.url},abort:function(){this._preventNumber=++this._number},getDefaultParams:function(){return $.extend(this.__base(),{cache:!0,type:"GET",dataType:"jsonp",timeout:2e4,retryCount:0,retryInterval:2e3})}})}(BEM),BEM.decl("i-request_type_ajax",{onSetMod:{js:function(){this.__base.apply(this,arguments),this.cacheIrrelevantParams=["yu","uinfo","viewport","rpt","_","pos"]}},getDefaultParams:function(){return $.extend(this.__base.apply(this,arguments),{timeout:3e5})},_get:function(t,e,i,n){if(this.params.timeout){var s,o=this._buildCacheKey(t,n),r=this.__self._cache,a=r[n.cacheGroup];n.cache&&a&&o in a.data&&(s=a.timestamps[o],(new Date).getTime()-s>this.params.timeout&&(delete a.timestamps[o],delete a.data[o],a.keys.splice(a.keys.indexOf(o),1)))}this.__base.apply(this,arguments)},_buildCacheKey:function(t,e){if("string"==typeof t)return t;for(var i=$.extend(!0,{},t),n=this.cacheIrrelevantParams,s=0,o=n.length;o>s;s++)n[s]in i&&delete i[n[s]];return void 0===i.p&&(i.p=1),$.param(i)+e.url},putToCache:function(t,e){var i=this._buildCacheKey(e,t),n=this.__self._cache,s=n[t.cacheGroup]||(n[t.cacheGroup]={keys:[],data:{},timestamps:{}});this.__base.apply(this,arguments),s.keys.length>=t.cacheSize&&delete s.timestamps[s.keys[0]],s.timestamps[i]=(new Date).getTime()}}),BEM.DOM.decl("b-page",{findBlocks:function(){return this.__base.apply(this,arguments),this._htmlBody=$("html,body"),this},_onUserScroll:function(){this._htmlBody.stop(),this.stopScrollTracking()},startScrollTracking:function(){this.isScrolling=!0,this.bindToWin("DOMMouseScroll mousewheel",$.throttle(this._onUserScroll.bind(this),100))},stopScrollTracking:function(){this.isScrolling=!1,this.unbindFromWin("DOMMouseScroll mousewheel",$.throttle(this._onUserScroll.bind(this),100))},scrollTo:function(t,e,i,n){i||(i=0);var s=t instanceof jQuery?t.offset().top-this._headerHeight-i-20:t;return e?this.isScrolling||(this.startScrollTracking(),this._htmlBody.animate({scrollTop:s},e,function(){this.stopScrollTracking(),n&&n.resolve()}.bind(this))):(window.scrollTo(0,s),n&&n.resolve()),this},enableScroll:function(){this.delMod("scroll-disabled"),this.loadScroll()},disableScroll:function(){this.saveScroll(),this.setMod("scroll-disabled","yes")},loadScroll:function(){window.scrollTo(this._savedScroll.x,this._savedScroll.y)},saveScroll:function(){this._savedScroll={x:window.scrollX,y:window.scrollY}}}),BEM.DOM.decl("b-page",{bindEvents:function(){return this.__base.apply(this,arguments),this._location.on("b-page_type_index",this._onPageIndex,this),this},_onPageIndex:function(t,e){this.checkCacheKey()&&this.loadIndex(e)},loadIndex:function(t){return this.load({type:"index",url:BEM.blocks["i-global"].param("router").index,params:t.params}),this}}),BEM.DOM.decl("b-page",{_onPageIndex:function(){this.__self.preventFocus=!0,this.__base.apply(this,arguments),this.afterCurrentEvent(function(){this.__self.preventFocus=!1}),this.cbirIntent&&this.cbirIntent.prepareInputForIndex()}}),BEM.DOM.decl("b-page",{bindEvents:function(){return this.__base.apply(this,arguments),this._location.on("b-page_type_search",this._onPageSearch,this),this},_onPageSearch:$.noop,loadSearch:function(t){return this.load({type:"search",url:t.path||BEM.blocks["i-global"].param("router").search,params:t.params,blocks:this.getBlocks()}),this}}),BEM.DOM.decl("b-page",{onSetMod:{js:{inited:function(){this.params.shouldUpdateFilters=!BEM.blocks["i-global"].param("hasHistoryAPI"),this.__base.apply(this,arguments)}}},_onPageSearch:function(t,e){this.checkCacheKey()&&this.loadSearch(e)},getBlocks:function(){var t=[{name:"search2:ajax",callback:function(t){this.trigger("search:input:update",t)}}];return this.params.shouldUpdateFilters&&t.push({name:"advanced-search__filters",callback:this._onAdvancedSearchData}),t},_onAdvancedSearchData:function(t){this.trigger("filters:update",t)}}),BEM.DOM.decl("b-page",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.params.shouldUpdateFilters=!0}}},getBlocks:function(){var t=this.__base.apply(this,arguments);return t.push({name:"preview__isWallpaper",callback:function(t){this.trigger("preview:update",t.params.isWallpaper)}}),t},_onAdvancedSearchData:function(t){_.isEmpty(t.params.filters)||this._advancedSearch||(this._advancedSearch=this.findBlockInside("advanced-search")),this.__base.apply(this,arguments)},_onPageSearch:function(){this.__base.apply(this,arguments),this.cbirIntent&&this.cbirIntent.prepareInputForSearch()}}),function(t,e){function i(t){t.isPrimary&&(f.push(t),setTimeout(Array.prototype.shift.bind(f),p))}function n(t,e){return Math.abs(t.clientX-e.clientX)>u||Math.abs(t.clientY-e.clientY)>u}function s(t){var e=t.clientX,i=t.clientY,n="_compat"+t.type;if(!t._sourcePoint){for(var s=0;s<f.length;s++){var o=f[s],r=o.target===t.target;if(!o[n]&&(r||!(Math.abs(e-o.clientX)>d||Math.abs(i-o.clientY)>d))&&(r||document.elementFromPoint(o.clientX,o.clientY)!==o.target)){t._sourcePoint=o,o[n]=t;break}}_.push(t),setTimeout(Array.prototype.shift.bind(_),p)}}function o(t){for(var e=0;e<_.length;e++)if(_[e]===t)return _[e]._sourcePoint}function r(t){var e=o(t);return Boolean(e)&&e.target!==t.target}function a(t){var i,n=t.type;return t.button||(t.type="pointerclick",i=e.event.dispatch.apply(this,arguments),t.type=n),i}if(!e.event.special.pointerclick){var c,h=void 0!==t.ontouchstart||navigator.msMaxTouchPoints>0,l="touchAction"in document.documentElement.style,u=10,d=25,p=900,m=250,f=[],_=[],g=null,b=null,v=l?function(t){function e(t){return t&&t!==document.documentElement?"manipulation"===getComputedStyle(t)["touch-action"]||e(t.parentElement):!1}return e(t)}:function(){return!1};h?(c={click:function(t){var e=Object(t.originalEvent)._sourcePoint;return e?void(e.isDefaultPrevented()&&t.preventDefault()):a.apply(this,arguments)},"pointerdown pointermove pointerleave pointercancel pointerup":function(t){var e=t.type;if("mouse"!==t.pointerType&&("pointerdown"!==e&&"pointerup"!==e||!v(t.target)))if("pointerdown"===e)b=t;else if("pointermove"===e&&b&&(b.target!==t.target||n(b,t)))b=null;else if("pointerleave"===e||"pointercancel"===e)b=null;else if("pointerup"===e){if(i(t),!b)return;if(!(t.timeStamp-b.timeStamp>m))return g||(g=setTimeout(function(){g=b=null})),a.apply(this,arguments);b=null}}},["mousedown","click"].forEach(function(e){t.addEventListener(e,function(t){s(t),r(t)&&(t.preventDefault(),t.stopPropagation())},!0)})):c={click:function(t){return a.apply(this,arguments)}},e.event.special.pointerclick={setup:function(){e(this).on(c)},teardown:function(){e(this).off(c)}}}}(window,jQuery),BEM.DOM.decl("popup",{getDefaultParams:function(){var t={left:15,right:15,top:15,bottom:15};return{zIndexGroupLevel:0,directions:[{to:"bottom",axis:"center",tail:{axis:"center"}},{to:"top",axis:"center",tail:{axis:"center"}},{to:"right",axis:"middle",tail:{axis:"middle"}},{to:"left",axis:"middle",tail:{axis:"middle"}}],tail:{width:24.04,height:12.02,offset:t},duration:150}},onSetMod:{js:{inited:function(){this._cache={},this._viewport=BEM.DOM.win,this._scope=BEM.DOM.scope,this._channel=BEM.channel("popups"),this._inContainer=!1,this._isParentFixed=!1,this._owner=null,this._destructor=null,this._userPosition=null,this._parent=null,this._childs=[],this._isShown=!1,this._isHiding=!1,this._positions={},this._currPos={},this._visibilityFactor=null,this._direction=!1,this._directions={};var t=this.getDefaultParams(),e=this.params,i=this._repackDirParams(t.directions),n=e.generateDirections?this._generateDirections:e.directions,s=this._repackDirParams(n);e.tail&&(this.params.tail=this._mergeParams(t.tail,e.tail)),this._order=s.keys.map(function(t){var e=s.directions[t],n=i.directions[t];return n||(n=i.directions[e.to]),this._directions[t]=this._mergeParams(n,e,{tail:this._tailParamsHook}),t},this),this._zIndex=null,this._zIndexGroupLevel=null}},visibility:{visible:function(){this._onShown()},"":function(){this._onHidden()}}},show:function(t){var e;if(t instanceof BEM)e=t.domElem.eq(0);else if(t instanceof $)e=t;else if(!t)return;if(e){if(this._owner&&e[0]!==this._owner[0]&&this.delMod("visibility"),this._owner=e,e.length){var i="_"+this.__self.getName()+"-destructor";this._destructor=e.addClass("i-bem "+i).bem(i)}var n=this._findParent(e);n&&this.setParent(n)}else this._userPosition=t;return this.setMod("visibility","outside").repaint()},hide:function(t){if(this._isHiding)return this;if(this._isShown){var e=$.Event("before-hide");if(this.trigger(e,t),e.isDefaultPrevented())return this;if(this._isHiding=!0,this._childs.forEach(function(t){t.hide&&t.hide(),t.delMod("visible")}),this.hasMod("animate","yes")&&!this.hasMod("fade-out","no")){var i=this;return this.beforeHide(function(){i.domElem&&i.delMod("visibility")}),this}}return this.delMod("visibility")},toggle:function(t,e){return this._isShown&&!this._isHiding?this.hide(e):this.show(t||this._owner)},repaint:function(){this._moveToContainer();var t=this._pickDirection();return this.setMod("to",t.to)._show(this._positions[t.key],this._tailPos&&this._tailPos[t.key]),this},getCurrPos:function(){return this._currPos},getCurrDirection:function(){return this._direction},setScope:function(t){return this._scope=t,this._inContainer=!1,this},setContent:function(t){return BEM.DOM.update(this.elem("content"),t),this._resetDefault(),this._isShown&&this.repaint(),this},isShown:function(){return this._isShown},setParent:function(t){return this._parent=t,this._isParentFixed=t.hasMod("position","fixed"),t.addChild&&t.addChild(this),this},addChild:function(t){for(var e=this._childs,i=e.length,n=0;i>n;n++)if(e[n]._uniqId===t._uniqId)return;t.on("hide",function(){this.removeChild(t)},this),t.on("beforeClose",function(){this.afterCurrentEvent(function(){this.removeChild(t)})},this),e.push(t)},_getParentPopup:function(){return this._parent},removeChild:function(t){for(var e=this._childs,i=e.length,n=0;i>n;n++)if(e[n]._uniqId===t._uniqId)return void e.splice(n,1)},setSize:function(t){return t&&(this._resetDefault(),this.domElem.css(t),this._isShown&&!this._isHiding&&this.repaint()),this},_show:function(t,e){return this._currPos=t,e&&this.elem("tail").removeAttr("style").css(e),this.domElem.css(t),(!this._isShown||this._isHiding)&&this.hasMod("animate","yes")&&!this.hasMod("fade-in","no")&&this.afterShow(),this._isHiding=!1,this.setMod("visibility","visible"),this},_onShown:function(){this._isShown||this._bindCompatibility(),this.bindToDoc("keydown",function(t){t.which===BEM.blocks.keycodes.ESC&&0===this._childs.length&&this.hide({source:"esc-key"})}),this._attachRepaintOnResize(),this._bindFocusEvents(),this._attachUnder(),this._isShown=!0,this.hasMod("autoclosable","yes")&&this.afterCurrentEvent(function(){this.domElem&&this._enableAutoclosable()}),this.hasMod("adaptive","yes")&&this._enableAdaptive(),this._channel.on("hide",this.hide,this),this.trigger("show")},_bindCompatibility:function(){this._captureZIndex(),this.__self._visiblePopupsStack.unshift(this),this.trigger("beforeOpen")},_unbindCompatibility:function(){this.trigger("beforeClose");var t=this.__self._visiblePopupsStack;t.splice(t.indexOf(this),1),this._releaseZIndex()},_onHidden:function(){this._isShown&&this._unbindCompatibility(),this.unbindFromDoc("keydown"),this._detachRepaintOnResize(),this._unbindFocusEvents(),this.hasMod("autoclosable","yes")&&this._disableAutoclosable(),this.hasMod("adaptive","yes")&&this._disableAdaptive(),this._detachUnder(),this._cache={},this._isShown=!1,this._isHiding=!1,this._channel.un("hide"),this._returnFocus(),this.trigger("hide")},_attachRepaintOnResize:function(){window.attachEvent&&this.domElem[0].attachEvent("onresize",this.__self._enforcePageRepaint)},_detachRepaintOnResize:function(){window.detachEvent&&this.domElem[0].detachEvent("onresize",this.__self._enforcePageRepaint)},_bindFocusEvents:function(){this._lastFocused=$($.dom.getActiveElement()[0]||this._scope);var t=this.__self._getFocusable(this.elem("content"));return this._firstFocusable=t.first(),this._lastFocusable=t.last(),this._skipReturnFocus=!1,0===this._firstFocusable.length?void(this._skipReturnFocus=!0):void this.bindTo(this._lastFocused,"keydown",this._onLastFocusedKeyDown).bindTo(this._firstFocusable,"keydown",this._onFirstFocusableKeyDown).bindTo(this._lastFocusable,"keydown",this._onLastFocusableKeyDown)},_unbindFocusEvents:function(){this.unbindFrom(this._firstFocusable,"keydown"),this.unbindFrom(this._lastFocusable,"keydown"),this.unbindFrom(this._lastFocused,"keydown")},_onLastFocusedKeyDown:function(t){this._lastFocused.is(this._scope)&&!this._lastFocused.is(t.target)||t.ctrlKey||t.altKey||t.metaKey||t.which===BEM.blocks.keycodes.TAB&&(t.preventDefault(),this[t.shiftKey?"_lastFocusable":"_firstFocusable"].focus())},_onFirstFocusableKeyDown:function(t){t.ctrlKey||t.altKey||t.metaKey||t.shiftKey&&t.which===BEM.blocks.keycodes.TAB&&(t.preventDefault(),this._lastFocused.focus())},_onLastFocusableKeyDown:function(t){t.shiftKey||t.ctrlKey||t.altKey||t.metaKey||t.which===BEM.blocks.keycodes.TAB&&(t.preventDefault(),this._lastFocused.focus())},_returnFocus:function(){var t=(this._parent||{})._skipReturnFocus||this._skipReturnFocus;t||this._lastFocused.focus()},_mergeParams:function(t,e,i){var n={},s=Object.prototype.hasOwnProperty;return i||(i={}),t&&"object"==typeof t&&Object.keys(t).forEach(function(e){n[e]=t[e]}),Object.keys(e).forEach(function(o){var r=s.call(i,o)?i[o].call(this,t[o],e[o]):e[o];!r||"object"!=typeof r||Array.isArray(r)?n[o]=r:t[o]?n[o]=this._mergeParams(t[o],r,i):n[o]=r},this),n},_tailParamsHook:function(t,e){return e.offset||(e.offset=this.params.tail.offset),"number"==typeof e.offset?{offset:{left:e.offset,top:e.offset}}:e},_generateDirections:function(){if(this.__self._generateDirectionsCache)return this.__self._generateDirectionsCache;for(var t=[["bottom","top"],["left","right"]],e=[["center","left","right"],["middle","top","bottom"]],i=e,n=t.length,s=[],o=0;n>o;o++)for(var r=t[o],a=r.length,c=0;a>c;c++)for(var h=e[o],l=h.length,u=0;l>u;u++)for(var d=i[o],p=d.length,m=0;p>m;m++)s.push({direction:r[c],axis:h[u],tail:{axis:d[m]}});return this.__self._generateDirectionsCache=s,s},_repackDirParams:function(t){var e={},i=[];return("string"==typeof t||$.isPlainObject(t))&&(t=[t]),i=t.map(function(t){if("string"==typeof t){var i=t.split("-");t={to:i[0],tail:{}},i[1]&&(t.axis=i[1]),i[2]&&(t.tail.axis=i[2])}var n=t.to;return e[n]||(e[n]=t),t.axis&&(n+="-"+t.axis),t.key=n,e[n]=t,n},this),{directions:e,keys:i}},setViewport:function(t){return this._viewport=t,this},_pickDirection:function(){var t,e=this._order,i=this.hasMod("adaptive","yes")?e.length:1;for(this._visibilityFactor=0,t=0;i>t;t++){var n=e[t],s=this._directions[n];this._resetPos(n)._pushPos(n,this._calcPos(s))._pushPos(n,this._calcOffsets(s)),this._hasTail()&&this._resetTailPos(n)._pushTailPos(n,this._calcTailPos(s))._pushTailPos(n,this._calcTailOffset(s))._pushPos(n,this._calcOffsetByTail(s)),this._pushPos(n,this._getParentOffset());var o=this._calcVisibilityFactor(s);if((o>this._visibilityFactor||!this._direction)&&(this._visibilityFactor=o,this._direction=this._directions[n],this.size=this.getPlacingSize(),100===o))break}return this._direction},_getParentOffset:function(){var t=this.domElem.offsetParent().offset();return t.left*=-1,t.top*=-1,t},_calcPos:function(t){this._calcPlacingSize(t);var e=this.getOwnerPos(),i=this.getOwnerSize(),n=this.getPlacingSize(),s=t.axis,o=this.params.position||{},r={},a=Object.prototype.hasOwnProperty;switch(t.to){case"bottom":r={top:a.call(o,"top")?o.top:e.top+i.height,left:a.call(o,"left")?o.left:this._calcLeft(s)};break;case"top":r={top:a.call(o,"top")?o.top:e.top-n.height,left:a.call(o,"left")?o.left:this._calcLeft(s)};break;case"left":r={top:a.call(o,"top")?o.top:this._calcTop(s),left:a.call(o,"left")?o.left:e.left-n.width};break;case"right":r={top:a.call(o,"top")?o.top:this._calcTop(s),left:a.call(o,"left")?o.left:e.left+i.width}}return r},_calcTop:function(t){var e=0,i=this.getPlacingSize(),n=this.getOwnerPos(),s=this.getOwnerSize();return"top"===t?e+=n.top:"middle"===t?e+=n.top+s.height/2-i.height/2:"bottom"===t&&(e+=n.top+s.height-i.height),e},_calcLeft:function(t){var e=0,i=this.getPlacingSize(),n=this.getOwnerPos(),s=this.getOwnerSize();return"left"===t?e+=n.left:"center"===t?e+=n.left+s.width/2-i.width/2:"right"===t&&(e+=n.left+s.width-i.width),e},getPlacingSize:function(){return this.getPopupSize()},_calcOffsets:function(t){var e,i=this._cache.offset||(this._cache.offset={}),n=t.key,s=t.offset;if(i[n])return i[n];if(!s)return!1;if(e={left:0,top:0},"number"==typeof s)switch(n){case"left":e.left+=s;break;case"right":e.left-=s;break;case"top":e.top+=s;break;case"bottom":e.top-=s}else s.left&&(e.left+=s.left),s.right&&(e.left-=s.right),s.top&&(e.top+=s.top),s.bottom&&(e.top-=s.bottom);return i[n]=e,e},_hasTail:function(){return 0!==this.elem("tail").length},_moveToContainer:function(t){if(t)this._inContainer=!1;else{if(this._isShown)return;t=this._parent?this._parent.domElem:this._scope}this.domElem.appendTo(t),this._inContainer=!0},_resetPos:function(t){return t?this._positions[t]=null:this._positions={},this},_pushPosTo:function(t,e,i){i!==!1&&("string"==typeof e?this._sum(t[e]||(t[e]={}),i):(i=e,Object.keys(t).forEach(function(e){this._sum(t[e],i)},this)))},_pushPos:function(t,e){return this._pushPosTo(this._positions,t,e),this},_sum:function(t,e){Object.keys(e).forEach(function(i){t[i]=(t[i]||0)+e[i]})},_getSizeOf:function(t){return{height:t.outerHeight(),width:t.outerWidth()}},getOwnerSize:function(){return this._owner?this._cache.ownerSize||(this._cache.ownerSize=this._getSizeOf(this._owner)):{height:0,width:0}},getPopupSize:function(){return this._getSizeOf(this.domElem)},_getPosOf:function(t){return t.offset()||{left:0,top:0}},getOwnerPos:function(){var t;return this._owner&&(t=this._getPosOf(this._owner),"pageYOffset"in window&&(t.top-=window.pageYOffset-(document.documentElement.scrollTop||document.body.scrollTop),t.left-=window.pageXOffset-(document.documentElement.scrollLeft||document.body.scrollLeft))),t||this._userPosition},_calcVisibilityFactor:function(t){var e,i,n=this._viewport,s=this._getSizeOf(n),o=this.getPopupSize(),r=this._positions[t.key],a=this._parent&&this._isParentFixed?this._parent.domElem.offset():{top:0,left:0},c=this.hasMod("position","fixed")?{top:0,left:0}:{top:n.scrollTop(),left:n.scrollLeft()},h=r.top+a.top-c.top,l=r.left+a.left-c.left,u=l+o.width-s.width,d=h+o.height-s.height,p={height:o.height,width:o.width},m=100;return d>0&&(p.height-=d),0>h&&(p.height+=h),0>l&&(p.width+=l),u>0&&(p.width-=u),p.height<0||p.width<0?m=0:(i=Math.abs(p.height*p.width),e=o.height*o.width,e!==i&&(m=i/e*100)),m},_findParent:function(t){var e=t.closest(".popup, .popup2");return this.findBlockOn(e,"popup")||this.findBlockOn(e,"popup2")},destruct:function(){return this._childs.forEach(function(t){t.domElem&&BEM.DOM.destruct(t.domElem)}),this.setMod("fade-out","no"),this.hide(),this._isShown&&this._unbindCompatibility(),this.__base.apply(this,arguments)},_calcZIndexGroupLevel:function(){var t=this.params.zIndexGroupLevel,e=this._getParentPopup();return e&&(t+=e._zIndexGroupLevel),this._destructor?this._destructor.findBlocksOutside("z-index-group").reduce(function(t,e){return t+Number(e.getMod("level"))},t):t},_captureZIndex:function(){null===this._zIndexGroupLevel&&(this._zIndexGroupLevel=this._calcZIndexGroupLevel());var t=this.__self._visiblePopupsZIndexes,e=this._zIndexGroupLevel,i=t[e],n=this._zIndex;return i||(i=t[e]=[(e+1)*this.__self.ZINDEX_FACTOR]),this._zIndex=i[i.length-1]+1,i.push(this._zIndex),this._zIndex!==n&&this.domElem.css("z-index",this._zIndex),this},_releaseZIndex:function(){var t=this.__self._visiblePopupsZIndexes[this._zIndexGroupLevel];return t.splice(t.indexOf(this._zIndex),1),this},_resetDefault:function(){},_calcPlacingSize:function(){}},{live:function(){this.liveBindTo("close","pointerclick",function(){this.hide({source:"close-click"})})},_visiblePopupsStack:(BEM.blocks.popup2||{})._visiblePopupsStack||[],_visiblePopupsZIndexes:(BEM.blocks.popup2||{})._visiblePopupsZIndexes||{},ZINDEX_FACTOR:1e3,_getFocusable:function(t){var e=$.data(t,"popup-getFocusable-id");e||(e=$.identify(),$.data(t,"popup-getFocusable-id",e)),e='*[data-popup-getFocusable-id="'+e+'"]';var i="a[href], link, ";return BEM.blocks["i-ua"].opera<13&&(i=""),t.find(i+'*[tabindex], button, input:not([type="hidden"]), textarea, select, menuitem').filter(function(){var t=$(this),i=!0;return parseInt(t.prop("tabindex"),10)<0||"hidden"===t.css("visibility")?!1:($(this).parentsUntil(e).each(function(){var t=$(this);return"none"===t.css("display")?i=!1:void 0}),i)})},_enforcePageRepaint:function(){document.body.className+=""},_generateDirectionsCache:null}),BEM.DOM.decl("popup",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.findBlockOn("share-dropdown")&&(this._isParentFixed=!0)}}}}),BEM.DOM.decl("popup",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),BEM.blocks["b-page"].on("load:start",this._onPageChange,this)}}},destruct:function(){BEM.blocks["b-page"].un("load:start",this._onPageChange,this),this.__base.apply(this,arguments)},_onPageChange:function(){this.hide()}}),BEM.DOM.decl("popup",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.findBlockOn("sizes-popup")&&(this._isParentFixed=!0)}},visibility:{visible:function(){this.__base.apply(this,arguments),this.bindToDoc("dragover",this.hide),BEM.blocks["i-keyrouter"].on("esc",this._onEsc,this),BEM.blocks["b-page"].on("touchmove",this._onTouchMove,this),this.hasMod("type","internal")||BEM.blocks["b-page"].on("scroll",this._onPageScroll,this)},"":function(){this.__base.apply(this,arguments),BEM.blocks["b-page"].un("touchmove",this._onTouchMove,this),BEM.blocks["i-keyrouter"].un("esc",this._onEsc,this),this.unbindFromDoc("dragover",this.hide),this.hasMod("type","internal")||BEM.blocks["b-page"].un("scroll",this._onPageScroll)}}},_onEsc:function(){this.hide()},_onTouchMove:function(t){$(t.target).closest(".popup").length||this.hide()},_pushPos:function(t,e){var i=e.top,n=e.left;return i&&"string"!=typeof i&&(e.top=Math.floor(i)),n&&(e.left=Math.floor(n)),this.__base.apply(this,arguments)},_onPageScroll:function(){this.hide()}}),BEM.decl("keycodes",{},{BACKSPACE:8,TAB:9,ENTER:13,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,is:function(t,e){return(Array.isArray(e)?e:Array.prototype.slice.call(arguments,1)).some(function(e){return this[e]===t},this)}}),BEM.DOM.decl("popup",{onSetMod:{js:{inited:function(){this.__base.call(this);var t=this.findElem("under").first();this._underClassAttr=t.attr("class"),this.isDivEnough()?this._under=t:(t.remove(),this._under=null),this._underInPool=!1}}},isDivEnough:function(){return!0},_createUnder:function(){return $('<iframe frameBorder="0" tabindex="-1" src="about:blank"/>')},_getUnder:function(){if(this._under)return this._under;var t=this.__self._underPool.pop();return t&&(this._underInPool=!1),this._under=t,t||this._createUnder()},_attachUnder:function(){var t=this._under=this._getUnder();t.attr("class",this._underClassAttr),this.hasMod(t,"type","paranja")?t.detach().insertBefore(this.domElem).css("z-index",this._zIndex):t.prependTo(this.domElem)},_detachUnder:function(){var t=this._under;t.removeAttr("style"),this.__self._underPool.push(t.detach()),this._under=null,this._underInPool=!0},destruct:function(){var t=this.__base.apply(this,arguments);return this._underInPool&&this.__self._underPool.pop(),this._under&&this._under.remove(),t}},{_underPool:[]}),BEM.DOM.decl("popup",{isDivEnough:function(){return BEM.blocks["i-global"].param("mobile")}}),BEM.DOM.decl("popup",{onSetMod:{autoclosable:{yes:function(){this._enableAutoclosable()},"":function(){this._disableAutoclosable()}}},_enableAutoclosable:function(){if(this.domElem){var t=this._under;this.hasMod(t,"type","paranja")&&(t.is("iframe")&&(t=$([t[0].contentWindow,t[0].contentWindow.document])),this.bindTo(t,"pointerclick",function(t){t.stopPropagation(),this.hide({source:"outside-click"})}),this.bindTo(t,"pointerdown",function(){this._skipReturnFocus=!0})),this.bindTo("pointerdown pointerclick",function(){var t=this;do t._preventHideByClick=!0,t=t._getParentPopup();while(t)}),this.bindToDoc("pointerclick",function(t){if(this._preventHideByClick)return void(this._preventHideByClick=null);if(!this._isRelatedNode($(t.target))){var e=$.Event("outside-click");this.trigger(e,t),e.isDefaultPrevented()||this.hide({source:"outside-click"})}}),this.bindToDoc("pointerdown",function(){this._skipReturnFocus=!0})}},_disableAutoclosable:function(){var t=this._under;this.hasMod(t,"type","paranja")&&(t.is("iframe")&&(t=$([t[0].contentWindow,t[0].contentWindow.document])),this.unbindFrom(t,"pointerclick pointerdown")),this.unbindFromDoc("pointerclick pointerdown")},_isRelatedNode:function(t){var e=this.containsDomElem(t);if(e||(e=Boolean(this._owner)&&this.containsDomElem.call({domElem:this._owner},t)),e)return!0;var i,n=this._childs.length;for(i=0;n>i;i++)if(this.containsDomElem.call({domElem:this._childs[i].domElem},t))return!0;return!1}}),BEM.DOM.decl({block:"popup",modName:"adaptive",modVal:"yes"},{onSetMod:{adaptive:{yes:function(){this._enableAdaptive()},no:function(){this._disableAdaptive()}},"watch-scroll":{yes:function(){this._watchScroll()},no:function(){this._unwatchScroll()}}},_enableAdaptive:function(){this.afterCurrentEvent(function(){this.domElem&&this.bindToWin("resize",this.onResize)}),this._watchScroll()},_disableAdaptive:function(){this.unbindFromWin("resize")._unwatchScroll()},getScrollEvents:function(){return["scroll"]},_watchScroll:function(){this._owner&&!this.hasMod("watch-scroll","no")&&this.bindTo(this._owner.parents().add(this._viewport),this.getScrollEvents().join(" "),this.onScroll,this)},_unwatchScroll:function(){this._owner&&this.unbindFromDomElem(this._owner.parents().add(this._viewport),this.getScrollEvents().join(" "))},onResize:function(t){this._cache={},this._isShown&&!this._isHiding&&this.repaint()},onScroll:function(t){this._cache={},this._isShown&&!this._isHiding&&this.repaint()},destruct:function(){this._disableAdaptive(),this.__base.apply(this,arguments)}}),BEM.DOM.decl({block:"popup",modName:"animate",modVal:"yes"},{afterShow:function(){var t=this.getCurrDirection();if(t){var e=t.to,i=this.getCurrPos(),n={opacity:1,top:i.top,left:i.left},s={opacity:0,top:i.top,left:i.left};"bottom"===e?s.top+=10:"top"===e?s.top-=10:"left"===e?s.left-=10:"right"===e&&(s.left+=10),this.domElem.stop(!0).css(s).animate(n,this.params.duration)}},beforeHide:function(t){var e=this.getCurrDirection();if(!e)return t();var i=e.to,n=this.getCurrPos(),s=this.domElem,o={top:n.top,left:n.left,opacity:0};return"bottom"===i?o.top+=10:"top"===i?o.top-=10:"left"===i?o.left-=10:"right"===i&&(o.left+=10),s.stop(!0,!0).animate(o,this.params.duration,function(){t(),s.css("opacity","")})}}),function(t){t.dom={getActiveElement:function(){try{return t(document.activeElement)}catch(e){return t()}}},t.fn.isFocused=function(){return this.is(t.dom.getActiveElement())}}(jQuery),BEM.DOM.decl({block:"popup",modName:"position",modVal:"fixed"},{addChild:function(t){this.__base.apply(this,arguments),t.setMod("watch-scroll","no")},_onFirstFocusableKeyDown:function(t){t.ctrlKey||t.altKey||t.metaKey||t.shiftKey&&t.which===BEM.blocks.keycodes.TAB&&(t.preventDefault(),this._lastFocusable.focus())},_onLastFocusableKeyDown:function(t){t.shiftKey||t.ctrlKey||t.altKey||t.metaKey||t.which===BEM.blocks.keycodes.TAB&&(t.preventDefault(),this._firstFocusable.focus())}}),BEM.DOM.decl({block:"popup",modName:"position",modVal:"fixed"},{getOwnerPos:function(){var t=this.__base.apply(this,arguments);if(this._owner){var e=this._viewport;t.top-=e.scrollTop(),t.left-=e.scrollLeft()}return t}}),BEM.DOM.decl("nps",{getDefaultParams:function(){return{timeout:{show:1e4,hide:5e3}}},onSetMod:{js:function(){var t,e=this.params;this.cookie=BEM.blocks["i-cookie"].get(),this.isEqual=this.hasMod("equal","yes"),e.save&&this.cookie.yp(this.hasMod("cbir","yes")?"cnps":"nps",[e.rand,e.status].join(":"),e.expires),
this.isClosed()||(this.findBlocks().bindEvents(),t=this.page.getMod("type"),this.hasMod("cbir","yes")?this.isCbirPages("b-page_type_"+t)&&this.show():"search"===t?this.show():this.location.on("b-page_type_search",this.show,this))},hidden:{yes:function(){this.isClosed()||this.afterCurrentEvent(function(){this.popup.hide()})},"":function(){this.isClosed()||this.hasMod("search","yes")&&this._disable||this.hasMod("cbir","yes")&&this._disable||(this.hasMod("cbir","yes")&&this.isEqual&&this.searchPopup&&(this.searchPopup._disable=!0),this.hasMod("search","yes")&&this.isEqual&&this.cbirPopup&&(this.cbirPopup._disable=!0),this.afterCurrentEvent(function(){this.popup.show(this.popupAnchor)}))}},layout:{view:function(){this.hide()},"":function(){this.show()}}},findBlocks:function(){return this.popupAnchor=this.findBlockOutside("b-page").elem("content"),this.location=BEM.blocks.location.getInstance(),this.popup=this.findBlockOn("popup"),this.list=this.findBlockInside("radio-button"),this.button=this.findBlockInside("button"),this.question=this.elem("text"),this.page=this.findBlockOutside("b-page"),this.cbirPopup=this.page.findBlockInside({block:"nps",modName:"cbir",modVal:"yes"}),this.searchPopup=this.page.findBlockInside({block:"nps",modName:"search",modVal:"yes"}),this},bindEvents:function(){return this.button.on("click",this._onSendClick,this),this.popup.on("hide",this._onPopupHidden,this),this.list.on("change",this._onRadioChange,this),this.location.on("change",this._onPageChange,this),this},destruct:function(){this.button.un("click",this._onSendClick,this),this.popup.un("hide",this._onPopupHidden,this),this.list.un("change",this._onRadioChange,this),this.location.un("change",this._onPageChange,this),this.__base.apply(this,arguments)},_onPageChange:function(t,e){"b-page_type_search"===e.block?this.show():this.hide()},_onRadioChange:function(t,e){this.enableButton(),this.value=e},_onPopupHidden:function(){if(this.hasMod("hidden","yes"))return!1;this.hide();var t=this.getMod("type");return this.hasMod("minimized","yes")?(this.saveStatus("close"),this.hasMod("thanks","yes")||w(null,["/image/new",this.hasMod("cbir","yes")?"cbir":"serp",t,"close"].join("/"))):(this.minimizeNPS(),w(null,["/image/new",this.hasMod("cbir","yes")?"cbir":"serp",t,"small"].join("/")),this.show()),!1},_onSendClick:function(){var t=this.getMod("type");this.hasMod("minimized","yes")?(this.maximizeNPS(),this._isShown&&this.popup.repaint(),w(null,["/image/new",this.hasMod("cbir","yes")?"cbir":"serp",t,"normal"].join("/"))):(w(null,["/image/new",this.hasMod("cbir","yes")?"cbir":"serp",t,"result","p"+this.value].join("/")),this.showThanks())},hide:function(){return this.setMod("hidden","yes")},show:function(){return this.isClosed()?void 0:(this._isShown?this.delMod("hidden"):this.startPopupTimer(),this)},disableButton:function(){return this.button.delMod("focused").setMod("theme","normal").setMod("disabled","yes"),this},enableButton:function(){return this.button.setMod("theme","action").delMod("disabled"),this},initPopup:function(){var t=this.page.getMod("type");return this.hasMod("search","yes")&&"search"!==t?"":this.hasMod("cbir","yes")&&!this.isCbirPages("b-page_type_"+t)?"":(this._isShown=!0,this.hasMod("layout","view")||this.show().countShow(),void(this.hasMod("minimized","yes")?this.minimizeNPS():this.maximizeNPS()))},startPopupTimer:function(){this.location.un("b-page_type_search",this.show,this),setTimeout(this.changeThis(function(){this.initPopup(),this.popup.domElem.css({bottom:-this.domElem.height()+"px"}).animate({bottom:0})}),this.params.timeout.show)},countShow:function(){return this.params.save&&w(null,["/image/new",this.hasMod("cbir","yes")?"cbir":"serp",this.getMod("type"),"show"].join("/")),this},minimizeNPS:function(){var t=this.params.i18n;return this.setMod("minimized","yes").setButtonText(t.answer).setQuestion(t.invite).enableButton().saveStatus("min")},maximizeNPS:function(){var t=this.params.i18n;return this.setMod("minimized","no").setButtonText(t.send).setQuestion(t.question).saveStatus("max"),this.value||this.disableButton(),this},showThanks:function(){var t=this.params;this.popup.hide().setMod("animate","yes"),this.setMod(this.elem("button"),"hidden","yes").setMod("minimized","yes").setMod("thanks","yes").saveStatus("close").setQuestion(t.i18n.thankyou).show(),setTimeout(this.changeThis(this.hide),t.timeout.hide)},setQuestion:function(t){return this.question.text(t),this},setButtonText:function(t){return this.button.elem("text").text(t),this},isClosed:function(){return"close"===this.params.status},saveStatus:function(t){return this.cookie.yp(this.hasMod("cbir","yes")?"cnps":"nps",[this.params.rand,t].join(":")),this.params.status=t,this}}),BEM.DOM.decl({block:"nps",modName:"cbir",modVal:"yes"},{isCbirPages:function(t){var e=["b-page_type_search-by-image","b-page_type_similar"];return _.includes(e,t)},_onPageChange:function(t,e){this.isCbirPages(e.block)?this.show():this.hide()}}),BEM.DOM.decl("button",{onSetMod:{js:{inited:function(){var t=this.isDisabled(),e=this.domElem;(this._href=e.attr("href"))&&t&&e.removeAttr("href")}},disabled:function(t,e){var i=this.domElem;e&&this.delMod("hovered"),this._href&&(e?i.removeAttr("href"):i.attr("href",this._href)),this.afterCurrentEvent(function(){i&&i.prop("disabled",e)})},pressed:function(t,e){return this.hasMod("disabled")?!1:void this.trigger(e?"press":"release")}},isDisabled:function(){return this.hasMod("disabled","yes")},url:function(t){return"undefined"==typeof t?this._href:(this._href=t,this.isDisabled()||this.domElem.attr("href",t),this)},getUrl:function(){return this.url()},setUrl:function(t){return this.url(t)},_onPointerpress:function(t){this.setMod("pressed","yes").bindToDoc("pointerrelease",this._onPointerrelease)},_onPointerrelease:function(t){this.delMod("pressed").unbindFromDoc("pointerrelease")},_onClick:function(t){this.isDisabled()?t.preventDefault():this.afterCurrentEvent(function(){this.domElem&&this.trigger("click")})}},{live:function(){this.liveBindTo("pointerclick",function(t){this._onClick(t)}).liveBindTo("pointerpress",function(t){this.isDisabled()||this._onPointerpress(t)})}}),BEM.DOM.decl("button",{onSetMod:{focused:{yes:function(){return this.isDisabled()?!1:(this.bindToWin("unload",function(){this.delMod("focused")}).bindTo("keydown",this._onKeyDown),this._isControlFocused()||this._getControl().focus(),void this.trigger("focus"))},"":function(){var t=BEM.blocks["i-ua"].opera<13;this.unbindFromWin("unload").unbindFrom("keydown"),(t||document.hasFocus())&&this._isControlFocused()&&this._getControl().blur(),this.trigger("blur")}},disabled:function(t,e){this.__base.apply(this,arguments),e&&(this.delMod("focused"),this.domElem.keyup())},hovered:function(t,e){return this.isDisabled()?!1:void(!e&&this.delMod("pressed"))},pressed:function(){return this.isDisabled()||this.setMod("focused","yes"),this.__base.apply(this,arguments)}},_getControl:function(){return this.elem("control").length&&this.elem("control")||this.domElem},_isControlFocused:function(){return this.containsDomElem($.dom.getActiveElement())},_onKeyDown:function(t){var e=BEM.blocks.keycodes,i=t.keyCode;!this._keyDowned&&e.is(i,"ENTER","SPACE")&&(this._keyDowned=!0,this.setMod("pressed","yes").bindTo("keyup",function(){this.delMod("pressed").unbindFrom("keyup"),delete this._keyDowned,i===e.SPACE&&this.domElem.attr("href")&&(document.location=this.domElem.attr("href"))}))},destruct:function(){this.delMod("focused"),this.__base.apply(this,arguments)}},{live:function(){return this.liveBindTo("pointerover pointerout",function(t){this.isDisabled()||this.domElem[0].contains(t.relatedTarget)||this.toggleMod("hovered","yes","pointerover"===t.type)}).liveBindTo("focusin focusout",function(t){this.toggleMod("focused","yes","focusin"===t.type)}),8===BEM.blocks["i-ua"].ie&&this.liveBindTo("mouseup mouseout",function(t){this.domElem.height()}),this.__base()}}),BEM.DOM.decl("button",{_keyDowned:!0}),BEM.DOM.decl("radiobox",{onSetMod:{js:{inited:function(){this._val=this.findElem(this.elem("radio","checked","yes"),"control").val(),this.elem("control").each(function(t,e){var i=$(e),n=this.__self._getRadioByElem(i);i.isFocused()&&this.setMod(n,"focused","yes"),i.prop("checked")&&this.setMod(n,"checked","yes")}.bind(this))}},disabled:{yes:function(){this.setMod(this.elem("radio"),"disabled","yes")},"":function(){this.delMod(this.elem("radio"),"disabled")}}},onElemSetMod:{radio:{focused:{yes:function(t){this.delMod(this.elem("radio","focused","yes"),"focused");var e=this.findElem(t,"control");e.isFocused()||e.focus(),this.afterCurrentEvent(function(){this.domElem&&this.trigger("focus",{current:t})})},"":function(t){this.afterCurrentEvent(function(){this.domElem&&this.trigger("blur",{prev:t})})}},checked:{yes:function(t){var e=this.elem("radio","checked","yes"),i=this.findElem(t,"control"),n=this._val;this._willSwitch=!0,this.delMod(e,"checked"),this._willSwitch=!1,i.prop("checked",!0),this._val=i.val(),this.trigger("change",{current:t,currentVal:this._val,prev:e,prevVal:n})},"":function(t){var e=this.findElem(t,"control"),i=this._val;e.prop("checked",!1),this._val=void 0,this._willSwitch||this.trigger("change",{current:$(),currentVal:void 0,prev:t,prevVal:i})}},hovered:function(t){return!this.isDisabled(t)},pressed:function(t){return!this.isDisabled(t)},disabled:function(t,e,i){t.find(this.buildSelector("control")).prop("disabled",i),i&&this.delMod(t,"hovered").delMod(t,"pressed")}}},isDisabled:function(t){return this.hasMod(t,"disabled","yes")},val:function(t){if("undefined"==typeof t)return this._val;var e=this;return this.elem("control").each(function(i,n){return n.value===t?(e.setMod(e.__self._getRadioByElem($(n)),"checked","yes"),!1):void 0}),e},name:function(t){var e=this.elem("control");return arguments.length?(e.attr("name",t),this):e.attr("name")},getCurrent:function(){return this.findElem("radio","checked","yes")},uncheckAll:function(){return this.delMod(this.elem("radio","checked","yes"),"checked"),this},_onRadioEnter:function(t){this.setMod(t.data.domElem,"hovered","yes")},_onRadioLeave:function(t){this.delMod(t.data.domElem,"hovered")},_onRadioClick:function(t,e){this.isDisabled(t)||this.setMod(t,"focused","yes")},_onChange:function(t){this.setMod(this.__self._getRadioByElem(t.data.domElem),"checked","yes")},_onPointerpress:function(t){var e=t.data.domElem;this.setMod(e,"pressed","yes").bindToDoc("pointerrelease",function(){this.delMod(e,"pressed").unbindFromDoc("pointerrelease")})}},{live:function(){this.liveBindTo("radio","pointerclick",function(t){this._onRadioClick(t.data.domElem,t)}).liveBindTo("control","change",function(t){this._onChange(t)}).liveBindTo("radio","pointerover pointerout",function(t){t.data.domElem[0].contains(t.relatedTarget)||("pointerover"===t.type?this._onRadioEnter(t):this._onRadioLeave(t))}).liveBindTo("control","focusin focusout",function(t){var e=this.__self._getRadioByElem(t.data.domElem);this.setMod(e,"focused","focusin"===t.type?"yes":""),parseInt(BEM.blocks["i-ua"].ios,10)>=8&&t.preventDefault()}).liveBindTo("radio","pointerpress",function(t){this.hasMod(t.data.domElem,"disabled")||this._onPointerpress(t)})},_getRadioByElem:function(t){return t.closest(this.buildSelector("radio"))}}),BEM.DOM.decl("radiobox",{_onRadioClick:function(t,e){this.__base.apply(this,arguments),this._onChange(e),e.preventDefault()}}),BEM.DOM.decl({block:"radio-button",baseBlock:"radiobox"},{onElemSetMod:{radio:{pressed:{yes:function(){this.delMod(this.elem("radio","pressed","yes"),"pressed")}}}},_onPointerPress:function(t){this._pressedRadio=t.data.domElem,this.isDisabled(this._pressedRadio)||(this.setMod(this._pressedRadio,"pressed","yes"),this.bindToDoc("pointerrelease",this._onPointerRelease))},_onPointerRelease:function(t){var e=this._pressedRadio;delete this._pressedRadio,this.delMod(e,"pressed"),this.afterCurrentEvent(function(){if(this.domElem){var i=this.findElem(e,"control");i.prop("checked")||!e.is(t.target)&&!e.find(t.target).length||i.trigger("change").focus()}}),this.unbindFromDoc("pointerrelease")}},{live:function(){return this.liveBindTo("radio","pointerpress",function(t){this._onPointerPress(t)}),this.__base()}}),BEM.DOM.decl({block:"radio-button",modName:"breadcrumbs",modVal:"yes"},{_onMouseEvent:function(t){var e=t.type,i=t.data.domElem,n=this.extractElemIndex(i),s=this.elem("radio").length;switch(e){case"mouseover":this.setElemsMod(s,"active","").setElemsMod(s,"checked","").setElemsMod(n,"hovered","yes").setMod(i,"checked","yes").setHint(this.extractHint(i)||this.params.hint);break;case"mouseout":this.selectedIndex||this.setActive(this.selectedIndex),this.setElemsMod(n,"hovered","").setElemsMod(s,"active","").setElemsMod(s,"checked","").setElemsMod(this.selectedIndex,"active","yes").setMod(this.selectedElem,"checked","yes").setHint(this.selectedElem&&this.extractHint(this.selectedElem)||this.params.hint);break;case"click":this.selectedIndex=n,this.selectedElem=i,this.setActive(n).setElemsMod(n,"hovered","").setMod(i,"checked","yes").setHint(this.extractHint(i)||this.params.hint),this.trigger("change",n)}},onElemSetMod:{radio:{checked:{yes:function(){this.delMod(this.elem("radio","checked","yes"),"checked")}}}},extractElemIndex:function(t){return this.elem("radio").index(t)+1},setElemsMod:function(t,e,i){return t&&this.setMod(this.elem("radio").slice(0,t),e,i),this},setActive:function(t){return this.setElemsMod(t,"active","yes")},setHint:function(t){return this.elem("hint").text(t||""),this},extractHint:function(t){return this.elemParams(t).hint}},{live:function(){this.__base.apply(this,arguments),this.liveBindTo("radio","click mouseover mouseout",function(t){this._onMouseEvent(t)})}}),BEM.DOM.decl("timing",{COUNTER_BASE_PARAMS:{dtype:"stred",pid:1,cid:72202,path:"690.1033"},onSetMod:{js:function(){this._data=BEM.blocks["rum-data"],this.params.execImmediately&&this.exec()}},getDefaultParams:function(){return{execImmediately:!0}},exec:function(){return BEM.blocks["rum-helper"].checkPrerequisites()?this._data.getVisibilityParams().then(this.buildMetrics.bind(this)).then(this.sendCounter.bind(this)):$.Deferred().reject(new Error("Invalid performance environment"))},buildMetrics:function(t){var e=this.getTimings(t),i=this._data.getNavigationData();return i.redirectCount&&(e[1384.1385]=i.redirectCount),i.navigationType&&(e[770.76]=i.navigationType),t.visibilityState&&(e[1484]=t.visibilityState),e[2299]=history.length,$.Deferred().resolve(e).promise()},getNavStart:function(){return this._data.getPageTiming().navigationStart},getTimings:function(t){var e=this._data.getPageTiming(),i={1036:[e.domainLookupStart,e.navigationStart],1037:[e.domainLookupEnd,e.domainLookupStart],1038:[e.connectEnd,e.connectStart],1039:[e.responseStart,e.connectEnd],1040:[e.responseEnd,e.responseStart],1040.906:[e.responseEnd,e.domainLookupStart],1310.2084:[e.domLoading,e.responseStart],1310.2085:[e.domInteractive,e.responseStart],1310.1309:[e.domContentLoadedEventEnd,e.domContentLoadedEventStart],1310.1007:[e.domContentLoadedEventStart,e.responseStart]},n=t.firstPaintTime;n>0&&(i[1041]=[n,e.responseStart],i[1041.906]=[n,e.domainLookupStart]),"lpPollingIterations"in t&&(i[2142]=t.lpPollingIterations);var s=e.secureConnectionStart;return s>0&&(i[1383]=[e.connectEnd,s]),i},sendCounter:function(t){return BEM.blocks["rum-helper"].sendCounter(this.params,this.getCounterParams(),this.getNavStart(),t)},getCounterParams:function(){return $.extend({},this.COUNTER_BASE_PARAMS)}}),BEM.DOM.decl("timing",{speedParams:{1036:"   DNS lookup (wait)",1037:"DNS lookup (dns)",1038:"TCP handshake (tcp)",1383:"  HTTPS  (ssl)",1039:"     (ttfb)",1040:"  HTML    (html)",1040.906:"  DNS Lookup    HTML (html-total)",1310.1007:"    html (dom-loaded)",1310.1309:"  DOM ( ) DOMContentLoaded (dom-init)",1310.2084:"   HTML    (dom-loading)",1310.2085:"   HTML    (dom-interactive)",1041:"    HTML    (ttfp)",1041.906:"  DNS Lookup    (ttfp-total)"},restParams:{1384.1385:"  redirect (redirect-count)",770.76:"    (nav-type)",143:" (page)",1042:"User-agent (ua)",2142:"    (lp_polling_iterations)"},getCounterParams:function(){var t=this.__base.apply(this,arguments),e=encodeURIComponent(BEM.blocks["i-global"].param("serpid")),i=encodeURIComponent(this.params.reqid);return t?(t.reqid=i,t.serpid=e,t):void 0},sendCounter:function(t){return BEM.blocks["i-global"].param("counterDebug")&&this._printRUMData(t),this.__base.apply(this,arguments)},_printRUMData:function(t){var e=_.cloneDeep(t),i=BEM.blocks["rum-helper"].normalizeMetrics(this.getNavStart(),e);i&&console.info&&console.table&&(console.info("RUM speed:"),console.table(this._getParamsTable(i,"speedParams")),console.info("RUM etc.:"),console.table(this._getParamsTable(i,"restParams")))},_getParamsTable:function(t,e){return _.map(t,function(t,i){return this[e][i]?{Blockstat:i,"":this[e][i],", ":t}:void 0}.bind(this))},exec:function(){return this.isRUMTimingEnabled()?this.__base.apply(this,arguments):void 0},isRUMTimingEnabled:function(){return this.params.isRUMTimingEnabled}}),BEM.decl("rum-helper",{},{NAVIGATION_START_THRESHOLD:18e5,init:function(){var t=window.performance||{};this._timing=t.timing||{},t.now&&(this.now=function(){return t.now()})},now:function(){return Date.now()},hasResourceTiming:function(){return!window.externalHost&&window.performance&&$.isFunction(window.performance.getEntriesByName)},checkPrerequisites:function(){var t=this._timing.navigationStart;return t&&Date.now()-t<this.NAVIGATION_START_THRESHOLD},getFullUrl:function(t){return t.indexOf("//")<0&&(t=location.protocol+"//"+location.host+t),t},getClickUrl:function(){var t=BEM.blocks["i-global"].param("clck");if(t)return t;var e=location.hostname.match(/^(?:[-\w]+\.)*(yandex(?:.[a-z]+)+)$/i);return t=(e?e[1]:"yandex.ru")+"/clck","//"+t+"/click"},serializeParams:function(t){var e=this.flatten,i={};return $.each(t,function(t,n){$.isPlainObject(n)?i[t]=e(n).join(","):i[t]=n}),e(i).join("/")},normalizeMetrics:function(t,e){e||(e=t,t=null);var i;return i=t?function(e){return e>=t}:function(){return!0},$.each(e,function(t,n){if($.isArray(n)){if(n[0]<n[1]||!i(n[1]))return e=!1;e[t]=n=n[0]-n[1]}return isNaN(n)||0>n?e=!1:void 0}),e},flatten:function(t,e){var i=[];return e=e||"=",$.each(t,function(t,n){i.push(t+e+n)}),i},sendCounter:function(t,e,i,n){var s=this.normalizeMetrics(i,n);if(s){e.reqid=encodeURIComponent(BEM.blocks["i-global"].param("reqid")||"<empty>");var o={1042:encodeURIComponent(navigator.userAgent),2086:encodeURIComponent(document.referrer)};return e.vars=$.extend(s,o,t.vars),this.sendRequest([t.clckHost||this.getClickUrl(),this.serializeParams(e),"*"].join("/")),e}},sendRequest:function(t){navigator.sendBeacon&&navigator.sendBeacon(t," ")||((new Image).src=t)}}),BEM.blocks["rum-helper"].init(),BEM.decl("rum-data",{},{LP_START_TIMEOUT:0,LP_POLLING_TIMEOUT:10,MAX_LP_POLLING_ITERATIONS:5,VISIBILITY_STATES:{visible:1,hidden:2,prerender:3},init:function(){var t=window.performance;this._timing=t&&t.timing,this._navigation=t&&t.navigation,this._chromeLoadTimes=window.chrome&&window.chrome.loadTimes,this._ua=navigator.userAgent},getPageTiming:function(){return this._timing},getVisibilityParams:function(){var t={},e=this.getVisibilityState();return t.visibilityState=e&&this.VISIBILITY_STATES[e],this.collectPaintTiming(t)},getVisibilityState:function(){return document.visibilityState||document.webkitVisibilityState||document.msVisibilityState},collectPaintTiming:function(t){function e(){return $.Deferred().resolve(t).promise()}var i=this.VISIBILITY_STATES;if(t.visibilityState===i.hidden||t.visibilityState===i.prerender)return e();var n,s,o;return this._timing.msFirstPaint&&(n=this._timing,o="msFirstPaint",s="ie"),$.isFunction(this._chromeLoadTimes)&&(n=this._chromeLoadTimes,o="firstPaintTime",s="chrome"),n?this._promisePaintData(n,o).then(function(e){var i=e.firstPaintTime;return"chrome"===s&&(i*=1e3),t.firstPaintTime=Math.floor(i),t.lpPollingIterations=e.pollingIterations,t}):e()},_promisePaintData:function(t,e){function i(){var t=r();if(!t||!t[e])return s.reject(new Error("Paint data is not supported"));var a=t[e];return 0===a&&++o<n.MAX_LP_POLLING_ITERATIONS?setTimeout(i,n.LP_POLLING_TIMEOUT):void s.resolve({firstPaintTime:a,pollingIterations:o})}var n=this,s=$.Deferred(),o=0,r=$.isFunction(t)?t:function(){return t};return setTimeout(i,this.LP_START_TIMEOUT),s.promise()},getNavigationData:function(){var t=this._navigation,e={};return t&&(t.redirectCount&&(e.redirectCount=t.redirectCount),1!==t.type&&2!==t.type||(e.navigationType=t.type)),e}}),BEM.blocks["rum-data"].init(),BEM.DOM.decl("raw-timing",{COUNTER_BASE_PARAMS:{dtype:"stred",pid:1,cid:72202,path:"690.2108"},TIMING_MAP:{unloadEventStart:2127,unloadEventEnd:2128,redirectStart:2109,redirectEnd:2110,fetchStart:2111,domainLookupStart:2112,domainLookupEnd:2113,connectStart:2114,secureConnectionStart:2115,connectEnd:2116,requestStart:2117,responseStart:2119,responseEnd:2120,domLoading:2121,domInteractive:2122,domContentLoadedEventStart:2123,domContentLoadedEventEnd:2131},onSetMod:{js:function(){this._data=BEM.blocks["rum-data"],this.params.execImmediately&&this.exec()}},getDefaultParams:function(){return{execImmediately:!0}},exec:function(){return BEM.blocks["rum-helper"].checkPrerequisites()?this._data.getVisibilityParams().then(this.buildMetrics.bind(this)).then(this.sendCounter.bind(this)):$.Deferred().reject(new Error("Invalid performance environment"))},buildMetrics:function(t){var e=this.getNavStart(),i=$.extend({2129:e},this.getTiming());t.firstPaintTime&&(i[2130]=t.firstPaintTime-e),"lpPollingIterations"in t&&(i[2142]=t.lpPollingIterations);var n=this._data.getNavigationData();return n.redirectCount&&(i[1384.1385]=n.redirectCount),n.navigationType&&(i[770.76]=n.navigationType),t.visibilityState&&(i[1484]=t.visibilityState),i[2299]=history.length,$.Deferred().resolve(i).promise()},getNavStart:function(){return this._data.getPageTiming().navigationStart},getTiming:function(){var t=this,e=this.getNavStart(),i=this._data.getPageTiming();return Object.keys(this.TIMING_MAP).reduce(function(n,s){var o=t.TIMING_MAP[s],r=i[s];return n[o]=r?r-e:0,n},{})},sendCounter:function(t){return BEM.blocks["rum-helper"].sendCounter(this.params,this.getCounterParams(),this.getNavStart(),t)},getCounterParams:function(){return $.extend({},this.COUNTER_BASE_PARAMS)}}),BEM.DOM.decl("ajax-perf",{ERRORS:{UNKNOWN_ERROR:-1,SERVER_TIMEOUT:1,CLIENT_TIMEOUT:2,ABORT:3,PARSE_ERROR:4,JS_ERROR:5,HTTP_ERROR:6,HANDLED_ERROR:7},COUNTER_BASE_PARAMS:{dtype:"stred",pid:1,cid:72202,path:"690.1201"},onSetMod:{js:function(){this.params.execImmediately&&this.exec()}},getDefaultParams:function(){return{execImmediately:!0}},exec:function(){this._requests={},this._actionTime=null,this._renderStart=null,this._render=null,window.performance&&performance.now&&(this.getTime=function(){return performance.now()}),this.bindEvents()},bindEvents:function(){function t(){this._actionTime=this.getTime()}BEM.blocks.history.getInstance().on("statechange",t,this),BEM.channel("serp").on({ajaxAction:t,successCallbacksStarted:function(){this._renderStart=this.getTime()},successCallbacksFinished:function(){this._renderStart&&(this._render=this.getTime()-this._renderStart,this._renderStart=null)}},this),this.bindToDoc({ajaxSend:this.onSend,ajaxError:this.onError,ajaxSuccess:this.onSuccess,ajaxComplete:this.onComplete})},getRequestData:function(t){return this._requests[$.identify(t)]},onSend:function(t,e,i){this.filterRequest(i)&&(this._requests[$.identify(e)]={ajaxSend:this.getTime(),actionTime:this._actionTime},this._actionTime=null)},onSuccess:function(t,e,i,n){if(n&&n.error){var s=this.getRequestData(e);s&&(s.ajaxError=this.getTime(),s.ajaxErrorType=this.ERRORS.HANDLED_ERROR)}},onError:function(t,e,i,n){var s=this.getRequestData(e);s&&(s.ajaxError=this.getTime(),s.ajaxErrorType=this.getErrorType(e,n))},onComplete:function(t,e,i){var n=this.getRequestData(e);if(n){n.ajaxComplete=this.getTime();var s=this.buildMetrics(n),o=i.url;this.hasResourceTiming()&&!n.ajaxError?this.afterCurrentEvent(function(){s=$.extend(s,this.buildMetricsForUrl(o)),this.sendCounter(s,o)}):this.sendCounter(s,o),delete this._requests[$.identify(e)]}},getErrorType:function(t,e){var i=this.ERRORS;if(0===t.status&&"timeout"===t.statusText)return i.SERVER_TIMEOUT;switch(e){case"timeout":return i.CLIENT_TIMEOUT;case"canceled":case"abort":return i.ABORT;case"parsererror":return i.PARSE_ERROR;default:if(e instanceof Error)return i.JS_ERROR}return 200!==t.status&&304!==t.status?i.HTTP_ERROR:i.UNKNOWN_ERROR},filterRequest:function(t){var e=BEM.blocks.uri.parse(t.url),i=e.path(),n=e.queryParams;return this.validatePath(i)&&n.callback&&!(n.rpt||n.filter)},validatePath:function(t){for(var e=this.allowedPaths(),i=0;i<e.length;i++){var n=e[i];if(t===n||t===n+"/")return!0}return!1},allowedPaths:function(){return[]},hasResourceTiming:function(){return!window.externalHost&&window.performance&&$.isFunction(window.performance.getEntriesByName)},getTime:function(){return Date.now()},buildMetrics:function(t){var e={1201.906:(t.ajaxError||t.ajaxComplete)-t.ajaxSend};return t.ajaxError&&(e["1201.1030"]=t.ajaxErrorType),t.actionTime&&(e[1201.789]=t.ajaxSend-t.actionTime),this._render&&(e["1201.1310"]=this._render,this._render=null),e},buildMetricsForUrl:function(t){t=BEM.blocks["rum-helper"].getFullUrl(t);var e={},i=performance.getEntriesByName(t);return 0===i.length?e:(i=i[0],e={1036:i.domainLookupStart-i.startTime,1037:i.domainLookupEnd-i.domainLookupStart,1038:i.connectEnd-i.connectStart,1039:i.responseStart-i.connectEnd,1040:i.responseEnd-i.responseStart,1040.906:i.responseEnd-i.domainLookupStart},i.secureConnectionStart>0&&(e[1383]=i.connectEnd-i.secureConnectionStart),e)},getCounterBaseParams:function(){return $.extend({},this.COUNTER_BASE_PARAMS,{reqid:encodeURIComponent(BEM.blocks["i-global"].param("reqid"))})},createCounterParams:function(t){var e=this.getCounterBaseParams();return e.vars=$.extend(t,this.params.vars),e.vars[1042]=encodeURIComponent(navigator.userAgent),e},sendCounter:function(t,e){var i=BEM.blocks["rum-helper"];if(t=i.normalizeMetrics(t)){t=this.createCounterParams(t);var n=[this.params.clckHost||i.getClickUrl(),i.serializeParams(t),"*"].join("/");t.vars["1201.1030"]&&(n+=encodeURIComponent(e)),i.sendRequest(n),this.trigger("counterSent",t)}}}),BEM.DOM.decl("ajax-perf",{filterRequest:function(t){var e=t&&t.url,i=BEM.blocks.location.getInstance(),n=BEM.blocks.uri,s={url:e,path:n.getPath(n.clearHashSymbol(e)),params:n.parseParams(e)};return"b-page_type_search"===i.detectBlock(s)&&e.indexOf("serp-list_infinite_yes")>-1},createCounterParams:function(){var t=this.__base.apply(this,arguments);return t.reqid=encodeURIComponent(this.__self._reqid),t.serpid=encodeURIComponent(BEM.blocks["i-global"].param("serpid")),t},sendCounter:function(t){BEM.blocks.counter.debug("ajax-perf",BEM.blocks["rum-helper"].normalizeMetrics(t)),this.__base.apply(this,arguments)}},{setReqid:function(t){this._reqid=t}}),BEM.DOM.decl("tags",{onSetMod:{js:{inited:function(){this.isResizable()&&this.bindEvents()}}},bindEvents:function(){BEM.blocks["b-page"].on("resize",this.insertMore,this)},unbindEvents:function(){BEM.blocks["b-page"].un("resize",this.insertMore,this)},destruct:function(){this.unbindEvents(),this.__base.apply(this,arguments)},isResizable:function(){return!this.hasMod("two-lines")&&!this.hasMod("type","scroll")},_onTagClick:function(t){var e=t.target.domElem[0].href;this.trigger("tag-click",{href:e,query:t.target.domElem.text(),pos:t.target.domElem.index()})}},{live:function(){return this.liveInitOnBlockInsideEvent("click","link",function(t){this.elem("tag").is(t.target.domElem)&&this._onTagClick(t)}),!1}}),BEM.DOM.decl({block:"tags",modName:"more",modVal:!0},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.isResizable()&&this.insertMore()}},show:{more:function(){this._removeContentMaxHeight(),this.unbindEvents()}}},_onClickMore:function(){this.setMod("show","more"),this.elem("more").remove(),this.trigger("more-click")},insertMore:function(){for(var t=this.elem("content")[0].getBoundingClientRect().bottom,e=this.elem("tag"),i=[],n=0;n<e.length&&e[n].getBoundingClientRect().bottom<=t;n++)i.push(e[n]);var s=this.elem("content").height(),o=this.elem("wrapper"),r=o.height()+parseInt(o.css("margin-top"));if(s>=r)return void this.unbindEvents();this.setMod(this.elem("more"),"visible","yes");for(var a=this.elem("more")[0],c=!1,h=i.length-1;!c;)$(i[h]).after(a),c=a.getBoundingClientRect().bottom<=t,h--;this._isMoreInserted=!0,this._setContentMaxHeightAccordingMoreButton()},_setContentMaxHeightAccordingMoreButton:function(){var t=this.elem("content").offset().top,e=this.elem("more").offset().top,i=this.elem("more").outerHeight();this.elem("content").css("max-height",e-t+i)},_removeContentMaxHeight:function(){this.elem("content").css("max-height","")}},{live:function(){return this.liveBindTo("more","pointerclick",function(t){t.preventDefault(),this._onClickMore()}),this.__base.apply(this,arguments)}}),BEM.DOM.decl({block:"link",modName:"triggerable",modVal:"yes"},{},{live:function(){this.__base.apply(this,arguments),this.liveBindTo({block:"link",modName:"triggerable",modVal:"yes"},"pointerclick",function(t){this.trigger("click",{domEvent:t})})}}),BEM.DOM.decl({block:"button2",baseBlock:"control"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments)}},pressed:{yes:function(){return this.hasMod("disabled")?!1:void this.trigger("press")},"":function(){this.trigger("release")}},checked:{yes:function(){this.trigger("check").domElem.attr("aria-pressed","true")},"":function(){this.trigger("uncheck").domElem.attr("aria-pressed","false")}},disabled:{yes:function(){this.__base.apply(this,arguments),this.delMod("pressed")}},focused:{"":function(){this.__base.apply(this,arguments),this.delMod("pressed")}},progress:{yes:function(){this.setMod("disabled","yes")},"":function(){this.delMod("disabled")}}},getText:function(){return this.elem("text").text()},setText:function(t){return this.elem("text").text(t),this},_onClick:function(t){this._preventClick||this.trigger("click",this._buildClickEventData(t)),this._preventClick=!1},_processClick:function(t){this.trigger("click",this._buildClickEventData(t))},_onPointerpress:function(t){this.setMod("pressed","yes").bindToDoc("pointerrelease",this._onPointerrelease)},_onPointerrelease:function(){this.delMod("pressed").unbindFromDoc("pointerrelease")},_onKeydown:function(t){var e=t.keyCode,i=BEM.blocks.keycodes;i.is(e,this.params.pressKeys)&&(this.setMod("pressed","yes"),i.is(e,this.params.prvntKeys)&&t.preventDefault())},_onKeyup:function(t){var e=t.keyCode,i=BEM.blocks.keycodes;i.is(e,this.params.prvntKeys)&&t.preventDefault(),i.is(e,this.params.pressKeys)&&(this.delMod("pressed"),i.is(e,this.params.clickKeys)&&(this._preventClick=!0,this._processClick(t)))},_buildClickEventData:function(t){return{domEvent:t,isModKey:t.ctrlKey||t.altKey||t.metaKey||t.shiftKey}},getDefaultParams:function(){return $.extend(this.__base(),{pressKeys:["SPACE","ENTER"],prvntKeys:[],clickKeys:[]})}},{live:function(){return this.liveBindTo("pointerpress",function(t){this.hasMod("disabled")||this._onPointerpress(t)}).liveBindTo("pointerclick",function(t){this.hasMod("disabled")||this._onClick(t)}).liveBindTo("keydown",function(t){this._onKeydown(t)}).liveBindTo("keyup",function(t){this._onKeyup(t)}),this.__base()}}),BEM.DOM.decl("button2",{onSetMod:{hovered:{yes:function(){return!this.hasMod("disabled")}},disabled:{yes:function(){this.__base.apply(this,arguments),this.delMod("hovered")}}},_onPointerenter:function(){
this.setMod("hovered","yes")},_onPointerleave:function(){this.delMod("hovered")}},{live:function(){return 8===BEM.blocks["i-ua"].ie&&this.liveBindTo("dblclick",function(t){this.hasMod("disabled")||this._onClick(t)}),this.liveBindTo("pointerover pointerout",function(t){this.hasMod("disabled")||this.domElem[0].contains(t.relatedTarget)||("pointerover"===t.type?this._onPointerenter(t):this._onPointerleave(t))}),this.__base()}}),BEM.DOM.decl("button2",{getIconWidth:function(){var t=this.elem("icon");return t.length?t.width():void 0}}),BEM.DOM.decl("more",{onSetMod:{loading:{yes:function(){this.hideButton(),this.blockInside("spin2").setMod("progress","yes")},"":function(){this.blockInside("spin2").delMod("progress")}},disabled:{yes:function(){this.hideButton()}}},_onClick:function(t){t.preventDefault(),this.trigger("click"),this.setMod("loading","yes")},startProgress:function(){return this.setMod("loading","yes"),this},stopProgress:function(){return this.delMod("loading"),this},show:function(){return this.delMod("hidden")},hide:function(){return this.setMod("hidden","yes")},showButton:function(){var t=this.blockInside("spin2");return t.hasMod("progress")&&t.delMod("progress"),this.delMod(this.elem("button"),"hidden"),this},hideButton:function(){return this.setMod(this.elem("button"),"hidden","yes"),this},url:function(t){return"undefined"!=typeof t?(this.elem("button").attr("href",t),this.params.url=t,this):this.elem("button").attr("href")}},{live:function(){this.liveBindTo("button","pointerclick",function(t){this._onClick(t)})}}),BEM.DOM.decl("more",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),BEM.blocks["serp-controller"].on("listOut",this._onListOut,this)}}},destruct:function(){BEM.blocks["serp-controller"].un("listOut",this._onListOut,this),this.__base.apply(this,arguments)},_onListOut:function(t,e){var i=this.hasMod("direction","next");"left"!==e&&"up"!==e||i||this.trigger("click"),"right"!==e&&"down"!==e||!i||this.trigger("click")},bindEvents:function(){return this.__base.apply(this,arguments),this.bindTo("button","pointerclick",this._onButtonClick),this}}),BEM.DOM.decl("more",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),BEM.blocks["pane2-controller"].on("listOut",this._onListOut,this)}}},destruct:function(){BEM.blocks["pane2-controller"].un("listOut",this._onListOut,this),this.__base.apply(this,arguments)}},{live:function(){return this.__base.apply(this,arguments),!1}}),BEM.DOM.decl({block:"more",modName:"direction",modVal:"next"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),BEM.blocks["i-keyrouter"].on("special:right pagedown space",this._onLoadNextPage,this)}}},destruct:function(){BEM.blocks["i-keyrouter"].un("special:right, pagedown space",this._onLoadNextPage,this),this.__base.apply(this,arguments)},_onLoadNextPage:function(){this._isEndOfPage()&&this.trigger("click")},_isEndOfPage:function(){return window.pageYOffset+window.innerHeight>=this.__self.doc.height()}}),BEM.DOM.decl({block:"more",modName:"direction",modVal:"next"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),BEM.blocks["b-page"].on("scroll",this._onScroll,this)}}},destruct:function(){BEM.blocks["b-page"].un("scroll",this._onScroll,this),this.__base.apply(this,arguments)},_onScroll:function(){if(this.hasMod("loading","yes")){var t,e=window.pageYOffset+window.innerHeight,i=this.__self.doc.height(),n=this.blockInside("spin2").hasMod("position","fixed"),s=160;e>i||(t=this.domElem.offset().top,e-t>=s?n||this.setSpinPosition("fixed"):n&&this.setSpinPosition(""))}},_onClick:function(){this.hasMod("last","yes")&&this.setSpinPosition(""),this.__base.apply(this,arguments)},setSpinPosition:function(t){var e="";"fixed"===t&&(e=this.domElem.offset().left+this.domElem.width()/2),this.blockInside("spin2").domElem.css("left",e),this.blockInside("spin2").setMod("position",t)}}),BEM.DOM.decl({block:"button2",modName:"type",modVal:"link"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._url=this.params._url||this.domElem.attr("href")}},disabled:{"":function(){this.__base.apply(this,arguments),this.domElem.attr("tabindex",this.params._tabindex).attr("href",this._url)},yes:function(){this.__base.apply(this,arguments),void 0!==this._url&&this.domElem.attr("tabindex",-1),this.domElem.removeAttr("href")}}},getUrl:function(){return this._url},setUrl:function(t){return this._url=t,this.hasMod("disabled")||this.domElem.attr("href",t),this},getDefaultParams:function(){return $.extend(this.__base(),{pressKeys:["ENTER"]})}}),BEM.DOM.decl({block:"button2",modName:"type",modVal:"link"},{},{live:function(){return this.liveBindTo("dragend",function(t){this.hasMod("type","link")&&!this.hasMod("disabled")&&this.delMod("pressed")}),this.__base()}}),BEM.DOM.decl("serp-controller",{_viewParams:[],onSetMod:{js:{inited:function(){this.__self.instance=this,this.findBlocks()._setPageMod(),this.bindEvents(),this.syncState()}},infinite:{"":function(){this.disableInfiniteLoad()}}},destruct:function(){this.__self.instance=null,this.unbindEvents(),this.__base.apply(this,arguments)},findBlocks:function(){return this.page=this.findBlockOutside("b-page"),this.location=BEM.blocks.location.getInstance(),this},bindEvents:function(){return BEM.blocks.more.on("click",this._onMoreClick,this),BEM.blocks["serp-item"].on(this.domElem,"clicked",this._onItemClicked,this),BEM.blocks["serp-item"].on(this.domElem,"selected",this._onItemSelected,this),this},unbindEvents:function(){return BEM.blocks.more.un("click",this._onMoreClick,this),BEM.blocks["serp-item"].un(this.domElem,"clicked",this._onItemClicked,this),BEM.blocks["serp-item"].un(this.domElem,"selected",this._onItemSelected,this),this},_onPageChanged:function(){this._setPageMod().syncState(),c&&BEM.blocks["ajax-perf"].setReqid(c.getReqId()),this.__base.apply(this,arguments)},_setPageMod:function(){return this.setMod("page",this.page.getMod("type")),this},_onMoreClick:function(t){var e=t.block.getMod("direction");this.hasMod("loading","yes")||(this.load(e),"prev"===e&&this.location.change({url:t.block.params.url,history:!1,trigger:!1}))},syncState:function(){this.loadInitialItem(),this._competitors=this.findBlockInside("competitors")},showFooter:function(){var t=this.page.blockInside("footer");return t&&t.show(),this.toggleCompetitors(),this},toggleCompetitors:function(){return BEM.blocks["i-global"].param("isPumpkin")?this:(this._competitors&&this._competitors.domElem&&this._competitors.setMod("visibility",BEM.blocks["i-global"].param("query")?"":"hidden"),this)},hideFooter:function(t){var e=this.page.blockInside("footer");return e&&(t?e.transparent():e.hide()),this._competitors&&this._competitors.setMod("visibility",t?"transparent":"hidden"),this},findMore:function(t){var e="_more"+t,i=this[e];return i&&i.domElem||(this[e]=this.findBlockInside({block:"more",modName:"direction",modVal:t})),this[e]},checkListOut:function(t){var e=t.params.pos,i=this.changeThis(this.getStraightItem||this.getNearItem),n=i(t,1),s=Boolean(this.getItemByPos(Number(e)+5).length);return n&&s||this.trigger("listOut","right"),this},addReqId:function(t){return t&&(t.params.reqid=c.getReqId(t.domElem)||!1),this},delViewParams:function(t){return this.location.change({url:BEM.blocks.uri.delParams(location.href,t||this._viewParams),trigger:!1,history:!1}),this}},{get:function(){return this.instance},live:function(){return this.liveInitOnBlockOutsideEvent("change","b-page",function(t,e){this._onPageChanged(t,e)}),this.liveInitOnBlockOutsideEvent("contentLoaded","b-page",function(){this._onContentLoaded()}),!1}}),BEM.DOM.decl("serp-controller",{onSetMod:{loading:{yes:function(){this.trigger("loading")}}},_getSerpList:function(){return this._serpList||(this._serpList=this.findBlockInside("serp-list"))},isCurrentPageLast:function(){var t=this._getSerpList();return t?t.isCurrentPageLast():!0},getInitialPageNum:function(){var t=this._getSerpList();return t?t.getInitialPageNum():0},getScrollPagesCount:function(){return this.params.count}}),BEM.DOM.decl("serp-controller",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.params.cacheMore&&this.setMod("cached-more","yes"),this._setPageMod()}},loading:{yes:function(){this.trigger("loading")}}},syncState:function(){return this.hasMod("page","search")&&(this.relatedBottom=this.findBlockInside({block:"related",modName:"position",modVal:"bottom"})),this.__base.apply(this,arguments)},_setPageMod:function(){var t="similar"===this.page.getMod("type"),e=this._viewParams.indexOf("rpt");return t?(e>-1&&this._viewParams.splice(e,1),this.setMod("page","search")):(-1===e&&this._viewParams.push("rpt"),this.setMod("page",this.page.getMod("type")))},showFooter:function(){return this.hasMod("page","search")&&this.relatedBottom&&this.relatedBottom.show(),this.__base.apply(this,arguments)},hideFooter:function(){return this.hasMod("page","search")&&this.relatedBottom&&this.relatedBottom.hide(),this.__base.apply(this,arguments)},_getPane2Api:function(){return this._pane2api||(this._pane2api=this.findBlockInside("pane2-api"))}}),BEM.DOM.decl("serp-controller",{_req:{},destruct:function(){this._clearRequestStack(),this.__base.apply(this,arguments)},_clearRequestStack:function(){return _.forOwn(this._req,function(t){t.abort()}),this._req={},this},syncState:function(){this._clearRequestStack(),this.delMod("loading"),this.__base.apply(this,arguments)},getRequest:function(t,e){var i={url:BEM.blocks.uri.getPath(t),ctx:this,cache:!0};return _.assign(i,e),BEM.create("i-request_type_bem",i)},load:function(t,e){this._loadPage(t,e)&&this._setLoading(t)},_setLoading:function(t){return this.setMod("loading","yes").findMore(t).setMod("loading","yes")},_loadPage:function(t,e){var i=this.params[t+"PageUrl"],n=BEM.blocks.uri.parseParams(i);return i?(e=_.assign(e||{},{direction:t}),_.assign(n,this.__self.getUrlRequestParams()),n.suggest_reqid=this.page.suggestReqID,this._sendRequest(n,e),!0):!1},_sendRequest:function(t,e){var i=this.getRequest(this.params[e.direction+"PageUrl"],e);this._req[t.p]=i,this.setRequestBlocks(i,e),i.get(t,this._onAjaxSuccess)},_onAjaxSuccess:$.noop,setRequestBlocks:function(t,e){var i=this,n=e.direction;return t.block("serp-controller",function(t){i._onSerpControllerLoaded(t,n)}).block("serp-list_infinite_yes",function(t){i._onListLoaded(t,n)}).block("more_direction_"+n,this._onMoreDataLoaded),this},_onSerpControllerLoaded:function(t,e){this.params[e+"PageUrl"]=t.params[e+"PageUrl"]},_onContentLoaded:function(){var t=this.findMore("next"),e=t&&t.params.visible;e||this.afterCurrentEvent(this.showFooter)},_onListLoaded:$.noop,_onMoreDataLoaded:function(t){var e=t.params.direction,i=this.findMore(e),n=t.params.visible;i&&(this.delMod("loading"),i.url(t.params.url).delMod("loading").setMod("disabled",n?"":"yes").setMod("hidden",n?"":"yes"),this["_onMoreDataLoaded"+e](t,i))},_onMoreDataLoadednext:function(t,e){var i=t.params.visible,n=this.getListCount()%this.params.count===0;e.setMod("last",n?"yes":"no"),this.hideFooter(),this.isMoreButtonShouldShown(i)&&(this.trigger("infiniteLoadStop"),e.showButton(),this.showFooter()),i||this.showFooter()},isMoreButtonShouldShown:function(t){return t&&this.getListCount()%this.params.count===0},_onMoreDataLoadedprev:function(t,e){t.params.visible&&e.showButton()}},{getUrlRequestParams:function(){var t={serpid:BEM.blocks["i-global"].param("serpid")},e=BEM.blocks.location.getInstance();return e.hasParam("rdpass")&&(t.rdpass=e.getParamValue("rdpass")),t}}),BEM.DOM.decl("serp-controller",{_onListLoaded:function(t,e){this.__base.apply(this,arguments),this._getSerpList()&&this._getSerpList().addSerpItems(t,e),this.trigger("loaded",{params:t.params,direction:e})}},{getUrlRequestParams:function(){var t=this.__base.apply(this,arguments);return _.assign(t,{uinfo:BEM.blocks["i-userinfo"].get().getUserInfo()})}}),BEM.DOM.decl("serp-controller",{setRequestBlocks:function(t){return this.__base.apply(this,arguments),t.block("gallery__items:ajax",this._onGalleryLoaded),this},_onGalleryLoaded:function(t){window.inNextFrame(function(){this.trigger("galleryLoaded",t)},this)},_onContentLoaded:function(){this.__base.apply(this,arguments),this._serpList=void 0,this.setMod("height",this._isFullHeightAllowed()?"full":"")},_isFullHeightAllowed:function(){var t=this.hasMod("page","search"),e=this.findMore("next"),i=e&&e.params.visible;return!BEM.blocks["i-global"].param("showRelevance")&&!BEM.blocks["i-global"].param("mobile")&&t&&i}}),BEM.DOM.decl("serp-controller",{deviation:5,itemSelector:".serp-item",getBlockByDirection:function(t){var e,i=this.getCurrentItem(),n=i&&i.params.pos;return i?(n>=0&&"left"===t?e=this.getNearItem(i,-1):"right"===t&&(e=this.getNearItem(i,1)),e&&e.length?e.bem("serp-item"):void 0):void 0},getNearItem:function(t,e){return this.getNearItemBySibling(t,e)||this.getNearItemByIdx(t,e)||this.getNearItemByPos(t,e)},getNearItemBySibling:function(t,e){var i=t.domElem[e>0?"next":"prev"](this.itemSelector);return i.length&&i},getNearItemByPos:function(t,e){for(var i=[],n=t.params.pos,s=n;0===i.length&&Math.abs(n-s)<this.deviation;)s+=e,i=this.getItemByPos(s);return i.length&&i},getNearItemByIdx:function(t,e){var i=t.domElem.index(this.itemSelector)+e,n=i>=0?$(this.itemSelector).eq(i):$([]);return n.length&&n},getStraightItem:function(t,e){var i,n,s,o,r,a,c,h,l,u=t.domElem,d=u.offset(),p=0,m=0;for(_.isEmpty(u)||BEM.blocks["scroll-spy"].getElemVisibility(u).visible||(a=this.getVisibleNearItem(u,-1),a&&(u=a),d=u.offset()),n=Math.floor(d.left+u.width()/2),s=d.top,o=this.getVisibleNearItem(u,e),r=o&&o.offset();o&&30>=p&&(p++,!(r.top!==s&&(s=r.top,m++,m>2)));){if(c=n-r.left,h=r.left+o.width()-n,l=Math.min(Math.abs(c),Math.abs(h)),c>=0&&h>=0||7>l){i=o;break}o=this.getVisibleNearItem(o,e),r=o&&o.offset()}return i},getVisibleNearItem:function(t,e){for(var i=this.getNearItem(t.bem("serp-item"),e);i&&i.hasClass("serp-item_extra_yes");)i=this.getNearItem(i.bem("serp-item"),e);return i},getItemByPos:function(t){return $(".serp-item_pos_"+t+":eq(0)")},getItemById:function(t){var e=$("#"+t);return e.length?e.bem("serp-item"):void 0},selectItem:function(t){return t.setMod("selected","yes"),this},getCurrentItem:function(){return BEM.blocks["serp-item"].getCurrent()},getPrevItem:function(){return BEM.blocks["serp-item"].getPrev()},selectCurrentItem:function(){var t=this.getCurrentItem();return t&&this.selectItem(t),this},unselectCurrentItem:function(){return BEM.blocks["serp-item"].delSelected(),this}}),BEM.DOM.decl("serp-controller",{getDefaultParams:function(){var t=this.__base.apply(this,arguments);return t.blinkTime=1e3,t},loadInitialItem:function(){},blinkCurrentItem:function(){var t=this.getCurrentItem();return t&&(t.setMod("blink","yes"),setTimeout(function(){t&&t.domElem&&t.delMod("blink")},this.params.blinkTime)),this}}),BEM.DOM.decl("serp-controller",{onSetMod:{js:{inited:function(){var t=this.getRejectedParams();this.__base.apply(this,arguments),t&&t.length&&(BEM.blocks["i-ua"].ie>=10?setTimeout(this.removeParams.bind(this,t),this.__self.DELAY_REMOVE_PARAMS):this.removeParams(t))}}},getDefaultParams:function(){var t=this.__base.apply(this,arguments)||{};return t.rejectedParams=["parent-reqid","uinfo","photo-upload"],t},getRejectedParams:function(){var t=BEM.blocks.uri.parseParams();return _.filter(this.params.rejectedParams,function(e){return Boolean(t[e])})},removeParams:function(t){this.delViewParams(t)}},{DELAY_REMOVE_PARAMS:3e3}),BEM.DOM.decl({block:"serp-controller",modName:"infinite",modVal:"yes"},{offset:{"default":700,serp:700,view:2e3},syncState:function(){return this.__base.apply(this,arguments),this.updateInfiniteLoadState(!0),this},unbindEvents:function(){return this.__base.apply(this,arguments),this.disableInfiniteLoad(),this},enableInfiniteLoad:function(){var t=this.findMore("next");t&&t.setMod("disabled","yes"),BEM.blocks["b-page"].on("scroll resize",this.tryLoad,this)},disableInfiniteLoad:function(){var t=this.findMore("next");t&&t.delMod("disabled"),BEM.blocks["b-page"].un("scroll resize",this.tryLoad,this)},updateInfiniteLoadState:function(){this.needMore()?(new window.rafQueue).add(this.enableInfiniteLoad,this).add(this.tryLoad,this).run():(new window.rafQueue).add(this.disableInfiniteLoad,this).add(this.toggleCompetitors,this).run()},getListCount:function(){return this.findElem("list").length},_onMoreDataLoaded:function(t){this.__base.apply(this,arguments),"next"===t.params.direction&&this.updateInfiniteLoadState()},tryLoad:function(){(new window.rafQueue).add(function(){!this.hasMod("loading","yes")&&this._isEndOfPage()&&(this.disableInfiniteLoad(),this.load("next"))}.bind(this)).run()},_isEndOfPage:function(){var t,e,i=window.pageYOffset+window.innerHeight,n=this.findMore("next");return n?(t=n.domElem.offset().top,e=this.offset["default"],i+e>=t):!1},needMore:function(){return this.getListCount()%this.params.count!==0}}),BEM.DOM.decl({block:"serp-controller",modName:"infinite",modVal:"yes"},{getListCount:function(){var t=this._getSerpList();return t?t.getPagesCount():0},_isEndOfPage:function(){return this.page.hasMod("fullscreen","yes")?!1:this.__base.apply(this,arguments)},needMore:function(){return this.page.hasMod("fullscreen","yes")?!0:this.hasMod("page","index")?!1:this.__base.apply(this,arguments)}}),BEM.DOM.decl({block:"serp-controller",modName:"page",modVal:"index"},{syncState:function(){return this.showFooter(),this.__base.apply(this,arguments)},_onItemClicked:function(t,e){this.location.change({block:"b-page_type_search",url:e.params.detail_url},t)}}),BEM.DOM.decl({block:"serp-controller",modName:"page",modVal:"search"},{_otherSitesBlockName:"other-sites",syncState:function(){return this.__self._removedThumbs&&this.__self._removedThumbs.empty(),this.__self._removedGalleryThumbs&&this.__self._removedGalleryThumbs.empty(),this.__base.apply(this,arguments)},_onPageChanged:function(){window.Ya.Images.ThumbsStore.clear(),this.__base.apply(this,arguments)},getLastPage:function(){return this._getSerpList().getLastPageNumber()}}),BEM.DOM.decl("navigation-controller",{onSetMod:{js:function(){this.__self.instance=this,this.serp=this.findBlockOn("serp-controller"),this.page=this.findBlockOutside("b-page"),this.bindEvents()}},bindEvents:function(){},goTo:function(t,e,i){var n=this.serp.getBlockByDirection(t);return n?(n.click(i||"keyboard",t),e&&this.hasMod("scrollable","yes")&&this.scroll(t),!0):(this.serp.trigger("listOut",t),!1)}},{get:function(){return this.instance}}),BEM.DOM.decl("navigation-controller",{onSetMod:{js:function(){this.__base.apply(this,arguments),this.ROW_HEIGHT=BEM.blocks["i-global"].getFlag("thumb_size")||190}},scroll:function(t){return"left"===t||"up"===t?this.tryScrollTop():"right"!==t&&"down"!==t||this.tryScrollBottom(),this},tryScrollBottom:function(){var t=this.__self.win,e=t.height(),i=t.scrollTop()+e,n=this.getOffset(),s=n+this.ROW_HEIGHT,o=i-s;(o<this.ROW_HEIGHT||o>e)&&this.page.scrollTo(s+this.ROW_HEIGHT-e,200)},tryScrollTop:function(){var t=this.__self.win,e=this.getOffset(),i=this.page._headerHeight+9,n=e-t.scrollTop();(n<this.ROW_HEIGHT||n>t.height())&&this.page.scrollTo(e-this.ROW_HEIGHT-i,200)},getOffset:function(){var t=BEM.blocks["serp-item"].getCurrent();return t?t.domElem.offset().top:0}}),function(){for(var t=0,e=["ms","moz","webkit","o"],i=0;i<e.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[e[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[i]+"CancelAnimationFrame"]||window[e[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var i=+new Date,n=Math.max(0,16-(i-t)),s=setTimeout(function(){e(i+n)},n);return t=i+n,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)}),window.rafQueue=function(){var t=[];this.add=function(e,i){return Array.isArray(e)||(e=[e]),e.forEach(function(e){var n;_.isPlainObject(e)&&(e=e.fn,n=e.ctx),t.push({fn:e,ctx:n||i})}.bind(this)),this},this.run=function(){var e,i=window.requestAnimationFrame,n=function(){0!==t.length&&(e=t.shift(),e.ctx?e.fn.call(e.ctx):e.fn(),i(n))};i(function(){i(n)})}},window.inNextFrame=function(t,e){window.requestAnimationFrame(function(){window.requestAnimationFrame(function(){e?t.call(e):t()})})}}(),BEM.DOM.decl("scroll-spy",{onFirstBecameVisible:function(t,e){var i=this.params.visibilityConditions;this.__self.notifyBecameVisible(this.domElem,t,e,i)}},{SCROLL_EVENT:"scroll touchmove",SCROLL_SMOOTHING:50,live:!0,init:function(){"undefined"==typeof this._watchedElements&&(this._win=BEM.DOM.win,this._watchedElements=[],this._onScrollSmooth=$.debounce(this._onScroll,this.SCROLL_SMOOTHING,this))},getElemVisibility:function(t){if(!t.is(":visible"))return{visible:!1,x:0,y:0,area:0};var e=t[0].getBoundingClientRect();if(e.right<=0||e.left>=window.innerWidth||e.bottom<=0||e.top>=window.innerHeight)return{visible:!1,x:0,y:0,area:0};var i=e.width*e.height,n=this.getIntersection(e,{top:0,right:window.innerWidth,bottom:window.innerHeight,left:0});return{visible:!0,x:e.width?n.xOverlap/e.width:0,y:e.height?n.yOverlap/e.height:0,area:i?n.overlapArea/i:0}},getIntersection:function(t,e){var i=Math.min(t.right,e.right)-Math.max(t.left,e.left),n=Math.min(t.bottom,e.bottom)-Math.max(t.top,e.top);return 0>i&&(i=0),0>n&&(n=0),{xOverlap:i,yOverlap:n,overlapArea:i*n}},watchVisibility:function(t,e,i){if("undefined"==typeof this._watchedElements&&this.init(),!t)throw new Error("Dom elem required");if(!e)throw new Error("Callback required");if(!t.length)throw new Error("Can't watch empty collection");var n=$.identify(t[0]);return this.isElemWatched(t,e)||(this._watchedElements.push({id:n,domElem:t,callback:e,ctx:i||null}),this._setupScrollListener()),this},stopWatchingVisibility:function(t,e,i){if(!t.length)return this;i=i||null;var n=$.identify(t[0]),s=e?function(t){return!(t.id===n&&t.callback===e&&t.ctx===i)}:function(t){return t.id!==n};return this._watchedElements=this._watchedElements.filter(s),this._setupScrollListener(),this},_setupScrollListener:function(){var t=this._watchedElements.length;1!==t||this._listeningScroll?0===t&&(this._win.off(this.SCROLL_EVENT,this._onScrollSmooth),this._listeningScroll=!1):(this._win.on(this.SCROLL_EVENT,this._onScrollSmooth),this._listeningScroll=!0)},_onScroll:function(){for(var t=0;t<this._watchedElements.length;t++){var e=this._watchedElements[t],i=this.getElemVisibility(e.domElem);setTimeout(e.callback.bind(e.ctx,i),0)}},isElemWatched:function(t,e,i){if("undefined"==typeof this._watchedElements&&this.init(),!t.length)return!1;var n=$.identify(t[0]);return i=i||null,this._watchedElements.some(function(t){return t.id===n&&t.callback===e&&t.ctx===i})},notifyBecameVisible:function(t,e,i,n){"undefined"==typeof this._watchedElements&&this.init();var s=e.bind(i),o=this.getElemVisibility(t);return this.checkVisibilityConditions(n,o)?setTimeout(s,0):void this.watchVisibility(t,function r(e){this.checkVisibilityConditions(n,e)&&(setTimeout(s,0),this.stopWatchingVisibility(t,r,this))},this)},checkVisibilityConditions:function(t,e){"undefined"==typeof this._watchedElements&&this.init();var i=e.visible;if(i)for(var n in t)if(t.hasOwnProperty(n)){var s=e[n]>=t[n];if(i=i&&s,!i)break}return i}}),BEM.DOM.decl({block:"serp-controller",modName:"navigation",modVal:"yes"},{extraScroll:0,isInitialScrollDone:!1,findBlocks:function(){return this.navigation=this.findBlockOn("navigation-controller"),this.__base.apply(this,arguments)},bindEvents:function(){return this.params.item&&this.params.item.selected&&this.bindToWin("load scroll",this.initialScroll),this.__base.apply(this,arguments)},initialScroll:function(){this.isInitialScrollDone||this.initialScrollToSelected(),this.unbindFromWin("load scroll",this.initialScroll),this.location.un("b-page_type_search",this.initialScroll,this),this.isInitialScrollDone=!0},needScrollTo:function(t){return _.isFunction(this.isViewLayout)&&this.isViewLayout()||t.offset().top>.7*this.__self.win.height()},initialScrollToSelected:function(){var t,e,i=this._getItemShouldScrollTo();i&&(t=i.domElem,e=this.needScrollTo(t)?t:this.__self.win.scrollTop(),this.page.scrollTo(e,950,this.extraScroll))},_getItemShouldScrollTo:function(){return this.getCurrentItem()}}),BEM.DOM.decl({block:"serp-controller",modName:"navigation",modVal:"yes"},{needMore:function(){return this.hasMod("page","search-by-image")?!0:this.__base.apply(this,arguments)}}),BEM.DOM.decl({block:"serp-controller",modName:"navigation",modVal:"yes"},{extraScroll:150,initialScroll:function(){"wiz"===BEM.blocks.uri.getParamValue("source")&&(this.isInitialScrollDone=!0),this._getPane2Api().isOpened&&(this.isInitialScrollDone=!0),this.__base.apply(this,arguments)}}),BEM.DOM.decl("serp-controller",{bindEvents:function(){this.__base.apply(this,arguments),BEM.blocks["b-page"].on("scroll",this._onScroll,this),this._enablePointerEventsDebounced=$.debounce(this._enablePointerEvents,300,this)},destruct:function(){BEM.blocks["b-page"].un("scroll",this._onScroll,this),this.__base.apply(this,arguments)},_needPointerEventsSwitching:function(){return!BEM.blocks["i-global"].param("mobile")&&BEM.blocks["i-ua"].isPointerEventsAvailable()},_onScroll:function(){this._needPointerEventsSwitching()&&(this.hasMod(this._getContent(),"pointer-events","none")||this._disablePointerEvents(),this._enablePointerEventsDebounced())},_disablePointerEvents:function(){this.setMod(this._getContent(),"pointer-events","none")},_enablePointerEvents:function(){this.delMod(this._getContent(),"pointer-events")},_getContent:function(){return this._content||(this._content=this.findElem("content"))},_onPageChanged:function(){this.__base.apply(this,arguments),this._content=void 0}}),BEM.DOM.decl({block:"serp-controller",modName:"page",modVal:"search-by-image"},{_nextDupsUrlChanged:!1,_onMoreClick:function(){this.load()},_onOtherSitesLoaded:function(t){this.findBlockInside(this._otherSitesBlockName).loadSites(t),"undefined"==typeof this._pagesCount&&(this._pagesCount=0),this._pagesCount++},_onMoreDataLoaded:function(t){var e=!(t.params.visible&&this.params.nextPageUrl||this._nextDupsUrlChanged);e&&this.params.nextPageUrlCBIR?(t.params.visible=!0,this._nextDupsUrlChanged=!0,this.params.nextPageUrl=this.params.nextPageUrlCBIR):t.params.visible=!1,this.__base.apply(this,arguments)},needMore:function(){return 2!==this._pagesCount?this.__base.apply(this,arguments):!1},syncState:function(){this._pagesCount=0,this.__base.apply(this,arguments),this._nextDupsUrlChanged=!1,this.delMod("loading")},load:function(){var t,e=this.params.nextPageUrl;return e||this._nextDupsUrlChanged||(this._nextDupsUrlChanged=!0,e=this.params.nextPageUrl=this.params.nextPageUrlCBIR),e?(this._setLoading("next"),t=this.getRequest(e).block({block:this._otherSitesBlockName+"__items",mods:{description:"yes"}},this._onOtherSitesLoaded).block("serp-controller",function(t){this.params.nextPageUrl=t.params.nextPageUrl}.bind(this)).block("more_direction_next",this._onMoreDataLoaded),t.get(BEM.blocks["i-url-controller"].mergePassedUrlParams(BEM.blocks["serp-controller"].getUrlRequestParams(),BEM.blocks.uri.parseParams(e))),this):void 0}}),BEM.DOM.decl("serp-controller",{syncState:function(){return this.params.hoverTime>0&&(clearInterval(this._sendHoverInterval),this._sendHoverInterval=setInterval(this.sendHoverStats.bind(this),this.params.hoverTime)),this.__base.apply(this,arguments)},sendHoverStats:function(){var t,e=BEM.blocks["serp-item"].anim;_.isEmpty(BEM.blocks["serp-item"].hovered)||(t=JSON.stringify(BEM.blocks["serp-item"].hovered),Object.keys(e).length&&(t+=",-anim="+JSON.stringify(e)),c.hit({dtype:"iweb",path:"/image/new/serp/hover",serpid:BEM.blocks["i-global"].param("serpid"),vars:"858,-info="+t}),BEM.blocks["serp-item"].hovered={},BEM.blocks["serp-item"].anim={})}}),BEM.DOM.decl("serp-controller",{bindEvents:function(){return BEM.blocks["pane2-api"].on("pane:close",this._onPane2Close,this),this.__base.apply(this,arguments)},unbindEvents:function(){return BEM.blocks["pane2-api"].un("pane:close",this._onPane2Close,this),this.__base.apply(this,arguments)},_onPane2Close:function(){this.unselectCurrentItem(),this.blinkCurrentItem()}}),BEM.DOM.decl({block:"serp-controller",modName:"prefetch",modVal:"yes"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),"search"===BEM.blocks["i-global"].param("page")&&this._loadPage("next",{cacheRequest:!0})}}},_clearRequestStack:function(){return _.forOwn(this._req,function(t){t.reject()}),this._req={},this},setRequestBlocks:function(t,e){return e.cacheRequest?(t.block("serp-controller",$.noop).block("serp-list_infinite_yes",$.noop).block("more_direction_"+e.direction,$.noop).block("gallery__items:ajax",$.noop),this):this.__base.apply(this,arguments)},_onSerpControllerLoaded:function(t,e){this.__base.apply(this,[t,e]),this._loadPage(e,{cacheRequest:!0})},_loadPage:function(t,e){var i=this.params[t+"PageUrl"],n=BEM.blocks.uri.parseParams(i),s=n.p;if(!i)return!1;if(e=_.assign(e||{},{direction:t}),_.assign(n,this.__self.getUrlRequestParams(e.direction)),this._req[s]&&e&&e.cacheRequest)return!0;if(this._req[s]){var o=this;return this._req[s].done(function(){return o._sendRequest(n,e)}),!0}return this._sendRequest(n,e),!0},_sendRequest:function(t,e){var i=$.Deferred(),n=this.getRequest(this.params[e.direction+"PageUrl"],e);this._req[t.p]=i,this.setRequestBlocks(n,e),n.get(t,this._onAjaxSuccess.bind(this,i))},_onAjaxSuccess:function(t){t.resolve&&t.resolve()}}),BEM.DOM.decl({block:"serp-controller",modName:"height",modVal:"full"},{onSetMod:{height:{"":function(){this._removeEmptySpace()}}},findBlocks:function(){return this.__base.apply(this,arguments),this.layout=this.findBlockOn("page-layout"),this},_emptySpaceAdded:!1,_addSpace:function(){var t=this._getSerpList();if(t){var e=t.domElem.height()/t.getPagesCount(),i=t.getCurrentPageNumber(),n=t.getLastPageNumber()-i,s=Math.min(n,this.params.count);0!==i&&s--,this.layout.setHeight(this.layout.getHeight()+e*s)}},enableInfiniteLoad:function(){this.__base.apply(this,arguments),!this._emptySpaceAdded&&this._isFullHeightAllowed()&&(window.inNextFrame(this._addSpace,this),this._emptySpaceAdded=!0)},disableInfiniteLoad:function(){this.__base.apply(this,arguments),this.needMore()&&this._getSerpList()&&!this._getSerpList().isCurrentPageLast()||this._removeEmptySpace()},_removeEmptySpace:function(){this.layout.setDefaultHeight(),this._emptySpaceAdded=!1}}),BEM.DOM.decl("serp-list",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),BEM.blocks["ajax-perf"].setReqid(this.params.reqid)}}}}),BEM.DOM.decl("serp-list",{_isLastPageHasBeenLoaded:!1,onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.totalPages=1,this.thumbRows=[],this._initialPageNum=this.params.pageNum,this.justifier=BEM.blocks.justifier,this.bindEvents(),this.init()}}},bindEvents:$.noop,unbindEvents:$.noop,destruct:function(){this.unbindEvents(),this.__base.apply(this,arguments)},_onPageResize:function(){this.fitAllItems()},init:function(){return window.Ya.Images.thumbRows?this.setThumbRows(window.Ya.Images.thumbRows):this.fitAllItems(),window.Ya.Images.thumbRows&&delete window.Ya.Images.thumbRows,this._removeDuplicates(this.domElem),this._onListAdded(),this._countLoadedRows(this.thumbRows),this},addSerpItems:function(t,e){this.params.pageNum=t.params.pageNum,this.params.lastPage=t.params.lastPage,this.params.reqid=t.params.reqid;var i,n=$(t.html),s=this.getLastRowItems();return this.thumbRows.pop(),this._removeDuplicates(n),"next"===e?(i=this.fitAddedItems(n.prepend(s)),BEM.DOM.append(this.domElem,n.contents()),this._countLoadedRows(i)):(BEM.DOM.prepend(this.domElem,n.contents()),this.fitAllItems()),this.totalPages++,this._onListAdded(),this},_onListAdded:function(){BEM.blocks["ajax-perf"].setReqid(this.params.reqid),this.trigger("loaded",{serpList:this,totalPages:this.totalPages})},_countLoadedRows:function(t){if(!_.isEmpty(t)){for(var e=BEM.blocks["i-userinfo"].get().getWindowSize(),i=function(t,e){return window.Ya.Images.ThumbsStore.get(t,"fittedItem."+e);
},n=[],s=[],o=[],r=0;r<t.length;r++){var a=i(t[r][0],"newHeight");a&&(n.push(t[r].length),s.push(a),o.push(t[r].map(function(t){return i(t,"newWidth")}).join("-")))}c.cpHitDelayed({pid:40,cid:72687,path:"desktop"===window.Ya.Images.platform?"8.228.471.436.1007":"8.584.471.436.1007",vars:["-thumbs="+n.join(";"),"-heights="+s.join(";"),"-widths="+o.join(";"),"-viewport="+e.width+";"+e.height].join(","),reqid:this.params.reqid})}},getLastRowItems:function(){return _.map(_.last(this.thumbRows),function(t){return document.getElementById(t)})},getLastThumbOfRow:function(t){return $(document.getElementById(_.last(this.thumbRows[t])))},getInitialPageNum:function(){return this._initialPageNum},getPagesCount:function(){return this.totalPages},getRowCount:function(){return this.thumbRows.length},setThumbRows:function(t){this.thumbRows=t},addThumbRows:function(t){this.thumbRows=this.thumbRows.concat(t)},isLastPageHasBeenLoaded:function(){return this.isCurrentPageLast()&&(this._isLastPageHasBeenLoaded=!0),this._isLastPageHasBeenLoaded},getPenultRowNum:function(){var t=this.isRowVisible(this.thumbRows.length-1);return t?this.thumbRows.length-2:this.thumbRows.length-3},isRowVisible:function(t){return"inline-block"===this.getLastThumbOfRow(t).css("display")},getThumbRow:function(t){for(var e,i=0,n=0;n<this.thumbRows.length;n++)for(e=0;e<this.thumbRows[n].length;e++)if(i++,i===t)return n},appendToRow:function(t,e){var i=-1===t?this.getPenultRowNum():t-1;this.getLastThumbOfRow(i).after(e)},appendIncutElem:function(t){return this.domElem.append(t),this},prependIncutElem:function(t){return this.domElem.prepend(t),this},getCurrentPageNumber:function(){return this.params.pageNum},getLastPageNumber:function(){return this.params.lastPage},isCurrentPageLast:function(){return this.params.pageNum===this.params.lastPage},getIds:function(){return _.flatten(this.thumbRows)}},{getUrls:function(){var t=$(".serp-item_type_search").toArray();return t.reduce(function(t,e){return t.concat(BEM.blocks["serp-item"].getUrls($(e)))},[])}}),BEM.DOM.decl("serp-list",{bindEvents:function(){BEM.blocks["b-page"].on("resize",this._onPageResize,this)},unbindEvents:function(){BEM.blocks["b-page"].un("resize",this._onPageResize,this)},_onPageResize:function(){this._resetContainerWidth(),this.__base.apply(this,arguments)},fitAllItems:function(){if(this.hasMod("justifier","no"))return null;var t=this.justifier.fitImages({container:this.domElem[0],containerWidth:this._getContainerWidth(),showDangling:this.isLastPageHasBeenLoaded(),fitIncuts:!0});return this.setThumbRows(t),t},fitAddedItems:function(t){var e=this.justifier.fitImages({container:t.get(0),containerWidth:this._getContainerWidth(),thumbRows:this.thumbRows,showDangling:this.isCurrentPageLast(),fitIncuts:!0});return this.addThumbRows(e),e},_getContainerWidth:function(){return this._containerWidth||(this._containerWidth=this.domElem.parent().width()),this._containerWidth},_resetContainerWidth:function(){return delete this._containerWidth,this}}),BEM.DOM.decl("commercial-discard",{_onButtonClick:function(){this.trigger("turn-off"),c.hitDelayed({dtype:"iweb",path:"/image/new/serp/commercial/filter/discard",reqid:BEM.blocks["i-global"].param("reqid")})}},{live:function(){this.liveInitOnBlockInsideEvent("click","button2",function(t){this._onButtonClick(t)})}}),BEM.DOM.decl("serp-item",{onSetMod:{selected:{yes:function(){this.delMod("hovered"),this.__self.delSelected()}}},saveCurrent:function(){return this.__self.prev=this.__self.getCurrent(),this.__self.setCurrent(this),this}},{getCurrent:function(){return this.current&&!this.current._isDestructing?this.current:void 0},getPrev:function(){return this.prev&&!this.prev._isDestructing?this.prev:void 0},setCurrent:function(t){this.current=t},clearCurrent:function(){this.setCurrent(null)},delSelected:function(){return this.getCurrent()&&this.getCurrent().delMod("selected"),this},current:null,prev:null}),BEM.DOM.decl("serp-item",{onSetMod:{hovered:{yes:function(){return this.canHover()}}},canHover:function(){return!this.hasMod("selected","yes")},_onClick:function(t){BEM.blocks["i-global"].param("isPumpkin")&&"index"===BEM.blocks["i-global"].param("page")||(this.click("mouse"),t.preventDefault())},click:function(t,e){return this.eventSource=t,this.eventParams=e,this.setMod("selected","yes").saveCurrent().trigger("clicked",this),this}},{live:function(){this.__base.apply(this,arguments),this.liveInitOnEvent("mousemove")},getParams:function(t){var e=$("#"+t).data("bem");return e?e["serp-item"]:void 0}}),BEM.DOM.decl("serp-item",{onSetMod:{js:function(){this.__base.apply(this,arguments),this.bindTo("pointermove",this._onPointerMove),this.bindTo("pointerleave",this._onPointerLeave)}},_onPointerMove:function(){this.setMod("hovered","yes")},_onPointerLeave:function(){this.delMod("hovered")}}),BEM.DOM.decl("serp-item",{},{_getParams:function(t){var e=this.getName();return t.classList.contains(e)?JSON.parse(t.getAttribute("data-bem"))[e]:void 0},_getNearestImages:function(t,e){var i=document.querySelector(this.buildSelector("pos",t));if(!i)return[];for(var n=[this._getParams(i)],s=i.nextElementSibling,o=i.previousElementSibling;e>0&&(s||o);)s&&(n.push(this._getParams(s)),s=s.nextElementSibling,e--),o&&e>0&&(n.push(this._getParams(o)),o=o.previousElementSibling,e--);return n.filter(function(t){return t})}}),BEM.DOM.decl("serp-item",{_hoverTimer:null,_onPointerMove:function(){if(null===this.__self.hoverStartTime&&(this.__self.hoverStartTime=Date.now()),!this.hasMod("hovered","yes")&&!this._hoverTimer){var t=BEM.blocks["i-global"].param("lags"),e=t&&(t.show||t.thumb),i=this.__base,n=arguments;e?this._hoverTimer=setTimeout(function(){i.apply(this,n)}.bind(this),e):i.apply(this,n)}},_onPointerLeave:function(){if(this.__base.apply(this,arguments),this.__self.hoverStartTime){var t=Number(this.getMod("pos"));this.__self.hovered[t]=(this.__self.hovered[t]||0)+Date.now()-this.__self.hoverStartTime,this.__self.hoverStartTime=null,this.params.isContainAnimBadge&&(this.__self.anim[t]=1)}clearTimeout(this._hoverTimer),this._hoverTimer=null},click:function(){var t=BEM.blocks["i-global"].param("lags"),e=t&&t.show,i=this.__base,n=arguments;e?setTimeout(function(){i.apply(this,n)}.bind(this),e):i.apply(this,n)},_onClick:function(){this.__base.apply(this,arguments),this.sendClickCounter({click_source:"serp"})},sendClickCounter:function(t){var e=BEM.blocks.counter.convertVarsToString(t),i={dtype:"iweb",path:"/image/new/serp/results/"+this.params.counterPath,pos:this.params.pos,reqid:this.params.reqid};return e&&(i.vars=e),c.hitDelayed(i,{href:this.params.img_href}),this}},{hovered:{},anim:{},hoverStartTime:null,getUrls:function(t){var e=t.params||t.data("bem")["serp-item"],i=[e.img_href,this._getOriginUrl(e.preview[0])],n=_.clone(e.dups);n.push.apply(n,e.preview);for(var s=0;s<n.length;s++)i.push(this._getOriginUrl(n[s]));return _.uniq(i)},_getOriginUrl:function(t){return t.origin?t.origin.url:t.url}}),function(){BEM.DOM.decl({block:"serp-item",modName:"type",modVal:"search"},{onSetMod:{hovered:{yes:function(){if(this.__base.apply(this,arguments)===!1)return!1;var t=this._calcWidth(),e=this.domElem;this._polaroid=BEM.DOM.blocks.polaroid2.showTo({commercial:this._getCommercialParams(),itemWidth:this.getWidth(),itemHeight:this.getHeight(),minWidth:this.getPolaroidMinWidth(),snippet:this.params.snippet,hovered:this._calcHoveredParams(t,e),serpItemDomElem:this.elem("preview"),position:this.params.pos,id:this.params.id,greenUrlCounterPath:this.params.greenUrlCounterPath}),this._polaroid.on("complain.click",this._onComplainClick,this)},"":function(){this._polaroid&&(this._polaroid.un("complain.click",this._onComplainClick,this),BEM.DOM.blocks.polaroid2.hide(this._polaroid),this._polaroid=null)}},blink:function(){this.__self.canUseCSSAnimation||this.domElem.animate({opacity:"1"},{duration:500})},selected:{yes:function(){this.__base.apply(this,arguments),this.trigger("viewed")}}},getPolaroidMinWidth:function(){return Number(BEM.blocks["i-global"].getFlag("images_direlaroid_min_width"))||this.__self.MIN_WIDTH},getWidth:function(){return this.domElem.width()},getHeight:function(){return this.domElem.height()},_getCommercialParams:function(){var t,e,i=this.params,n=i.marketSnippet||i.market,s=i.moreLink&&i.moreLink.type||"market",o=i.pos,r="-pos="+o;return n?(t=n.visiblePrice||n.price,e=t?BEMHTML.apply({tag:"b",content:[t,{block:"rub",mods:{space:"yes"}}]}):BEM.I18N("serp-item","",{context:'[  ]        : "   "'}),s&&(r+=",-link_type="+s),{text:BEM.I18N("serp-item","{price}   ",{context:'[  ]       : "1 234    "  "   "',price:e}),url:n.url,counters:{click:{path:"/image/new/serp/results/thumb/commercial/button/market",params:{reqid:i.reqid,pos:o,domain:n.domain,money_id:n.money_id||n.moneyId,vars:r}}}}):void 0},_getPreviewSize:function(){var t=_.get(this.params,"preview.0.origin")||_.get(this.params,"preview.0");return{width:t.w,height:t.h}},_calcHoveredParams:function(t,e){var i=this._isFirstImageInRow(e,e.prev()),n=this._isLastImageInRow(t,e,e.next()),s=!i&&!n;return{lastInRow:n,firstInRow:i,middle:s,small:t===this.getPolaroidMinWidth()}},_calcWidth:function(t){return t=t||this.domElem.width(),Math.max(t,this.getPolaroidMinWidth())},_calcPolaroidPadding:function(t){return t=t||this.domElem.height(),t+this.__self.PADDING},_onComplainClick:function(){BEM.blocks.feedback.showPopup(this)},_isLastImageInRow:function(t,e,i){var n=e.offset(),s=!(i.length&&n.top===i.offset().top),o=n.left+t+this.__self.PADDING>this.__self.doc.width();return s&&o},_isFirstImageInRow:function(t,e){return!e.length||t.offset().top!==e.offset().top}},{live:function(){this.__base.apply(this,arguments),this.liveBindTo("link","pointerclick",function(t){return t.stopPropagation(),2===t.which||t.metaKey||t.ctrlKey?!0:void this._onClick(t)}),this.canUseCSSAnimation=BEM.blocks["i-ua"].canUseCSSAnimation()},PADDING:12,MIN_WIDTH:170})}(),BEM.DOM.decl({block:"serp-item",modName:"scale",modVal:"yes"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this._resetScaleStyles(),BEM.blocks["b-page"].on("resize",this._onResize,this)},hovered:{yes:function(){if(!this._leaved){var t=BEM.blocks["i-global"].getFlag("images_thumb_hover_scale"),e=this;this.__base.apply(this,arguments),t>1&&(this._baseSize=this._calcBaseParams(this.domElem),this._scaledSize=this._calcScaledParams(t),this.setMod("scaled","yes"),this._nextFrameExec(function(){e.elem("preview").css({left:e._scaledSize.left,top:e._scaledSize.top,width:e._scaledSize.width,paddingBottom:e._scaledSize.paddingBottom})}))}}},selected:{yes:function(){this._leave(this.__base)}}},destruct:function(){BEM.blocks["b-page"].un("resize",this._onResize,this),this.__base.apply(this,arguments)},_onResize:function(){this._resetScaleStyles(),this._scaledSize=null,this._baseSize=null},_resetScaleStyles:function(){var t=this.domElem.width();this.elem("preview").css({left:0,top:0,width:t})},_nextFrameExec:function(t){window.requestAnimationFrame(function(){window.requestAnimationFrame(function(){t()})})},_onPointerLeave:function(){this._leave(this.__base)},_leave:function(t){var e=this.domElem.width(),i=this;this._leaved=!0,this._nextFrameExec(function(){i.elem("preview").css({left:0,top:0,width:e})}),setTimeout(function(){this.delMod("scaled"),this._leaved=!1,t&&t.apply(this,arguments)}.bind(this),this.__self.HOVER_ANIMATION_DURATION)},_calcBaseParams:function(t){return this._baseSize||{height:t.height(),width:t.width(),paddingTop:this._calcPolaroidPadding()}},_calcScaledParams:function(t){var e=this._scaledSize||{height:Math.floor(this._baseSize.height*t),width:Math.floor(this._baseSize.width*t)};return e.left=this._calcShiftLeft(this._baseSize,e),e.top=this._calcShiftTop(this._baseSize,e),e.paddingBottom=Math.floor((this._baseSize.height-this.elem("thumb").height())/2),e},_calcShiftLeft:function(t,e){var i=this.domElem;return this._isFirstImageInRow(i,i.prev())?0:this._isLastImageInRow(e.width,i,i.next())?t.width-e.width:Math.floor((t.width-e.width)/2)},_calcShiftTop:function(t,e){var i=this.domElem;return this._isFirstRow(i,i.parent())?0:Math.floor((t.height-e.height)/2)},_isFirstRow:function(t,e){var i=t.offset(),n=e.offset();return i.top===n.top}},{HOVER_ANIMATION_DURATION:150}),BEM.DOM.decl({block:"serp-list",modName:"unique",modVal:"yes"},{_removeDuplicates:function(t){this._uniqIds||(this._uniqIds={});var e=this._uniqIds,i=!1,n=this;_.forEach(t.find(".serp-item"),function(t){e[t.id]?($(t).remove(),n._countRemovedDuplicate(t),i=!0):e[t.id]=!0}),i&&this.fitAllItems()},_countRemovedDuplicate:function(t){var e=$(t).data("bem")["serp-item"].img_href;window.Ya.Images.errcnt({src:e},73082)}}),BEM.DOM.decl({block:"serp-list",modName:"rum",modVal:"yes"},{_loadedThumbs:{},_serpItemImgSelector:".serp-item__thumb",_rumThumbCounterPath:void 0,getDefaultParams:function(){var t=this.__base.apply(this,arguments);return t.chunks=[6,6,18],t},onSetMod:{js:{inited:function(){if(this.MAX_RESULTS=450,this.__base.apply(this,arguments),this._isResourceTimingAPIAvaliable()){this.setupSpeedTest();var t=this._getImagesToBind(this.domElem.find(this._serpItemImgSelector).get());t&&t.forEach(function(t){this.bindToImages(t)}.bind(this))}}}},_getImagesToBind:function(t){if(!t||!t.length)return null;var e,i,n,s=this.params.chunks,o=[],r=0;for(n=0;n<s.length&&(i=r+s[n],e=t.slice(r,i),e.length);n++)o.push(this._getImagesWithPos(e,r)),r=i;return o},_getImagesWithPos:function(t,e){return e||(e=0),t.map(function(t,i){return{domElem:t,pos:i+e}})},_isResourceTimingAPIAvaliable:function(){return window.performance&&(window.performance.getEntries||window.performance.webkitGetEntries)},setupSpeedTest:function(){var t=window.performance,e=t.setResourceTimingBufferSize?"setResourceTimingBufferSize":"webkitSetResourceTimingBufferSize";return t[e]&&t[e](this.MAX_RESULTS),this},bindToImages:function(t){var e=t.length,i=function(){e--,0===e&&setTimeout(function(){this.allImagesLoadedHandler(t)}.bind(this),1)}.bind(this);return t.forEach(function(t){return t.domElem.complete?void i():void $(t.domElem).bind("load error",i)}),this},getEntriesName:function(){return window.performance.getEntries?"getEntries":"webkitGetEntries"},getImagesTimings:function(t){for(var e,i,n,s,o,r,a,c=this.getEntriesName(),h=window.performance[c](),l=BEM.blocks["i-ua"].getConnectionType(),u=[],d=0,p=h.length;p>d;d++)r=h[d],a=r.name,"undefined"==typeof t[a]||this._loadedThumbs[a]||(s=-1!==a.indexOf("http://")?"http":"https",n=a.replace(".yandex.net","").replace(s+"://","").split("/"),o=r.startTime,i=r.responseStart||o,e=[Math.floor(o),Math.floor(r.redirectEnd-r.redirectStart),Math.floor(r.domainLookupEnd-r.domainLookupStart),Math.max(Math.floor(r.domainLookupStart-r.fetchStart),0),Math.floor(r.connectEnd-(r.secureConnectionStart||r.connectStart)),Math.floor(r.responseStart-r.requestStart),Math.floor(r.responseEnd-i),Math.floor(r.duration),Math.floor(r.responseEnd),"undefined"==typeof r.transferSize?-1:Math.floor(r.transferSize),s,encodeURIComponent(n[0]),encodeURIComponent(n[1]),t[a]],l&&e.push(l),u.push(e.join(";")),this._loadedThumbs[a]=e);return u},allImagesLoadedHandler:function(t){var e,i,n={};t.forEach(function(t){i=t.domElem.src,/^https?\:/.test(i)||(i=window.location.protocol+i),n[i]=t.pos}),e=this.getImagesTimings(n),e.length&&this.sendStats(e)},sendStats:function(t){c.hitDelayed({dtype:"iweb",path:this._rumThumbCounterPath,vars:"-info="+t.join("!")},this.domElem),BEM.blocks.counter.debug("thumbs load timings",{path:this._rumThumbCounterPath,vars:t})}}),BEM.DOM.decl({block:"serp-list",modName:"rum",modVal:"yes"},{_rumThumbCounterPath:"/image/new/thmb_speed"}),BEM.decl("justifier",{},{fitImages:function(t){return window.Ya.Images.fitImages(t)},verticalFitImages:function(t,e){return window.Ya.Images.verticalFitImages(t,e)}}),BEM.DOM.decl({block:"serp-list",modName:"direct-insertions",modVal:"yes"},{bindEvents:function(){this.__base.apply(this,arguments),BEM.blocks["serp-list"].on("loaded",this._showDirectItems,this)},unbindEvents:function(){BEM.blocks["serp-list"].un("loaded",this._showDirectItems,this),this.__base.apply(this,arguments)},_showDirectItems:function(){var t=this.findBlocksInside({block:"serp-direct",modName:"pending",modVal:"yes"}),e=t.map(function(t){return t.getDirect().getRenderPromise()});e.length&&$.when.apply($,e).always(this._onAllDirectsRendered.bind(this,t))},_onAllDirectsRendered:function(t){var e=!1,i=0,n=this,s=function(t,i){"show"===i?(t.hasMod("hidden","yes")&&(e=!0),t.show()):(t.hasMod("hidden","yes")||(e=!0),t.hide())},o=function(){++i>=t.length&&e&&n.fitAllItems()};t.forEach(function(t){t.getDirect().getRenderPromise().done(function(){s(t,"show")}).fail(function(){s(t,"hide")}).always(o)})}}),BEM.DOM.decl("serp-direct",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.getDirect().update()}}},show:function(){this.domElem[0].classList.add("justifier__item"),this.delMod("pending").delMod("hidden"),this.blockInside("spin2").delMod("progress")},hide:function(){this.domElem[0].classList.remove("justifier__item"),this.delMod("pending").setMod("hidden","yes"),this.blockInside("spin2").delMod("progress")},getDirect:function(){return this.blockInside("direct")}}),BEM.DOM.decl("back",{onSetMod:{js:function(){this._isEnabled()&&(this.setMod("visibility","visible"),this.bindTo("pointerclick",this._onClick))}},_isEnabled:function(){return window.history&&window.history.length>1},_onClick:function(t){t.preventDefault(),window.history.back()}}),BEM.DOM.decl("other-sites",{loadSites:function(t){BEM.DOM.append(this.elem("container"),t.html)}}),BEM.DOM.decl("other-sites",{_hitCounter:function(t){var e,i=t.target.className.match(/other-sites__(title-link|outer-link|thumb)/),n=i&&i[1],s=t.data.domElem.index();if(n){switch(n){case"thumb":e="/image/new/cbir/results/thumb";break;case"title-link":e="/image/new/cbir/results/site";break;case"outer-link":e="/image/new/cbir/results/duplicates/url"}c.hit({dtype:"iweb",path:e,pos:s,reqid:this.params.reqid})}},_onMiddleClick:function(t){1===t.button&&this._hitCounter(t)}},{live:function(){this.liveBindTo("item","pointerclick contextmenu",function(t){this._hitCounter(t)}).liveBindTo("item","click",function(t){this._onMiddleClick(t)})}}),BEM.DOM.decl("boards",{show:function(){return this.delMod("visibility")},_sendCounter:function(){cp({dtype:"stred",pid:40,cid:73019,path:"8.228.471.2177.882"})},_onComplain:function(t){var e=this.elem("board").toArray(),i=e[t],n=e.map(function(t){return this.elemParams($(t))}.bind(this)),s=n.map(function(t){return t.title}).join(";"),o=n.map(function(t){return t.thumbs}).join(";"),r=this.elemParams($(i))||{};BEM.channel("feedback").trigger("show",{abuseLink:BEM.blocks["i-global"].param("abuseLink"),"shows-related-images":o,"shows-related-queries":s,"related-query-complaint":r.title,"related-image-complaint":r.thumbs})}},{live:function(){return this.liveBindTo("link button","pointerclick",function(){this._sendCounter()}),this.liveBindTo({elem:"board",modName:"more",modVal:"yes"},"pointerclick",function(){this._sendCounter()}),this.liveBindTo("complain","pointerclick",function(t){this._onComplain(this.elem("complain").index(t.target.domElem))}),this.__base.apply(this,arguments)}}),BEM.DOM.decl("carousel",{onSetMod:{js:{inited:function(){this.setScrollMod(),this.bindTo("wrap","scroll",$.throttle(this._onScroll,50,this)),BEM.blocks["b-page"].on("resize",this._onResize,this)}},scroll:{both:function(){this.trigger("scrollModChange",{type:"both"})}}},destruct:function(){BEM.blocks["b-page"].un("resize",this._onResize,this),this.__base.apply(this,arguments)},setScrollMod:function(){var t,e=this.elem("wrap").scrollLeft(),i=this.elem("wrap")[0].scrollWidth,n=this.elem("wrap").width();return t=0>=i-n?"":0===e?"right":i>e+n?"both":"left",this.setMod("scroll",t)},checkEndOfList:function(){if(!this.params.offset)return this;var t=this.elem("wrap"),e=t.scrollLeft(),i=t[0].scrollWidth,n=t.width();return e<=this.params.offset&&this.trigger("listOut","left"),e+n>i-this.params.offset&&this.trigger("listOut","right"),this},scrollToStart:function(){this.elem("wrap").scrollLeft(0)},setItemsInList:function(t){this.getList().html(t)},setItemsInListWithInit:function(t){BEM.DOM.update(this.getList(),t)},appendItemsInList:function(t){this.getList().append(t)},appendItemsInListWithInit:function(t){BEM.DOM.append(this.getList(),t)},prependItemsInList:function(t){this.getList().prepend(t)},prependItemsInListWithInit:function(t){BEM.DOM.prepend(this.getList(),t)},getList:function(){return this.list||(this.list=this.elem("list"))},getContentWidth:function(){return this.getList().width()},getControlWidth:function(t){return this.elem("control","side",t).width()},getWrapperWidth:function(){return this.elem("wrap").width()},scrollLeft:function(t){return"undefined"!=typeof t?this.elem("wrap").scrollLeft(t):this.elem("wrap").scrollLeft()},flatten:$.noop,_onScroll:function(){this.setScrollMod().checkEndOfList()},_onResize:function(){this.setScrollMod()}},{live:!0}),BEM.DOM.decl("carousel",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.bindTo("item","pointerclick",function(t){this._onItemClick(t)})}}},_onItemClick:function(t){return this.preventClick?(this.preventClick=!1,t.stopImmediatePropagation(),t.preventDefault(),!1):void 0},_onMouseMove:function(t){this.setMod(t.data.domElem,"hovered","yes")},_onMouseLeave:function(){this.delMod(this.elem("control"),"hovered")},_onMouseDown:function(t){this.clicked=!0,this.preventClick=!1,this.startPoint=t.clientX+this.elem("wrap").scrollLeft(),this._mouseDownX=t.clientX,this._mouseDownY=t.clientY},_onDragStart:function(t){t.preventDefault()},_onItemMouseMove:function(t){!this.clicked||t.clientX===this._mouseDownX&&t.clientY===this._mouseDownY||(this.setMod(this.elem("wrap"),"grabbing","yes"),this.elem("wrap").scrollLeft(this.startPoint-t.clientX),this.preventClick=!0)},_onMouseUp:function(){this.delMod(this.elem("wrap"),"grabbing"),this.clicked=!1}},{live:function(){this.__base(),this.liveBindTo("control","mouseover",function(t){this._onMouseMove(t)}).liveBindTo("control","mouseout",function(){this._onMouseLeave()}).liveBindTo("wrap","dragstart",function(t){this._onDragStart(t)}).liveBindTo("wrap","mousedown",function(t){this._onMouseDown(t)}).liveBindTo("wrap","mousemove",function(t){this._onItemMouseMove(t)}).liveBindTo("wrap","mouseup mouseleave",function(){this._onMouseUp()})}}),BEM.DOM.decl("carousel",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.scrollToStart(),this.setWidth(),this.items=this.elem("item")}}},getDefaultParams:function(){var t=this.__base();return t.animationTime=this.hasMod("full-scroll","yes")?400:300,t},setWidth:function(){return this.carouselWidth=this.domElem.width(),this},_onResize:function(){this.__base.apply(this,arguments),this.setWidth()}}),BEM.DOM.decl("carousel",{insertAfterThumb:function(t,e){this.getList().find("#gallery-"+e).after(t)},insertBeforeAllThumbs:function(t){this.getList().prepend(t)},getStep:function(){return this.params.step}}),BEM.DOM.decl({block:"wizard-wrapper"},{hitVisible:function(){this.trigger("wizard-in-viewport")}}),BEM.DOM.decl("categories-index",{onSetMod:{js:function(){BEM.blocks["b-page"].on("scroll",this._onPageScroll,this)}},destruct:function(){BEM.blocks["b-page"].un("scroll",this._onPageScroll,this),this.__base.apply(this,arguments)},_onItemClick:function(t){var e=this.elemParams(t.data.domElem);cp({pid:40,cid:72623,path:"px500.categories.theme."+e.theme+".item."+e.query})},_onButtonClick:function(t){cp({pid:40,cid:72623,path:"px500.categories.theme."+this.elemParams(t.data.domElem).query})},_onPageScroll:function(){var t=BEM.DOM.win,e=270;t.scrollTop()>=t.height()-e&&(cp({pid:40,cid:72623,path:"px500.categories.show"}),BEM.blocks["b-page"].un("scroll",this._onPageScroll,this))}},{live:function(){this.liveBindTo("item","pointerclick",function(t){this._onItemClick(t)}),this.liveBindTo("button","pointerclick",function(t){this._onButtonClick(t)})}}),BEM.DOM.decl("direct",{onSetMod:{js:{inited:function(){this.hasMod("update-on-init","yes")&&this.update()}}},update:function(t,e){window.Ya&&window.Ya.Direct&&this.__self._isLoaded||this._load(t,e),this.__self._isAdvManagerInited?this._update(t,e):this.__self.initedPromise.done(this._update.bind(this,t,e))},_load:function(){this.__self.load(this._onLoad.bind(this))},_onLoad:function(){var t=window.yandex_context_callbacks||(window.yandex_context_callbacks=[]);t.push(this._onAdvManagerInited.bind(this))},_onDirectLoaded:function(){return this._isDestructing?void 0:BEM.blocks["i-global"].param("isPornoQuery")?void this.hide():void this.show()},_onAdvManagerInited:function(){this.__self._isAdvManagerInited=!0,this.__self.initedPromise.resolve()},_render:function(t,e,i){if(window.Ya.Context){window.Ya.Context._asyncModeOn=!0;var n={blockId:i||this._getDirectId(),renderTo:e,async:!0,onRender:this._onDirectLoaded.bind(this),grab:this._getGrabText(t),extParams:"&"+$.param(this._getExtParams()),pageNumber:this.params.pageNumber>=0?this.params.pageNumber:null};if(this.params.data)try{n.data=JSON.parse(this.params.data)}catch(s){}window.Ya.Context.AdvManager.render(n,this._onEmptyDirectLoaded.bind(this))}return this},_getDirectId:function(){return this.params.directId},_getGrabText:$.noop,_getExtParams:function(){return{}},_onEmptyDirectLoaded:$.noop},{LOADER_URL:"//an.yandex.ru/system/context.js",initedPromise:$.Deferred(),_status:"not exists",load:function(t){t(),"not exists"===this._status&&$.getScript(this.LOADER_URL).done(function(){this._isLoaded=!0,this._status="loaded"}.bind(this)).fail(function(){this.initedPromise.reject(),this._status="error"}.bind(this)),this._status="loading"}}),BEM.DOM.decl("direct",{onSetMod:{js:{inited:function(){return BEM.blocks["i-global"].param("isPornoQuery")?void this.hide():(this.__base.apply(this,arguments),void this.bindEvents())}}},bindEvents:function(){this.params.dynamicDirectIds&&BEM.blocks["b-page"].on("resize",this._onPageResize,this)},destruct:function(){this.params.dynamicDirectIds&&BEM.blocks["b-page"].un("resize",this._onPageResize,this),this.__base.apply(this,arguments)},_onPageResize:function(){this.update()},updateIncut:function(){this.update()},transparent:function(){this.setMod("visibility","transparent")},hide:function(){return this.setMod("visibility","hidden")},show:function(){return this.delMod("visibility")},_update:function(){if(!this.__self._isLoaded)return this;var t=BEM.blocks["i-global"];if(t.param("isPornoQuery"))return this.hide(),this;var e=t.param("query");return this._render(e,this.domElem[0].id,this._getDirectId()),this},_onEmptyDirectLoaded:function(){this.hide()},_getDirectId:function(){return this.params.dynamicDirectIds?this._getDynamicDirectId():this.params.directId},_getDynamicDirectId:function(){for(var t,e=this.params.dynamicDirectIds,i=window.innerWidth,n="",s=e.length-1;s>=0;s--)if(t=e[s],i>=t["min-width"]){n=t.id;break}return n},_getExtParams:function(){var t=this.getMod("type")||this.getMod("pos");return this.__self.getExtParams(t,this._rowNum)},_getGrabText:function(t){var e,i="t"+t+"\n";return BEM.blocks["i-global__utils"].base64Encode(i,e)},isExists:function(){return!this.domElem.is(":empty")}},{getExtParams:function(t,e){var i=BEM.blocks["i-global"],n={serpid:i.param("serpid"),testid:i.param("testId"),position:t||""};return i.param("mobile")?n.ui="phone":i.param("tablet")?n.ui="pad":n.ui="desktop",e&&(n.line=e),n}}),BEM.DOM.decl({block:"direct",modName:"type",modVal:"insertion"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._renderPromise=$.Deferred()}}},_load:function(){var t=this;this.__base.apply(this,arguments),this.__self.initedPromise.fail(function(){t._renderPromise.reject()})},getRenderPromise:function(){return this._renderPromise},_onEmptyDirectLoaded:function(){this._renderPromise.reject()},_onDirectLoaded:function(){return this.__base.apply(this,arguments),this._isDestructing?void this._renderPromise.reject():BEM.blocks["i-global"].param("isPornoQuery")?void this._renderPromise.reject():void this._renderPromise.resolve()}}),BEM.DOM.decl({block:"direct",modName:"type",modVal:"related"},{},{live:function(){return this.__base.apply(this,arguments),this.liveInitOnBlockOutsideEvent("shown","incut",function(){document.getElementById(this.domElem[0].id)?this.update():this.afterCurrentEvent(function(){this.update()})}),!1}}),BEM.DOM.decl("trimmer",{onSetMod:{js:{inited:function(){if(this._setDefaults(),this._checkParentSize(),!this.hasMod("disabled",!0)){var t;t=this._convertPixelsToPercentages(this.params.minWidth,this.params.minHeight),this.setSize(t.x,t.y),this.setPosition(this.params.x,this.params.y)}}}},getDefaultParams:function(){return{minWidth:50,minHeight:50,x:0,y:0}},show:function(){return this.setMod("visible","yes")},hide:function(){return this.delMod("visible")},setPosition:function(t,e){return t=this._roundNumber(t),e=this._roundNumber(e),t=Math.max(0,t),e=Math.max(0,e),t=Math.min(100-this._width,t),e=Math.min(100-this._height,e),this.domElem.css({top:e+"%",left:t+"%"}),this._positionX=t,this._positionY=e,this},getPosition:function(){return{x:this._positionX,y:this._positionY}},setSize:function(t,e){var i=this._convertPixelsToPercentages(this.params.minWidth,this.params.minHeight);return t=this._roundNumber(t),e=this._roundNumber(e),t=Math.max(i.x,t),e=Math.max(i.y,e),this.domElem.css({width:t+"%",height:e+"%"}),this._width=t,this._height=e,this},getSize:function(){return{width:this._width,height:this._height}},getRectangle:function(){return{point1:{x:this._positionX,y:this._positionY},point2:{x:this._positionX+this._width,y:this._positionY+this._height}}},getArea:function(){var t=this.getRectangle(),e=t.point1,i=t.point2;return{point1:{x:this._roundNumber(this._toRangeFromZeroToOne(e.x),4),y:this._roundNumber(this._toRangeFromZeroToOne(e.y),4)},point2:{x:this._roundNumber(this._toRangeFromZeroToOne(i.x),4),y:this._roundNumber(this._toRangeFromZeroToOne(i.y),4)}}},_toRangeFromZeroToOne:function(t){return t/100},_setDefaults:function(){this._startPointerXMove=NaN,this._startPointerYMove=NaN,this._startPositionXMove=NaN,this._startPositionYMove=NaN,this._startSizeWidthMove=NaN,this._startSizeHeightMove=NaN,this._pointNameMove=""},_onPointerDown:function(t){this._startPointerXMove=t.clientX,this._startPointerYMove=t.clientY,this._startPositionXMove=this._positionX,this._startPositionYMove=this._positionY,this._startSizeWidthMove=this._width,this._startSizeHeightMove=this._height,this._checkParentSize(),this.bindToDoc("pointerup",function(){this._onPointerUp()})},_onPointerUp:function(){this.unbindFromDoc("pointermove pointerup"),this._setDefaults()},_onPointPointerDown:function(t){this._onPointerDown(t),this._pointNameMove=this.getMod($(t.target),"position"),this.bindToDoc("pointermove",function(t){t.preventDefault(),this._onPointPointerMove(t)}).bindToDoc("pointerup",function(){this.trigger("size")})},_onPointPointerMove:function(t){var e=t.clientX-this._startPointerXMove,i=t.clientY-this._startPointerYMove,n=this._convertPixelsToPercentages(e,i),s=this._convertPixelsToPercentages(this.params.minWidth,this.params.minHeight),o=this._startPositionXMove+this._startSizeWidthMove,r=this._startPositionYMove+this._startSizeHeightMove,a=100-this._startPositionXMove,c=100-this._startPositionYMove,h=this._startPositionXMove+this._startSizeWidthMove-s.x,l=this._startPositionYMove+this._startSizeHeightMove-s.y;switch(this._pointNameMove){case"left-top":this.setSize(Math.min(o,this._startSizeWidthMove-n.x),Math.min(r,this._startSizeHeightMove-n.y)),this.setPosition(Math.min(h,this._startPositionXMove+n.x),Math.min(l,this._startPositionYMove+n.y));break;case"right-top":this.setSize(Math.min(a,this._startSizeWidthMove+n.x),Math.min(r,this._startSizeHeightMove-n.y)),this.setPosition(this._startPositionXMove,Math.min(l,this._startPositionYMove+n.y));
break;case"right-bottom":this.setSize(Math.min(100-this._positionX,this._startSizeWidthMove+n.x),Math.min(100-this._positionY,this._startSizeHeightMove+n.y));break;case"left-bottom":this.setSize(Math.min(o,this._startSizeWidthMove-n.x),Math.min(c,this._startSizeHeightMove+n.y)),this.setPosition(Math.min(h,this._startPositionXMove+n.x),this._startPositionYMove)}},_onTrimmerPointerDown:function(t){this._onPointerDown(t),this.bindToDoc("pointermove",function(t){t.preventDefault(),this._onTrimmerPointerMove(t)}).bindToDoc("pointerup",function(){this.trigger("drag")})},_onTrimmerPointerMove:function(t){var e=t.clientX-this._startPointerXMove,i=t.clientY-this._startPointerYMove,n=this._convertPixelsToPercentages(e,i);this.setPosition(this._startPositionXMove+n.x,this._startPositionYMove+n.y)},_checkParentSize:function(){var t=this.domElem.parent();this._parentWidth=t.width(),this._parentHeight=t.height()},_convertPixelsToPercentages:function(t,e){return{x:t/this._parentWidth*100,y:e/this._parentHeight*100}},_roundNumber:function(t,e){e=e||2;var i=Math.pow(10,e);return Math.round(t*i)/i}},{live:function(){this.liveBindTo("point","pointerdown",function(t){this.hasMod("disabled",!0)||(t.stopPropagation(),this._onPointPointerDown(t))}).liveBindTo("pointerdown",function(t){this.hasMod("disabled",!0)||this._onTrimmerPointerDown(t)})}}),BEM.DOM.decl("other-sizes",{_hitCounter:function(t){var e=this.getMod(t.parent(),"size"),i=t.index()+1;switch(e){case"large":e="big";break;case"medium":e="middle"}c.hit({dtype:"iweb",path:"/image/new/cbir/results/othersize/"+e+"/p"+i,reqid:this.params.reqid})},_onMiddleClick:function(t){1===t.button&&this._hitCounter(t.data.domElem)}},{live:function(){this.liveBindTo("column-item","pointerclick contextmenu",function(t){this._hitCounter(t.data.domElem)}).liveBindTo("column-item","click",function(t){this._onMiddleClick(t)})}}),BEM.DOM.decl("notice",{_onEnableClick:$.noop,_onDisableCLick:$.noop,_hitCounter:$.noop},{live:function(){this.liveInitOnBlockInsideEvent("click","button2",function(t){var e=t.target.domElem;this.elem("enable").is(e)?this._onEnableClick():this.elem("disable").is(e)&&this._onDisableClick(),this.setMod("hidden","yes")})}}),BEM.DOM.decl({block:"notice",modName:"type",modVal:"commercial"},{_onEnableClick:function(){this.__base.apply(this,arguments),this.trigger("commercial:turn-on"),this._hitCounter("yes")},_onDisableClick:function(){this.__base.apply(this,arguments),this._hitCounter("no")},_hitCounter:function(t){c.hitDelayed({dtype:"iweb",path:"/image/new/serp/commercial/filter/suggest",vars:"-action="+t})}}),BEM.DOM.decl({block:"notice",modName:"type",modVal:"safe-search"},{_onEnableClick:function(){this.__base.apply(this,arguments),this._setCookieValue(1),this._hitCounter("enable")},_onDisableClick:function(){this.__base.apply(this,arguments),this._setCookieValue(0),this.trigger("safe-search:turn-off"),this._hitCounter("disable")},_setCookieValue:function(t){$.cookie("ipnd",t,{expires:new Date(Date.now()+18e5),path:BEM.blocks["i-global"].param("router").index})},_hitCounter:function(t){c.hitDelayed({dtype:"iweb",path:"/image/new/serp/porno/disclaimer",vars:"-action="+t})}}),BEM.DOM.decl("related",{show:function(){return this.delMod("visibility")},hide:function(){return this.setMod("visibility","hidden")},shuffle:function(){BEM.DOM.update(this._getWizard().elem("list"),this.elem("item").sort(function(){return Math.random()-.5}))},_onItemClick:function(t){var e={},i=t.data.domElem;this.trigger("item-click",{item:i}),this._hitItemClickCounter(t),e[this.getMod("position")]="p"+this.getItemIndex(i),BEM.blocks["b-statcounter"].hit({params:{query:{related:e}}})},_hitItemClickCounter:function(t){var e=t.data.domElem,i=this.elemParams(e);c.hit({dtype:"iweb",path:this._getItemClickCounterPath(),serpid:BEM.blocks["i-global"].param("serpid"),vars:"-pos="+i.position+",-index="+this.getItemIndex(e)+",-query="+encodeURIComponent(i.label)+",-theme="+this._getWizard().getMod("theme")},{href:i.link})},_getItemClickCounterPath:function(){return"/image/new/serp/related_query/click"},_getWizard:function(){return this._wizard||(this._wizard=this.findBlockOn("wizard-wrapper"))},getItemIndex:function(t){return this.elem("item").index(t)}},{live:function(){this.liveInitOnBlockInit("wizard-wrapper").liveBindTo("item","pointerclick",function(t){this._onItemClick(t)}).liveBindTo("preview","click",function(t){t.preventDefault()})}}),function(){var t=Array.prototype.slice.call(document.querySelectorAll(".related__thumb[data-thumb]"));t.forEach(function(t){t.getAttribute("src")||t.setAttribute("src",t.getAttribute("data-thumb"))})}(),BEM.DOM.decl({block:"related",modName:"complain",modVal:"yes"},{_onComplain:function(t){var e=this.elem("item").toArray(),i=e.map(function(t){return this.elemParams($(t))}.bind(this)),n=_.map(i,"label").join(";"),s=_.map(i,"thumb").join(";"),o=this.elemParams($(e[t]))||{};BEM.channel("feedback").trigger("show",{abuseLink:BEM.blocks["i-global"].param("abuseLink"),"shows-related-images":s,"shows-related-queries":n,"related-query-complaint":o.label,"related-image-complaint":o.thumb})}},{live:function(){return this.liveInitOnBlockInsideEvent("click","button2",function(t){this._onComplain(this.elem("complain").index(t.target.domElem))}),this.__base.apply(this,arguments)}}),BEM.DOM.decl({block:"related",modName:"carousel",modVal:"yes"},{reduceLabelHeight:function(){return this._getWizard().reduceLabelHeight(),this},setCarouselMod:function(){return this._getWizard().setCarouselMod(),this},setCarouselSizes:function(){return this._getWizard().setCarouselSizes(),this}}),BEM.DOM.decl({block:"wizard-wrapper",modName:"carousel",modVal:"yes"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.reduceLabelHeight().setCarouselMod().setCarouselSizes(),this._getCarousel().on("scrollModChange",this._onCarouselScrollModChange,this)}}},getDefaultParams:function(){return{pageWidth:this.__self.win.width()}},reduceLabelHeight:function(){this.delMod("one-line-label");for(var t=this.elem("label"),e=2*parseInt(t.css("line-height"),10),i=Math.floor(this.params.pageWidth/this._getCarousel().getStep()),n=!1,s=0;i>s;s++)if(t[s]&&t[s].offsetHeight===e){n=!0;break}return n||this.setMod("one-line-label","yes"),this},setCarouselSizes:function(){return this.setCarouselHeight(),this._getCarousel().setWidth(),this},setCarouselHeight:function(t){return t||(t=this._getCarousel().elem("list").height()),0!==t&&this.elem("carousel").css("height",t),this},_getCarousel:function(){return this._carousel||(this._carousel=this.findBlockInside("carousel"))},setCarouselMod:function(){return this._getCarousel().setScrollMod(),this},_onCarouselScrollModChange:function(){this._getCarousel().un("scrollModChange",this._onCarouselScrollModChange,this),this.trigger("scrolled")}}),BEM.DOM.decl({block:"carousel",modName:"controls",modVal:!0},{onSetMod:{scroll:{left:function(){var t=this.elem("control","side","right");this.hasMod(t,"hovered","yes")&&this.setMod(t,"disable","yes")},right:function(){var t=this.elem("control","side","left");this.hasMod(t,"hovered","yes")&&this.setMod(t,"disable","yes")}}},onElemSetMod:{control:{hovered:{"":function(){this.delMod(this.elem("control"),"disable")}}}},getDefaultParams:function(){return{animationTime:300,offset:null}},_onControlClick:function(t){if(!this.hasMod(this.elem("control"),"disable","yes")){var e=this.getMod(t.data.domElem,"side");this.canScrollTo(e)&&this.move(e)}},_onControlPress:function(t){this.setMod(t.data.domElem,"pressed","yes")},_onPointerRelease:function(t){this.delMod(t.data.domElem,"pressed")},canScrollTo:function(t){var e=this.getMod("scroll");return"both"===e||e===t},move:function(t){var e=this.elem("wrap").scrollLeft(),i=e+this.getOffset(t);this.elem("wrap").animate({scrollLeft:i},this.params.animationTime,this.setScrollMod.bind(this))},getOffset:function(t){return("left"===t?-1:1)*this.params.step}},{live:function(){this.__base(),this.liveBindTo("control","pointerclick",function(t){this._onControlClick(t)}).liveBindTo("control","pointerpress",function(t){this._onControlPress(t)}).liveBindTo("control","pointerrelease",function(t){this._onPointerRelease(t)}).liveBindTo("control","dblclick",function(t){t.preventDefault()})},liveMod:!1}),BEM.DOM.decl({block:"carousel",modName:"controls",modVal:!0},{getDefaultParams:function(){var t=this.__base();return t.offsetRatio=1.4,t},getOffset:function(t){var e=this.hasMod("full-scroll","yes")?this.getFullOffset(t):this.params.step,i=this.shouldAddExtraScroll(e,t)?e*this.params.offsetRatio:e,n="left"===t?-1:1;return n*i},getFullOffset:function(t){var e,i,n,s=this.carouselWidth,o=this.elem("wrap").scrollLeft(),r=this.elem("control").width();return i=_.findLast(this.items,function(i){return e=$(i).position().left,"right"===t?o+s>e:"left"===t?o>e:void 0}),n="right"===t?e-r-o:s+o-e-$(i).outerWidth(!0)-r},shouldAddExtraScroll:function(t,e){var i=this.domElem.width(),n=this.elem("wrap").scrollLeft(),s=this.elem("wrap")[0].scrollWidth;return"right"===e&&.4*t>=s-i-n-t||"left"===e&&.4*t>=n-t}}),BEM.DOM.decl("video-wizard",{_sendCounter:function(t,e){var i={pos:"p"+t,target:e};BEM.blocks["b-statcounter"].hit({params:{query:{"video-wizard":i}}})},_sendViewCounter:function(){c.hitDelayed({dtype:"iweb",path:"/image/new/serp/wizards/video",reqid:BEM.blocks["i-global"].param("reqid"),vars:"-pos="+this.params.pos})},_onCoverClick:function(t){this._sendCounter(this.getItemIndex("cover",t.data.domElem),"thumb")},_onGreenurlClick:function(t){this._sendCounter(this.getItemIndex("greenurl",t.data.domElem),"greenurl")},_onLabelClick:function(t){this._sendCounter(this.getItemIndex("label",t.data.domElem),"label")},getItemIndex:function(t,e){return this.elem(t).index(e)},_onMorelClick:function(){BEM.blocks["b-statcounter"].hit({params:{query:{"video-wizard":{target:"more"}}}})}},{live:function(){this.liveInitOnBlockEvent("wizard-in-viewport","wizard-wrapper",function(){this._sendViewCounter()}).liveBindTo("cover","pointerclick",function(t){this._onCoverClick(t)}).liveBindTo("greenurl","pointerclick",function(t){this._onGreenurlClick(t)}).liveBindTo("label","pointerclick",function(t){this._onLabelClick(t)}).liveBindTo("more","pointerclick",function(t){this._onMorelClick(t)})}}),BEM.DOM.decl("auto-wizard",{_hitCounter:function(t){c.hit({dtype:"iweb",path:"/image/new/serp/wizard/autoru/"+t,vars:"-source=cbir"})}},{live:function(){this.liveBindTo("title","pointerclick",function(){this._hitCounter("title")}).liveBindTo("thumb","pointerclick",function(){this._hitCounter("images/thumb")}).liveBindTo("more","pointerclick",function(){this._hitCounter("images/showmore")}).liveBindTo("info-link","pointerclick",function(){this._hitCounter("category")})}}),BEM.DOM.decl("similar",{onSetMod:{js:function(){!BEM.blocks["i-ua"].hasFlexbox()||window.opera?(this.setMod("flexbox","no"),_.forEach(this.elem("thumb"),function(t){$(t).removeAttr("style").after(" ")}),this.justifyFallbackTimer=setTimeout(function(){this.initMoreLink()}.bind(this),1e3)):this.initMoreLink(),this.bindTo("thumb","pointerclick contextmenu",this._hitCounter),this.bindTo("thumb","click",this._onMiddleThumbClick)}},destruct:function(){clearTimeout(this.justifyFallbackTimer),this.__base.apply(this,arguments)},initMoreLink:function(){for(var t,e,i=this.hasMod("no-results","yes")?3:2,n=130,s=this.elem("thumb"),o=s.length,r=o-1;r>=0;r--)if(e=s[r].offsetTop,e>=n*(i-1)&&n*i>=e){t=s.eq(r),this.setMod(t,"last","yes"),this.findElem(t,"link").append(this.elem("more-link")).attr("href",this.params.moreLink),this.bindTo(t,"click",this._onSimilarThumbClick);break}},_onSimilarThumbClick:function(){BEM.blocks["b-statcounter"].hit({params:{query:{cbir:"similar"}}})},_onMiddleThumbClick:function(t){1===t.button&&this._hitCounter(t)},_hitCounter:function(t){var e=t.data.domElem,i="yes"===this.getMod(e,"last"),n=e.index()+1,s=i?"/image/new/cbir/results/similar/more":"/image/new/cbir/results/similar/thumb";c.hit({dtype:"iweb",path:s,pos:n,reqid:this.params.reqid})}}),BEM.DOM.decl("incut",{show:function(){return this.isVisible()||(this.delMod("visibility"),this.updateIncutBlock()),this},isVisible:function(){return!this.hasMod("visibility","hidden")},hide:function(){return this.setMod("visibility","hidden")},transparent:function(){return this.setMod("visibility","transparent")},setShown:function(){return this.setMod("inserted","yes")},getPositionType:function(){return this.params.positionType},updateIncutBlock:function(){var t,e=this.params.incutBlock;e&&(t=this.blockInside(e),t&&"function"==typeof t.updateIncut&&t.updateIncut())},isIncutInViewport:function(){var t=this.domElem&&this.domElem[0].getBoundingClientRect();return t&&t.top>=0&&t.left>=0&&t.bottom-t.height/2<=$(window).height()&&t.right<=$(window).width()}},{live:!0}),BEM.DOM.decl({block:"incut",modName:"type",modVal:"related"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._isWizardCarousel()&&BEM.blocks["serp-controller"].on("loaded",this._setCarouselMod,this),this.isIncutInViewport()?this._onScroll():BEM.blocks["b-page"].on("scroll",this._onScroll,this),this.isVisible()&&this._triggerShown()}}},destruct:function(){this._isWizardCarousel()&&BEM.blocks["serp-controller"].un("loaded",this._setCarouselMod,this),BEM.blocks["b-page"].un("scroll",this._onScroll,this),this.__base.apply(this,arguments)},show:function(){return this.__base.apply(this,arguments),this._triggerShown(),this},_triggerShown:function(){this.trigger("shown")},_setCarouselMod:function(){var t=this._getWizard();t&&(t.reduceLabelHeight().setCarouselMod().setCarouselSizes(),BEM.blocks["serp-controller"].un("loaded",this._setCarouselMod,this))},_onScroll:function(){if(this.isIncutInViewport()){var t=this._getWizard();t&&t.hitVisible(),BEM.blocks["b-page"].un("scroll",this._onScroll,this)}},_getWizard:function(){var t=this.blockInside("wizard-wrapper");return t&&t.domElem?t:null},_isWizardCarousel:function(){var t=this._getWizard();return t&&t.hasMod("carousel","yes")}},{live:!1}),BEM.DOM.decl({block:"incut",modName:"position",modVal:"bottom"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),BEM.blocks.footer.on({transparent:this._onFooterTransparent,show:this._onFooterShow,hide:this._onFooterHide},this)}}},destruct:function(){BEM.blocks.footer.un({transparent:this._onFooterTransparent,show:this._onFooterShow,hide:this._onFooterHide},this),this.__base.apply(this,arguments)},_onFooterTransparent:function(){this.transparent()},_onFooterHide:function(){this.hide()},_onFooterShow:function(){this.show()}}),BEM.DOM.decl("polaroid2",{showTo:function(t){return this._itemParams=t,this._setSnippet(t.snippet),this.domElem.css(this._calcPolaroidStyle(t)),t.serpItemDomElem.append(this.domElem),this.show(),this},_calcPolaroidStyle:function(t){var e,i=t.itemWidth,n=t.padding||0,s=t.hovered,o=t.minWidth+2*n,r=i+2*n,a={top:-n,bottom:0};return s.middle&&s.small?(e=Math.floor((Math.max(r,o)-i)/2),a.left=-e,a.right=-e):(a.left=s.lastInRow?-Math.abs(o-r):-n,a.right=s.firstInRow&&s.small?-Math.abs(o-r):-n),a},_setSnippet:function(t){var e=this.elem("link");this.elem("title").html(t.text),this.setMod(this.elem("title"),"visibility",t.text?"":"hidden"),e.text(t.domain),e.attr("href",t.redirUrl),e.attr("title",t.domain)},_onComplainClick:function(){this.trigger("complain.click")},_onUrlClick:function(){c.hit({dtype:"iweb",path:this._itemParams.greenUrlCounterPath,pos:this._itemParams.position,reqid:BEM.blocks["i-global"].param("reqid")},{href:this._itemParams.snippet.url})},isVisible:function(){return this.hasMod("visible")},show:function(){this.setMod("visible","yes")},hide:function(){this._itemParams=null,this.delMod("visible")}},{_instances:[],_cloneInstance:function(t){var e=t.domElem.clone(),i=e.bem(this.getName());return i.hide(),i},getInstance:function(){var t=this._instances;return this._instance||(this._instance=$(this.buildSelector()).bem(this.getName())),this._instance.domElem?t.length?this._getHiddenInstance(t):(t.push(this._instance),this._instance):(this.clearInstances(),this.getInstance())},_getHiddenInstance:function(t){for(var e,i=0;i<t.length;i++)if(!t[i].isVisible())return t[i];return e=this._cloneInstance(this._instance),t.push(e),e},clearInstances:function(){this._instance=null,this._instances=[]},showTo:function(t){return t?this.getInstance().showTo(t):null},hide:function(t){t&&t.hide()},live:function(){this.liveBindTo("complain","pointerclick",function(){this._onComplainClick()}).liveBindTo("url","pointerclick",function(){this._onUrlClick()})}}),BEM.DOM.decl({block:"polaroid2",modName:"with-commercial",modVal:"yes"},{showTo:function(t){return t.commercial?this._showCommercial(t.commercial):this._hideCommercial(),this.__base.apply(this,arguments)},_showCommercial:function(t){var e=t.text,i=t.url;e&&i&&(this.elem("button").html(e),this.elem("button").attr("href",i),this.setMod(this.elem("button"),"visibility","visible"),this.setMod("commercial","yes"),this._hitCounter("show"))},_hideCommercial:function(){this.delMod(this.elem("button"),"visibility"),this.delMod("commercial")},_onCommercialClick:function(){this._hitCounter("click")},_hitCounter:function(t){var e=_.get(this._itemParams,"commercial.counters."+t);e&&c.hitDelayed(_.assign({dtype:"iweb",path:e.path},e.params),this.domElem)}},{live:function(){this.__base.apply(this,arguments),this.liveBindTo("button","pointerclick",function(){this._onCommercialClick()})}}),BEM.DOM.decl({block:"polaroid2",modName:"with-direct",modVal:"yes"},{showTo:function(t){return this.updateCommercial(t),this.__base.apply(this,arguments)},updateCommercial:function(t){var e=this.blockInside("direct-updater").update({market:t.commercial,pos:t.position,id:t.id}),i=this.blockInside("direct-snippet");e.then(function(){i.show()}).fail(function(){i.hide()})}}),BEM.DOM.decl("direct-updater",{getDefaultParams:function(){return{showOnlyLoaded:!1,showOnMarket:!0,preloadCount:6,includeQuery:!1,useMarketTitle:!1,useMarketPage:!1,commThreshold:0,useJsonp:!1,url:null,pageId:null,commPageId:null}},onSetMod:{js:{inited:function(){this.params.showOnlyLoaded||this._getDirectLoader().on("loaded error",this._onDirectLoadComplete,this)}}},destruct:function(){this.params.showOnlyLoaded||this._getDirectLoader().un("loaded error",this._onDirectLoadComplete,this),this.__base.apply(this,arguments)},update:function(t){if(this._dfd&&this._dfd.reject(),this._dfd=$.Deferred(),this._current=t,this._isDirectDisabled(t))return this.hideDirect(),this._dfd.promise();var e=this._getLoadedDirect(t.id);return this._preloadDirect({pos:t.pos,count:this.params.preloadCount}),(this.params.showOnlyLoaded||e)&&this._updateDirect(e),this._dfd.promise()},showDirect:function(t,e){this._getDirectSnippet().update(t,e),this._dfd.resolve(this._getDirectSnippet())},hideDirect:function(){this._getDirectSnippet().hide(),this._dfd.reject()},getCommercialThreshold:function(){return this.params.commThreshold},_isDirectDisabled:function(t){var e=BEM.blocks["i-global"];return e.param("isPornoQuery")||e.param("isCommercialEnabled")||Boolean(!this.params.showOnMarket&&t.market)},_getLoadedDirect:function(t){return this._getDirectLoader().getLoaded(t)},_updateDirect:function(t){var e=t&&t.data;return e?void this.showDirect(e,t.id):void this.hideDirect()},_preloadDirect:function(t){var e=this._getLoadingDirectParams(t);this._getDirectLoader().batchLoad(e)},_getLoadingDirectParams:function(t){var e=BEM.blocks["serp-item"]._getNearestImages(t.pos,t.count).filter(this._noDirectData.bind(this));return this.params.showOnMarket||(e=e.filter(this._notMarketImage)),this._prepareLoadingDirectParams(e)},_notMarketImage:function(t){return!(t.marketSnippet||t.market)},_prepareLoadingDirectParams:function(t){var e=this.params.includeQuery?BEM.blocks["i-global"].param("query")+" ":"";return t.map(function(t){return{id:t.id,text:BEM.blocks["i-global__utils"].decodeEntities(e+this._getImageTitle(t)),pageId:this._getPageId(t)}},this)},_getImageTitle:function(t){var e,i;return this.params.useMarketTitle&&(e=t.marketSnippet||t.market,i=e&&e.title),i||(i=t.snippet.title),i},_getPageId:function(t){var e=this.params;return this._shouldUseCommPageId(t)?e.commPageId:e.pageId},_shouldUseCommPageId:function(t){var e=this.params,i=BEM.blocks["i-global"].param("cm2"),n=e.commPageId,s=e.commThreshold,o=s&&i>s,r=e.useMarketPage&&(t.marketSnippet||t.market);return Boolean(n&&(o||r))},_noDirectData:function(t){return!this._getLoadedDirect(t.id)},_getDirectLoader:function(){return this._directLoader||(this._directLoader=BEM.create("direct-loader",{region:BEM.blocks["i-global"].param("lr"),url:this.params.url,useJsonp:this.params.useJsonp})),this._directLoader},_onDirectLoadComplete:function(t,e){e.id===this._current.id&&this._updateDirect(e)},_getDirectSnippet:function(){return this._directSnippet||(this._directSnippet=this.findBlockOn("direct-snippet")),this._directSnippet}},{live:!0}),BEM.decl("batch-data-loader",{onSetMod:{js:{inited:function(){this.clear()}}},clear:function(){return this._states={},this},batchLoad:function(t){return t&&t.length?(this._getAbortRequests(t).forEach(this.abort.bind(this)),this._loadQueue=t,this._loadNext(),this):this},load:function(t){if(!t||!t.id)return this;var e=this._getState(t.id),i=e&&e.status;switch(i){case"loaded":case"error":this.trigger(i,e),this._onComplete();break;case"loading":break;default:this._load(t)}return this},abort:function(t){return t&&t.req?(t.req.abort(),this._setState(t.id,{status:"canceled"}),this):this},getLoaded:function(t){var e=this._getState(t),i=e&&e.status;return"loaded"===i||"error"===i?e:null},_load:function(t){var e=t.id,i=this._getRequest(t).success(this._onSuccess.bind(this,e)).error(this._onError.bind(this,e)).complete(this._onComplete.bind(this,e));return this._setState(e,{status:"loading",req:i}),this},_loadNext:function(){var t=this._loadQueue;t&&t.length&&this.load(t.shift())},_onSuccess:function(t,e){this._setState(t,{status:"loaded",data:this._convert(e)})},_onError:function(t,e){this._setState(t,{status:"error",error:e})},_onComplete:function(){this._loadNext()},_getAbortRequests:function(t){for(var e,i=Object.keys(this._states),n=t.map(function(t){return t.id}),s=[],o=0;o<i.length;o++)e=this._getState(i[o]),"loading"===e.status&&-1===n.indexOf(e.id)&&s.push(e);return s},_getState:function(t){return this._states[t]},_setState:function(t,e){var i={status:e.status,id:t};e.data&&(i.data=e.data),e.error&&(i.error=e.error),e.req&&(i.req=e.req),this._states[t]=i,this.trigger(i.status,i)},_convert:function(t){return t},_getRequest:$.noop}),BEM.decl({block:"direct-loader",baseBlock:"batch-data-loader"},{getDefaultParams:function(){return{url:"https://bs.yandex.ru/page/",pageId:"241381",region:0,useJsonp:!1}},_getRequest:function(t){return this._getDirectParser().req(this._getUrl(t),{jsonp:this.params.useJsonp})},_onSuccess:function(t,e){var i=this._parseDirect(e);return i.error?void this._onError(t,i.error):void this.__base.call(this,t,i)},_getUrl:function(t){var e,i=this.params,n=t.pageId||i.pageId,s={"target-ref":encodeURI(this._getTargetRef()),"tune-region-id":i.region,charset:"utf-8",text:t.text.replace(/ /g,"+")},o=String(n).split("-");return 2===o.length&&(n=o[0],e=o[1]),e&&(s["imp-id"]=e),BEM.blocks.uri.setParams(i.url+n,s)},_getTargetRef:function(){var t=BEM.blocks.location.getInstance().getState().url,e=BEM.blocks.uri.parse(t),i=e.protocol()+"://images.yandex."+BEM.blocks["i-global"].param("tld");return i+"/search"+e.query()},_parseDirect:function(t){return this._getDirectParser().parse(t)},_convert:function(t){if(!t||!t.common)return null;var e=t.premium||t.direct;if(!e||!e.ads||!e.ads.length)return null;var i=e.ads[0];return{source:"direct",url:i.url,title:i.title,text:i.body,domain:i.domain,link_head:t.common.linkHead,link_tail:i.linkTail}},_getDirectParser:function(){return this._directParser||(this._directParser=BEM.create("direct-parser")),this._directParser}},{_instances:{},getInstance:function(t,e){var i;return e=e||{},this._instances[t]||(i={region:BEM.blocks["i-global"].param("lr")},e.url&&(i.url=e.url),this._instances[t]=BEM.create("direct-loader",i)),this._instances[t]}}),BEM.decl("direct-parser",{load:function(){var t=$.Deferred(),e=this.__base.apply(this,arguments);return e?e:(this.req(this.params.url).success(function(e){var i=this.parse(e);i.error?t.reject(i.error):t.resolve(i)}.bind(this)).error(t.reject),t)},req:function(t,e){var i={url:t,xhrFields:{withCredentials:!0}};return e&&e.jsonp&&(i.dataType="jsonp"),$.ajax(i)},parse:function(t){var e,i;"string"==typeof t&&(e=t.match(/^(\/\*\*\/)?\('(.*)\'\)$/)),i=e&&e[2]?e[2]:t;try{return new Function("return"+i)()}catch(n){return{error:n}}}}),BEM.DOM.decl("direct-snippet",{update:function(t){var e=t.link_head,i=t.link_tail;return this.setCurrent(t)._updateTitle(t)._updateGreenurl(t)._updateText(t),e&&i&&this._hitShowCounter(e,i),this},setCurrent:function(t){return this._snippet=t,this},getCurrent:function(){return this._snippet},show:function(){return this.setMod("visible","yes")},hide:function(){return this.delMod("visible")},_updateTitle:function(t){return this.elem("title").html(t.title).attr("href",t.url),this},_updateGreenurl:function(t){return this.elem("greenurl").text(t.domain).attr("href",t.url),this},_updateText:function(t){return this.elem("text").html(t.text),this},_hitShowCounter:function(t,e){var i=this,n=t+e;return this._isShown(n)?this:(this._makeShowCounterRequest(n).done(function(){i._setShown(n)}),this)},_makeShowCounterRequest:function(t){return $.ajax({url:t,dataType:"script",cache:!0,async:!0})},_setShown:function(t){this.__self._shownAds[t]=!0},_isShown:function(t){return Boolean(this.__self._shownAds[t])}},{_shownAds:{},live:function(){this.liveBindTo("title","pointerclick",function(t){this.trigger("direct:title:click",{domElem:t.target,snippet:this.getCurrent()})}).liveBindTo("greenurl","pointerclick",function(t){this.trigger("direct:link:click",{domElem:t.target,snippet:this.getCurrent()})})}}),$.extend({debounce:function(t,e,i,n){var s,o=function(){var o=arguments;n=n||this,i&&!s&&t.apply(n,o),clearTimeout(s),s=setTimeout(function(){i||t.apply(n,o),s=null},e)};return 3===arguments.length&&"boolean"!=typeof i&&(n=i,i=!1),o.stop=function(){clearTimeout(s),s=null},o},throttle:function(t,e,i){var n,s,o,r=function(){s=arguments,o=!0,i=i||this,n||function(){o?(t.apply(i,s),o=!1,n=setTimeout(arguments.callee,e)):n=null}()};return r.stop=function(){clearTimeout(n),n=null},r}}),function(t){var e=t.innerWidth>t.innerHeight,i=t.innerWidth,n=400,s=$.throttle(function(){var n=t.innerWidth,s=t.innerHeight,o=n>s;o!==e&&n!==i&&($(t).trigger("orientchange",{landscape:o,width:n,height:s}),e=o,i=n)},n);BEM.DOM.win.bind("resize",s),BEM.DOM.decl("i-ua",{onSetMod:{js:{inited:function(){this.bindToWin("orientchange",this._onOrientChange,this).__base.apply(this,arguments)}}},_onOrientChange:function(t,e){var i=this.__self,n=document.documentElement,s=n.className,o="i-ua_orient_"+(e.landscape?"landscape":"portrait");-1===s.indexOf(o)&&(n.className=s.replace(/\bi-ua_orient_\w+\b/,o)),i.width=e.width,i.height=e.height,i.landscape=e.landscape}},{width:t.innerWidth,height:t.innerHeight,landscape:e})}(window),BEM.DOM.decl("header",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.bindToWin("resize",$.throttle(this._onResize,150)),this._collapseUserIfNeeded()}}},_onResize:function(){this._collapseUserIfNeeded()},_onUserUpdatesName:function(){this._collapseBreakpoint=null,this._collapseUserIfNeeded()},_collapseUserIfNeeded:function(){var t=this._getUser();t&&t.toggleCollapsed(this._getCollapseBreakpoint()>=this.elem("nav").width())},_getCollapseBreakpoint:function(){return this._collapseBreakpoint||(this._collapseBreakpoint=this._getNavItemsWidth()+this.__self.NAV_ITEMS_GAP),this._collapseBreakpoint},_getNavItemsWidth:function(){var t=0;return this.elem("nav").children().each(function(){t+=$(this).outerWidth(!0)}),t},_getUser:function(){return this._user?this._user._isDestructing&&(this._collapseBreakpoint=null,this._user=this.findBlockInside("user")):(this._user=this.findBlockInside("user"),this._user&&this._user.on("update-name",this._onUserUpdatesName,this)),this._user}},{NAV_ITEMS_GAP:10,live:!1}),BEM.DOM.decl("header",{},{live:function(){return this.liveBindTo("action","click",function(t){t.preventDefault()}),this.__base.apply(this,arguments)}}),BEM.DOM.decl("header",{onSetMod:{js:function(){this.__base.apply(this,arguments),this.__self.instance=this,this.__self.searchBlock=this.findBlockInside("search2"),this._syncState().bindEvents()}},_syncState:function(){var t=this.getFiltersCount();return t>0&&this._isFiltersCountHidden()&&(this.params.filtersAutoopen=t),this},_getAdvanced:function(){return this._advancedSearch||(this._advancedSearch=this.findBlockInside("advanced-search"))},getHeight:function(){return this.domElem.height()},_getNavItemsWidth:function(){var t,e=0;return this.elem("nav").children().each(function(){t=$(this),t.is(":visible")&&(e+=t.outerWidth(!0))}),e}},{get:function(){return this.instance||(this.instance=$(this.buildSelector()).bem(this.getName()))},getSearch:function(){return this.searchBlock||$(".search2").bem("search2")}}),BEM.DOM.decl("header",{_onDaasWillShow:function(t,e){this.elem("under").css("top","+="+e.height)},_onDaasWillHide:function(t,e){this.elem("under").css("top","-="+e.height)}},{live:function(){this.__base(),this.liveInitOnChannelEvent("atom","stripe-will-show",function(t,e){this._onDaasWillShow(t,e)}).liveInitOnChannelEvent("atom","stripe-will-hide",function(t,e){this._onDaasWillHide(t,e)})}}),BEM.DOM.decl("header",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),BEM.DOM.blocks["cbir-panel"].on({modName:"visibility",modVal:"visible"},function(){this.setMod("cbir-panel","visible")},this).on({modName:"visibility",modVal:"hidden"},function(){this.delMod("cbir-panel")},this)}}}}),BEM.DOM.decl({block:"header",modName:"type",modVal:"advanced"},{getHeight:function(){if(this._height)return this._height;var t=this._getAdvanced();return this._height=this.domElem.height(),t&&(this._height+=t.domElem.height()-1),this._height}}),BEM.DOM.decl("header",{bindEvents:function(){return this.__base.apply(this,arguments),BEM.blocks["advanced-search"].on("countUpdate",this._onCountUpdate,this),this},_onCountUpdate:function(t,e){this.setFiltersCount(e.count)},_isFiltersCountHidden:function(){return this.hasMod(this.getFiltersCountElem(),"hidden","yes")},setFiltersCount:function(t){return this.getFiltersCountElem().text(t),this.setMod(this.getFiltersCountElem(),"hidden",t?"":"yes")},getFiltersCount:function(){return Number(this.getFiltersCountElem().text())},getFiltersCountElem:function(){return this._filtersCount||(this._filtersCount=this.elem("filters-count"))}}),BEM.DOM.decl("header",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._openedSlide=null}}},onElemSetMod:{action:{pressed:{"":function(t){this.elemParams(t).releaseByDocumentScroll&&this.unbindFromWin("scroll"),this._openedSlide&&(this._openedSlide.unbindFromDoc("pointerclick"),this._openedSlide=null),this.unbindFromWin("closeUnder"),t.attr({"aria-pressed":!1,"aria-expanded":!1}),t.trigger("released")},yes:function(t,e){var i=this;i.delMod(this.elem("action"),e).bindToWin("closeUnder",function(){i.delMod(t,e)}),i.elemParams(t).releaseByHeaderOutsideClick&&i.afterCurrentEvent(function(){if(i.domElem){var e=i._openedSlide=i._getOpenedSlide(t);e&&i._slideOnClick(e,t)}}),i.elemParams(t).releaseByDocumentScroll&&this.bindToWin("scroll",function(){i._onScroll(t)}),t.attr({"aria-pressed":!0,"aria-expanded":!0}),t.trigger("pressed")}}}},_getOpenedSlide:function(t){var e,i=this.buildSelector("action","type",this.getMod(t,"type"));return this.findBlocksInside("slide").some(function(t){return t.params.rel&&t.params.rel[0].elem===i?(e=t,!0):!1}),e},_onScroll:function(t){this.delMod(t,"pressed")},_slideOnClick:function(t,e){var i=this;t.bindToDoc("pointerclick",function(n){var s=$(n.target);t.containsDomElem(s)||s.is(i.elem("main"))||s.is(i.elem("action-i"))||i.delMod(e,"pressed");
})},_onActionClick:function(t){t.preventDefault(),BEM.blocks["i-ua"].opera<13&&t.stopPropagation(),this.toggleMod(t.data.domElem,"pressed","yes","")},_onActionKeyup:function(t){var e=BEM.blocks["i-ua"].opera<13,i=BEM.blocks.keycodes;(!e&&t.keyCode===i.ENTER||t.keyCode===i.SPACE)&&(t.preventDefault(),this.toggleMod(t.data.domElem,"pressed","yes",""))},destruct:function(){this._openedSlide&&(this._openedSlide.unbindFromDoc("pointerclick"),this._openedSlide=null),this.__base.apply(this,arguments)}},{live:function(){return this.liveBindTo("action","pointerclick",function(t){this._onActionClick(t)}).liveBindTo("action","keyup",function(t){t.shiftKey||t.ctrlKey||t.altKey||t.metaKey||this._onActionKeyup(t)}),this.__base()}}),BEM.DOM.decl("advanced-search",{onSetMod:{js:function(){this._vals=[],this.findBlocks().bindEvents()}},findBlocks:function(){return this.page=this.findBlockOutside("b-page"),this.dropdowns=this.findBlocksInside({block:"dropdown",modName:"advanced",modVal:"yes"}),this.checkboxes=this.findBlocksInside({block:"check-button",modName:"advanced",modVal:"yes"}),this.filters=this.dropdowns.concat(this.checkboxes),this._resetButton=this.elem("action","type","reset"),this},_onTouchMove:function(){this.dropdowns.forEach(function(t){t.hide()})},bindEvents:function(){return BEM.blocks["b-page"].on("filters:update",this.updateFilters,this),BEM.blocks["b-page"].on("touchmove",this._onTouchMove,this),BEM.blocks.search2.on("search:query:changed",this._resetMisspell,this),this.bindTo(this.domElem,"submit",this._onSubmit),this.filters.forEach(this._initSearchControl.bind(this)),this.afterCurrentEvent(function(){this.filters.forEach(function(t){t.on("change",this.submit,this)},this),this._updateResetButton()}),this.dropdowns.forEach(function(t){t.on("change",this._onDropdownItemChange,this)},this),this.bindTo(this._resetButton,"click",this._onResetClick),this.page.on("change",this._onPageChange,this),this},unbindEvents:function(){return BEM.blocks["b-page"].un("filters:update",this.updateFilters,this),BEM.blocks["b-page"].un("touchmove",this._onTouchMove,this),BEM.blocks.search2.un("search:query:changed",this._resetMisspell,this),this.afterCurrentEvent(function(){this.filters.forEach(function(t){t.un("change",this.submit,this)},this),this._updateResetButton()}),this.dropdowns.forEach(function(t){t.un("change",this._onDropdownItemChange,this)},this),this.page.un("change",this._onPageChange,this),this},destruct:function(){this.unbindEvents(),this.__base.apply(this,arguments)},_onSubmit:function(){return this.submit(),!1},_onResetClick:function(){this.reset()},_initSearchControl:function(t,e){this._vals.push(t.val()),t.on("change silentChange",function(t){this._vals[e]=t.block.val(),this._updateResetButton()},this)},_onDropdownItemChange:function(t){var e=t.block;t.target.hide(),e.setMod("applied",e.val()?"yes":"")},updateFilters:function(t,e){var i=e.params.filters;_.forEach(this.dropdowns,function(t){this.updateDropdown(t,i)}.bind(this)),_.forEach(this.checkboxes,function(t){this.updateCheckButton(t,i)}.bind(this))},createMisspell:function(){var t=BEMHTML.apply([{block:"advanced-search",elem:"misspell-hidden-input",tag:"input",attrs:{type:"hidden",name:"noreask",value:1}},this._hasParam("nomisspell")?{block:"advanced-search",elem:"misspell-hidden-input",tag:"input",attrs:{type:"hidden",name:"nomisspell",value:1}}:""]);BEM.DOM.append(this.domElem,t)},_resetMisspell:function(){this.findElem("misspell-hidden-input").remove()},updateDropdown:function(t,e){t._control.val(e[t.params.name]||""),t.trigger("silentChange")},updateCheckButton:function(t,e){e[t.params.name]?t.setMod("checked","yes"):t.delMod("checked")},_onPageChange:function(t,e){"search"===e.type||this.reset()},isDefaultState:function(){return!this._vals.some(_.identity)},submit:function(t){if(this.page.hasMod("type","search")){var e=this.page.findBlockInside("search2");this._needCreateMisspell()&&this.createMisspell(),this._checkPreventAfter(t)||this.afterCurrentEvent(function(){this.afterCurrentEvent(function(){e.domElem.submit()})})}},_needCreateMisspell:function(){return _.isEmpty(this.findElem("misspell-hidden-input"))&&(this._hasParam("nomisspell")||this._hasParam("noreask"))},_hasParam:function(t){return"1"===BEM.blocks.uri.getParamValue(t)},reset:function(){this.isDefaultState()||(this._disableCounters(),this.controlsToReset().forEach(function(t){t.reset()}),this.findBlocksInside("input").forEach(function(t){t.val("")}),this.afterCurrentEvent(function(){this.submit(),this._updateResetButton()}),this._enableCounters())},controlsToReset:function(){return this.filters},_updateResetButton:function(){this._updateSelectedCounter(),this.setMod(this._resetButton,"hidden",this.isDefaultState()?"yes":"")},_updateSelectedCounter:function(){var t=this._vals.filter(function(t){return t&&""!==t});this.trigger("countUpdate",{count:t.length})},_enableCounters:function(){this.filters.forEach(function(t){t.enableCounters()})},_disableCounters:function(){this.filters.forEach(function(t){t.disableCounters()})},getParams:function(){return this.domElem.serialize().replace(/&?[^&?]+=(?=(?:&|$))/g,"").replace(/^&/,"")},_checkPreventAfter:function(){return!1}},{live:!0}),BEM.DOM.decl("advanced-search",{onSetMod:{js:{inited:function(){this.params.disabled||(this.__base.apply(this,arguments),this._setExtraWallpaperText())}}},findBlocks:function(){return this.__base.apply(this,arguments),this.site=this.findBlockInside("custom-site"),this.filters=this.filters.concat(this.site),this.size=this.findBlockInside("custom-size"),this.color=this.findBlockInside("filter-color"),this.sizesDropdown=this.findBlockInside({block:"dropdown",modName:"custom-size",modVal:"yes"}),this.wallpaperButton=this.findBlockInside({block:"check-button",modName:"wallpaper",modVal:"yes"}),this.commercialButton=this.findBlockInside({block:"check-button",modName:"commercial",modVal:"yes"}),this},bindEvents:function(){return this.__base.apply(this,arguments),this.wallpaperButton.on("change",this._onWallpaperChange,this),BEM.blocks.notice&&BEM.blocks.notice.on({"commercial:turn-on":this._onTurnOnCommercial,"commercial:turn-off":this._onTurnOffCommercial},this),BEM.blocks["commercial-discard"]&&BEM.blocks["commercial-discard"].on({"turn-off":this._onTurnOffCommercial},this),this},destruct:function(){this.wallpaperButton.un("change",this._onWallpaperChange,this),BEM.blocks.notice&&BEM.blocks.notice.un({"commercial:turn-on":this.turnOnCommercialFilter,"commercial:turn-off":this.turnOffCommercialFilter},this),BEM.blocks["commercial-discard"]&&BEM.blocks["commercial-discard"].un({"turn-off":this._onTurnOffCommercial},this),this.__base.apply(this,arguments)},_onWallpaperChange:function(){this.wallpaperButton.isChecked()&&this.resolveConflicts(this.wallpaperButton)},_onDropdownItemChange:function(t){this.__base.apply(this,arguments);var e=t.block;e.val()&&this.resolveConflicts(e)},_onPageChange:function(){this.__base.apply(this,arguments),this.wallpaperButton.setChanged(!1)},_onResetClick:function(){this.wallpaperButton.setChanged(!0),this.reset(),BEM.blocks["b-statcounter"].hit({params:{query:{filter:{reset:"yes"}}}})},updateFilters:function(t,e){var i=e.params.filters;BEM.blocks["i-global"].param("isPumpkin")||(e.params.wallpaper&&!this.wallpaperButton.hasMod("checked","yes")?this.setMod("wallpaper","autoChecked"):this.delMod("wallpaper"),_.isEmpty(i)&&(this.wallpaperButton.isChanged()||this.wallpaperButton.reset()),this.color&&i.icolor&&this.color.setMod("color",i.icolor),this._submitDisabled=!0,this.__base.apply(this,arguments),this.afterCurrentEvent(function(){this._submitDisabled=!1,this.trigger("show")}),"eq"===i.isize&&this.size.updateSizes(i.iw,i.ih))},isWallpaper:function(t){return t&&t.isize&&"wallpaper"===t.isize},updateDropdown:function(t,e){var i="isize"===t.params.name?!this.isWallpaper(e):!0;i&&this.__base.apply(this,arguments)},updateCheckButton:function(t,e){var i=!0;switch(t.params.name){case"isize":i=this.isWallpaper(e);break;case"icomm":i=1===e.icomm}i&&this.__base.apply(this,arguments)},submit:function(){this._submitDisabled||("search"===BEM.blocks["i-global"].param("page")&&(BEM.blocks.header.getSearch().submitByFilters=!0),this.__base.apply(this,arguments))},resolveConflicts:function(t){var e=t.params.name,i=this.isWallpaper(t.params.values);return"isize"===e&&i&&(this.sizesDropdown.disableCounters(),this.sizesDropdown.reset(),this.sizesDropdown.enableCounters()),"isize"!==e||t._isCustom||i||this.wallpaperButton.reset(),this},controlsToReset:function(){var t=$.extend([],this.__base.apply(this,arguments));return t.push(this.site),t},_setExtraWallpaperText:function(){var t=BEM.blocks["i-userinfo"].get().getScreenInfo(),e=this.findElem(this.elem("more-item","wallpaper","yes"),"more-item-text");e.text(e.text()+" "+t.width+""+t.height)},getParams:function(){var t=this.__base.apply(this,arguments);return this.hasMod("wallpaper","autoChecked")&&!this.wallpaperButton.isChanged()&&(this.delMod("wallpaper"),t=t.replace(/wp=(?!off)[^&]+&?/g,"").replace(/isize=[^&]+&?/g,"")),t},turnOffCommercialButton:function(){this.commercialButton.delMod("checked").val({})},turnOnCommercialButton:function(){this.commercialButton.setMod("checked","yes")},_onTurnOnCommercial:function(){this.turnOnCommercialButton(),this.commercialButton.setChanged(!0),this.commercialButton.val({comm:"1"}),this.submit()},_onTurnOffCommercial:function(){this.turnOffCommercialButton(),this.commercialButton.setChanged(!0),this.commercialButton.val({comm:"0"}),this.submit()},_checkPreventAfter:function(t){var e;return"undefined"==typeof t?!1:(e=t.target,e.isChanged&&!e.isChanged()&&("wp"===e._field&&"off"===_.get(e,"params.values.wp")||e.hasMod("auto","yes")))}},{live:!1}),BEM.DOM.decl({block:"checkbox",baseBlock:"control"},{onSetMod:{js:{inited:function(){var t=this.elem("control");this.toggleMod("checked","yes",t.prop("checked")),this.toggleMod("focused","yes",t.isFocused())}},hovered:{yes:function(){return!this.hasMod("disabled")}},pressed:{yes:function(){return!this.hasMod("disabled")}},checked:function(t,e){this.elem("control").prop("checked",e),this.trigger("change",{checked:Boolean(e)})},disabled:{yes:function(){this.__base.apply(this,arguments),this.delMod("hovered").delMod("pressed")}}},isDisabled:function(){return this.hasMod("disabled","yes")},isChecked:function(){return Boolean(this.elem("control").prop("checked"))},toggle:function(){this.toggleMod("checked","yes")},val:function(t){var e=this.elem("control");return"undefined"==typeof t?e.val():(e.val(t),this)},name:function(t){var e=this.elem("control");return arguments.length?(e.attr("name",t),this):e.attr("name")},_onChange:function(t){this.toggleMod("checked","yes",t.target.checked)},_onPointerenter:function(t){this.setMod("hovered","yes")},_onPointerleave:function(t){this.delMod("hovered")},_onPointerpress:function(t){this.setMod("pressed","yes").bindToDoc("pointerrelease",this._onPointerrelease)},_onPointerrelease:function(t){this.delMod("pressed").unbindFromDoc("pointerrelease")},_onClick:function(t){this.domElem[0]===t.target&&this._onChange(t),this.trigger("click",{domEvent:t}),this.setMod("focused","yes")},_onKeydown:function(t){t.keyCode===BEM.blocks.keycodes.SPACE&&this.setMod("pressed","yes")},_onKeyup:function(t){t.keyCode===BEM.blocks.keycodes.SPACE&&this.delMod("pressed")}},{live:function(){return this.liveBindTo("pointerover pointerout",function(t){this.isDisabled()||this.domElem[0].contains(t.relatedTarget)||("pointerover"===t.type?this._onPointerenter(t):this._onPointerleave(t))}).liveBindTo("pointerpress",function(t){this.hasMod("disabled")||this._onPointerpress(t)}).liveBindTo("pointerclick",function(t){this.hasMod("disabled")||this._onClick(t)}).liveBindTo("control","keydown",function(t){this.hasMod("disabled")||this._onKeydown(t)}).liveBindTo("control","keyup",function(t){this.hasMod("disabled")||this._onKeyup(t)}).liveBindTo("control","change",function(t){this._onChange(t)}),this.__base()}}),BEM.DOM.decl({block:"check-button",baseBlock:"checkbox"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments)}},checked:function(t,e){return this.__base.apply(this,arguments)===!1?!1:void this.elem("control").attr("aria-pressed",Boolean(e))}}}),BEM.DOM.decl({block:"check-button",modName:"advanced",modVal:"yes"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.bindEvents().initButton()},checked:function(t,e){this.__base.apply(this,arguments),this._buttonProcess(e?this.params.values:"")}},bindEvents:function(){return this.on("change",this._onAdvancedClick),this},_onAdvancedClick:function(){this.delMod("focused")},_generateHidden:function(t,e){return BEMHTML.apply({block:"check-button",mods:{advanced:"yes"},elem:"hidden-value",tag:"input",attrs:{type:"hidden",name:t,value:e}})},initButton:function(){this._buttonProcess(this.val())},_buttonProcess:function(t){this.params.generateHidden&&(t===this.params.defaultValue?this.reset():this.val(t))},val:function(t){if(arguments.length){this.findElem("hidden-value").remove();for(var e=Object.keys(t),i=0,n=e.length;n>i;i++)this.domElem.append(this._generateHidden(e[i],t[e[i]]))}return this.isChecked()?this.params.values:""},reset:function(){"wp"!==_.get(this.params,"state.field")&&this.findElem("hidden-value").remove(),this.delMod("checked")},enableCounters:function(){this._countersDisabled=!1},disableCounters:function(){this._countersDisabled=!0},getDefaultParams:function(){return $.extend(this.__base.apply(this,arguments),{generateHidden:!0})}}),BEM.DOM.decl({block:"check-button",modName:"advanced",modVal:"yes"},{_onChange:function(){if("yes"!==this.getMod("site")&&(this.__base.apply(this,arguments),!this._countersDisabled)){var t=this.params.name,e={ifreshness:"fresh"},i={ifreshness:"week",isize:"wallpaper",icomm:"yes"},n=this.val()?i[t]:"any",s={};s[e[t]||t]=n,BEM.blocks["b-statcounter"].hit({params:{query:{filter:s}}})}}}),BEM.DOM.decl("dropdown",{onSetMod:{js:{inited:function(){var t=this,e=t.params,i=t.findBlockOn(t.elem(e.popupElem),"popup");t._popup=i,i.on("show",t._onPopupShow,t).on("hide",t._onPopupHide,t),e.popupMethods.forEach(function(e){t[e]=i[e].bind(i)}),t.elem("switcher").attr({"aria-haspopup":!0,"aria-expanded":!1})}},action:function(t,e){var i="open"===e;this.elem("switcher").attr("aria-expanded",i),this._getButton()&&this._getButton().toggleMod("arrow","up","down",i)}},getPopup:function(){return this._popup},_getButton:function(){return this._button||(this._button=this.findBlockInside("switcher","button")),this._button},_toggle:function(){var t=["button","link"].some(function(t){var e=this.findBlockOn("switcher",t);return e&&e.hasMod("disabled")},this);t&&!this._popup.isShown()||this._popup.toggle(this.elem("switcher"))},_onSwitcherClick:function(){this._toggle()},_onSwitcherKeyUp:function(t){if(!(t.shiftKey||t.ctrlKey||t.altKey||t.metaKey)){var e=this.elem("switcher")[0].tagName.toLowerCase(),i=BEM.blocks.keycodes;"button"!==e&&("a"!==e&&t.keyCode===i.ENTER||t.keyCode===i.SPACE)&&(t.preventDefault(),this._toggle())}},_onPopupShow:function(){this.setMod("action","open").trigger("show")},_onPopupHide:function(){this.setMod("action","closed").trigger("hide")},destruct:function(){this._popup.un("show",this._onPopupShow,this).un("hide",this._onPopupHide,this),this._popup.domElem&&BEM.DOM.destruct(this._popup.domElem),this.__base.apply(this,arguments)},getDefaultParams:function(){return{popupElem:"popup",popupMethods:["toggle","show","hide","setContent"]}}},{live:function(){this.liveBindTo("switcher","pointerclick",function(t){this._onSwitcherClick(t)}).liveBindTo("switcher","keyup",function(t){this._onSwitcherKeyUp(t)})}}),BEM.DOM.decl("popup",{onSetMod:{js:{inited:function(){this.__base(),this._tailPos={}}}},_calcTailPos:function(t){var e=t.to,i=this._positions[t.key],n=t.tail.axis,s={};return"top"===e||"bottom"===e?s.left=this._calcTailLeft(n,i):"left"!==e&&"right"!==e||(s.top=this._calcTailTop(n,i)),s},_calcTailTop:function(t,e){var i=0,n=this.getOwnerSize(),s=this.getOwnerPos(),o=this.params.tail.width,r=this.getPopupSize(),a=r.height,c=s.top-e.top,h=e.top+r.height-(s.top+n.height);return c>0&&(i+=c,a-=c),h>0&&(a-=h),"middle"===t?(a-=o,i+=a/2):"bottom"===t&&(a-=o,i+=a),0>i&&(i=0),i},_calcTailLeft:function(t,e){var i=0,n=this.getOwnerSize(),s=this.getOwnerPos(),o=this.params.tail.width,r=this.getPopupSize(),a=s.left-e.left,c=r.width,h=e.left+r.width-(s.left+n.width);return a>0&&(i+=a,c-=a),h>0&&(c-=h),"center"===t?(c-=o,i+=c/2):"right"===t&&(c-=o,i+=c),i},_calcOffsetByTail:function(t){var e=this.params.tail,i=e.height,n={};switch(t.to){case"top":n={top:-i};break;case"bottom":n={top:i};break;case"right":n={left:i};break;case"left":n={left:-i}}return n},_calcTailOffset:function(t){var e={},i=t.to,n=t.tail,s=n.offset,o=n.axis;return s?("top"===i||"bottom"===i?(e.left=0,"left"===o?e.left+=s.left:"center"===o?(s.left&&(e.left+=s.left),s.right&&(e.left-=s.right)):"right"===o&&(e.left-=s.right)):"left"!==i&&"right"!==i||(e.top=0,"top"===o?e.top+=s.top:"middle"===o?(s.top&&(e.top+=s.top),s.bottom&&(e.top-=s.bottom)):"bottom"===o&&(e.top-=s.bottom)),e):!1},_resetTailPos:function(t){return t?this._tailPos[t]=null:this._tailPos={},this},_pushTailPos:function(t,e){return this._pushPosTo(this._tailPos,t,e),this}}),BEM.DOM.decl({block:"dropdown",modName:"advanced",modVal:"yes"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this._popup=this.findBlockInside("popup"),this._button=this.findBlockInside("button"),this._buttonText=this.findElem(this._button.domElem,"switcher-text"),0===this._buttonText.length&&(this._buttonText=this._button.elem("text")),this._buttonDefaultTitle=this._buttonText.text(),this._buttonIcon=this.findElem(this._button.domElem,"icon"),this._initControl(),this._afterInit()}},_initControl:function(){this._control=this.findBlockInside("radiobox"),this._control.on("change",function(t,e){this._radioboxProcess(e.current,t.target.val(),this._control.name()),this.trigger("change")},this)},_afterInit:function(){this._radioboxProcess(this._control.getCurrent(),this._control.val(),this._control.name())},_buildHidden:function(t,e){return BEMHTML.apply({block:"dropdown",mods:{advanced:"yes"},elem:"hidden-value",name:e,value:t})},_radioboxProcess:function(t,e){var i=this.findElem(t,"text").text(),n=Number(e)!==this.params.defaultValue?i:this._buttonDefaultTitle;this._buttonText.empty().append(n),this.params.withIcons&&this.setMod(this._buttonIcon,"type",this.params.withIcons[e]),this._generateHidden()},_generateHidden:function(){if(this.params.generateHidden&&!this.findBlockInside("popup")){this.findElem("hidden-value").remove();var t=this._control.val();t!==this.params.defaultValue&&this.domElem.append(this._buildHidden(t,this._control.name()))}},val:function(){return this._control.val()!==this.params.defaultValue?[{name:this.params.name,val:this._control.val()}]:void 0},reset:function(){this.findElem("hidden-value").remove(),"undefined"!=typeof this.params.defaultValue&&this._control.val(this.params.defaultValue)},getDefaultParams:function(){return _.assign(this.__base.apply(this,arguments),{generateHidden:!0})},enableCounters:function(){this._countersDisabled=!1},disableCounters:function(){this._countersDisabled=!0}}),BEM.DOM.decl({block:"dropdown",modName:"advanced",modVal:"yes"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.afterCurrentEvent(function(){this.on("change",this._onChange,this)}),this.on("show",this._radioboxProcess,this)}},_onChange:function(t){if(!this._countersDisabled){var e=t.block,i=e.val(),n=e.params.name,s={itype:"format",icolor:"color"},o={};o[s[n]||n]=i&&i[0]?i[0].val:"any",BEM.blocks["b-statcounter"].hit({params:{query:{filter:o}}})}},_radioboxProcess:function(){this._generateHidden()}}),function(t,e){"use strict";t.ajaxPrefilter(function(t,e,i){return"iframe"===t.type.toLowerCase()?"iframe":void 0}),t.ajaxTransport("iframe",function(e,i,n){var s,o,r=t(e.file),a="iframe-"+t.now(),c=t("<form></form>").hide().attr({action:e.url,target:a}),h=function(){o&&o.replaceWith(r),c.remove(),s.attr("src","javascript:false;").remove()};return e.dataTypes.shift(),t.each(i.data||{},function(e,i){t("<input />").attr({type:"hidden",name:e,value:i}).appendTo(c)}),r.length&&(o=r.after(r.clone().prop("disabled",!0)).next(),c.attr({enctype:"multipart/form-data",method:"POST"}),c.append(r)),{send:function(e,i){s=t("<iframe></iframe>").hide().attr({name:a,id:a,src:"javascript:false;"}),s.one("load",function(){s.bind("load",function(){try{var t=this.contentWindow?this.contentWindow.document:this.contentDocument?this.contentDocument:this.document,e=t.documentElement?t.documentElement:t.body;i(200,e.innerHTML)}catch(n){i(500)}setTimeout(function(){h()},42)}),c[0].submit()}),t("body").append(c,s)},abort:function(){null!==s&&(s.unbind("load").attr("src","javascript:false;"),h())}}})}(jQuery),BEM.DOM.decl("advanced-search",{findBlocks:function(){this._freshness=this.findBlockInside({block:"check-button",modName:"freshness",modVal:"yes"}),this._commercial=this.findBlockInside({block:"check-button",modName:"commercial",modVal:"yes"}),this._commercial&&!this.findElem(this._commercial.domElem,"extra").length&&(this._commercial=null),this._moreDropdown=this.findBlockOn(this.elem("more"),"dropdown2");var t=this.elem("more-item","site","yes");return this._moreSiteDefaultText=this.findElem(t,"more-item-text","type","default"),this._moreSiteCustomText=this.findElem(t,"more-item-text","type","custom"),this.__base.apply(this,arguments),this._updateMoreButtonState(),this},bindEvents:function(){return this.bindTo(this.elem("more-item","freshness","yes"),"pointerclick",function(){this._freshness.toggle(),this._onMoreItemClick()}),this.bindTo(this.elem("more-item","commercial","yes"),"pointerclick",function(){this._commercial.toggle(),this._onMoreItemClick()}),this.bindTo(this.elem("more-item","wallpaper","yes"),"pointerclick",function(){this.wallpaperButton.setChanged(!0),this.wallpaperButton.toggle(),this._onMoreItemClick()}),this.bindTo(this.elem("more-item","site","yes"),"pointerclick",function(){this.site.showModal(),this._moreDropdown.delMod("opened")}),this.__base.apply(this,arguments)},getMoreFilters:function(){return[this._commercial,this._freshness,this.wallpaperButton,this.site]},_onMoreItemClick:function(){this._moreDropdown.delMod("opened"),this._updateMoreButtonState()},_updateMoreButtonState:function(){var t=this.getMoreFilters().some(function(t){return Boolean(t&&t.val())});t?this.setMod(this.elem("more-button"),"checked","yes"):this.delMod(this.elem("more-button"),"checked")},_onCheckButtonChange:function(t,e){var i,n;t.block.hasMod("site")||(t.block.hasMod("freshness")?i="freshness":t.block.hasMod("wallpaper")?i="wallpaper":t.block.hasMod("commercial")&&(i="commercial"),n=this.elem("more-item",i,"yes"),e.checked?this.setMod(n,"selected","yes"):this.delMod(n,"selected"),this._updateMoreButtonState())},_onCustomSiteChange:function(t,e){var i=this.elem("more-item","site","yes");e.value?(this.setMod(i,"selected","yes"),this.setMod(this._moreSiteCustomText.text(e.value),"visibility","visible"),this.setMod(this._moreSiteDefaultText,"visibility","hidden")):(this.delMod(i,"selected"),this.setMod(this._moreSiteCustomText,"visibility","hidden"),this.setMod(this._moreSiteDefaultText,"visibility","visible")),this._updateMoreButtonState()}},{live:function(){return this.__base.apply(this,arguments),this.liveInitOnBlockInsideEvent("change","check-button",function(t,e){this._onCheckButtonChange(t,e)}).liveInitOnBlockInsideEvent("change","custom-site",function(t,e){this._onCustomSiteChange(t,e)}),!1}}),BEM.DOM.decl("dropdown2",{onSetMod:{js:{inited:function(){this._switcher=null,this._popup=null}},opened:{yes:function(){return this.hasMod("disabled")?!1:void this.trigger("beforeOpen").getPopup().setAnchor(this.getSwitcher()).setMod("visible","yes").on("beforeClose",this._onPopupBeforeClose,this)},"":function(){this.trigger("beforeClose").getPopup().delMod("visible").un("beforeClose",this._onPopupBeforeClose,this)}},disabled:{"*":function(t,e){this.getSwitcher().setMod(t,e)},yes:function(){this.delMod("opened")}}},getPopup:function(){return this._popup||(this._popup=this.findBlockInside("popup2")),this._popup},getSwitcher:function(){return this._switcher||(this._switcher=this.findBlockInside(this.getMod("switcher"))),this._switcher},_onPopupBeforeClose:function(){this.delMod("opened")},_onSwitcherClick:function(t){this._switcher||(this._switcher=t.block),this.toggleMod("opened","yes")}},{live:!0}),BEM.DOM.decl("popup2",{onSetMod:{js:{inited:function(){this._parentPopup=void 0,this._zIndex=null,this._zIndexGroupLevel=null,this._scope=BEM.DOM.scope,this._isAttachedToScope=!1}},visible:{yes:function(){this.trigger("beforeOpen"),this._isAttachedToScope||(this._scope.append(this.domElem),this._isAttachedToScope=!0),this._captureZIndex()._bindToParentPopup().bindTo("pointerdown pointerclick",this._setPreventHideByClick)},"":function(){this.trigger("beforeClose")._releaseZIndex()._unbindFromParentPopup().unbindFrom("pointerdown pointerclick")}}},destruct:function(){this.delMod("visible"),this.__base.apply(this,arguments)},setScope:function(t){return this._scope=t,this._isAttachedToScope=!1,this},setContent:function(t){return BEM.DOM.update(this.domElem,t),this},_calcZIndexGroupLevel:function(){var t=this.params.zIndexGroupLevel,e=this._getParentPopup();return e&&(t+=e._zIndexGroupLevel),t},_setPreventHideByClick:function(){var t=this;do t._preventHideByClick=!0,t=t._getParentPopup();while(t)},_bindToParentPopup:function(){var t=this._getParentPopup();return t&&(t.on("beforeClose",this._onParentPopupClose,this),t.addChild&&t.addChild(this)),this},_unbindFromParentPopup:function(){return this._parentPopup&&this._parentPopup.un("beforeClose",this._onParentPopupClose,this),this._parentPopup=void 0,this},_onParentPopupClose:function(){this.delMod("visible")},_getParentPopup:function(){return this._parentPopup},_captureZIndex:function(){null===this._zIndexGroupLevel&&(this._zIndexGroupLevel=this._calcZIndexGroupLevel());var t=this.__self._visiblePopupsZIndexes,e=this._zIndexGroupLevel,i=t[e],n=this._zIndex;return i||(i=t[e]=[(e+1)*this.__self.ZINDEX_FACTOR]),this._zIndex=i[i.length-1]+1,i.push(this._zIndex),this._zIndex!==n&&this.domElem.css("z-index",this._zIndex),this},_releaseZIndex:function(){var t=this.__self._visiblePopupsZIndexes[this._zIndexGroupLevel];return t&&t.splice(t.indexOf(this._zIndex),1),this},_recaptureZIndex:function(){return this._releaseZIndex(),this._zIndexGroupLevel=null,this._captureZIndex()},getDefaultParams:function(){return{zIndexGroupLevel:0}}},{live:!0,_visiblePopupsZIndexes:(BEM.blocks.popup||{})._visiblePopupsZIndexes||{},ZINDEX_FACTOR:1e3}),BEM.DOM.decl("popup2",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._bindEvents()}}},_bindEvents:function(){return this.redraw&&(BEM.channel("atom").on("stripe-show",this._onDaasChanged,this),BEM.channel("atom").on("stripe-hide",this._onDaasChanged,this)),BEM.blocks["b-page"].on("load:start",this._onPageChange,this),this.__base.apply(this,arguments)},destruct:function(){this.redraw&&(BEM.channel("atom").un("stripe-show",this._onDaasChanged,this),BEM.channel("atom").un("stripe-hide",this._onDaasChanged,this)),BEM.blocks["b-page"].un("load:start",this._onPageChange,this),this.__base.apply(this,arguments)},_onPageChange:function(){this.delMod("visible")},_onDaasChanged:function(){this.redraw()}}),BEM.DOM.decl("popup2",{onSetMod:{visible:{yes:function(){this.__base.apply(this,arguments),this.hasMod("type","internal")||BEM.blocks["b-page"].on("scroll",this._onPageScroll,this)},"":function(){this.__base.apply(this,arguments),this.hasMod("type","internal")||BEM.blocks["b-page"].un("scroll",this._onPageScroll)}}},_onPageScroll:function(){this.delMod("visible")}}),BEM.DOM.decl({block:"popup2",modName:"target"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._lastPopupDrawingCss={left:void 0,top:void 0,zIndex:void 0,display:void 0},this._lastTailDrawingCss={left:void 0,top:void 0},this._initialVisible=this.hasMod("visible")}},visible:{yes:function(){this.__base.apply(this,arguments),this.bindToWin("scroll resize",this._onWinScollAndResize).redraw(!0)},"":function(){this.__base.apply(this,arguments),this.unbindFromWin("scroll resize")}}},setContent:function(){return this.__base.apply(this,arguments).redraw()},redraw:function(t){function e(t,e){var i=!1;return Object.keys(e).forEach(function(n){var s=e[n];t[n]!==s&&(t[n]=s,i=!0)}),i}if(!this.hasMod("visible","yes")&&!t)return this;this.setMod("outside","yes");var i=this._calcBestDrawingParams();return this.setMod("direction",i.direction),e(this._lastPopupDrawingCss,this._calcDrawingCss(i))&&this.domElem.css(this._lastPopupDrawingCss),e(this._lastTailDrawingCss,this._calcTailDrawingCss(i))&&this.elem("tail").css(this._lastTailDrawingCss),this.delMod("outside")},_calcDrawingCss:function(t){var e=this._scope.offset();return t.top-=e.top,t.left-=e.left,{left:t.left,top:t.top}},_calcTailDrawingCss:function(t){return{left:t.tail.left,top:t.tail.top}},calcPossibleDrawingParams:function(){var t=this._calcTargetDimensions(),e=this._calcViewportDimensions(),i=this._calcOffsets();return this.params.directions.map(function(n){var s={direction:n,width:0,height:0,left:0,top:0};return this._checkMainDirection(n,"bottom")?(s.top=t.top+t.height+i.main,s.height=e.bottom-s.top-i.viewport):this._checkMainDirection(n,"top")?(s.height=t.top-e.top-i.main-i.viewport,s.top=t.top-s.height-i.main):(this._checkSecondaryDirection(n,"center")?(s.height=e.bottom-e.top-2*i.viewport,s.top=t.top+(t.height-s.height)/2):this._checkSecondaryDirection(n,"bottom")?(s.height=t.top+t.height-e.top-i.secondary-i.viewport,s.top=t.top+t.height-s.height-i.secondary):this._checkSecondaryDirection(n,"top")&&(s.top=t.top+i.secondary,s.height=e.bottom-s.top-i.viewport),this._checkMainDirection(n,"left")?(s.width=t.left-e.left-i.main-i.viewport,s.left=t.left-s.width-i.main):(s.left=t.left+t.width+i.main,s.width=e.right-s.left-i.viewport)),this._checkSecondaryDirection(n,"right")?(s.width=t.left+t.width-e.left-i.secondary-i.viewport,s.left=t.left+t.width-s.width-i.secondary):this._checkSecondaryDirection(n,"left")?(s.left=t.left+i.secondary,s.width=e.right-s.left-i.viewport):this._checkSecondaryDirection(n,"center")&&this._checkMainDirection(n,"top","bottom")&&(s.width=e.right-e.left-2*i.viewport,s.left=t.left+t.width/2-s.width/2),s},this)},_calcBestDrawingParams:function(){for(var t,e,i,n,s,o,r=this._calcPopupDimensions(),a=this._calcTargetDimensions(),c=this._calcViewportDimensions(),h=this.params.directions,l=h.length,u=0;l>u&&(t=h[u],e=this._calcPos(t,a,r),i=this._calcViewportFactor(e,c,r),(0===u||i>o||!o&&this.hasMod("direction",t))&&(n=t,o=i,s=e),!(o>this.__self.VIEWPORT_ACCURACY_FACTOR));u++);return{direction:n,left:s.left,top:s.top,tail:this._calcTailPos(n,a,r,s)}},_calcPopupDimensions:function(){var t=this.domElem.outerWidth(),e=this.domElem.outerHeight();return{width:t,height:e,innerWidth:this.domElem.innerWidth(),innerHeight:this.domElem.innerHeight(),area:t*e}},_calcTailDimension:function(){var t=this.elem("tail");return t.length>0&&"none"!==t.css("display")?t.outerWidth():0},_calcTargetDimensions:function(){},_calcViewportDimensions:function(){var t=BEM.DOM.win,e=t.scrollTop(),i=t.scrollLeft(),n=t.width(),s=t.height();return{top:e,left:i,bottom:e+s,right:i+n}},_calcPos:function(t,e,i){var n={},s=this._calcOffsets();return this._checkMainDirection(t,"bottom")?n.top=e.top+e.height+s.main:this._checkMainDirection(t,"top")?n.top=e.top-i.height-s.main:this._checkMainDirection(t,"left")?n.left=e.left-i.width-s.main:this._checkMainDirection(t,"right")&&(n.left=e.left+e.width+s.main),this._checkSecondaryDirection(t,"right")?n.left=e.left+e.width-i.width-s.secondary:this._checkSecondaryDirection(t,"left")?n.left=e.left+s.secondary:this._checkSecondaryDirection(t,"bottom")?n.top=e.top+e.height-i.height-s.secondary:this._checkSecondaryDirection(t,"top")?n.top=e.top+s.secondary:this._checkSecondaryDirection(t,"center")&&(this._checkMainDirection(t,"top","bottom")?n.left=e.left+e.width/2-i.width/2:this._checkMainDirection(t,"left","right")&&(n.top=e.top+e.height/2-i.height/2)),
n},_calcTailPos:function(t,e,i,n){var s={},o=this._calcTailDimension()/2;return this._checkMainDirection(t,"bottom")?s.top=-o:this._checkMainDirection(t,"top")?s.top=Math.floor(i.innerHeight-o):this._checkMainDirection(t,"left")?s.left=Math.floor(i.innerWidth-o):this._checkMainDirection(t,"right")&&(s.left=-o),this._checkSecondaryDirection(t,"right")?s.left=i.innerWidth-Math.ceil(Math.min(i.innerWidth,e.width)/2)-o:this._checkSecondaryDirection(t,"left")?s.left=Math.ceil(Math.min(i.innerWidth,e.width)/2)-o:this._checkSecondaryDirection(t,"bottom")?s.top=i.innerHeight-Math.ceil(Math.min(i.innerHeight,e.height)/2)-o:this._checkSecondaryDirection(t,"top")?s.top=Math.ceil(Math.min(i.innerHeight,e.height)/2)-o:this._checkSecondaryDirection(t,"center")&&(this._checkMainDirection(t,"top","bottom")?s.left=Math.ceil(i.innerWidth/2)-o:s.top=Math.ceil(i.innerHeight/2)-o),s},_calcViewportFactor:function(t,e,i){var n=this.params.viewportOffset,s=Math.max(t.left,e.left+n),o=Math.min(t.left+i.width,e.right-n),r=Math.max(t.top,e.top+n),a=Math.min(t.top+i.height,e.bottom-n);return o>s&&a>r?(o-s)*(a-r)/i.area:0},_calcOffsets:function(){var t=this.params,e=this._calcTailDimension();return{main:e>0?Math.max(t.mainOffset,Math.round(e*Math.SQRT1_2)):t.mainOffset,secondary:t.secondaryOffset,viewport:t.viewportOffset}},_checkMainDirection:function(t,e,i){return 0===t.indexOf(e)||i&&0===t.indexOf(i)},_checkSecondaryDirection:function(t,e){return t.indexOf("-"+e)>0},_checkDirection:function(t,e){return t.indexOf(e)>=0},_onWinScollAndResize:function(t){this.redraw()},getDefaultParams:function(){return $.extend(this.__base.apply(this,arguments),{mainOffset:0,secondaryOffset:0,viewportOffset:0,directions:this.__self.AVAILABLE_DIRECTIONS})},_setVisible:function(){this._initialVisible&&(this._initialVisible=!1,this.delMod("visible").setMod("visible","yes"))}},{VIEWPORT_ACCURACY_FACTOR:.99,AVAILABLE_DIRECTIONS:["bottom-left","bottom-center","bottom-right","top-left","top-center","top-right","right-top","right-center","right-bottom","left-top","left-center","left-bottom"]}),BEM.DOM.decl({block:"popup2",modName:"theme",modVal:"normal"},{getDefaultParams:function(){return $.extend(this.__base(),{mainOffset:5,viewportOffset:5})}}),BEM.DOM.decl({block:"popup2",modName:"autoclosable",modVal:"yes"},{onSetMod:{visible:{yes:function(){this.__self._visiblePopupsStack.unshift(this),this.afterCurrentEvent(function(){this.domElem&&this.hasMod("visible")&&this.bindToDoc("pointerclick",this._onDocClick)}),this.__base.apply(this,arguments)},"":function(){var t=this.__self._visiblePopupsStack;t.splice(t.indexOf(this),1),this.unbindFromDoc("pointerclick").__base.apply(this,arguments)}}},_onDocClick:function(t){this.hasMod("target","anchor")&&(this._anchor[0]===t.target||this._anchor.find(t.target).length>0)||(this._preventHideByClick?this._preventHideByClick=null:this.delMod("visible"))}},{live:function(){return BEM.DOM.doc.on("keydown",this._onDocKeyPress.bind(this)),this.__base()},_visiblePopupsStack:(BEM.blocks.popup||{})._visiblePopupsStack||[],_onDocKeyPress:function(t){BEM.blocks.keycodes.is(t.keyCode,"ESC")&&this._visiblePopupsStack.length&&this._visiblePopupsStack[0].__self.getName()===this.getName()&&this._visiblePopupsStack[0].delMod("visible")}}),BEM.DOM.decl({block:"popup2",modName:"autoclosable",modVal:"yes"},{_onDocClick:function(t){return this.hasMod("fixed","yes")&&(this._anchor[0]===t.target||this._anchor.find(t.target).length>0)?void 0:this.__base.apply(this,arguments)}}),function(t){function e(t,e){return t.addClass("i-bem "+e).bem(e)}BEM.DOM.decl({block:"popup2",modName:"target",modVal:"anchor"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._anchor=null,this._anchorParents=null,this._destructor=null,this._isAnchorVisible=void 0,this._fixedAnchor=void 0,this._updateIsAnchorVisible=t.throttle(this._updateIsAnchorVisible,this.__self.UPDATE_TARGET_VISIBILITY_THROTTLING_INTERVAL,this)}},visible:{yes:function(){this._anchorParents=this._getAnchorParents(),this._bindToAnchorParents(),this.__base.apply(this,arguments)},"":function(){this.__base.apply(this,arguments),this._updateIsAnchorVisible.stop(),this._unbindFromAnchorParents(),this._anchorParents=null,this._isAnchorVisible=void 0}}},_getAnchorParents:function(){for(var e,i=this;i;)e=i,i=i._getParentPopup();return t(e._anchor).parents()},destruct:function(){this._unbindFromDestructor(),this.__base.apply(this,arguments)},setAnchor:function(t){return this._unbindFromAnchorParents()._unbindFromParentPopup()._unbindFromDestructor(),this._anchor=t instanceof BEM.DOM?t.domElem:t,this._destructor=e(this._anchor,"_"+this.__self.getName()+"-destructor"),this._isAnchorVisible=void 0,this._fixedAnchor=void 0,this._bindToDestructor(),this._setVisible(),this.hasMod("visible")?(this._anchorParents=this._getAnchorParents(),this._recaptureZIndex()._bindToAnchorParents()._bindToParentPopup().redraw()):(this._anchorParents=null,this._zIndexGroupLevel=null),this},_calcTargetDimensions:function(){var t=this._anchor,e=this._getOffsetOf(t);return{left:e.left,top:e.top,width:t.outerWidth(),height:t.outerHeight()}},_getOffsetOf:function(t){var e=t.offset();return"pageYOffset"in window&&(e.top-=window.pageYOffset-(document.documentElement.scrollTop||document.body.scrollTop),e.left-=window.pageXOffset-(document.documentElement.scrollLeft||document.body.scrollLeft)),e},_calcDrawingCss:function(e){var i,n=this.__base.apply(this,arguments);return"undefined"==typeof this._isAnchorVisible&&(this._isAnchorVisible=this._calcIsAnchorVisible(),this._fixedAnchor=void 0),this._isAnchorVisible&&("undefined"==typeof this._fixedAnchor&&(this._fixedAnchor=this._getFirstFixedParent(this._anchor)),this._fixedAnchor&&(i=this._getOffsetOf(this._fixedAnchor),n.top-=i.top,n.left-=i.left)),t.extend(n,{display:this._isAnchorVisible?"":"none",position:this._fixedAnchor?"fixed":""})},_getFirstFixedParent:function(e){for(e=e[0];e;){var i=e.style;if(i&&"fixed"===i.position)return t(e);e=e.parentNode}return null},_calcIsAnchorVisible:function(){var e=this._anchor,i=this._getOffsetOf(e),n=i.left,s=i.top,o=n+e.outerWidth(),r=s+e.outerHeight(),a=this.getMod("direction"),c=Math.floor(this._checkDirection(a,"top")?s:r),h=Math.floor(this._checkDirection(a,"left")?n:o),l=!0;return this._anchorParents.each(function(e,i){if("BODY"===i.tagName)return!1;i=t(i);var n=/scroll|hidden|auto/,s=n.test(i.css("overflow-y")),o=n.test(i.css("overflow-x"));if(s||o){var r=this._getOffsetOf(i),a=Math.floor(r.top);if(a>c||a+i.outerHeight()<c)return l=!1;var u=Math.floor(r.left);return l=h>=u&&u+i.outerWidth()>=h}}.bind(this)),l},_calcZIndexGroupLevel:function(){var t=this.__base.apply(this,arguments);return this._destructor.findBlocksOutside("z-index-group").reduce(function(t,e){return t+Number(e.getMod("level"))},t)},_bindToAnchorParents:function(){return this.bindTo(this._anchorParents,"scroll",this._onAnchorParentsScroll)},_unbindFromAnchorParents:function(){return this._updateIsAnchorVisible.stop(),this._anchorParents&&this.unbindFrom(this._anchorParents,"scroll"),this},_onAnchorParentsScroll:function(){this.redraw()._updateIsAnchorVisible()},_onWinScollAndResize:function(){this.__base.apply(this,arguments),this._updateIsAnchorVisible()},_updateIsAnchorVisible:function(){if(this.domElem){var t=this._calcIsAnchorVisible();t!==this._isAnchorVisible&&(this._isAnchorVisible=t,this.redraw())}},_bindToDestructor:function(){return this._destructor.on("destruct",this._onPopupAnchorDestruct,this),this},_unbindFromDestructor:function(){return this._updateIsAnchorVisible.stop(),this._destructor&&this._destructor.un("destruct",this._onPopupAnchorDestruct,this),this},_onPopupAnchorDestruct:function(){this.domElem&&BEM.DOM.destruct(this.domElem)},_getParentPopup:function(){if(void 0===this._parentPopup){var t=this._anchor.closest(".popup, .popup2");this._parentPopup=this.findBlockOn(t,this.__self.getName())||this.findBlockOn(t,"popup")}return this._parentPopup}},{UPDATE_TARGET_VISIBILITY_THROTTLING_INTERVAL:100});var i=BEM.DOM;i.decl("_popup2-destructor",{destruct:function(){this.trigger("destruct"),this.__base.apply(this,arguments)}})}(jQuery),BEM.DOM.decl({block:"popup2",modName:"target",modVal:"anchor"},{syncVisible:function(){this._updateIsAnchorVisible()}}),BEM.DOM.decl({block:"dropdown2",modName:"switcher",modVal:"button"},{onSetMod:{opened:function(t,e){this.__base.apply(this,arguments),this.hasMod("has-tick")&&this.getSwitcher().toggleMod("arrow","up","down",Boolean(e))}}},{live:function(){return this.liveInitOnBlockInsideEvent("click","button",function(t){this._onSwitcherClick(t)}),this.__base()}}),BEM.DOM.decl({block:"dropdown",modName:"custom-size",modVal:"yes"},{onSetMod:{js:function(){this.__base.apply(this,arguments);var t=BEM.blocks["i-global"].param("mobile");this.afterCurrentEvent(function(){BEM.blocks["custom-size"].on("change",this._onCustomChange,this).on("reset",this._onCustomReset,this)}),t||this._popup.on("show",this._onPopupShow,this),t&&this.bindTo("size-input","blur",this._popupKeyboardHideFix)}},destruct:function(){BEM.blocks["custom-size"].un("change",this._onCustomChange,this).un("reset",this._onCustomReset,this),this.__base.apply(this,arguments)},_popupKeyboardHideFix:function(){this.afterCurrentEvent(function(){window.scrollTo(0,0)})},_onPopupShow:function(){this.setMod("action","open"),this.getCustomSize().focus()},_onCustomChange:function(){this._isCustom=!0,this.getAdvancedSearch().submit(),this._popup.hide(),this.trigger("silentChange")},_onCustomReset:function(){this._isCustom=!1,this.trigger("silentChange")},val:function(){return this._isCustom?this.getCustomSize().selected:this.__base.apply(this,arguments)},_radioboxReset:function(){this.__base.apply(this,arguments),this.getCustomSize().reset()},getCustomSize:function(){return this._customSize||(this._customSize=this.findBlockOn("custom-size")),this._customSize},getAdvancedSearch:function(){return this._advancedSearch||(this._advancedSearch=$(".advanced-search").bem("advanced-search")),this._advancedSearch}}),BEM.DOM.decl("custom-site",{onSetMod:{js:function(){this.findBlocks().bindEvents().val(this._controlVal())}},findBlocks:function(){return this._modal=this.findBlockInside("modal"),this._checkButton=this.findBlockInside("check-button"),this._input=this.findBlockInside("input"),this},bindEvents:function(){return BEM.blocks.button2.on(this.elem("cancel"),"click",this._onCancel,this),BEM.blocks.button2.on(this.elem("search"),"click",this._onSearch,this),this._modal.on({afterOpen:function(){this._input.setMod("focused","yes")},afterClose:this._onCancel},this),this._input.bindTo("keypress",this._onKeyPress.bind(this)),this},destruct:function(){this._modal.domElem&&(BEM.blocks.button2.un(this._modal.domElem,"click"),this._input.unbindFrom("keypress"),this._modal.un("afterOpen"),BEM.DOM.destruct(this._modal.domElem)),this.__base.apply(this,arguments)},toDomain:function(t){var e=new RegExp("^(?:(?:https?|ftp)://)?((?:(?:xn--)?(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:xn--)?(:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:xn--)?(?:[a-z\\u00a1-\\uffff]{2,})))(?::\\d{2,5})?(?:/[^\\s]*)?"),i=e.exec(t.toLowerCase());return i?i[1]:""},submit:function(t){return BEM.blocks["b-statcounter"].hit({params:{query:{filter:{site:this.toDomain(t)?"on":"any"}}}}),this},val:function(t){if("undefined"==typeof t)return this._controlVal();this._checkButton.delMod("checked");var e=this.toDomain(t);e?(this._val=e,this._checkButton.setMod("checked","yes"),this._checkButton.elem("text").text(e)):(this._val="",this._checkButton.elem("text").text(this.params.label));var i=this.val();return this._controlVal(this._val),i!==this._val&&this.trigger("change",{value:this._val}),this},reset:function(){this.val("")},showModal:function(){this._modal.setMod("visible","yes")},hideModal:function(){this._modal.delMod("visible")},_onKeyPress:function(t){13===t.which&&this._onSearch()},_controlVal:function(t){return"undefined"==typeof t?this._checkButton.val():(this._checkButton.val(t),this._input.val(t),this)},_onCancel:function(){this.hideModal(),this.val(this.val())},_onSearch:function(){var t=this._input.val();this.hideModal(),this.val(t),this.submit(t)},disableCounters:$.noop,enableCounters:$.noop},{live:function(){return this.liveInitOnBlockInsideEvent("click","check-button",function(){this.showModal()}),!1}}),BEM.DOM.decl("modal",{onSetMod:{js:{inited:function(){this._popup=this.findBlockOn("popup2")}},visible:function(t,e){var i=e?"Open":"Close",n=this.elem("content"),s=window.getComputedStyle?window.getComputedStyle(n[0]):n[0].currentStyle,o=parseFloat(s.animationDuration)>0?"animationend":parseFloat(s.webkitAnimationDuration)>0?"webkitAnimationEnd":"",r=function(){this.trigger("after"+i)};this.trigger("before"+i)._popup.setMod(t,e),o?n.one(o,r.bind(this)):this.afterCurrentEvent(r)}},destruct:function(){this.delMod("visible").__base.apply(this,arguments)},setContent:function(t){return BEM.DOM.update(this.elem("content"),t),this}},{live:!0}),BEM.DOM.decl("modal",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._enforceRepaint=this._enforceRepaint.bind(this)}},visible:{yes:function(){this.__base.apply(this,arguments),window.attachEvent&&this.elem("content")[0].attachEvent("onresize",this._enforceRepaint)},"":function(){this.__base.apply(this,arguments),window.detachEvent&&this.elem("content")[0].detachEvent("onresize",this._enforceRepaint)}}},_enforceRepaint:function(){this.domElem[0].className+=""}}),BEM.DOM.decl({block:"modal",modName:"theme",modVal:"normal"},{onSetMod:{visible:{yes:function(){this.setMod("has-animation","yes").__base.apply(this,arguments)}}}}),BEM.DOM.decl({block:"modal",modName:"autoclosable",modVal:"yes"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._preventHideByClick=!1}},visible:{yes:function(){this.__base.apply(this,arguments),this.bindTo("content","pointerdown pointerclick",this._setPreventHideByClick).bindTo("pointerclick",this._onPointerClick)._popup.on("beforeClose",this._onPopupClose,this)},"":function(){this.__base.apply(this,arguments),this.unbindFrom("content","pointerdown pointerclick").unbindFrom("pointerclick")._popup.un("beforeClose",this._onPopupClose,this)}}},_setPreventHideByClick:function(t){this._preventHideByClick=!0},_onPointerClick:function(t){this._preventHideByClick||this.delMod("visible"),this._preventHideByClick=!1},_onPopupClose:function(){this.delMod("visible")}}),BEM.DOM.decl("input",{onSetMod:{js:{inited:function(){this._val=this.elem("control").val()}},disabled:{"*":function(t,e){this.elem("control").prop("disabled",e)},yes:function(){this.delMod("focused")}},focused:function(t,e){return this.hasMod("disabled")?!1:(e?this._focused||this._focus():this._focused&&this._blur(),void this.afterCurrentEvent(function(){this.domElem&&this.trigger(e?"focus":"blur")}))}},isDisabled:function(){return this.hasMod("disabled","yes")},val:function(t,e){var i="undefined"!=typeof t,n=this.elem("control");return t=i?null===t?"":t.toString():n.val(),this._val!==t&&(this._val=t,n.val()!==t&&n.val(t),this.trigger("change",e)),i?this:t},name:function(t){var e=this.elem("control");return arguments.length?(e.attr("name",t),this):e.attr("name")},getSelectionEnd:function(){var t=this.elem("control")[0],e=0;if("number"==typeof t.selectionEnd)e=t.selectionEnd;else{var i=document.selection.createRange();if(i&&i.parentElement()===t){var n=t.value.length,s=t.createTextRange();s.moveToBookmark(i.getBookmark());var o=t.createTextRange();o.collapse(!1),e=s.compareEndPoints("EndToEnd",o)>-1?n:-s.moveEnd("character",-n)}}return e},_onFocus:function(){if(parseInt(BEM.blocks["i-ua"].ios,10)>=8&&!this.hasMod("type","textarea")){var t=this.elem("control")[0];t.selectionStart===t.value.length&&(t.scrollLeft=t.scrollWidth)}return this._focused=!0,this.setMod("focused","yes")},_onBlur:function(){return this._returnFocus?(this.afterCurrentEvent(function(){this.domElem&&this._focus()}),this):this.hasMod(this.elem("clear"),"pressed")?this:(this._focused=!1,this.delMod("focused"))},_focus:function(){return this.hasMod("disabled","yes")?!1:void this.elem("control").focus()},_blur:function(){this._returnFocus=!1,this.elem("control").blur()},_updateVal:function(){this.val(this.elem("control").val())},destruct:function(){this._blur(),this.__base.apply(this,arguments)}},{live:function(){this.liveBindTo("control","focusin focusout",function(t){this["focusin"===t.type?"_onFocus":"_onBlur"](t)}),this.liveBindTo("control","input",function(){this._updateVal()}),9===document.documentMode&&(this.liveBindTo("control","focusin",function(){this.bindToDoc("selectionchange",this._updateVal)}),this.liveBindTo("control","focusout",function(){this.unbindFromDoc("selectionchange")}))}}),BEM.DOM.decl("input",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments);var t=this.elem("control"),e=$.dom.getActiveElement(),i=this.params.autoFocus&&!e.is("input, textarea");(e[0]===t[0]||i)&&(this.setMod("focused","yes")._focused=!0),this.params.shortcut&&this.bindToDoc("keydown",function(t){t.ctrlKey&&t.which===BEM.blocks.keycodes.UP&&!$(t.target).is("input, textarea")&&this.setMod("focused","yes")})}}},_focus:function(){if(this.__base()===!1)return!1;var t=this.elem("control")[0];if(t.createTextRange&&!t.selectionStart){var e=t.createTextRange();e.move("character",t.value.length),e.select()}},destruct:function(){this.params.shortcut&&this.unbindFromDoc("keydown"),this.__base.apply(this,arguments)},_onPointerenter:function(t){this.setMod("hovered","yes")},_onPointerleave:function(t){this.delMod("hovered")},_updateValNextTick:function(){this.afterCurrentEvent(function(){this.domElem&&this._updateVal()})}},{live:function(){return this.liveBindTo("box","pointerover pointerout",function(t){this.hasMod("disabled")||this.elem("box")[0].contains(t.relatedTarget)||("pointerover"===t.type?this._onPointerenter(t):this._onPointerleave(t))}),this.liveBindTo("control","dragenter"),this.liveBindTo("control","dragend",function(){this._updateValNextTick()}),"documentMode"in document&&document.documentMode<=8&&(this.liveBindTo("control","focusin",function(){this.bindTo("control","propertychange keyup",this._updateVal),this.bindTo("control","cut paste",function(){this._updateValNextTick()})}),this.liveBindTo("control","focusout",function(){this.unbindFrom("control","cut paste"),this.unbindFrom("control","propertychange keyup"),this._updateValNextTick()})),this.__base()}}),BEM.DOM.decl("input",{onSetMod:{js:function(){this.__base.apply(this,arguments),this.bindTo(this.domElem,"keypress",this._onKeyPress),BEM.blocks["pane2-api"].on("fullscreen:enter",this._onFullscreenEnter,this).on("fullscreen:exit",this._onFullscreenExit,this)}},_onKeyPress:function(t){this.trigger("keypress",t)},_onFullscreenEnter:function(){this.setMod("disabled","yes")},_onFullscreenExit:function(){this.delMod("disabled")},setFocus:function(){return this.setMod("focused","yes")}},{live:function(){var t=this.__base.apply(this,arguments);return this.liveBindTo("cbir-button","pointerclick",function(){this.trigger("cbir:click")}),t}}),BEM.DOM.decl("input",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.on("change",this._updateClear)._updateClear()}}},_onClearClick:function(){return this.trigger("clear"),this.removeInsets&&this.removeInsets(),this.clearInput({source:"clear"})._focus()},clearInput:function(t){return this.val("",t),this},_updateClear:function(){return this.toggleMod(this.elem("clear"),"visibility","visible",Boolean(this._val))}},{live:function(){return this.liveBindTo("clear","pointerpress",function(t){this.setMod(this.elem("clear"),"pressed","yes")}).liveBindTo("clear","pointerover",function(t){this.setMod(this.elem("clear"),"hovered","yes")}).liveBindTo("clear","pointerout",function(t){this.delMod(this.elem("clear"),"hovered")}).liveBindTo("clear","pointerclick",function(){this.delMod(this.elem("clear"),"pressed"),this._onClearClick()}).liveBindTo("control","paste",function(){this.setMod(this.elem("clear"),"visibility","visible")}),this.__base()}}),BEM.DOM.decl("input",{_onBoxClear:function(){BEM.blocks["b-page"].preventFocus||this.__base.apply(this,arguments)}}),BEM.DOM.decl({block:"input",modName:"cbir",modVal:"yes"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.bindEvents().findBlocks()}},findBlocks:function(){return this.cbirIntent=BEM.blocks.header.getSearch().findBlockInside("cbir-intent"),this},bindEvents:function(){return this.__base.apply(this,arguments),this.bindTo(this.domElem,"keypress",this._onKeyPress),BEM.blocks["cbir-intent"].on("enableInput",this._onEnableInput,this).on("disableInput",this._onDisableInput,this).on("inputFocus",this._onInputFocus,this),BEM.blocks["cbir-panel"].on("inputFocus",this._onInputFocus,this),this},destruct:function(){BEM.blocks["cbir-intent"].un("enableInput",this._onEnableInput,this).un("disableInput",this._onDisableInput,this).un("inputFocus",this._onInputFocus,this),BEM.blocks["cbir-panel"].un("inputFocus",this._onInputFocus,this),this.__base.apply(this,arguments)},disableInput:function(){this.elem("control").attr("disabled",!0),this.delMod(this.elem("clear"),"visibility"),this.setMod(this.elem("box"),"cbir","yes"),this.val("")},_onDisableInput:function(){this.disableInput()},_onEnableInput:function(){this.elem("control").attr("disabled",!1),this.elem("control").val()&&this.setMod(this.elem("clear"),"visibility","visible"),this.delMod(this.elem("box"),"cbir")},_onInputFocus:function(){this.setFocus()}}),BEM.DOM.decl("cbir-intent",{onSetMod:{js:function(){this._intentTexts=this.params.texts,this.bindEvents().checkIntent()},loading:{yes:function(){this.setIntentTitle("loading").startSpin()}}},bindEvents:function(){return this.bindTo("close","pointerclick",this._onClearClick),BEM.blocks["b-page"].on("cbir-intent:loaded",this.prepareInputForCBIR,this),this},destruct:function(){BEM.blocks["b-page"].un("cbir-intent:loaded",this.prepareInputForCBIR,this),this.__base.apply(this,arguments)},_onClearClick:function(){this.delMod("visibility").enableInput().trigger("focusInput")},checkIntent:function(){var t=this.elem("thumb").attr("data-src");t&&this.bindLoadThumbEvent().setThumbSrc(t).makeIntentLoading(),(this.isVisible()||t)&&this.disableInput()},bindLoadThumbEvent:function(){return this.elem("thumb").one("load",this.makeIntentNormal.bind(this)),this},setThumbSrc:function(t){return this.elem("thumb").attr("src",t),this},isVisible:function(){return this.hasMod("visibility","visible")},startSpin:function(){return this.getSpin().setMod("progress","yes"),this},getSpin:function(){return this._spin||(this._spin=this.findBlockOn(this.elem("spinner"),"spin2"))},setIntentTitle:function(t){var e=this._intentTexts[t];return e&&this.elem("title").text(e),this},stopSpin:function(){return this.getSpin().delMod("progress"),this},makeIntentLoading:function(){var t=this.elem("thumb"),e=!_.isEmpty(t[0])&&t[0].width>0;return this.setMod("visibility","visible"),e||this.setMod("loading","yes").delMod(this.elem("thumb"),"visibility"),this},makeIntentNormal:function(){var t=this.elem("thumb").attr("src");return t?this.setMod(this.elem("thumb"),"visibility","visible").setIntentTitle("loaded").stopSpin():this.delMod("visibility").stopSpin(),this},prepareInputForIndex:function(){return this.delMod("visibility").delMod(this.elem("thumb"),"visibility").enableInput()},disableInput:function(){return this.trigger("disableInput"),this},enableInput:function(){return this.trigger("enableInput"),this},focusInput:function(){return this.trigger("focusInput"),this},prepareInputForCBIR:function(t,e){return _.isEmpty(e.html)?void 0:(this.elem("thumb").attr("src",e.html),this.setMod("visibility","visible").delMod("loading").makeIntentNormal().disableInput())},prepareInputForSearch:function(){return this.clearThumb(),this.delMod(this.elem("thumb"),"visibility").delMod("loading").delMod("visibility").enableInput()},clearThumb:function(){this.elem("thumb").attr("src","")}}),BEM.DOM.decl("custom-size",{onSetMod:{js:function(){var t=this.params.values;this.findBlocks().bindEvents(),this.select(t.iw,t.ih),this.setHints()}},findBlocks:function(){return this.dropdown=this.findBlockOn("dropdown"),this.radiobox=this.dropdown.findBlockInside("radiobox"),this.switcher=this.dropdown.findBlockOn(this.dropdown.elem("switcher"),"button"),this._initialSwitcherText=this.switcher.elem("text").text(),this.inputs=this.findBlocksInside("input"),this.button=this.findBlockOn(this.elem("button"),"button"),this.message=this.elem("message"),this},bindEvents:function(){return this.button.on("click",this.trySubmit,this),this.dropdown.on("change",this.reset,this),_.forEach(this.inputs,function(t){t.on("change",this._onInputUpdate,this).bindTo("keypress",this.changeThis(this._onKeyPress))}.bind(this)),this},destruct:function(){this.button.un("click",this.trySubmit,this),this.dropdown.un("change",this.reset,this),_.forEach(this.inputs,function(t){t.un("change",this._onInputUpdate,this)}.bind(this)),this.__base.apply(this,arguments)},_onKeyPress:function(t){13===t.which&&this.trySubmit()},trySubmit:function(){var t=this.getVals(),e=this.checkVal(t.width),i=this.checkVal(t.height);this.hideError(),e&&i?this.select(t.width,t.height):this.showError(e,i)},_onInputUpdate:function(){_.forEach(this.inputs,function(t){t.hasMod("invalid")&&this.hideError()}.bind(this))},select:function(t,e){return t&&e?(this.removeVals().setCustomValues().setText(t,e).trigger("change"),this):this},setCustomValues:function(){for(var t=[{name:"isize",val:"eq"}],e=this.getVals(),i={isize:this.params.values.isize,iw:e.width,ih:e.height},n=Object.keys(i),s=0,o=n.length;o>s;s++)this.dropdown.domElem.append(this._generateHidden(n[s],i[n[s]]));return this.selected=t,this},removeVals:function(){return this.radiobox.val("custom"),this.dropdown.findElem("hidden-value").remove(),this},reset:function(){return"custom"===this.radiobox.val()?this:(this.selected=!1,this.setVals(),this.resetText(),this.hideError().trigger("reset"),this.dropdown.val()||this.dropdown.delMod("applied"),this)},_generateHidden:function(t,e){return BEMHTML.apply({block:"dropdown",mods:{advanced:"yes"},elem:"hidden-value",tag:"input",attrs:{type:"hidden",name:t,value:e}})},showError:function(t,e){return this.highlightInvalidFields(t,e),this.setMod(this.message,"hidden",""),this},hideError:function(){return this.highlightInvalidFields(!0,!0),this.setMod(this.message,"hidden","yes"),this},highlightInvalidFields:function(t,e){return this.inputs[0].setMod("invalid",t?"":"yes"),this.inputs[1].setMod("invalid",e?"":"yes"),this},checkVal:function(t){return/^[0-9]+$/.test(t)&&Number(t)>0},setText:function(t,e){return this.switcher.elem("text").text(t+"x"+e),this},resetText:function(){return this.switcher.elem("text").text(this._initialSwitcherText),this},getVals:function(){return{width:this.inputs[0].val(),height:this.inputs[1].val()}},setVals:function(t,e){return this.inputs[0].val(t||""),this.inputs[1].val(e||""),this},setHints:function(){var t=BEM.blocks["i-userinfo"].get().getScreenSize();this.inputs[0].elem("hint").text(t.width),this.inputs[1].elem("hint").text(t.height)},updateSizes:function(t,e){this.setVals(t,e).select(t,e)},focus:function(){this.inputs[0].elem("control").focus()}},{live:!0}),BEM.DOM.decl("wallpaper",{onSetMod:{js:function(){this.checkButton=this.findBlockOn("check-button"),this.params.text=this.checkButton.elem("text").text(),this.setResolution()}},setResolution:function(){var t=this.checkButton,e=this.getScreenParams();return t.elem("text").text(this.params.text+" "+e.resolution),t.params.values.wp=e.wp,this},getScreenParams:function(){var t,e=this.params.resolution;return e||(t=this._getScreenInfo(),e=t.width+""+t.height),{resolution:e,wp:"wh"+this._getWP()}},_getScreenInfo:function(){return BEM.blocks["i-userinfo"].get().getScreenInfo()},_getWP:function(){return BEM.blocks["i-userinfo"].get().getWP()}}),BEM.DOM.decl({block:"check-button",modName:"state",modVal:"three"},{onSetMod:{js:function(){this._isChanged=!1,this._field=this.params.state.field,this._value=this.params.state.value,this.__base.apply(this,arguments)}},initButton:function(){this.__base.apply(this,arguments),this.on("change",BEM.blocks["i-ua"].ie?function(){this.afterCurrentEvent(this._onStateChange)}:this._onStateChange)},_onClick:function(){this.__base.apply(this,arguments),this.setChanged(!0)},_onStateChange:function(){var t={};t[this._field]=this._value,!this.isChecked()&&this.isChanged()&&this._field&&this.val(t)},reset:function(){var t,e;if(this.delMod("checked"),"wp"===this._field){t=this.findElem("hidden-value");for(var i=0;i<t.length;i++)e=t[i],("isize"===e.name||"wp"===e.name&&"off"!==e.value)&&e.parentNode.removeChild(e)}},setChanged:function(t){this._isChanged=t},isChanged:function(){return this._isChanged}}),BEM.DOM.decl("paranja",{onSetMod:{js:{inited:function(){[].concat(this.params.rel||[]).forEach(function(t){$(t.elem||this.domElem).on(t.event,this[t.method].bind(this))},this),this.bindTo("pointerclick",function(){this.trigger("click")})}},state:{open:function(){this.trigger("open")},close:function(){this.trigger("close")}}},open:function(t){this.setMod("state","open")},close:function(t){this.setMod("state","close")}},{live:!1}),BEM.DOM.decl("paranja",{setTheme:function(t){return this.setMod("theme",t)},delTheme:function(){return this.delMod("theme")}}),BEM.DOM.decl("i-services",{getServiceUrl:function(t,e){var i=this.params[t],n="";return i?(i.search&&e&&(n=i.search+encodeURIComponent(e)),n=n?i.params?n+i.params:n:i.params?"/?"+i.params.replace(/^\&/,""):"all"===t?"":"/",i.baseUrl+n):""}},{getInstance:function(){return this._instance||(this._instance=$(this.buildSelector()).bem(this.getName())),this._instance},getServiceUrl:function(t,e){return this.getInstance().getServiceUrl(t,e)},live:!0}),BEM.DOM.decl("tabs-navigation",{_onDocClick:function(t){this.elem("tab").is(t.target)||this.delMod("show-extra").unbindFromDoc("click")},_onMoreClick:function(){this.setMod("show-extra","yes").bindToDoc("click",this._onDocClick)},_onMoreKeydown:function(t){BEM.blocks.keycodes.is(t.keyCode,"SPACE")&&t.preventDefault()},_onMoreKeyup:function(t){BEM.blocks.keycodes.is(t.keyCode,"ENTER","SPACE")&&this.setMod("show-extra","yes").bindToDoc("click",this._onDocClick)}},{live:function(){this.liveBindTo("more","pointerclick",function(t){this._onMoreClick(t)}).liveBindTo("more","keydown",function(t){this._onMoreKeydown(t)}).liveBindTo("more","keyup",function(t){this._onMoreKeyup(t)})}}),BEM.DOM.decl("tabs-navigation",{hide:function(){return this.setMod("hidden","yes")},show:function(){return this.delMod("hidden")}}),BEM.DOM.decl("search2",{_onInputChange:function(){BEM.blocks["i-global"].setParams({searchInputText:_.escape(this._input.val())})},reset:function(){return this._input.val("",{suggest:!1}),this},focus:function(){if(!BEM.blocks["i-global"].param("isPumpkin")){var t=this._suggest.params.onFocus;this._suggest.params.onFocus=!1}return this._input.elem("control").focus(),BEM.blocks["i-global"].param("isPumpkin")||this.afterCurrentEvent(function(){this._suggest.params.onFocus=t},this),this},val:function(){return this._input.val()}}),BEM.DOM.decl("search2",{onSetMod:{js:{inited:function(){this.findBlocks().bindEvents()}}},findBlocks:function(){return this._location=BEM.blocks.location.getInstance(),this._input=this.findBlockInside("input"),this._suggest=this.findBlockInside("suggest2"),this},bindEvents:function(){return this._location.on("change",this._onChange,this),this._suggest&&this._suggest.on("select",this._onSuggestSelect,this),this._input.on("change",this._onInputChange,this),this._input.on("focus",this._onInputFocus,this),BEM.blocks["b-page"].on("search:input:update",this.updateSearchPage,this),BEM.blocks["i-global"].param("isPumpkin")||this.bindTo("submit",this._onSubmit),this},_onInputFocus:function(){this.trigger("input:focus")},_onSuggestSelect:function(t){t.preventDefault()},_onSubmit:function(t,e){
this.submit(t,e),t.preventDefault()},submit:function(t,e){var i=BEM.blocks["i-global"].getFlag("suggest_context_redirect"),n=BEM.blocks["i-global"].param("tld");i&&"ru"===n?this._checkRedirectURL(t,i):(this.val()!==BEM.blocks.uri.getParamValue("text")&&this.trigger("search:query:changed"),this._ajaxSubmit(t,e&&e.cgiQuerySource))},_ajaxSubmit:function(t,e){this._location.change({url:this._buildUrl(e)},t)},_checkRedirectURL:function(t,e){var i=BEM.blocks["i-global"].param("id"),n=this._input.val(),s="images"===i?40:197,o="images"===i?72863:72894,r=2===e?"control-":"",a=this;$.ajax({url:"//yandex.ru/suggest/suggest-redir",data:{current:i,part:n,lr:BEM.blocks["i-global"].param("lr")},dataType:"json",context:this,cache:!1}).then(function(t,e,i){var n=_.get(t,"redirect_info.url"),s=$.Deferred();return n?s.resolve(n):s.reject(i,"no"),s.promise()}).then(function(c){cp({pid:s,cid:o,path:r+"yes",text:n,service:i},{href:c}),2===e?a._ajaxSubmit(t):location.href=c},function(e,c){cp({pid:s,cid:o,path:r+c,text:n,service:i}),a._ajaxSubmit(t)})},_buildUrl:function(t){var e=this.getAdvancedSearch();return this.domElem.attr("action")+"?"+this.domElem.serialize()+(e?"&"+e.getParams():"")+(t?"&query_source="+t:"")},_onChange:function(t,e){switch(this.__self.win.scrollTop(0),e.block){case"b-page_type_index":case"b-page_type_favorites":this.updateIndexPage(t,e);break;case"b-page_type_search":this.updateSearchPage(t,e)}},updateIndexPage:function(){this.reset().focus()},updateSearchPage:function(t,e){this.fill(e.params.text),this._input._updateClear(),this._input.delMod("focused")},fill:function(t){var e=t;return Array.isArray(t)&&(e=t[0]),BEM.blocks["i-global"].param("isPumpkin")&&this._input&&this._input.val(e),this._suggest&&this._suggest.params["suggest2-input"]&&this._suggest.params["suggest2-input"].valWithoutSuggest(e),this},getAdvancedSearch:function(){if(!this._advancedSearch){var t=$(".advanced-search");this._advancedSearch=!_.isEmpty(t)&&t.bem("advanced-search")}return this._advancedSearch}}),BEM.DOM.decl("search2",{bindEvents:function(){return this.__base.apply(this,arguments),this},countSubmit:function(){return this.submitByFilters?void(this.submitByFilters=!1):this.submitBySuggest?void(this.submitBySuggest=!1):void("index"===BEM.blocks["i-global"].param("page")?(_.includes(["ru","ua","com.tr"],BEM.blocks["i-global"].param("tld"))&&BEM.blocks["b-statcounter"].goal({goal:"button",params:{query:{morda:"submit"}}}),BEM.blocks["b-statcounter"].hit({params:{query:{morda:"submit"}}})):BEM.blocks["b-statcounter"].hit({params:{query:{reform:"submit"}}}))},_onSuggestSelect:function(t){return BEM.blocks["i-global"].param("isPumpkin")?(this._location.change({url:this._buildUrl(),reload:!0},t),void t.preventDefault()):(this.__base.apply(this,arguments),this.submitBySuggest=!0,void BEM.blocks["b-statcounter"].hit({params:{query:"index"===BEM.blocks["i-global"].param("page")?{morda:"suggest"}:{reform:"suggest"}}}))},updateIndexPage:function(){this.reset(),this._input.setMod("autofocus","yes")},updateCbirPage:function(){this.fill(""),this._input.delMod("autofocus")},updateSearchPage:function(){this.__base.apply(this,arguments),this._input.setMod("autofocus","yes")}},{live:function(){this.liveBindTo("label","click",function(t){t.preventDefault()})}}),function(){var t=function(t){var e=t.charCode||t.keyCode||t.which||0,i=t.ctrlKey||t.altKey||t.metaKey,n=e>=48&&57>=e,s=e>=96&&105>=e,o=[e>=65&&90>=e,e>=1025&&1071>=e,0===e,231===e].some(Boolean);return!i&&(n||s||o)};BEM.DOM.decl({name:"input",modName:"autofocus",modVal:"yes"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.bindToDoc("keydown",this._autoFocusBind)}}},_autoFocusBind:function(e){if(!this.hasMod("focused","yes")&&!this.elem("control").attr("disabled")){var i;try{i=document.activeElement.tagName.toLowerCase()}catch(n){}if(t(e)&&"input"!==i&&"textarea"!==i){var s=this.elem("control")[0],o=this.val();if(o.length>0&&" "!==o.slice(-1)&&(o+=" ",this.val(o)),s.createTextRange){var r=s.createTextRange();r.collapse(!1),r.select()}else s.selectionStart&&s.setSelectionRange(o.length,o.length);this.setMod("focused","yes")}}}})}(),BEM.DOM.decl("input",{onSetMod:{autofocus:{yes:function(){this.bindToDoc("keydown",this._autoFocusBind)}}}}),BEM.DOM.decl({block:"input",modName:"found",modVal:"yes"},{_onFoundUpdate:function(t,e){this.setFound(BEM.blocks["i-common__string"].escapeHTML(e.text))}}),BEM.DOM.decl("suggest2",{onSetMod:{js:{inited:function(){this.params.form||this.findBlockOutside("suggest2-form"),this._lastSubmitTime=0,this._lastBlurTime=0,this._clear()}}},_bodyHandler:function(t){if(!this._isDestructing){var e=$(t.target),i=this.containsDomElem(e)||this.params.form.containsDomElem(e);i||(this._freezeInputFocus=!1)}},getDefaultParams:function(){return{submitBySelect:!1,updateOnEnterByKeyboard:!0,onFocus:"request",requestOnEmptyInput:!1,abortQueries:!1,sequentialQueriesTimeout:!1}},destruct:function(){this.unbindAllEvents(),this.__base.apply(this,arguments)},init:function(){var t=this;return t.params.form.on("submit",function(e,i){t._lastSubmitTime=(new Date).getTime(),t._isActualSearchCGIParams?t._isActualSearchCGIParams=!1:"suggest2-counter"!==i.data.block&&i.data.prevent!==!1&&this.removeHiddenInputs(),t._clear(),t._popup.hide()}),t._input=t.params["suggest2-input"],t._popup=t.params["suggest2-popup"],t._inputValue=t._input.val(),t._model=t.initModel(),t._view=t.initView(),t._counter=t.initCounter(),t._model.on({response:this.setItems,reject:function(e,i){2===i.code&&(t._popup.hide(),t._clear())}},t),t.bindToDoc("pointerclick",t._bodyHandler),t.bindEvents(),this._input.isFocused()&&this._doRequest(),t},initModel:function(){return BEM.create("suggest2-model",this.params)},getModel:function(){return this._model},initView:function(t,e){var i=this.getMod("type");return t=t||{},"simple"!==i&&"all"!==i||(t.simple="yes"),"advanced"!==i&&"all"!==i||(t.advanced="yes"),BEM.create({block:"suggest2-view",mods:t||{}},e||{})},getView:function(){return this._view},initCounter:function(){return this.params.counter?this.params.counter.initValues().bindEvents():void 0},getCounter:function(){return this._counter},setDataConverter:function(t){return this.getModel().getProvider().convert=t,this},setRequestData:function(t){return this.getModel().getProvider().getRequestData=t,this},setRequestUrl:function(t){return this.getModel().getProvider().getRequestUrl=t,this},setOwner:function(t){return this._popup.owner(t),this},bindEvents:function(){var t=this;return t._input.bindEvents({change:t._onChange,focus:t._onFocus,blur:t._onBlur},t),t._popup.on({preshow:function(){t.trigger("preshow")},show:function(){t._onShow()},hide:function(e,i){t._onHide(i)}}),t.params.form&&t.params.form.on("button-press",t._onSearchButtonMousedown,t),BEM.blocks["suggest2-item"].on(t.domElem,{"link-click":function(e,i){t._counter&&"_self"===$(i.domEvent.target).attr("target")&&i.domEvent.preventDefault()}}),t},_onShow:function(){this.trigger("show")},_onHide:function(t){this.trigger("hide",t)},_onSearchButtonMousedown:function(){this._input.realVal(this._input.val()),this._popup.hide()},unbindAllEvents:function(){var t=this;return t.unbindFromDoc("pointerclick"),t._input.unbindAllEvents(),t.params.form.un("submit"),t._model.un("response").un("reject"),t._popup.un("preshow").un("show").un("hide"),t.params.form&&t.params.form.un("button-press",t._onSearchButtonMousedown,t),t},setItems:function(t,e){var i=this,n=e.data.items||[];return i._isFormSubmitDurinQuery()||!n.length?(i._popup.hide(),i._clear()):this.params.sequentialQueriesTimeout||i._input.val()===e.val?(i._text=e.val,i._pos=e.pos,i._meta=e.data.meta||{},i._popup.show(i._view.html(n,i._meta)).width(i.getPopupWidth()),i._items=i.findBlocksInside("suggest2-item"),i._clearItems().trigger("update",{val:i._text,pos:i._pos,items:i._items}),i):i._clear()},getItems:function(){return this._items||[]},isBlur:function(){return this._isBlur&&!this._isMouseDown},getPopupWidth:function(){},getInputWidth:function(){return 0},isNeedSubmitFormOnSelectItem:function(t){return this.params.submitBySelect&&"link"!==t.getMod("interact")},_isFormSubmitDurinQuery:function(){return this._lastSubmitTime?(this._model.filterRequestsByVal(this._input.realVal()),this._model.isTimeInRequestInterval(this._lastSubmitTime)):!1},_onChange:function(t,e){this._inputValue!==this._input.val()&&(this._inputValue=this._input.val(),this._doRequest(e))},_doRequest:function(t){this._model.request(this._input.realVal(this._input.val()),this._input.getCaretPosition(),t)},_onFocus:function(){!this._popup.isShown()&&this._isBlur&&this.params.onFocus&&this._isLastBlurTimeLater(50)&&(this.getItems().length&&this._input.val()===this._text?(this._clearItems(),this._popup.show()):this._isMouseDown||"request"!==this.params.onFocus||this._doRequest())},_onBlur:function(){this._isBlur?(this._clear(),this._popup.hide()):this._freezeInputFocus?(this._clear(),this._input.focus()):this._isMouseDown&&this._input.focus(),this._lastBlurTime=(new Date).getTime(),this._isBlur=!0},_getItemIndex:function(t){return this.getItems().indexOf(t)},_clear:function(){return this._isBlur=!0,this._freezeInputFocus=!1,this._clearItems()},_clearItems:function(){return this._isMouseDown=!1,this._enterItemIndex=-1,this._unselectItems()},_isLastBlurTimeLater:function(t){return(new Date).getTime()-this._lastBlurTime>t},_unselectItems:function(t){var e=t?[].slice.call(arguments):this.getItems();return e.forEach(function(t){t.onLeave()}),this},_onSelectItem:function(t,e){var i=this,n=i._getItemIndex(t),s=t.onSelect(e),o=t.valOnSelect();return i._text=i._input.realVal(o),i._isBlur=!0,i._freezeInputFocus=!1,i._setSearchCGIParams(t),i.trigger("select",{val:i._text,pos:i._pos,item:t,meta:i._meta,itemIndex:n,byKeyboard:e,callbackOnSelect:s}),o!==!1&&(i._items=[],this.isNeedSubmitFormOnSelectItem(t)&&i.params.form.submit()),n},_isActualSearchCGIParams:!1,_setSearchCGIParams:function(t){this.params.form.removeHiddenInputs(),t.params.searchCGI&&(this._isActualSearchCGIParams=!0,this.params.form.appendHiddenInputs(t.params.searchCGI.map(function(t){return{name:t[0],value:t[1]}})))},_onDownItem:function(){this._isBlur=!1,this._isMouseDown=!0}}),BEM.DOM.decl("suggest2",{bindEvents:function(){var t=this;return t._input.bindEvents({keydown:t._onKeyDown,keyup:t._onKeyUp,keypress:t._onKeyPress,mousedown:function(){t._input.isFocused()&&t._onFocus()}},t),BEM.blocks["suggest2-item"].on(t.domElem,{mouseover:function(e){t._onEnterItem(e.block,!1)},mouseout:function(e,i){var n=e.block.domElem[0];n===i.relatedTarget||$.contains(n,i.relatedTarget)||t._onLeaveItem(e.block,!1)},mousedown:function(){t._onDownItem()},click:function(e){t._onSelectItem(e.block,!1)}}),t.__base.apply(t,arguments)},_onKeyDown:function(t){var e=this.__self.keyboard,i=t.which;!this._popup.isShown()||i!==e.up&&i!==e.down||(t.preventDefault(),this._enterByKeyboard(i))},_onKeyUp:function(t){var e=this.__self.keyboard;if(t.which!==e.left&&t.which!==e.right||(this.trigger("change-cursor-pos"),this._model.request(this._input.realVal(this._input.val()),this._input.getCaretPosition())),t.which===e.right&&-1!==this._enterItemIndex&&this._enterItemByKeyboard){var i=this._items[this._enterItemIndex];i&&this.trigger("ahead",{item:i,val:"link"===i.getMod("interact")?i.elem("text").text():i.val()})}},_onKeyPress:function(t){if(t.which===this.__self.keyboard.enter&&-1!==this._enterItemIndex&&this._enterItemByKeyboard){var e=this._items[this._enterItemIndex];e&&(t.preventDefault(),this._onSelectItem(e,!0))}},_enterByKeyboard:function(t){var e=t-39,i=this._items.length,n=this._enterItemIndex+e;return-1===n||n===i?(this._enterItemIndex=n,this._unselectItems(this._items[n]),this.trigger("out",{val:this._text,byKeyboard:!0})):(0>n?n=i-1:n>=i&&(n=0),void this._onEnterItem(this._items[n],!0))},_onEnterItem:function(t,e){this._enterItemIndex=this._getItemIndex(t),this._enterItemByKeyboard=e,this._unselectItems(),t.onEnter(e)},_onLeaveItem:function(t,e){this._clearItems()._unselectItems(t)}},{keyboard:{enter:13,left:37,up:38,right:39,down:40},live:function(){return this.liveBindTo("mousedown",function(){this._onDownItem()}),this.__base()}}),BEM.DOM.decl("suggest2",{getInputLeft:function(){return 0},getInputWidth:function(){return 0},getContainerWidth:function(){return 0},getMetrics:function(){var t=this.getInputLeft(),e=this.getInputWidth(),i=this.getContainerWidth()-t;return{marginLeft:t,minWidth:e>=i?i:e,maxWidth:i}},adjustView:function(){return{}}}),BEM.DOM.decl("suggest2",{init:function(){this.__base.apply(this,arguments),this._toggleHistory()},_onSelectItem:function(t){"no"!==t.getMod("interact")&&this.__base.apply(this,arguments)},_toggleHistory:$.noop}),BEM.DOM.decl("suggest2",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),BEM.blocks["pane2-api"].on("fullscreen:enter",this._onFullscreenEnter,this).on("fullscreen:exit",this._onFullscreenExit,this).on("pane:open",this._onPaneOpen,this).on("pane:close",this._onPaneClose,this)}}},_onFullscreenEnter:function(){this._disable()},_onFullscreenExit:function(){this._enable()},_onPaneOpen:function(){this._disable()},_onPaneClose:function(){this._enable()},_disable:function(){this.setMod("disabled","yes")},_enable:function(){this.delMod("disabled")}}),BEM.decl("suggest2-model",{onSetMod:{js:{inited:function(){this._requests=[]}}},destruct:function(){this._provider&&this._provider.destruct(),this.__base.apply(this,arguments)},getProvider:function(){return this._provider?this._provider:(this._provider=this.setProvider(this.params),this._provider)},setProvider:function(t){return this._provider=BEM.create("suggest2-provider",t),this._provider},getCancelRequestConditions:function(){return[{block:"suggest2",show:!1},{block:"suggest2",event:"select"},{block:"suggest2-item",event:"select"},{block:"suggest2",event:"out"},{block:"suggest2-item",show:!1},{block:"suggest2-popup",event:"hide"},{suggest:!1},{source:"sample"}]},request:function(t,e,i){var n=this,s={val:t,caretPosition:e,data:i};n._requests.push(s);var o=n._isNeedRequest(t,i);return o.need?(s.requestTime=(new Date).getTime(),n.lastSendedRequest=s,n.trigger("request",{val:t,pos:e,request:s}),n.getProvider().get(t,e,function(t,e,i,o){s.responseTime=(new Date).getTime(),$.extend(s,{duration:s.responseTime-s.requestTime,error:i.error,fromCache:o,itemsCount:i.items?i.items.length:0}),n._onResponse(t,e,i,s);var r=n._requests[n._requests.length-1];n.params.sequentialQueriesTimeout&&r.val!==t&&n.request(r.val,r.caretPosition,r.data)}),n):n.trigger("reject",{val:t,pos:e,code:o.code,reason:o.reason||{}})},isTimeInRequestInterval:function(t){for(var e=this._requests.length-1;e>=0;e--)if(t>this._requests[e].requestTime&&t<this._requests[e].responseTime)return!0;return!1},filterRequestsByVal:function(t){this._requests=this._requests.filter(function(e){return e.val===t})},_isNeedRequest:function(t,e){if(""===t&&!this.params.requestOnEmptyInput)return{need:!1,code:2};var i;if(this.lastSendedRequest&&this.lastSendedRequest.val===t)return{need:!1,code:4};if(this.params.sequentialQueriesTimeout)for(i=this._requests.length-1;i>=0;i--){var n=this._requests[i];if(void 0===n.responseTime&&(new Date).getTime()-n.requestTime<this.params.sequentialQueriesTimeout)return{need:!1,code:3,reason:{request:n}}}if(!e)return{need:!0};var s,o=this.getCancelRequestConditions();t:for(i=0;i<o.length;i++){s=o[i];for(var r in s)if(s.hasOwnProperty(r)&&s[r]!==e[r])continue t;return{need:!1,code:1,reason:{condition:s}}}return{need:!0}},_onResponse:function(t,e,i,n){var s={val:t,pos:e,data:i||[],request:n};BEM.channel("suggest2").trigger("response",s),this.trigger("response",s)}}),BEM.DOM.decl("suggest2-detect",{onSetMod:{js:{inited:function(){this.bindToDoc("keydown",function(t){this.__self._pressedKeyCode=t.which},this).bindToDoc("keyup",function(){this.__self._pressedKeyCode=null},this),this.__self.isSupportInlineSVG()||this.setMod("inlinesvg","no")}}}},{_pressedKeyCode:null,isPressedEscape:function(){return 27===this._pressedKeyCode},_isSupportInlineSVG:null,isSupportInlineSVG:function(){if(null!==this._isSupportInlineSVG)return this._isSupportInlineSVG;var t=document.createElement("div");return t.innerHTML="<svg/>",this._isSupportInlineSVG="http://www.w3.org/2000/svg"===(t.firstChild&&t.firstChild.namespaceURI),this._isSupportInlineSVG}}),function(t){if(!t.support.cors&&t.ajaxTransport&&window.XDomainRequest){var e=/^(https?:)?\/\//i,i=/^get|post$/i,n=new RegExp("^(//|"+location.protocol+")","i");t.ajaxTransport("* text html json",function(s,o,r){if(s.crossDomain&&s.async&&i.test(s.type)&&e.test(s.url)&&n.test(s.url)){var a=null;return{send:function(e,i){var n="",r=(o.dataType||"").toLowerCase();a=new XDomainRequest,/^\d+$/.test(o.timeout)&&(a.timeout=o.timeout),a.ontimeout=function(){i(500,"timeout")},a.onload=function(){var e="Content-Length: "+a.responseText.length+"\r\nContent-Type: "+a.contentType,n={code:200,message:"success"},s={text:a.responseText};try{if("html"===r||/text\/html/i.test(a.contentType))s.html=a.responseText;else if("json"===r||"text"!==r&&/\/json/i.test(a.contentType))try{s.json=t.parseJSON(a.responseText)}catch(o){n.code=500,n.message="parseerror"}}catch(c){throw c}finally{i(n.code,n.message,s,e)}},a.onprogress=function(){},a.onerror=function(){i(500,"error",{text:a.responseText})},o.data&&(n="string"===t.type(o.data)?o.data:t.param(o.data)),a.open(s.type,s.url),a.send(n)},abort:function(){a&&a.abort()}}}})}}(jQuery),BEM.decl("suggest2-provider",{getDefaultParams:function(){return{cache:!1,type:"GET",dataType:"jsonp",timeout:2e3}},_cachedResponses:Object.create?Object.create(null):{},_cachingTime:6e4,_lastQuery:null,get:function(t,e,i){var n=this,s=n.params.abortQueries,o=n._extendParamsData(n.getRequestData(t,e));i=i.bind(n,t,e),s&&null!==n._lastQuery&&n._lastQuery.abort(),n._lastQuery=$.ajax(o).done(function(t){i(n.convert(t),n._validateCache(this.url))}).fail(function(t,e){!s&&i({error:e||"error"})})},convert:function(t){return{orig:t[0],items:t[1],meta:t[2]}},getRequestData:function(t,e){return $.extend({part:t,pos:e},BEM.blocks["suggest2-detect"].isSupportInlineSVG()&&{svg:1})},getRequestUrl:function(){return this.params.url},_extendParamsData:function(t){return this.params.url=this.getRequestUrl(),this.params.data=$.extend(this.params.data||{},t),this.params},_validateCache:function(t){var e=Boolean(this._cachedResponses[t])&&this._cachedResponses[t]>Date.now();return!e&&this._addToCache(t),e},_addToCache:function(t){this._cachedResponses[t]=Date.now()+this._cachingTime,setTimeout(function(){this._cachedResponses[t]=void 0}.bind(this),this._cachingTime)}}),BEM.decl("suggest2-provider",{getRequestData:function(t,e){return $.extend(this.__base.apply(this,arguments),{"prev-query":BEM.blocks["i-global"].param("query")})}}),BEM.DOM.decl("suggest2-item",{val:function(){if(void 0!==this.params.val)return this.params.val;var t=this.elem("text");return(t.length?t:this.domElem).text()},valOnSelect:function(){return this.val()},valOnEnter:function(){return this.val()},valOnLeave:function(){return this.val()},onEnter:function(t){return this.setMod("selected","yes").triggerEvent("enter",{val:this.valOnEnter(),byKeyboard:t})},onLeave:function(t){return this.domElem?this.delMod("selected").triggerEvent("leave",{val:this.valOnLeave(),byKeyboard:t}):this},onSelect:function(t){this.triggerEvent("select",{val:this.valOnSelect(),byKeyboard:t})},_onPointerpress:function(t){this.setMod("pressed","yes").bindToDoc("pointerrelease",this._onPointerrelease)},_onPointerrelease:function(t){this.delMod("pressed").unbindFromDoc("pointerrelease")},triggerEvent:function(t,e){return this.trigger(t,{val:e.val,id:this.domElem.attr("id"),show:!1,byKeyboard:e.byKeyboard})}},{live:function(){return this.liveBindTo("pointerpress",function(t){this.hasMod("disabled")||this._onPointerpress(t)}),this.__base()}}),BEM.DOM.decl("suggest2-item",{},{live:function(){return this.liveBindTo("mouseover mouseout mousedown pointerclick",function(t){this.trigger("pointerclick"===t.type?"click":t.type,{domEvent:t})}).liveBindTo("link","pointerclick",function(t){this.trigger("link-click",{domEvent:t})}),this.__base()}}),BEM.DOM.decl({block:"suggest2-item",modName:"interact",modVal:"no"},{val:function(){return""},onEnter:function(){},onLeave:function(){},onSelect:function(){},_onPointerpress:function(){},_onPointerrelease:function(){},_onClick:function(t){t.stopPropagation()}}),BEM.decl("suggest2-popup",{onSetMod:{js:{inited:function(){this._popup=this.params.popup,this._popupContent=this.params.popupContentElem&&this._popup.findElem(this.params.popupContentElem),this.bindSuggestEvents()}}},show:function(t){return this._popup.domElem?(t&&this.setContent(t),this.isShown()?this:(this.trigger("preshow"),this._setPosition(),this.trigger("show"),this)):this},_setPosition:function(){throw new Error("       _for")},hide:function(t){throw new Error("       _for")},setContent:function(t){return this._popupContent?BEM.DOM.update(this._popupContent,t):this._popup.setContent(t),this},isShown:function(){throw new Error("       _for")},owner:function(t){return t?(this.params.owner=t,this):this.params.owner},get:function(){return this._popup},width:function(t){return void 0===t?this._popup.domElem.outerWidth():(this._popup.domElem.outerWidth(t),this)},destruct:function(){this._popup&&(this.unbindAllEvents(),this.__base.apply(this,arguments))},bindSuggestEvents:function(){return this.params.suggest.on({select:this._onSuggestSelect,update:this._onSuggestUpdate},this),this},_onSuggestSelect:function(t,e){this.hide(e)},_onSuggestUpdate:function(t,e){e.items.length||this.hide({response:"empty"})},unbindAllEvents:function(){return this.params.suggest.un("select").un("update"),this}}),BEM.decl("suggest2-view",{html:function(t,e){return BEMHTML.apply(this.build(t,e))},build:function(t,e){return{block:"suggest2",elem:"content",elemMods:{theme:"normal"},content:this.buildItems(t,e)}},buildItems:function(t,e){return t.reduce(function(t,e){return t.push(this.buildItem(e)),t}.bind(this),[])},buildItem:function(t){var e=this.__self._getPrefs(t),i=this.__self._getType(t,e),n="html"===i||"bemjson"===i?{}:{type:i};return this._getItemByType(t,e,i,{text:{elem:"text",content:this.__self._highlight(this.__self._getText(t,e),e)},mods:n,js:e.js||{},props:{},content:[]})},_getItemByType:function(t,e,i,n){var s=n.text,o=n.mods,r=n.js,a=n.props,c=n.content;return e.pers&&(o.personal="yes"),e.url&&(o.interact="link",a.url=this.__self._resolveUrl(e.url),e.target&&(a.target=e.target)),e.search_cgi&&(r.searchCGI=e.search_cgi),0===c.length&&c.push(s),e.attrs&&(a.attrs=e.attrs),$.extend({block:"suggest2-item",mods:o,js:r,content:c},a)}},{_getPrefs:function(t){if(!Array.isArray(t))return{};var e=t[t.length-1];return $.isPlainObject(e)?e:{}},_getType:function(t,e){var i=Array.isArray(t)?t[0]||"text":"text";return"icon"!==i||e.icon?i:"text"},_getText:function(t){return Array.isArray(t)?t[1]:t},_highlight:function(t,e){if(!e.hl)return t;var i,n=e.hl.sort(function(t,e){return t[0]-e[0]}).filter(function(t){return t[0]>=0}),s=[],o=0;return n.length?(n.forEach(function(e){i=o>e[0]?o:e[0],s.push(t.slice(o,i)),s.push({elem:"highlight",content:t.slice(i,o=e[1])})},this),s.push(t.slice(o)),s.filter(function(t){return t})):t},_resolveUrl:function(t){return(/[\/]{2}/.test(t)?"":"http://")+t}}),BEM.decl("suggest2-view",{},{_getGroupType:function(t,e){return t.pers?"nah":-1!==["nav"].indexOf(e)?e:"text"},_getTextLabel:function(t){return BEM.I18N("suggest2",t)}}),BEM.decl("suggest2-view",{},{_getTextLabel:function(t){return"text"===t?BEM.blocks["i-global"].param("serviceName"):BEM.I18N("suggest2",t)}}),BEM.decl("suggest2-input",{onSetMod:{js:{inited:function(){var t=this;t._input=t.params.input,t.disableBrowserAutocomplete(),t.realVal(t.val()),t.bindEvents({change:function(e,i){t._onChange(e,i)},clear:$.throttle(function(e,i){t._onClear(e,i)},300)}),t.bindSuggestEvents()}}},_onChange:function(t,e){this.trigger("change",e)},_onClear:function(t,e){this.trigger("clear",e)},destruct:function(){this.unbindAllEvents(),this.__base.apply(this,arguments)},get:function(){return this._input},isFocused:function(){return this._input.hasMod("focused")},focus:function(){return this._input.setMod("focused","yes"),this},blur:function(){return this._input.delMod("focused"),this},getControl:function(){return this._input.elem("control")},val:function(t,e){return this._input.val.apply(this._input,arguments)},valWithoutSuggest:function(t,e){return this._input.val.call(this._input,t,$.extend(e,{suggest:!1}))},realVal:function(t){return void 0===t?this._realVal:("string"==typeof t&&(this._realVal=t),this._realVal)},width:function(){return this._input.domElem.width()},getCaretPosition:function(){var t,e=this.getControl()[0],i=this.val().length;return document.selection?(t=document.selection.createRange(),t.moveStart("character",-i),t.text.length):"number"==typeof e.selectionStart?e.selectionStart:i},moveCaretToEnd:function(){var t=this.getControl()[0],e=t.value.length;if("undefined"!=typeof t.createTextRange){var i=t.createTextRange();i.collapse(!1),i.select()}else"number"==typeof t.selectionStart&&(t.scrollLeft=999999,t.setSelectionRange(e,e));return this},disableBrowserAutocomplete:function(){this.getControl().attr({autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false","aria-autocomplete":"list"})},_bindedEventsNames:[],bindEvents:function(t,e){return Object.keys(t).forEach(function(i){-1===this._bindedEventsNames.indexOf(i)&&this._bindedEventsNames.push(i),this._eventsFilter(i).on(i,t[i].bind(e||this))},this),this},bindSuggestEvents:function(){var t=this.params.suggest;return t.on({out:function(t,e){this.a11yDeactive(),this._changeValueByEvent(t,e)}},this),BEM.blocks["suggest2-item"].on(t.domElem,{tpah:this._onSuggestItemTpah,select:this._onSuggestItemSelect,enter:this._onSuggestItemEnter},this),this},_onSuggestItemTpah:function(t,e){this._changeValueByEvent(t,e),this.moveCaretToEnd()},_onSuggestItemSelect:function(t,e){"link"!==t.block.getMod("interact")&&(this._changeValueByEvent(t,e),this.moveCaretToEnd())},_onSuggestItemEnter:function(t,e){this.a11yActive(e.id),e.byKeyboard&&this.params.updateOnEnterByKeyboard&&(this._changeValueByEvent(t,e),this.moveCaretToEnd())},unbindAllEvents:function(){return this._input.domElem&&this._bindedEventsNames.forEach(function(t){var e=this._eventsFilter(t);e[e instanceof BEM.DOM?"un":"off"](t)},this),this._bindedEventsNames=[],this.params.suggest.un("out"),this},a11yActive:function(t){this.getControl().attr("aria-activedescendant",t)},a11yDeactive:function(){this.getControl().removeAttr("aria-activedescendant")},_eventsFilter:function(t){var e=["blur","focus","change","clear"];return-1!==e.indexOf(t)?this._input:this.getControl()},_changeValueByEvent:function(t,e){var i=e&&void 0!==e.val?e.val:this.realVal();this.val(i,$.extend({block:t.block.__self.getName(),event:t.type},e))}}),BEM.decl("suggest2-input",{onSetMod:{js:{inited:function(){var t=this;t.__base.apply(this,arguments),t.bindEvents({keydown:function(e){t._onKeyDown(e)}},t)}}},_onKeyDown:function(t){t.which===this.params.suggest.__self.keyboard.enter&&this.trigger("enter")}}),BEM.DOM.decl("suggest2",{onSetMod:{disabled:{yes:function(){this._disabled=!0,this._clear(),this._popup.hide()},"":function(){this._disabled=!1,this.params.showPopupOnEnabled&&this._input.isFocused()&&this._doRequest()}}},getDefaultParams:function(){var t=this.__base.apply(this,arguments);return t.showPopupOnEnabled=!1,t},_onFocus:function(){this._disabled||this.__base.apply(this,arguments)},_onBlur:function(){this._disabled||this.__base.apply(this,arguments)},_doRequest:function(){this._disabled||this.__base.apply(this,arguments)},setItems:function(){this._disabled||this.__base.apply(this,arguments)}}),BEM.DOM.decl({block:"suggest2",modName:"disabled",modVal:"yes"},{_onKeyDown:function(){},_onKeyUp:function(){},_onKeyPress:function(){}}),BEM.DOM.decl({block:"suggest2",modName:"adaptive",modVal:"yes"},{init:function(){this.__base.apply(this,arguments),this._boundResizeHandler=this._resizeHandler.bind(this),this.__self._bindToWinResize(this._boundResizeHandler)},_resizeHandler:function(){this._popup.width(this.getPopupWidth())},destruct:function(){this.__self._unbindFromWinResize(this._boundResizeHandler),this._boundResizeHandler=null,this.__base.apply(this,arguments)}},{_resizeCallbacks:[],_bindToWinResize:function(t){return this._resizeCallbacks.push(t),this},_unbindFromWinResize:function(t){for(var e=0;e<this._resizeCallbacks.length;e++)if(this._resizeCallbacks[e]===t)return this._resizeCallbacks.splice(e,1),this;return this},_getResizeCallback:function(){return $.throttle(function(){var t=arguments;this._resizeCallbacks.forEach(function(e){e.apply(this,t)},this)},300,this)},live:function(){return this._resizeCallback=this._getResizeCallback(),BEM.DOM.win.on("resize",this._resizeCallback),this.__base()}}),BEM.DOM.decl({block:"suggest2",modName:"adaptive",modVal:"yes"},{_minWidth:0,_maxWidth:0,_resizeHandler:function(){this.__base.apply(this),this.hasMod("theme","large")&&this.afterCurrentEvent(function(){this.adjustView()})},_onShow:function(){this.__base.apply(this),this.hasMod("theme","large")&&this._applyMetricsToContent()},adjustView:function(){this.__base.apply(this,arguments);var t=this.getMetrics(),e=t.minWidth,i=t.maxWidth,n=!1;return e!==this._minWidth&&(this._minWidth=e,n=!0),i!==this._maxWidth&&(this._maxWidth=i,n=!0),n&&this._popup.isShown()&&this._applyMetricsToContent(),t},_applyMetricsToContent:function(){this.__base.apply(this,arguments);var t=this.findElem("content");this._minWidth&&t.css("min-width",this._minWidth),this._maxWidth&&t.css("max-width",this._maxWidth)}}),BEM.DOM.decl({block:"suggest2",modName:"theme",modVal:"large"},{_marginLeft:0,init:function(){this.__base.apply(this,arguments),this.adjustView()},initView:function(t,e){return t=t||{},this.__base($.extend(t,{theme:"large",group:"false"===this.getMod("group")?!1:t.group||this.getMod("group")||"type"}),e)},adjustView:function(){this.__base.apply(this,arguments);var t=this.getMetrics();this._view.setMarginLeft(t.marginLeft),this._view.setMinWidth(t.minWidth),this._view.setMaxWidth(t.maxWidth);var e=!1;t.marginLeft!==this._marginLeft&&(this._marginLeft=t.marginLeft,e=!0),e&&this._popup.isShown()&&this._applyMetricsToContent()},getInputLeft:function(){var t=this._input.get().findElem("control"),e=t.offset(),i=t[0];if(!i)return 0;var n=i.currentStyle?i.currentStyle:window.getComputedStyle(i),s=parseInt(n.borderLeftWidth,10)||0,o=parseInt(n.paddingLeft,10)||0;return e.left+s+o},getInputWidth:function(){return this._input.get().domElem.outerWidth()},getContainerWidth:function(){return BEM.DOM.scope.width()},_applyMetricsToContent:function(){this.__base.apply(this,arguments);var t=this.findElem("content");this._marginLeft&&t.css("margin-left",this._marginLeft)}}),BEM.DOM.decl({block:"suggest2",modName:"theme",modVal:"large"},{getInputWidth:function(){return this._input.get().elem("control").outerWidth()}}),BEM.decl({block:"suggest2-view",modName:"theme",modVal:"large"},{build:function(t,e){var i=this.__base.apply(this,arguments);return i.elemMods.theme="large",i}}),BEM.decl({block:"suggest2-view",modName:"theme",modVal:"large"},{getMinWidth:function(){return this._minWidth||0},getMaxWidth:function(){return this._maxWidth||0},setMinWidth:function(t){return this._minWidth=t,this},setMaxWidth:function(t){return this._maxWidth=t,this},getMarginLeft:function(){return this._marginLeft},setMarginLeft:function(t){return this._marginLeft=t,this},build:function(t,e){var i=this.__base.apply(this,arguments),n=["min-width:"+this.getMinWidth()+"px;"],s=this.getMaxWidth();s&&n.push("max-width:"+s+"px;");var o=this.getMarginLeft();return o&&n.push("margin-left:"+o+"px;"),i.attrs={style:n.join(" ")},i}}),BEM.decl({block:"suggest2-view",
modName:"group",modVal:"type"},{buildItems:function(t,e){var i,n;return t.reduce(function(t,e){var s=this.__self._getPrefs(e),o=this.__self._getType(e,s),r=this.__self._getGroupType(s,o);return i!==r&&(i=r,n=[],t.push({block:"suggest2",elem:"group",content:[{elem:"title",content:this.__self._getTextLabel(i)},{elem:"items",content:n}]})),n.push(this.buildItem(e)),t}.bind(this),[])}}),BEM.DOM.decl({block:"suggest2",modName:"group",modVal:"label"},{initView:function(t,e){return this.__base($.extend(t||{},{group:"label"}),$.extend(e||{},{label:this.params.label}))}}),BEM.decl({block:"suggest2-view",modName:"group",modVal:"label"},{buildItems:function(t,e){var i,n;return t.reduce(function(t,e,s){var o=this.__self._getPrefs(e).label||"";if(i!==o){i=o,n=[];var r;r=o?o:0===s?"":this.params.label||this.__self._getTextLabel("text"),t.push({block:"suggest2",elem:"group",content:[{elem:"title",content:r},{elem:"items",content:n}]})}return n.push(this.buildItem(e)),t}.bind(this),[])}}),BEM.decl({block:"suggest2-view",modName:"advanced",modVal:"yes"},{_getItemByType:function(t,e,i,n){var s=n.js,o=n.content;switch(i){case"html":s.val=t[1],o.push(e.body);break;case"bemjson":s.val=t[1],o.push.apply(o,Array.isArray(e.bemjson)?e.bemjson:[e.bemjson])}return this.__base.apply(this,arguments)}}),BEM.DOM.decl({block:"suggest2-item",modName:"interact",modVal:"link"},{onSelect:function(t){var e=this;e.__base.apply(e,arguments);var i=e.elem("link");return t||"_self"===i.attr("target")?function(){e._locationChange(i.attr("href"))}:void 0},_locationChange:function(t){window.location=t},valOnSelect:function(){return!1}}),BEM.DOM.decl("suggest2-form",{onSetMod:{js:{inited:function(){this._isReady=!1,this._nodes=this.initNodes()}}},getDefaultParams:function(){return{inputName:"input",buttonName:"button2",popupName:"popup"}},destruct:function(){this._nodes.forEach(function(t){t.suggest.domElem&&BEM.DOM.destruct(t.suggest.domElem),this.unbindFormEvents(t),t.counter&&t.counter.destruct(),t.proxies.input.destruct(),t.proxies.popup.destruct()},this),this.__base.apply(this,arguments)},getOwner:function(t){},isReady:function(){return this._isReady},initNodes:function(){var t=this.getNodes();return t.forEach(function(t){t.suggest.init()}),this._isReady=!0,this.trigger("ready",{nodes:t}),t},getNodes:function(){return this.getNodeList().map(function(t){var e=t.suggest,i=e.params;return i.form=this,i.input=t.input,i.popup=t.popup,i.button=t.button,t.proxies={},t.proxies.popup=i["suggest2-popup"]=BEM.create({block:"suggest2-popup",mods:$.extend({"for":this.params.popupName},this.params.popupMods)},this._getNodePopupParams(e,i)),t.proxies.input=i["suggest2-input"]=BEM.create({block:"suggest2-input",mods:this.params.inputMods},this._getNodeInputParams(e,i)),t.counter&&(t.counter.params.form=this,t.counter.params.suggest=e,i.counter=t.counter),this.bindFormEvents(t),t},this)},_getNodeInputParams:function(t,e){return{suggest:t,input:e.input,updateOnEnterByKeyboard:e.updateOnEnterByKeyboard}},_getNodePopupParams:function(t,e,i){return{suggest:t,popup:e.popup,popupContentElem:this.params.popupContentElem,owner:this.getOwner(i)||e.input}},bindFormEvents:function(t){var e=this;return t.button&&t.button.bindTo("pointerclick",function(t){e._onButtonClick(t)}),e.bindTo("submit",function(t,i){e.onSubmit(t,i)}),e},_onButtonClick:function(t){this.trigger("button-click",{domEvent:t})},unbindFormEvents:function(t){var e=this;return t.button&&t.button.unbindFrom("pointerclick"),e.unbindFrom("submit"),e},submit:function(t){return this.domElem.trigger("submit",t||{}),this},onSubmit:function(t,e){t.data=e||{},this.trigger("submit",t)},getNodeList:function(){var t=this,e=[];return t.elem("node").each(function(i,n){var s=$(n),o=t._getFormNodeElems(s);e.push(t._getFormNodeBlocks(o,s))}),e},_getFormNodeElems:function(t){return{input:this.findElem(t,"input"),button:this.findElem(t,"button2")}},_getSuggestForNode:function(t){return this.findBlockInside(t,"suggest2")},_getFormNodeBlocks:function(t,e){var i=this._getSuggestForNode(e);return{node:e,suggest:i,counter:this.findBlockOn("suggest2-counter"),input:this.findBlockOn(t.input,"input"),button:this.findBlockOn(t.button,this.params.buttonName),popup:i.findBlockOn(this.params.popupName)}},appendHiddenInputs:function(t){return BEM.DOM.append(this.domElem,BEMHTML.apply(t.map(function(t){return{block:this.__self.getName(),elem:"hidden-input",tag:"input",attrs:{type:"hidden",name:t.name,value:t.value}}},this))),this},removeHiddenInputs:function(){return BEM.DOM.destruct(this.findElem(this.domElem,"hidden-input")),this}},{live:function(){return this.liveInitOnBlockInsideEvent("pointerclick change focus","input"),this.__base()}}),BEM.DOM.decl("suggest2-form",{_getFormNodeElems:function(t){return{input:this.findElem(t,"input"),button:this.findElem(t,"button")}}},{}),BEM.DOM.decl("suggest2-counter",{pointerStartEvent:"pointerdown",onSetMod:{js:{inited:function(){this.clear()}}},destruct:function(){this.unbindAllEvents()},getDefaultParams:function(){return{submitBySelect:!1,suggestReqID:!1,preventSubmit:!0,host:"//yandex.ru",path:"clck/jclck",dataUrl:"http://ya.ru",params:{},timeout:300}},metaProps:{exprt:"exprt",r:"region",log:"log"},clear:function(){var t=this;return t._params={user_input:"",text:""},t._times=[],t._renderTimes=[],t._renderTime=0,t._path={service:t.params.service,state:"not_shown",index:0,personal:"nah_not_shown",submit:""},t._ratio={len:0,queryLen:0,actionsCount:0},t._firstChange=0,t._lastChange=0,t._sinceChange={first:0,last:0},t._selectedText="",t._session=0,t._reqID=0,t._meta={},t._afterSendAjaxCallback,t._startClickTime=null,t._startInputTime=null,t._requests=[],t._clicksCount=0,t},submit:function(t){var e=this,i=e.params.suggest.params["suggest2-input"],n=i.val();e._params.text=n,e._params.pos=i.getCaretPosition(),e._params.times=e._requests.map(function(t){return!t.error&&t.duration?t.duration:0}).join("."),e.params.suggestReqID&&e.attachReqID(),e.sendAjax(e.getUrl(),$.extend({submitForm:!0,afterSendAjaxCallback:function(){}},t)),e.trigger("submit",e._getSubmitEventData()).clear(),e._params.prev_query=n},_getSubmitEventData:function(){var t=this;return{path:t._path,times:t._times,render_times:t._params.times,prev_query:t._params.prev_query,user_input:t._params.user_input,text:t._params.text,pos:t._params.pos,ratio:t._ratio,since_first_change:t._sinceChange.first,since_last_change:t._sinceChange.last,session:t._session,suggest_reqid:t._reqID,meta:t._meta,url:t.getUrl()}},sendAjax:function(t,e){return $.ajax({type:"GET",url:t,dataType:"script",timeout:this._getAjaxTimeout()}).always(this._sendAjaxAlways.bind(this,e)),this},_getAjaxTimeout:function(){return this.params.timeout},afterSendAjax:function(t){return this._afterSendAjaxCallback=t,this},getUrl:function(){return this.params.host+["/",this.params.path].concat(this._getUrlParams()).join("/").replace(/(\/+)/g,"/")},_sendAjaxAlways:function(t){t||(t={}),this.params.preventSubmit&&t.submitForm&&this.params.form.submit({block:this.__self.getName(),prevent:!1}),t.afterSendAjaxCallback&&t.afterSendAjaxCallback(),this._afterSendAjaxCallback&&this._afterSendAjaxCallback()},_getUrlParams:function(){var t=this;return this._getParamsList().concat(t._getData()).reduce(function(e,i){return e.concat(t._getParams(i))},[]).concat(["/"])},_getParamsList:function(){var t=this;return[t.params.params,t._getPath(),t._params,t._getRatio(),t._getSinceChange(),t._getSession(),t._getResponsesShows(),{suggest_reqid:t._reqID}]},initValues:function(){return this._params.prev_query=this.params.suggest.params["suggest2-input"].val(),this},attachReqID:function(){this._reqID=this.__self._generateReqID(),this.params.form.appendHiddenInputs([{name:"suggest_reqid",value:this._reqID}])},bindEvents:function(){var t=this,e=t.params,i=e.suggest,n=e.form,s=i.getModel(),o=i.params["suggest2-input"],r=i.params["suggest2-popup"];return n.on({"button-click":t._onFormButtonClick,submit:t._onFormSubmit},t),s.on({request:t._onModelRequest,response:t._onModelResponse},t),o.on({change:t._onInputChange,enter:t._onInputEnter},t),r.on({show:t._onPopupShow},t),BEM.blocks["suggest2-item"].on(i.domElem,"enter",t._onSuggestItemEnter,t),i.on({update:t._onSuggestUpdate,select:t._onSuggestSelect},t),t._input=o._input,t._input.bindTo(t.pointerStartEvent,t._onInputClick.bind(t)).on("focus",t._onInputFocus,t),t._input.findElem("control").on("blur",t._onInputBlur.bind(t)),t},_onInputClick:function(){this._startInputTime||(this._startClickTime=Date.now())},_onClickPopup:function(){this._clicksCount++},_onInputFocus:function(){this._timeoutInputTime&&clearTimeout(this._timeoutInputTime),this._startInputTime=this._startClickTime},_onInputBlur:function(t){this._timeoutInputTime=setTimeout(function(){this._startClickTime=null,this._startInputTime=null}.bind(this),300)},_onFormButtonClick:function(){"keyboard"!==this._path.submit&&(this._path.submit="button_by_mouse")},_onFormSubmit:function(t,e){e.data.block!==this.__self.getName()&&e.data.prevent!==!1&&(this.params.preventSubmit&&(e.stopImmediatePropagation(),e.preventDefault()),this._doSubmit())},_doSubmit:function(){this.submit()},_onModelRequest:function(t,e){this._requests.push(e.request)},_onModelResponse:function(t,e){if(Object(e.data).items){var i=e.data.items;this._path.personal=this._hasPersonal(i)?"nah_not_used":"nah_not_shown",this._meta=e.data.meta||{},this._renderTime=new Date,this._setMetaProps(e),this._requests[e.val.toLowerCase()]=void 0}},_onInputChange:function(t,e){e&&"clear"!==e.source||(this._params.user_input=t.block.val(),this[this._firstChange?"_lastChange":"_firstChange"]=new Date,this._startInputTime||(this._startInputTime=this._firstChange.getTime())),this._selectedText&&(this._path.state="edit"),this._ratio.actionsCount++},_onInputEnter:function(){this._path.submit="keyboard"},_onPopupShow:function(){"not_shown"===this._path.state&&(this._path.state="not_used")},_onSuggestItemEnter:function(t,e){e.byKeyboard&&this.params.suggest.params.updateOnEnterByKeyboard&&(this._selectedText=e.val,this._path.state="suggest")},_onSuggestUpdate:function(){this._addRenderTime(new Date-this._renderTime)},_onSuggestSelect:function(t,e){var i=this;i._path.state=e.byKeyboard?"keyboard":"mouse",i._path.index=e.itemIndex+1,i._selectedText=e.val,e.item.hasMod("personal")&&(i._path.personal="nah_used"),i.params.submitBySelect&&(i._path.submit=e.byKeyboard?"keyboard":"click_by_mouse",i._params.pos=e.pos,i._params.text=this._selectedText),i.params.suggest.isNeedSubmitFormOnSelectItem(e.item)||i.submit({submitForm:!1,afterSendAjaxCallback:e.callbackOnSelect})},unbindAllEvents:function(){var t=this.params,e=t.suggest,i=t.form,n=e.params["suggest2-popup"];return i.un("button-click").un("submit"),e.getModel().un("request").un("response"),e.params["suggest2-input"].un("change").un("enter"),n.un("show").un("hide"),e.un("select"),this},_hasPersonal:function(t){return t.some(function(t){return 1===BEM.blocks["suggest2-view"]._getPrefs(t).pers})},_setMetaProps:function(t){t.data.meta&&Object.keys(this.metaProps).forEach(function(e){this._params[this.metaProps[e]]=t.data.meta[e]||""},this)},_getParams:function(t){return Object.keys(t).reduce(function(e,i){return""===t[i]?e:(e.push(i+"="+encodeURIComponent(t[i]).replace(/%5B/g,"[").replace(/%5D/g,"]").replace(/%2C/g,",")),e)},[])},_getPath:function(){return{path:[this._path.service,this._path.state,"p"+this._path.index,this._path.personal,this._path.submit].join(".")}},_getSession:function(){return this._session=(new Date).getTime()+Math.round(1e4*Math.random()),{session:this._session}},_getSinceChange:function(){var t=this._getSinceTime("first"),e=this._startInputTime&&Date.now()-this._startInputTime||0;return{since_first_change:t,since_last_change:this._getSinceTime("last"),total_input_time:e}},_getSinceTime:function(t){var e="_"+t+"Change";return this._sinceChange[t]=this[e]?(new Date).getTime()-this[e]:0,this._sinceChange[t]},_getResponsesShows:function(){return this._requests.reduce(function(t,e){return t.rqs++,e.error||(e.responseTime&&t.rsp++,0===e.itemsCount&&t.ersp++,e.fromCache&&t.cchd++),t},{rqs:0,rsp:0,rnd:this._renderTimes.length,ersp:0,clks:this._clicksCount,cchd:0})},_getRatio:function(){return this._ratio.len=this._params.user_input.length,this._ratio.queryLen=this._params.text.length,{ratio:[this._ratio.len,this._ratio.queryLen,this._ratio.actionsCount].join(".")}},_addRenderTime:function(t){return this._renderTimes.push(t),this._params.render_times=this._renderTimes.join("."),this},_getData:function(){return{"*data":"url="+this.params.dataUrl}}},{_generateReqID:function(){var t=BEM.blocks["i-global"]&&BEM.blocks["i-global"].param("yandexuid")?BEM.blocks["i-global"].param("yandexuid"):this._random(9)+this._random(9);return t+String(Date.now()).slice(-7)+this._random(7)},_random:function(t){return Math.random().toString().slice(-Math.min(t,10))}},{live:function(){this.liveInitOnBlockEvent("init","suggest2-form")}}),BEM.DOM.decl("suggest2-counter",{bindEvents:function(){this.__base.apply(this,arguments);var t=this.params.suggest;BEM.blocks["suggest2-item"].on(t.domElem,"pointerclick",this._onClickPopup.bind(this))}}),BEM.DOM.decl("suggest2-counter",{_onModelResponse:function(t,e){if(Object(e.data).items){var i=e.data.items;this._path.personal=this._hasPersonal(i)?"nah_not_used":"nah_not_shown",this._meta=e.data.meta||{},this._renderTime=new Date,this._setMetaProps(e),this._requests&&delete this._requests[e.val.toLowerCase()]}},bindEvents:function(){return BEM.blocks["b-page"].on("beforeContentLoad",this._onAjaxRequest,this),this.__base.apply(this,arguments)},_doSubmit:function(){this._formSubmit=!0},_onAjaxRequest:function(){this._formSubmit&&"not_shown"!==this._path.state&&(this._formSubmit=!1,this.submit())},unbindAllEvents:function(){return this.__base.apply(this,arguments),BEM.blocks["b-page"].un("beforeContentLoad",this._onAjaxRequest),this}},{live:function(){return this.liveInitOnBlockEvent("init","suggest2-form"),this.__base()}}),BEM.DOM.decl("suggest2-counter",{_onFormSubmit:function(t,e){e.data&&e.data.notSendCounter||this.__base.apply(this,arguments)}}),BEM.decl({block:"suggest2-popup",modName:"for",modVal:"popup2"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._popup.on("beforeClose",function(){this.afterCurrentEvent(function(){BEM.blocks["suggest2-detect"].isPressedEscape()&&this.trigger("hide",{})})},this)}}},_setPosition:function(){this._popup.setAnchor(this.params.owner),this._popup.setMod("visible","yes")},hide:function(t){return this.isShown()&&(this._popup.delMod("visible"),this.trigger("hide",t||{})),this},isShown:function(){return this._popup?this._popup.hasMod("visible"):!1}}),BEM.DOM.decl({block:"popup2",modName:"fixed",modVal:"yes"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._anchor=null,this._lastDrawingCss={left:void 0,top:void 0}}},visible:{yes:function(){if(!this._anchor)throw new Error("Can't show popup without anchor");this.setMod("outside","yes").redraw().delMod("outside"),this.__base.apply(this,arguments)}}},show:function(t){return this.setAnchor(t).setMod("visible","yes")},hide:function(){return this.delMod("visible")},setAnchor:function(t){return this._anchor=t instanceof BEM.DOM?t.domElem:t,this},redraw:function(){if(!this.hasMod("visible","yes")&&!this.hasMod("outside","yes"))return this;var t=this._lastDrawingCss,e=!1;return $.each(this._calcDrawingParams(),function(i,n){t[i]!==n&&(t[i]=n,e=!0)}),e&&this.domElem.css(t),this},_calcDrawingParams:function(){var t=this._calcAnchorDimensions();return{left:t.left,top:t.top+t.height}},_calcAnchorDimensions:function(){var t=this._anchor,e=t.offset(),i=BEM.DOM.win;return{left:e.left-i.scrollLeft(),top:e.top-i.scrollTop(),width:t.outerWidth(),height:t.outerHeight()}},_calcZIndexGroupLevel:function(){var t=this.__base.apply(this,arguments);return this.findBlocksOutside(this._anchor,"z-index-group").reduce(function(t,e){return t+Number(e.getMod("level"))},t)}}),BEM.DOM.decl({block:"search2",modName:"cbir",modVal:"yes"},{_onSubmit:function(t,e){this.trigger("search:submit",{event:t,data:e}),t.preventDefault()},getErrorTargetDomElem:function(){return this.elem("input")}}),BEM.DOM.decl("cbir-logo",{_onClick:function(){this.trigger("showPanel")}},{live:function(){this.liveBindTo("pointerclick",function(t){this._onClick(t)})}}),BEM.DOM.decl("tooltip",{onSetMod:{js:{inited:function(){this._popup=null,this._owner=null}},shown:{yes:function(){this._getPopup().setMod("visible","yes").unbindFromDoc("keydown")},"":function(){this._getPopup().delMod("visible")}}},getOwner:function(){return this._owner},setOwner:function(t){return this._owner=t,this._getPopup().setAnchor(t),this},setContent:function(t){return BEM.DOM.update(this.elem("content"),t),this.redraw()},redraw:function(){return this.hasMod("shown","yes")&&this._getPopup().redraw(),this},destruct:function(){this.delMod("shown"),this.__base.apply(this,arguments)},_getPopup:function(){return this._popup||(this._popup=this.findBlockOn("popup2").on("beforeOpen",this._onPopupShow,this).on("beforeClose",this._onPopupHide,this)),this._popup},_onPopupShow:function(){this.trigger("show")},_onPopupHide:function(){this.delMod("shown").trigger("hide")},_onClick:function(){this.trigger("click").delMod("shown")}},{live:function(){this.liveBindTo("click",function(){this._onClick()})}}),BEM.DOM.decl("tooltip",{_onEnter:function(){this.setMod("hovered","yes")},_onLeave:function(){this.delMod("hovered")}},{live:function(){return this.liveBindTo("pointerover pointerout",function(t){this.domElem[0].contains(t.relatedTarget)||("pointerover"===t.type?this._onEnter(t):this._onLeave(t))}),this.__base()}}),BEM.DOM.decl("tooltip",{syncVisible:function(){this.getOwner()&&this.hasMod("shown","yes")&&this._getPopup().syncVisible()}}),BEM.DOM.decl("tooltip",{show:function(){return this.setMod("shown","yes")},hide:function(){return this.delMod("shown")}}),BEM.DOM.decl("cbir-panel",{onSetMod:{js:function(){this.detectDragDrop()&&this.setMod("dragdrop","yes"),this.findBlocks().bindEvents()}},detectDragDrop:function(){var t=$("<div />")[0];return("draggable"in t||"ondragstart"in t&&"ondrop"in t)&&!window.opera&&(!BEM.blocks["i-ua"].ie||BEM.blocks["i-ua"].ie>=10)},findBlocks:function(){return this.file=this.elem("file-input"),this.input=this.findBlockInside({block:"input",modName:"type",modVal:"cbir"}),this},bindEvents:function(){return this.bindTo("find-button","pointerclick",this._onFindButtonClick).bindTo(this.file,"change",this._onFileChange).bindTo("input","pointerclick",this._onInputBoxClick).bindTo("input","submit",this._onFormSubmit).bindTo("close","keypress",this._onCloseKeyboard).bindTo("close","pointerclick",this._onCloseClick).bindTo("input","keydown",this._onInputChange),this.input.on("clear change",this._onValueChange,this),BEM.blocks["i-keyrouter"].on("esc",this.hidePanel,this),this.bindToDoc("pointerclick",this._onOutsideClick),BEM.blocks["b-page"].on("contentLoaded",this.hidePanel,this),this},destruct:function(){BEM.blocks["i-keyrouter"].un("esc",this.hidePanel,this),this.unbindFromDoc("pointerclick",this._onOutsideClick),this.input.un("clear change",this._onValueChange,this),BEM.blocks["b-page"].un("contentLoaded",this.hidePanel,this),this.__base.apply(this,arguments)},getController:function(){return BEM.blocks["i-cbir-controller"].get()},_onFindButtonClick:function(){this.getController().submit()},_onCloseClick:function(){this.hidePanel()},_onCloseKeyboard:function(t){13!==t.which&&32!==t.which||(t.preventDefault(),this.hidePanel())},_onInputBoxClick:function(){this.input.setFocus()},_onFormSubmit:function(t){t.preventDefault(),this.getController().submit()},_onOutsideClick:function(t){this.hasMod("visibility","visible")&&(this.containsDomElem($(t.target))||this.hidePanel())},_onInputChange:function(t){switch(t.keyCode){case 13:this.getController().submit();break;case 27:this.hidePanel()}},_onValueChange:function(t){var e=this.blockInside({block:"button",modName:"type",modVal:"cbir"});e.toggleMod("disabled","yes",!t.block.val()||"clear"===t.type)},_onFileChange:function(t){this.trigger("filechange",t)},showPanel:function(t){var e=this;return this.getController().runCBIRRequest().showParanja(),this.domElem.fadeIn(250,function(){e.setMod("visibility","visible")}),t&&this.input.setFocus(),this.getController().pane2Api.hide(),this},hidePanel:function(){if(!this.hasMod("visibility","visible"))return this;var t=this;return this.getController().cancelCBIRRequest().hideParanja(),this.input.val(""),this.delMod("opened"),this.domElem.fadeOut(250,function(){t.setMod("visibility","hidden")}),this._isPopupShowedByCode=!1,this.getController().hideError(),this.getController().pane2Api.show(),this},clearFileInput:function(){return BEM.blocks["i-ua"].ie?setTimeout(function(){this.file.replaceWith(this.file=this.file.clone(!0))}.bind(this),100):this.file.val(""),this},val:function(){return this.input.val()},setThreateningLook:function(){this.setMod(this.elem("input"),"error","yes")},unsetThreateningLook:function(){this.delMod(this.elem("input"),"error")},getErrorTargetDomElem:function(t){return"url"===t?this.elem("input"):this.elem("dragzone")},isDragSupported:function(){return this.hasMod("dragdrop","yes")}},{live:!0}),BEM.DOM.decl({block:"cbir-panel",modName:"dragdrop",modVal:"yes"},{bindEvents:function(){return this.__base.apply(this,arguments),this.bindToDoc("dragover dragend",this.processDragEvent),this.bindToDomElem(this.elem("dragzone"),{"dragenter dragover dragleave":this._onDrag,drop:this._onDrop}),this._onImageDragStart=this._onImageDragStart.bind(this),this.bindedDragendHack=this.dragendHack.bind(this),$("body").on("dragstart",this._onImageDragStart),this},destruct:function(){this.unbindFromDoc("dragover dragend",this.processDragEvent),this.unbindFromDoc({dragover:this._onDragOver,dragend:this._onDragEnd}),$("body").off("dragstart",this._onImageDragStart),this.__base.apply(this,arguments)},processDragEvent:function(t){switch(t.type){case"dragover":return this.showPanelOnDrag(t);case"dragstart":return this.processImageDragStartEvent(t)}},processImageDragStartEvent:function(t){var e,i=t.originalEvent.dataTransfer,n=$(t.target);return n.is("img")||(n=n.find("img:eq(0)")),n.length?(this.hasMod("visibility","visible")&&this.setMod("opened","yes"),void(i&&(e=n.attr("src"),e.indexOf("//")||(e=location.protocol+e),i.setData("text",e)))):!1},_onImageDragStart:function(t){return this.processImageDragStartEvent(t)},_onDrag:function(t){return this.toggleStroke("dragleave"!==t.type),!1},_onDrop:function(t){this._isPopupShowedByCode=!1,this.toggleStroke(!1).uninstallDragendHack(),this.getController().hideError();var e,i,n=t.originalEvent.dataTransfer,s=n.files[0];try{e=n.getData("text"),i=this.extractImageFromHtml(n.getData("text/html"))}catch(o){}return s?this.getController().tryUploadFile(s):i?this.getController().tryUploadURL(i):e&&this.getController().tryUploadURL(e),!1},showPanelOnDrag:function(){this.hasMod("visibility","visible")||(this._isPopupShowedByCode=!0,this.showPanel().uninstallDragendHack().installDragendHack())},installDragendHack:function(){return $("body").one("mousemove",this.bindedDragendHack),this},uninstallDragendHack:function(){return $("body").unbind("mousemove",this.bindedDragendHack),this},dragendHack:function(){return setTimeout(function(){this._isPopupShowedByCode&&this.hideUploaderAfterDrag()}.bind(this),42),!1},hideUploaderAfterDrag:function(t){return this.hasMod("opened","yes")&&"none"===t.originalEvent.dataTransfer.dropEffect?!1:(this.uninstallDragendHack().hidePanel(),this)},toggleStroke:function(t){return this.setMod(this.elem("wrap"),"hover",t?"yes":""),this},extractImageFromHtml:function(t){var e=t.match(/<img.*?src=['"](.+?)['"]/i);return e&&e[1]}}),BEM.DOM.decl("i-cbir-controller",{onSetMod:{js:function(){this.findBlocks().bindEvents()}},findBlocks:function(){return this.cbirPanel=this.findBlockInside("cbir-panel"),this.cbirError=this.findBlockInside("cbir-error"),this.cbirIntent=this.findBlockInside("cbir-intent"),this.pane2Api=this.findBlockInside("pane2-api"),this.search=BEM.blocks.header.getSearch(),this.layout=this.findBlockInside("page-layout"),this.paranja=this.findBlockInside("paranja"),this._location=BEM.blocks.location.getInstance(),this},bindEvents:function(){return BEM.blocks["b-page"].on("change",this._onPageChange,this),BEM.blocks["cbir-logo"].on("showPanel",this._onLogoClick,this),BEM.blocks.input.on("cbir:click",this._onLogoClick,this),BEM.blocks["cbir-error"].on("showParanja",this.showParanja,this).on("hideParanja",this.hideParanja,this),this},unbindEvents:function(){return BEM.blocks["b-page"].un("change",this._onPageChange,this),BEM.blocks["cbir-logo"].un("showPanel",this._onLogoClick,this),BEM.blocks.input.un("cbir:click",this._onLogoClick,this),BEM.blocks["cbir-error"].un("showParanja",this.showParanja,this).un("hideParanja",this.hideParanja,this),this},destruct:function(){this.unbindEvents(),this.__base.apply(this,arguments)},_onPageChange:function(){var t=this._location.getState().block,e=["b-page_type_search-by-image","b-page_type_similar"];"b-page_type_search-by-image"===t||this.setCachedUrl(""),_.includes(e,t)||this.clearIntent()},_onLogoClick:function(){this.showPanel(!BEM.blocks["i-global"].param("mobile"))},showError:function(t){return this.getRequestStatus()?this.cbirError.showError(t,this.cbirPanel):this.cbirError.showError(t,this.search),this},hideError:function(){return this.cbirError.hideError(),this},showPanel:function(t){return this.cbirPanel.showPanel(t),this},hidePanel:function(){return this.cbirPanel.hidePanel(),this},getRequestStatus:function(){return this.__self.getRequestStatus()},setRequestStatus:function(t){return this.__self.setRequestStatus(Boolean(t)),this},cancelCBIRRequest:function(){return this.setRequestStatus(!1),this},runCBIRRequest:function(){return this.setRequestStatus(!0),this},clearIntent:function(){return this.cbirIntent.clearThumb(),this},showLoader:function(){return this.cbirIntent.makeIntentLoading(),this},hideLoader:function(){return this.cbirIntent.makeIntentNormal(),this},showParanja:function(){return this.layout.toggleCBIRMode(!0),this.paranja.setTheme("dark").open(),this},hideParanja:function(){return this.layout.toggleCBIRMode(!1),this.paranja.delTheme().close(),this}},{live:!0,_instance:null,getRequestStatus:function(){return this.isRequestRunning},setRequestStatus:function(t){this.isRequestRunning=Boolean(t)},get:function(){return this._instance||(this._instance=$(this.buildSelector()).bem(this.getName()))}}),BEM.decl("i-cbir-controller",{validateFile:function(t){return this.isValidFile(t)?this.isValidFileSize(t)?!0:(this.showError("size"),!1):(this.showError("format"),!1)},isValidFile:function(t){return t&&/image.*/.test(t.type)},isValidFileSize:function(t){var e=BEM.blocks["i-global"].getFlag("images_cbir_upload_max_size"),i="number"==typeof e?e:8;return t.size<=1024*i*1024},validateURL:function(t){return t.indexOf("http")&&(t="http://"+t),BEM.blocks.uri.isAcceptable(t)}}),function(){var t;BEM.decl("i-cbir-controller",{setCachedUrl:function(e){t=e},checkCachedUrl:function(e){return t===e}})}(),BEM.decl("i-cbir-controller",{linkBlockName:"b-page_type_search-by-image__link",queryArgs:{rpt:"imageview"},_makeUrl:function(t){return BEM.blocks.uri.buildRelativeUrl(BEM.blocks["i-global"].param("router").search,BEM.blocks["i-url-controller"].mergePassedUrlParams(BEM.blocks["serp-controller"].getUrlRequestParams(),this.queryArgs,{format:"json",request:JSON.stringify({blocks:[{block:this.linkBlockName}]})},t))},uploadFileNormal:function(t){var e=new FormData;return this.setRequestStatus(!0),e.append("upfile",t),this.fade(),this.showLoader(),$.ajax({type:"post",url:this._makeUrl(),data:e,dataType:"json",context:this,cache:!1,contentType:!1,processData:!1,success:this._onSuccess.bind(this),error:this.showUploadError.bind(this)}),this},_onSuccess:function(t){var e=this._retrieveUrlParams(t);e?(this._hitCounter(),this._loadCbirPage(e)):this.showUploadError()},_retrieveUrlParams:function(t){return _.get(t,"blocks.0.params.url")},_hitCounter:function(){BEM.blocks["b-statcounter"].hit({params:{query:{cbir:"file"}}})},uploadFileFrame:function(t){return this.fade(),this.showLoader(),BEM.create("i-request_type_ajax",{url:this._makeUrl()+"&from=cbirFrame",type:"iframe",dataType:"html",file:t.target,cache:!1,paramsToSettings:["file","cache"],callbackCtx:this}).get({},function(){this._frameSuccess(arguments[2])},function(){this._frameError()}),this},_frameSuccess:function(t){var e;try{e=$(t.statusText).text()}catch(i){}e?(BEM.blocks["b-statcounter"].hit({params:{query:{cbir:"file"}}}),this._loadCbirPage(e)):this.showUploadError()},_frameError:function(){this.showUploadError()},uploadURL:function(t){var e=this;-1===t.indexOf("://")&&(t=location.protocol+"//"+t),this.fade().checkImageAccessibility(t).done(function(t){e.setRequestStatus(!0).showLoader().setCachedUrl(t),BEM.blocks["b-statcounter"].hit({params:{query:{cbir:"url"}}}),BEM.blocks.location.getInstance().change({block:"b-page_type_search-by-image",url:BEM.blocks.uri.buildRelativeUrl(BEM.blocks["i-global"].param("router").search,_.assign({url:t},e.queryArgs))})}).fail(function(){e.showError("url").unfade()})},checkImageAccessibility:function(t){var e,i=$.Deferred(),n=!1,s=new Image;return s.onload=function(){n||(clearTimeout(e),n=!0,i.resolve(t))},s.onerror=function(){n=!0,clearTimeout(e),i.reject()},e=setTimeout(s.onerror,3e5),s.src=t,s.complete&&s.onload(),i.promise()},tryUploadURL:function(t){if(t)if(this.validateURL(t)){if(this.checkCachedUrl(t))return;this.uploadURL(t)}else this.showError("url")},tryUploadFile:function(t){this.validateFile(t)?this.uploadFileNormal(t):this.clearFileInput()}}),BEM.decl("i-cbir-controller",{bindEvents:function(){return this.__base.apply(this,arguments),this.search.on("search:submit",this._onSearchSubmit,this),this},unbindEvents:function(){return this.__base.apply(this,arguments),this.search.un("search:submit",this._onSearchSubmit,this),this},_onSearchSubmit:function(t,e){this.processSubmitEvent(e.event,e.data)},processSubmitEvent:function(t,e){this.submit()!==!1&&(this.search.submit(t,e),this.search.countSubmit())},submit:function(){if(this.isCBIRRequest()||this.isExcessSearch()){var t=this.getURL();return""===t||this.tryUploadURL(t),!1}return!0},isCBIRRequest:function(){return this.getRequestStatus()},getURL:function(){return this.isCBIRRequest()?this.cbirPanel.val():this.search.val()},isExcessSearch:function(){return""===this.getURL()&&"b-page_type_search-by-image"===this._location.getState().block}}),BEM.decl("i-cbir-controller",{fade:function(){return this.trigger("fade"),this},unfade:function(){return this.trigger("unfade"),this}}),BEM.DOM.decl("i-cbir-controller",{bindEvents:function(){return this.cbirPanel.on("filechange",this._onFileChange,this),this.__base.apply(this,arguments)},unbindEvents:function(){return this.cbirPanel.un("filechange",this._onFileChange,this),this.__base.apply(this,arguments)},_onFileChange:function(t,e){var i=this.getFile(e);-1!==i&&(i?this.tryUploadFile(i):this.uploadFileFrame(e))},getFile:function(t){var e,i,n;if(t){if(t.target&&(i=t.target.files),t.dataTransfer&&(n=t.dataTransfer.files),i)return i.length?i[0]:-1;if(n)return n[0]}else if(e=this.cbirPanel.fileInput,e&&(i=e.get(0).files),i)return i[0]},clearFileInput:function(){return this.cbirPanel.clearFileInput(),this}}),BEM.DOM.decl("i-cbir-controller",{_loadCbirPage:function(t){var e=this._buildFullUrl(t);this.clearFileInput().hideLoader(),this._isRepeatedRequest(e)?this.unfade().hidePanel():(this.setCachedUrl(""),this._location.change({block:"b-page_type_search-by-image",url:e}))},_buildFullUrl:function(t){var e=BEM.blocks["i-global"].param("router").search,i=e+"?"+t;return BEM.blocks.uri.setParams(i,{rpt:"imageview",from:""})},_isRepeatedRequest:function(t){var e=BEM.blocks.uri.getParamValue(t,"cbir_id"),i=BEM.blocks.uri.getParamValue("cbir_id");return e===i},showUploadError:function(){
this.hideLoader().showError("upload").unfade()}}),BEM.decl("downscale",{resize:function(t,e,i){var n=window.URL?window.URL:window.webkitURL,s=n.createObjectURL(t);return this._loadImage(s).then(this._getOrientation.bind(this,t)).then(this._putImageOnCanvas.bind(this)).then(this._resizeImage.bind(this,e,i)).always(n.revokeObjectURL.bind(this,s))},canvasToBlob:function(t,e,i){var n=$.Deferred();try{i.toBlob(n.resolve,t,e)}catch(s){n.reject(s)}return n.promise()},shouldEnable:function(){var t=window.URL||window.webkitURL,e=BEM.blocks["i-ua"].ios,i=BEM.blocks["i-ua"].android;return t&&t.createObjectURL?e&&parseFloat(e)<7.1?!1:!(i&&parseFloat(i)<4.4):!1},_getOrientation:function(t,e){var i,n=$.Deferred(),s=new FileReader;return s.onload=function(t){if(i=new DataView(t.target.result),65496!==i.getUint16(0,!1))return n.resolve(e,-2);for(var s,o,r,a=i.byteLength,c=2;a>c;)if(s=i.getUint16(c,!1),c+=2,65505===s){o=18761===i.getUint16(c+=8,!1),c+=i.getUint32(c+4,o),r=i.getUint16(c,o),c+=2;for(var h=0;r>h;h++)if(274===i.getUint16(c+12*h,o))return n.resolve(e,i.getUint16(c+12*h+8,o))}else{if(65280!==(65280&s))break;c+=i.getUint16(c,!1)}return n.resolve(e,-1)},s.error=n.reject,s.readAsArrayBuffer(t[File.prototype.webkitSlice?"webkitSlice":"slice"](0,65536)),n.promise()},_putImageOnCanvas:function(t,e){var i=this._getSizeByOrientation(t,e),n=this._getMaxSize(i),s=i.transform,o=document.createElement("canvas"),r=o.getContext("2d");return o.width=n.width,o.height=n.height,"left"===s?(r.setTransform(0,-1,1,0,0,n.height),r.drawImage(t,0,0,n.height,n.width)):"right"===s?(r.setTransform(0,1,-1,0,n.width,0),r.drawImage(t,0,0,n.height,n.width)):"flip"===s?(r.setTransform(-1,0,0,-1,n.width,n.height),r.drawImage(t,0,0,n.width,n.height)):(r.setTransform(1,0,0,1,0,0),r.drawImage(t,0,0,n.width,n.height)),o},_getMaxSize:function(t){var e,i,n=5e6,s=4096,o=t.width/t.height,r={};return t.width*t.height>n?t.width>t.height?(e=Math.sqrt(n*o),r={width:Math.floor(e),height:Math.floor(n/e)}):(i=Math.sqrt(n/o),r={width:Math.floor(n/i),height:Math.floor(i)}):r=t,r.width>s&&(r.width=s,r.height=Math.round(r.width/o)),r.height>s&&(r.height=s,r.width=Math.round(o*r.height)),r},_getSizeByOrientation:function(t,e){var i,n,s="none";return 8===e?(i=t.height,n=t.width,s="left"):6===e?(i=t.height,n=t.width,s="right"):3===e?(i=t.width,n=t.height,s="flip"):1===e?(i=t.width,n=t.height):(i=t.width,n=t.height),{width:i,height:n,transform:s}},_resizeImage:function(t,e,i){var n=i.width/i.height,s=$.Deferred();return t>e?e=Math.round(t/n):t=Math.round(e*n),this.shouldResizeImage(i,t,e)?(this._initResize(i.width,t,e),this._stepResize(i,t,e,s.resolve.bind(s)),s.promise()):s.resolve(i)},shouldResizeImage:function(t,e,i){return t.width>e&&t.height>i},_initResize:function(t,e,i){this._steps=Math.ceil(Math.log(t/e)/Math.LN2),this._currentWidth=e*Math.pow(2,this._steps-1),this._currentHeight=i*Math.pow(2,this._steps-1)},_stepResize:function(t,e,i,n){return this._steps&&this.shouldResizeImage(t,e,i)?void this.afterCurrentEvent(this._stepResizeDelay.bind(this,t,e,i,n)):void n(t)},_stepResizeDelay:function(t,e,i,n){var s=document.createElement("canvas");s.width=this._currentWidth,s.height=this._currentHeight,s.getContext("2d").drawImage(t,0,0,this._currentWidth,this._currentHeight),t.width=1,t.height=1,t=s,this._currentWidth=Math.round(this._currentWidth/2),this._currentHeight=Math.round(this._currentHeight/2),--this._steps,this._stepResize(t,e,i,n)},_loadImage:function(t){var e=$.Deferred(),i=new Image;return i.onload=e.resolve.bind(this,i),i.onerror=e.reject.bind(this,i),i.src=t,e.promise()}}),HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,i){for(var n=atob(this.toDataURL(e,i).split(",")[1]),s=n.length,o=new Uint8Array(s),r=0;s>r;r++)o[r]=n.charCodeAt(r);t(new Blob([o],{type:e||"image/jpeg"}))}}),BEM.DOM.decl("cbir-error",{onSetMod:{js:function(){this.setTexts().findBlocks().bindEvents(),this.params.searchError&&(this.afterCurrentEvent(this.showSearchError),BEM.blocks.location.getInstance().change({url:BEM.blocks.uri.delParams(["cbirerror"]),history:!1,trigger:!1}))}},findBlocks:function(){return this.popupUser=this.findBlockOn(this.elem("popup","type","user"),"popup"),this.popupSearch=this.findBlockOn(this.elem("popup","type","search"),"popup"),this.popupSearch&&(this.closeSearchErrorButton=this.findBlockOn(this.elem("close-error-button"),"button")),this},bindEvents:function(){this.popupUser.on("hide",this._onUserPopupHide,this),this.popupSearch&&(this.popupSearch.on("hide",this._onSearchPopupHide,this),this.closeSearchErrorButton.on("click",this._onCloseErrorClick,this))},destruct:function(){this.popupUser.un("hide",this._onUserPopupHide,this).destruct(),this.popupSearch&&(this.closeSearchErrorButton.un("click",this._onCloseErrorClick,this),this.popupSearch.un("hide",this._onSearchPopupHide,this).destruct()),this.__base.apply(this,arguments)},setTexts:function(){return this.errorTexts={size:BEM.I18N("cbir-error_spok_yes","  ,    ."),format:BEM.I18N("cbir-error_spok_yes","   .    ."),upload:BEM.I18N("cbir-error_spok_yes","  ,   ."),url:BEM.I18N("cbir-error_spok_yes","      ,    .")},this},_onCloseErrorClick:function(){this.popupSearch.hide()},_onUserPopupHide:function(){this.delMod(this.elem("input"),"error"),this.hidePopupTimeout&&(clearTimeout(this.hidePopupTimeout),this.hidePopupTimeout=null)},_onSearchPopupHide:function(){this.trigger("hideParanja")},hideError:function(){return this.popupUser.hide(),this.popupSearch&&this.popupSearch.hide(),this._lastErrorTager&&(this._lastErrorTager.unsetThreateningLook(),this._lastErrorTager=null),this},showSearchError:function(){return this.popupSearch.show(),this.trigger("showParanja"),this},showError:function(t,e){var i=this.errorTexts[t],n=this;return i?(this.popupUser.elem("error-text").text(i),"url"===t&&e.setThreateningLook&&(this._lastErrorTager=e,e.setThreateningLook()),this.popupUser.show(e.getErrorTargetDomElem(t)),this.hidePopupTimeout=setTimeout(function(){n.hidePopupTimeout=null,n.hideError()},5e3),this):this}}),BEM.DOM.decl("tooltip-owner",{onSetMod:{js:{inited:function(){this.findBlocks().bindEvents()}}},findBlocks:function(){return this.tooltip=this.findBlockInside("tooltip"),this},bindEvents:function(){return this.bindTo("mouseleave",this._onMouseOut),this},desctruct:function(){this.unbindFrom("mouseleave",this._onMouseOut)},show:function(){this.tooltip.setOwner(this.domElem).show()},hide:function(){this.tooltip.hide()},setContent:function(t){this.tooltip.setContent(t)},_onMouseOver:function(){this.show()},_onMouseOut:function(){this.hide()},_onClick:function(){this.hide()}},{live:function(){this.liveInitOnEvent("mousemove"),this.liveBindTo("pointerclick",function(t){this._onClick(t)}),this.liveBindTo("pointerover",function(t){BEM.blocks["i-global"].param("mobile")||this._onMouseOver(t)})}}),BEM.DOM.decl("disk-logo",{bounce:function(){return this._bounceTimer=setTimeout(function(){this.offColoredIcon().offBounce()}.bind(this),5500),this.toggleColoredIcon().toggleBounce()},toggleColoredIcon:function(){return this.toggleMod(this._getColorIcon(),"visibility","","hidden")},toggleBounce:function(){return this.toggleMod(this._getColorIcon(),"action","bounce","")},offBounce:function(){return this.delMod(this._getColorIcon(),"action")},offColoredIcon:function(){return this.setMod(this._getColorIcon(),"visibility","hidden")},showPopup:function(t){return this._getPopup().show(t||this.domElem),this},_onClick:function(){this.trigger("click"),c.hit({dtype:"stred",pid:40,cid:72947,path:"disk.logo"})},_onAnimationEnd:function(){clearTimeout(this._bounceTimer),this.toggleColoredIcon().toggleBounce()},_getPopup:function(){return this._tooltip||(this._tooltip=this.findBlockInside("popup"))},_getColorIcon:function(){return this._colorIcon||(this._colorIcon=this.elem("icon","theme","color"))}},{live:function(){this.liveBindTo("button","pointerclick",function(t){this._onClick(t)}).liveBindTo("icon","animationend webkitAnimationEnd oAnimationEnd",function(t){this._onAnimationEnd(t)})}}),BEM.DOM.decl("footer",{hide:function(){this.hasMod("hidden","yes")||(this.setMod("hidden","yes"),this.trigger("hide"))},transparent:function(){this.setMod("hidden","yes"),this.trigger("transparent")},show:function(){this.delMod("hidden"),this.trigger("show")}}),BEM.DOM.decl("footer",{onSetMod:{js:function(){this.__base.apply(this,arguments),BEM.blocks["b-page"].on("change",this._onPageChange,this)}},destruct:function(){BEM.blocks["b-page"].un("change",this._onPageChange,this),this.__base.apply(this,arguments)},_onPageChange:function(){BEM.blocks["i-global"].param("mobile")&&!BEM.blocks["i-global"].param("tablet")&&this.updateMobileLink()},updateMobileLink:function(){var t=this.elem("link","mobile","yes"),e=t.attr("href"),i=BEM.blocks.uri.getParamValue(e,"retpath"),n=BEM.blocks.uri.getParamValue("text"),s=BEM.blocks.uri.parse(i),o=_.isEmpty(n)?s.getRoot():s.getRoot()+"/search?text="+encodeURIComponent(n);t.attr("href",BEM.blocks.uri.setParam(e,"retpath",o))}}),BEM.DOM.decl("footer",{onSetMod:{js:function(){this.__base.apply(this,arguments),this.distro=this.findBlockInside("distro"),this.hasMod("distro","yes")&&this.distroCounterOnScroll()}},distroCounterOnScroll:function(){this._isDistroDisabled()||(BEM.blocks["b-page"].on("scroll",this._onScroll,this),this._onScroll())},destruct:function(){BEM.blocks["b-page"].un("scroll",this._onScroll,this),this.__base.apply(this,arguments)},showDistro:function(){this.setMod("distro","yes"),this.distro.show(),this.trigger("distro","show")},hideDistro:function(){this.delMod("distro"),this.distro.hide(),this.trigger("distro","hide")},_onPageChange:function(t,e){var i=this.params.links;return this.__base.apply(this,arguments),BEM.blocks["b-page"].un("scroll",this._onScroll,this),this.elem("link","type","help").attr({href:"index"===e.type?i["help-index"]:i.help}),this.distro&&"ru"===BEM.blocks["i-global"].param("tld")?this._isDistroDisabled()?void this.hideDistro():void this.distroCounterOnScroll():void 0},_isDistroDisabled:function(){var t=BEM.blocks["i-global"];return t.getFlag("images_morda_distro_hide")&&"index"===t.param("page")},_onScroll:function(){var t=BEM.DOM.win,e=this.distro.domElem;!this.hasMod("hidden")&&t.scrollTop()+t.height()>=e.offset().top+e.height()&&(this.showDistro(),BEM.blocks["b-page"].un("scroll",this._onScroll,this))}}),BEM.DOM.decl("lang-switcher",{setRetpath:function(t){var e=encodeURIComponent(t),i=this.findBlockOn("dropdown2").getPopup();return this.findElem(i.domElem,"lang").map(function(){var t=$(this),i=t.attr("href");if(i){var n=i.replace(/(&retpath=)[^\&]*/,"$1"+e);n!==i&&t.attr("href",n)}}),this}},{live:!0}),BEM.DOM.decl("lang-switcher",{onSetMod:{js:{inited:function(){var t=this.findBlockOn("dropdown2").getPopup().domElem;this.langs=this.findElem(t,"lang")}}}},{live:function(){this.liveBindTo("pointerclick",function(){this.langs.each(function(){var t=$(this).attr("href"),e=BEM.blocks.uri;t&&$(this).attr("href",e.setParam(t,"retpath",e.clearHashSymbol(location.href)))})})}}),BEM.DOM.decl({block:"dropdown2",modName:"switcher",modVal:"link"},null,{live:function(){return this.liveInitOnBlockInsideEvent("click","link",function(t){this._onSwitcherClick(t)}),this.__base()}}),BEM.DOM.decl({block:"link",modName:"pseudo",modVal:"yes"},{_onClick:function(t){t.preventDefault(),this.hasMod("disabled")||this.trigger("click",this._buildClickEventData(t))},_onKeydown:function(t){BEM.blocks.keycodes.is(t.keyCode,"ENTER","SPACE")&&(BEM.blocks.keycodes.is(t.keyCode,"SPACE")&&t.preventDefault(),this.setMod("pressed","yes"))},_onKeyup:function(t){BEM.blocks.keycodes.is(t.keyCode,"ENTER","SPACE")&&(BEM.blocks.keycodes.is(t.keyCode,"SPACE")&&this.trigger("click"),this.delMod("pressed"))},_buildClickEventData:function(t){return{domEvent:t,isModKey:t.ctrlKey||t.altKey||t.metaKey||t.shiftKey}}},{live:function(){return this.liveBindTo({modName:"pseudo",modVal:"yes"},"pointerclick",function(t){this._onClick(t)}).liveBindTo({modName:"pseudo",modVal:"yes"},"keydown",function(t){this.hasMod("disabled")||this._onKeydown(t)}).liveBindTo({modName:"pseudo",modVal:"yes"},"keyup",function(t){this.hasMod("disabled")||this._onKeyup(t)}),this.__base()}}),BEM.DOM.decl({block:"menu",baseBlock:"control"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.elem("item").attr("id",function(t,e){return e||$.identify()}),this._val=this.getVal()}},disabled:function(t,e){this.__base.apply(this,arguments),this.setMod(this.elem("item"),t,e)}},onElemSetMod:{item:{hovered:{yes:function(t){return this.hasMod(t,"disabled")?!1:(this.delMod(this.elem("item","hovered","yes"),"hovered"),this.domElem.attr("aria-activedescendant",t.attr("id")),void this.trigger("item-hover",{item:t}))},"":function(){this.domElem.removeAttr("aria-activedescendant"),this.trigger("item-hover",{})}},checked:function(t,e,i){this.domElem.attr("aria-selected",Boolean(i))},disabled:{yes:function(){this.delMod("hovered"),this.domElem.attr("aria-disabled",!0)},"":function(){this.domElem.attr("aria-disabled",!1)}}}},_onChange:function(){var t=this._val,e=this.getVal();return t!==e&&(this._val=e,this.trigger("change",{prevVal:t,currVal:e})),this},getItems:function(t,e){return this.elem("item",t,e).get().map(function(t){return $(t)})},setContent:function(t){return BEM.DOM.update(this.domElem,t),this.reset(),this},getVal:function(){},reset:function(){this.dropElemCache()},_onItemEnter:function(t,e){this.setMod(t,"hovered","yes")},_onItemLeave:function(t,e){this.delMod(t,"hovered")},_onItemFocusin:function(t,e){this.setMod(t,"hovered","yes")},_onFocusout:function(t){this.__base.apply(this,arguments),this.delMod(this.elem("item","hovered","yes"),"hovered")},_onItemClick:function(t,e,i){this.trigger("click",{item:t,source:i.source})}},{live:function(){return this.liveBindTo("item","pointerover pointerout",function(t){var e=t.data.domElem;this.hasMod(e,"disabled","yes")||e[0].contains(t.relatedTarget)||("pointerover"===t.type?this._onItemEnter(e,t):this._onItemLeave(e,t))}).liveBindTo("item","pointerclick",function(t){var e=t.data.domElem;this.hasMod(e,"disabled")||this._onItemClick(e,t,{source:"pointer"})}).liveBindTo("item","focusin",function(t){var e=t.data.domElem;this.hasMod(e,"disabled")||this._onItemFocusin(e,t)}).liveBindTo("focusout",function(t){this._onFocusout(t)}),this.__base()}}),BEM.DOM.decl("menu",{onSetMod:{focused:{yes:function(){return this.__base.apply(this,arguments),this.hasMod("type","navigation")?!1:(this.elem("item","hovered","yes").length||(this.setMod(this.elem("item").eq(0),"hovered","yes"),this._scrollToItem(this.elem("item").eq(0))),void this.bindToDoc("keydown",this._onKeydown).bindToDoc("keypress",this._onKeypress))},"":function(){this.__base.apply(this,arguments),this.unbindFromDoc("keydown keypress").delMod(this.elem("item","hovered","yes"),"hovered")}}},hoverNext:function(t){for(var e,i,n=t?this.getItems().reverse():this.getItems(),s=0,o=!1;i=n[s];s++)if(!this.hasMod(i,"disabled"))if(this.hasMod(i,"hovered"))o=!0;else{if(o){e=i;break}e||(e=i)}e&&(this.setMod(e,"hovered","yes"),this._scrollToItem(e))},hoverText:function(t,e){for(var i,n=this.getItems(),s=n.length,o=this._normalizeText(t),r=e||0;s>r;){if(i=n[r],!this.hasMod(i,"disabled")&&0===this._normalizeText(i.text()).indexOf(o))return this.setMod(i,"hovered","yes"),void this._scrollToItem(i);r++,r===n.length&&(r=0,s=e)}},_normalizeText:function(t){return t.toLowerCase().replace(//,"")},reset:function(){this.__base.apply(this,arguments),this._dropSearchCache()},_dropSearchCache:function(){this._lastTime=this._lastChar=this._searchTerm=void 0},_scrollToItem:function(t){var e=this.domElem.offset().top,i=t.offset().top,n=0;e>i?n=i-e:(n=i+t.outerHeight()-e-this.domElem.outerHeight(),0>n&&(n=0)),this.domElem.scrollTop(this.domElem.scrollTop()+n)},_onKeydown:function(t,e){var i=BEM.blocks.keycodes,n=t.keyCode;t.shiftKey||t.ctrlKey||t.altKey||t.metaKey||((i.is(n,"UP","DOWN")||!e&&n===i.SPACE)&&t.preventDefault(),i.is(n,"ENTER","SPACE")&&this._onItemClick(this.elem("item","hovered","yes"),t,{source:"keyboard"}),i.is(n,"UP","DOWN")&&(this.hoverNext(i.is(n,"UP")),this._dropSearchCache()))},_onKeypress:function(t){var e,i,n=Number(new Date),s=t.charCode,o=String.fromCharCode(s).toLowerCase(),r=o===this._lastChar&&1===this._searchTerm.length,a=this.getItems();return s<=BEM.blocks.keycodes.SPACE||t.ctrlKey||t.altKey||t.metaKey?void(this._lastTime=n):(n-this._lastTime>this.SEARCH_TIMEOUT||r?this._searchTerm=o:this._searchTerm=(this._searchTerm||"")+o,this._lastChar=o,this._lastTime=n,e=this.elem("item","hovered","yes"),i=$($.map(a,function(t){return t.get()})).index(e),i=i>=0?i:0,r&&0===this._normalizeText(e.text()).indexOf(this._searchTerm)&&(i=i>=a.length-1?0:i+1),void this.hoverText(this._searchTerm,i))},SEARCH_TIMEOUT:1500}),BEM.DOM.decl("b-statcounter",{onSetMod:{js:{inited:function(){this.findElem("metrika").length<1||(this.location=BEM.blocks.location.getInstance().on("change",this._onChange,this),this.__self.on("hit",this.hitMetrika,this),this.__self.on("goal",this.reachGoal,this),this.trigger("hitAndGoalInited"),this.__base.apply(this,arguments))}}},destruct:function(){this.location.un("change",this._onChange,this),this.__self.un("hit",this.hitMetrika,this),this.__self.un("goal",this.reachGoal,this),this.__base.apply(this,arguments)},_onChange:function(){this.hitMetrika()},hitMetrika:function(t,e){e||(e={});var i=this.getMetrika();i&&i.hit(e.url||window.location.href,e.title,e.referer,e.params),BEM.blocks.counter.debug("metrika hit",JSON.stringify(e.params))},reachGoal:function(t,e){e||(e={});var i=this.getMetrika();i&&i.reachGoal(e.goal,e.params),BEM.blocks.counter.debug("metrika reachGoal",JSON.stringify(e))},getMetrika:function(){return this._mc||(this._mc=window["yaCounter"+this.elemParams("metrika").id])}},{hit:function(t){this.trigger("hit",t)},goal:function(t){this.trigger("goal",t)}}),BEM.DOM.decl("b-statcounter",{_onChange:$.noop}),function(t){t.decl("b-statcounter__metrika",{onSetMod:{js:{inited:function(){this.__self.loadMetrika(),this.addCounter(this.params)}}},addCounter:function(t){var e=window.Ya&&Ya.Metrika,i=window.yandex_metrika_callbacks||(window.yandex_metrika_callbacks=[]),n=function(){window["yaCounter"+t.id]=new Ya.Metrika(t)};if(!t.id)throw new Error([BEM.I18N("b-statcounter__metrika","JSERR_incorrectID"),"block: "+this.__self.getName(),"method: addCounter"].join("\n"));e?n():i.push(n)},getDefaultParams:function(){return{enableAll:!0}}},{loadMetrika:function(){var t=window.Ya&&Ya.Metrika,e="https:"===document.location.protocol?"https:":"http:",i="//mc.yandex.ru/metrika/watch.js";!t&&$.ajax({url:e+i,dataType:"script",cache:!0}),this.loadMetrika=function(){}}})}(BEM.DOM),BEM.DOM.decl("b-statcounter__metrika",{addCounter:function(t){this.params.includeFrom&&this.__self.updateFromParam(t),this.__base.apply(this,arguments)},hit:function(t){var e=window.Ya&&Ya.Metrika,i=window.yandex_metrika_callbacks||(window.yandex_metrika_callbacks=[]),n=function(){window["yaCounter"+this.params.id].hit(t.url||window.location.href,t)}.bind(this);e?n():i.push(n),BEM.blocks.counter.debug("metrika hit",JSON.stringify(t))},reachGoal:function(t){var e=window.Ya&&Ya.Metrika,i=window.yandex_metrika_callbacks||(window.yandex_metrika_callbacks=[]),n=function(){var e=window["yaCounter"+this.params.id];e&&e.reachGoal(t.goal,t.params)}.bind(this);e?n():i.push(n),BEM.blocks.counter.debug("metrika reachGoal",JSON.stringify(t))}},{getInstance:function(){return this._instance||(this._instance=$(this.buildSelector()).bem(this.getName())),this._instance},updateFromParam:function(t){var e=$.cookie("mfrom");return t.params||(t.params={}),e?t.params.from=e:this._setCookie(t.params.from||"organic"),this},_setCookie:function(t){return $.cookie("mfrom",t,{expires:3650,path:BEM.blocks["i-global"].param("router").index}),this}}),BEM.DOM.decl("fade",{onSetMod:{progress:function(t,e){this.getSpin().setMod(t,e)}},getSpin:function(){return this._spin||(this._spin=this.findBlockInside("spin2")),this._spin},show:function(){this.setMod("progress","yes")},hide:function(){this.delMod("progress")}}),BEM.DOM.decl("fade",{coverPageLayout:function(){this.delMod("include")},coverTabs:function(){this.setMod("include","tabs")},coverHeader:function(){this.setMod("include","header")}}),BEM.DOM.decl("page-layout",{},{getInstance:function(){return this._instance||(this._instance=$(this.buildSelector()).bem(this.getName())),this._instance}},{live:!0}),BEM.DOM.decl("page-layout",{_shouldTrigger:!0,onSetMod:{layout:function(t,e){this._shouldTrigger&&this.trigger(t,e),this._shouldTrigger=!0}},disableTrigger:function(){return this._shouldTrigger=!1,this}}),BEM.DOM.decl("page-layout",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),BEM.blocks.footer.on("distro",this._onDistroStateChange,this)}}},destruct:function(){BEM.blocks.footer.un("distro",this._onDistroShow,this),this.__base.apply(this,arguments)},_onDistroStateChange:function(t,e){"show"===e?this.setMod("distro-footer","yes"):this.delMod("distro-footer")},changeHeight:function(t){return this.elem("content-wrapper").css("min-height","+="+t),this},getHeight:function(){return this.elem("content-wrapper").height()},setHeight:function(t){return this.elem("content-wrapper").css("min-height",t),this},setDefaultHeight:function(){return this.elem("content-wrapper").css("min-height",""),this}}),BEM.DOM.decl("page-layout",{toggleCBIRMode:function(t){return this.toggleMod("cbir","visible","",t)}}),BEM.DOM.decl("pane2",{getDefaultParams:function(){var t=this.__base.apply(this,arguments)||{};return t.ANIMATION_DURATION=300,t.mouseMovingTimeoutDelay=2e3,t.playTimeoutDelay=4e3,t},onSetMod:{js:{inited:function(){this.setMod("flexbox",BEM.blocks["i-ua"].hasFlexbox()?"yes":"no"),this.setMod(this.elem("column","type","info"),"flexbox",BEM.blocks["i-ua"].hasFlexbox()?"yes":"no"),this.findBlocks().bindEvents(),this.playback=this.playback.bind(this)}},fullscreen:{yes:function(){this._onThrottledMouseMove=$.throttle(this._onMouseMove,100,this),this.bindTo("mousemove",this._onThrottledMouseMove),this.bindTo("pointerclick",this._onPageClick)},no:function(){this.unbindFrom("mousemove"),this.unbindFrom("click")}},"mouse-moving":{yes:function(){this.blockInside("slideshow-controls").show()},"":function(){this.blockInside("slideshow-controls").hide()}}},onElemSetMod:{column:{hidden:function(t,e,i){this.hasMod(t,"type","info")&&this.afterCurrentEvent(function(){this.trigger("info:"+("yes"===i?"closed":"opened"))})}}},findBlocks:function(){return this._related=this.findBlockInside("related","related2"),this},bindEvents:function(){return screenfull.enabled&&(this.bindTo("fullscreen","pointerclick",this._onFullscreenEnter),this.bindToDoc(screenfull.raw.fullscreenchange,this._onFullscreenChange),this.bindToDoc(screenfull.raw.fullscreenerror,this._onFullscreenError),BEM.blocks["slideshow-controls"].on({start:this.slideshowStart,stop:this.slideshowStop,close:this.exitFullscreen},this),BEM.blocks["pane2-api"].on("prev next",this._onSlideChange,this)),this},unbindEvents:function(){screenfull.enabled&&BEM.blocks["slideshow-controls"].un({start:this.slideshowStart,stop:this.slideshowStop,close:this.exitFullscreen},this),BEM.blocks["pane2-api"].un("prev next",this._onSlideChange,this)},destruct:function(){this.unbindEvents(),this.__base.apply(this,arguments)},getLoadedDup:function(){return this.getPreview().getLoadedDup()},isOrientationChanged:function(){return this._isVerticalOrientation!=window.innerHeight>window.innerWidth?(this._isVerticalOrientation=!this._isVerticalOrientation,!0):!1},_onKeyboardClose:function(t){this.close("mouse")},_onMouseClose:function(t){this.close("mouse")},open:function(){return this.isMobile()&&(this._isVerticalOrientation=window.innerHeight>window.innerWidth)?this.hideInfoPanel():this.showInfoPanel(),this.setMod("visibility","visible"),this.domElem.animateRaf([{property:"opacity",from:0,to:1,duration:this.params.ANIMATION_DURATION,timing:"ease"}],function(){this.trigger("open")}.bind(this)),this.hasMod("mobile","yes")&&window.scrollBy(0,1),this},isOpened:function(){return this.hasMod("visibility","visible")},updatePreview:function(){return this.getPreview().hideError().load(),this},updateInfoPanel:function(){return this.isInfoPanelOpened()?(this._updateSnippet(),this._updateSlideshowControls(),this):this},_updateSlideshowControls:function(){var t=BEM.blocks["pane2-api"].getItemParams();this.blockInside("slideshow-controls").update(t)},_updateSnippet:function(){return this._getSnippet().update(BEM.blocks["pane2-api"].getItemParams()),this},_getSnippet:function(){return this._snippet||(this._snippet=this.findBlockInside("snippet2"))},close:function(t){return this.hasMod("fullscreen","yes")?(this.exitFullscreen(),this):(this.trigger("beforeClose"),this.domElem.animateRaf([{property:"opacity",from:1,to:0,duration:this.params.ANIMATION_DURATION,timing:"ease"}],function(){this.delMod("visibility"),this.trigger("close",t)}.bind(this)),this)},toggleInfoPanel:function(){this.toggleMod(this.elem("column","type","info"),"hidden","yes","")},showInfoPanel:function(){this.delMod(this.elem("column","type","info"),"hidden")},hideInfoPanel:function(){this.setMod(this.elem("column","type","info"),"hidden","yes")},isInfoPanelOpened:function(){return!this.hasMod(this.elem("column","type","info"),"hidden","yes")},isMobile:function(){return this.hasMod("mobile","yes")},getPreview:function(){return this.preview||(this.preview=this.findBlockOn("preview","preview2"))},_onFullscreenEnter:function(t,e){return this.hasMod("fullscreen","yes")?!1:void this.enterFullscreen()},slideshowStart:function(){this._playTimeout=setTimeout(this.playback,this.params.playTimeoutDelay),this.blockInside("slideshow-controls").play(),this.__self._slideshowPlaying=!0},slideshowStop:function(){clearTimeout(this._playTimeout),this.blockInside("slideshow-controls").stop(),this.__self._slideshowPlaying=!1},_onFullscreenChange:function(){screenfull.isFullscreen===!1&&window.inNextFrame(function(){this.exitFullscreen()}.bind(this))},_onFullscreenError:function(){window.inNextFrame(function(){this.exitFullscreen()}.bind(this))},_onMouseMove:function(){this.updateControls()},_onPageClick:function(){this.updateControls()},_onSlideChange:function(t,e){"slideshow"!==e.source&&this.__self.isSlideshowPlaying()&&this._updateSlideshowTimeout()},_updateSlideshowTimeout:function(){clearTimeout(this._playTimeout),this._playTimeout=setTimeout(this.playback,this.params.playTimeoutDelay)},playback:function(){this.trigger("slideshow:next"),this._updateSlideshowTimeout()},updateControls:function(){return this.setMod("mouse-moving","yes"),clearTimeout(this.mouseMovingTimeout),this.mouseMovingTimeout=setTimeout(function(){this.delMod("mouse-moving")}.bind(this),this.params.mouseMovingTimeoutDelay),this},enterFullscreen:function(){return screenfull.request(),this.setMod(this.elem("close"),"color","white"),this.setMod("fullscreen","yes"),this.blockInside("slideshow-controls").show(),this.__self._fullscreenEnabled=!0,this.trigger("fullscreen:enter"),this},exitFullscreen:function(){return screenfull.exit(),this.setMod(this.elem("close"),"color",this.params.originCloseColor),this.setMod("fullscreen","no"),this.slideshowStop(),this.blockInside("slideshow-controls").hide(),this.__self._fullscreenEnabled=!1,this.updatePreview().updateInfoPanel(),this.trigger("fullscreen:exit"),this}},{live:function(){this.liveBindTo("close","keypress",function(t){13===t.keyCode&&this._onKeyboardClose(t)}),this.liveBindTo("close","pointerclick",function(t){this._onMouseClose(t)}),this.liveBindTo("pointerclick",function(t){$(t.target).is(this.elem("paranja"))&&this._onMouseClose(t)})},_slideshowPlaying:!1,_fullscreenEnabled:!1,isFullscreen:function(){return this._fullscreenEnabled},isSlideshowPlaying:function(){return this._slideshowPlaying}}),BEM.DOM.decl("pane2",{onSetMod:{fullscreen:{yes:function(){this.__base.apply(this,arguments),this._hitFullscreenCounter("open")},no:function(){this.__base.apply(this,arguments),this._hitFullscreenCounter("close")}},market:function(t,e){var i="no"===e;this._replaceSnippet(i)}},bindEvents:function(){return BEM.blocks.share.on(this.elem("share"),"beforeOpen",this._onShareOpen,this),BEM.blocks["search-by-image"].on(this.elem("cbir"),"click",this._onSimilarClick,this),BEM.blocks["dropdown-more"].on(this.elem("dropdown-more"),"beforeOpen",this._onDropdownOpen,this),BEM.blocks.button2.on(this.elem("complain"),"click",this._onComplainClick,this),BEM.blocks.preview2.on("loaded",this._onPreviewDupLoaded,this),this.__base.apply(this,arguments)},unbindEvents:function(){return BEM.blocks.share.un(this.elem("share"),"beforeOpen",this._onShareOpen,this),BEM.blocks["search-by-image"].un(this.elem("cbir"),"click",this._onSimilarClick,this),BEM.blocks["dropdown-more"].un(this.elem("dropdown-more"),"beforeOpen",this._onDropdownOpen,this),BEM.blocks.button2.un(this.elem("complain"),"click",this._onComplainClick,this),BEM.blocks.preview2.un("loaded",this._onPreviewDupLoaded,this),this.__base.apply(this,arguments)},findBlocks:function(){return this.__base.apply(this,arguments),this._getSearchByImage(),this._bigThumbsFlag=BEM.blocks["i-global"].getFlag("images_big_thumbs"),this},getCroppedViewUrl:function(t,e){return this._getSearchByImage().getCroppedViewUrl(t,e)},open:function(){this.__base.apply(this,arguments),this.showCropOnboarding()},close:function(){this.__base.apply(this,arguments),this.hideCropOnboarding()},enterFullscreen:function(){this.__base.apply(this,arguments),this.hideCropOnboarding()},exitFullscreen:function(){this.__base.apply(this,arguments),this.showCropOnboarding()},showCropOnboarding:function(){BEM.channel("crop-onboarding").trigger("show")},hideCropOnboarding:function(){BEM.channel("crop-onboarding").trigger("hide")},_shareUpdate:function(t){var e=BEM.blocks["pane2-api"].getItemParams();this._shareItemId!==e.id&&(t.update({bestShareDup:this._bestShareDup,description:e.snippet.text}),this._shareItemId=e.id)},_onSimilarClick:function(t,e){this.trigger("similar:click",e)},_onDropdownOpen:function(){var t=this._getDropdownMore();this._shareUpdate(t)},_onShareOpen:function(){this.trigger("share:click");var t=this._getShare();this._shareUpdate(t)},_hitFullscreenCounter:function(t){return c.hitDelayed({dtype:"iweb",path:"/image/new/fullscreen/"+t,reqid:BEM.blocks["pane2-api"].getItemParams().reqid}),this},_onPreviewDupLoaded:function(t,e){var i=e.image;this._getSizes().update(i),this._bestShareDup=i,this._getSearchByImage()&&this._getSearchByImage().update(BEM.blocks["pane2-api"].getDuplicateOriginUrl(i))},_onComplainClick:function(){BEM.blocks.feedback.showPopup(BEM.blocks["pane2-api"].getItem())},getRelated:function(){return this.elem("related")[0]&&this.elem("related")[0].outerHTML},_updateMarketState:function(t){var e=$.Deferred(),i=this.isMarketState()&&this._getMarketSnippet().isEnabled(t.offers),n=Boolean(BEM.blocks["i-global"].getFlag("images_market_separate_button_compact")),s="no";return this._getSizes().setButtonTheme(i&&!n?"normal":"action"),(i||this.hasMod("ajax-direct","yes")&&t.marketSnippet)&&(s=n?"separate":"yes",this._getMarketSnippet().updateMod(t.marketSnippet).update(t.marketSnippet,t.id,t.offers,t.moreLink)),this.setMod("market",s),e.resolve().promise()},_updateMarketSnippet:function(t){var e=$.Deferred();return t?(this._getSizes().setButtonTheme("normal"),this.setMod("market","separate"),this.blockInside("market-snippet2").update(t).show(),e.resolve().promise()):(this.blockInside("market-snippet2").hide(),this.setMod("market","no"),this._getSizes().setButtonTheme("action"),e.reject())},updateMarket:function(){var t=BEM.blocks["pane2-api"].getItemParams(),e=BEM.blocks["i-global"].getFlag("images_market_snippet2");
return e?this._updateMarketSnippet(t.market):this._updateMarketState(t)},updateDirectAjax:function(){var t=BEM.blocks["pane2-api"].getItemParams();return this.hasMod("ajax-direct","yes")?this.updateCommercial(t):$.Deferred().reject().promise()},isMarketState:function(){return Boolean(BEM.blocks["pane2-api"].getItemParams().isMarketIncut)},_updateDiskState:function(){return this._getDisk().updateButton(),this},updateInfoPanel:function(){this.__base.apply(this,arguments);var t=BEM.blocks["pane2-api"].getItem(),e=t.params,i=e.images[0];return this._updateImageSource(),this._getDisk()&&this._updateDiskState(),this._getSizes().update(i),this._bestShareDup=i,this._getSearchByImage()&&this._getSearchByImage().update(BEM.blocks["pane2-api"].getDuplicateOriginUrl(i)),t.isRim?this.hideShare():this.showShare(),this.trigger("update-info"),this},getAwailableHieght:function(){var t=this.elem("column","type","info").height(),e=this.elem("info-wrapper").height();return t-e},updateSimilarOffers:function(){var t,e=$.Deferred(),i=BEM.blocks["pane2-api"].getItemParams().similarOffers,n=this._getSimilarOffers(),s=$.noop;return n?(i?(n.render(i),t=this.hasMod("market","yes")?"market":"plain",n.hasMod("theme","for-scroll")?n.show(t):s=function(){n.show(t)},e.resolve(n,s)):(n.hide(),e.reject()),e.promise()):e.reject()},hideRelated:function(){var t=this._getRelated();t&&t.hide()},showRelated:function(){var t=this._getRelated();t&&t.show()},hideShare:function(){this.setMod(this.elem("share"),"hidden",!0),this.setMod(this._getSaveButton(),"wide","yes")},showShare:function(){this.delMod(this.elem("share"),"hidden"),this.delMod(this._getSaveButton(),"wide")},_getSimilarOffers:function(){return this._similarOffers||null===this._similarOffers||(this._similarOffers=this.blockInside("similar-offers")),this._similarOffers},_hitSimilarOffersCounter:function(t,e){var i=BEM.blocks["pane2-api"].getItemParams();c.hit({dtype:"iweb",path:"/image/new/preview/commercial/"+t,reqid:i.reqid,vars:e},{href:i.preview[0].url})},_onSimilarOffersShow:function(t,e){this._hitSimilarOffersCounter("show/related/market","-count="+e.count)},_onSimilarOffersClick:function(t,e){var i=[];e.type&&i.push("-type="+e.type),e.pos&&i.push("-pos="+e.pos),this._hitSimilarOffersCounter("related/market",i.join(";"))},updateRelated:function(){var t=this.findBlockInside("related2");if(t){var e,i=BEM.blocks["pane2-api"].getItem(),n=i.params;if(!i.isRim)return BEM.blocks["i-global"].getFlag("images_desktop_rim_preload_data")&&(e=BEM.blocks["serp-item"]._getNearestImages(n.pos,BEM.blocks["i-global"].getFlag("images_desktop_rim_preload_data_count")||2)),t.load(n,e)}},_getSaveButton:function(){return this._saveButton||(this._saveButton=this.findElem(this.elem("disk-button"),"button"))},_getRelated:function(t){return this._related&&!t||(this._related=this.findBlockInside("related2")),this._related},_getPage:function(){return this.page||(this.page=this.findBlockOutside("b-page"))},_getSizes:function(){return this.sizes||(this.sizes=this.findBlockInside("sizes"))},_getSearchByImage:function(){return this._searchByImage||(this._searchByImage=this.findBlockInside("search-by-image"))},_getDropdownMore:function(){return this._dropdownMore||(this._dropdownMore=this.findBlockInside("dropdown-more"))},_getShare:function(){return this._share||(this._share=this.findBlockInside("share"))},_getDisk:function(){return this._disk||(this._disk=BEM.blocks["disk-controller"].get())},_getMarketSnippet:function(){return this._marketSnippet||(this._marketSnippet=this.findBlockInside("market-snippet"))},_replaceSnippet:function(t){BEM.blocks["i-global"].getFlag("images_oneline_organic_snippet")&&(t?(this.blockInside("snippet2").show(),this.blockInside("image-source").hide(),this.delMod(this.elem("column_type_info"),"snippet-pos")):(this.setMod(this.elem("column_type_info"),"snippet-pos","bottom"),this.blockInside("snippet2").hide(),this.blockInside("image-source").show()))},_updateImageSource:function(){if(BEM.blocks["i-global"].getFlag("images_oneline_organic_snippet")){var t=BEM.blocks["pane2-api"].getItemParams(),e=t.snippet.domain,i=t.snippet.redirUrl||t.snippet.url;this.blockInside("image-source").update(e,i)}}},{live:function(){this.__base.apply(this,arguments),this.liveInitOnBlockInsideEvent("show","similar-offers",function(t,e){this._onSimilarOffersShow(t,e)}).liveInitOnBlockInsideEvent("click","similar-offers",function(t,e){this._onSimilarOffersClick(t,e)})}}),BEM.DOM.decl({block:"pane2",modName:"color-position",modVal:"yes"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.params.originClosePos=this.getMod(this.elem("close"),"pos"),this.params.originCloseColor=this.getMod(this.elem("close"),"color"),this.params.isCloseButtonRight="preview-right"===this.params.originClosePos}}},onElemSetMod:{column:{hidden:function(t,e,i){this.__base.apply(this,arguments);var n,s;"yes"===i?(n="white",s="default"):(n=this.params.originCloseColor,s=this.params.originClosePos),this.setMod(this.elem("close"),"color",n),this.params.isCloseButtonRight&&this.setMod(this.elem("close"),"pos",s)}}}}),BEM.DOM.decl({block:"pane2",modName:"scrollable",modVal:!0},{enterFullscreen:function(){this.setMod(this.elem("content"),"hidden",!0),this.__base.apply(this,arguments)},exitFullscreen:function(){this.__base.apply(this,arguments),this.delMod(this.elem("content"),"hidden")},open:function(){var t=this.domElem;window.requestAnimationFrame(function(){t.scrollTop(0)}),this.__base.apply(this,arguments)}}),BEM.DOM.decl("pane2-api",{isFullscreen:!1,isSlideshowActive:!1,isOpened:!1,_scrollStart:null,onSetMod:{js:{inited:function(){this.__self._instance=this}}},destruct:function(){this.__self._instance=null,this.unbindEvents(),this.__base.apply(this,arguments)},bindEvents:function(){return BEM.blocks.gallery.on("click",this._onGalleryItemClicked,this),BEM.blocks.preview2.on({thumbClick:this._onThumbClick,rightClick:this._onRightClick,arrowClick:this._onArrowClick,loaded:this._onPreviewDupLoaded,notfound:this._onPreviewNotfound,timeout:this._onPreviewTimeout,error:this._onPreviewError},this),BEM.blocks.snippet2.on({"title:click":this._onTitleClick,"link:click":this._onLinkClick,"query:click":this._onQueryClick},this),BEM.blocks["market-snippet"].on("market:button:click market:link:click market:title:click market:thumb:click",this._onMarketSnippetClick,this),BEM.blocks["direct-snippet"].on("direct:link:click direct:title:click",this._onDirectSnippetClick,this),BEM.blocks["market-snippet2"]&&BEM.blocks["market-snippet2"].on("market:show market:button:click market:link:click market:title:click market:thumb:click",this._onMarketSnippetEvent,this),BEM.blocks.carousel.on("listOut",this._onListOut,this),BEM.blocks.pane2.on({open:this._onPaneOpen,close:this._onPaneClose,beforeClose:this._beforePaneClose,"info:opened":this._onInfoPanelOpened,"info:closed":this._onInfoPanelClosed,"fullscreen:enter":this._onFullscreenEnter,"fullscreen:exit":this._onFullscreenExit,"slideshow:next":this._onSlideshowNext},this),this._debouncedOnResize=$.debounce(this._onResize,100,!1,this),this.bindToWin(this._getWheelEvent(),this._onMouseWheel),this.bindToWin("resize orientationchange",this._debouncedOnResize),BEM.blocks["slideshow-controls"].on({"title:click":this._onTitleClick,"link:click":this._onLinkClick,start:this._onSlideshowStart,stop:this._onSlideshowStop},this),BEM.blocks["i-global"].param("tablet")&&this.bindToWin("touchmove",this._onTouchMove),BEM.blocks["i-keyrouter"].on({"space left right up down":this._onKeyNavigation,"esc backspace":this._closeByKeyboard,"o v":this._onKeyPress},this),BEM.DOM.blocks.related2.on({"rim-click":this._onRimClick,"rim-loaded":this._onRimLoaded},this),BEM.blocks["image-source"].on("click",this._onImageSourceClick,this),this},unbindEvents:function(){return BEM.blocks.gallery.un("click",this._onGalleryItemClicked,this),BEM.blocks.preview2.un({thumbClick:this._onThumbClick,rightClick:this._onRightClick,arrowClick:this._onArrowClick,loaded:this._onPreviewDupLoaded,notfound:this._onPreviewNotfound,timeout:this._onPreviewTimeout,error:this._onPreviewError},this),BEM.blocks.snippet2.un({"title:click":this._onTitleClick,"link:click":this._onLinkClick,"query:click":this._onQueryClick},this),BEM.blocks["market-snippet"].un("market:button:click market:link:click market:title:click market:thumb:click",this._onMarketSnippetClick,this),BEM.blocks["direct-snippet"].un("direct:link:click direct:title:click",this._onDirectSnippetClick,this),BEM.blocks["market-snippet2"]&&BEM.blocks["market-snippet2"].un("market:show market:button:click market:link:click market:title:click market:thumb:click",this._onMarketSnippetEvent,this),BEM.blocks["slideshow-controls"].un({"title:click":this._onTitleClick,"link:click":this._onLinkClick,start:this._onSlideshowStart,stop:this._onSlideshowStop},this),BEM.blocks.carousel.un("listOut",this._onListOut,this),BEM.blocks.pane2.un({open:this._onPaneOpen,close:this._onPaneClose,beforeClose:this._beforePaneClose,"info:opened":this._onInfoPanelOpened,"info:closed":this._onInfoPanelClosed,"fullscreen:enter":this._onFullscreenEnter,"fullscreen:exit":this._onFullscreenExit,"slideshow:next":this._onSlideshowNext},this),this.unbindFromWin(this._getWheelEvent(),this._onMouseWheel),this.unbindFromWin("resize orientationchange",this._debouncedOnResize),BEM.blocks["i-global"].param("tablet")&&this.unbindFromWin("touchmove",this._onTouchMove),BEM.blocks["i-keyrouter"].un({"space left right up down":this._onKeyNavigation,"esc backspace":this._closeByKeyboard,"o v":this._onKeyPress},this),BEM.DOM.blocks.related2.un({"rim-click":this._onRimClick,"rim-loaded":this._onRimLoaded},this),BEM.blocks["image-source"].un("click",this._onImageSourceClick,this),this},open:function(t){this.__self.setItem(t),this.bindEvents(),this.isOpened=!0;var e=this;return BEM.blocks["pane2-api"].frameQueue.add(function(){e._getGallery().init()}).add(function(){e._beforePaneOpen(),e._getPane().open()}).add(function(){e.loadItem(t)}),this},close:function(t){return this._getPane().close(t),this},loadItem:function(t){this.__self.setItem(t),this._canSelectItem()&&this.selectCurrentItem(),this.updatePane()},_canSelectItem:function(){var t=this.__self.getItem();return!this.isFullscreen&&!t.isRim},preloadItems:function(t){return this._getPreloader().setImages(t).batchLoad(),this},showSpin:function(t){this._getGallery().showSpin(this.getDirectionByPageNum(t))},hideSpin:function(t){this._getGallery().hideSpin(this.getDirectionByPageNum(t))},loadGallery:function(t,e){var i,n=this._getGallery();if(!n.needAddList(e))return!1;i=this.getDirectionByPageNum(e),n.hideSpin(i),n.savePageNum(e);var s=n.addList(t,i);return this.isOpened&&"left"===i&&n.move(n.getCurrentScrollPos()+(n._getItemWidth()+n.params.thumbsMargin)*s),!0},getDirectionByPageNum:function(t){return this._getGallery().getDirectionByNum(t)},selectCurrentItem:function(){var t=this.__self.getItemParams();this._getGallery().selectItemByID(t.id)},updatePane:function(){var t=this._getPane();return t.updatePreview(),BEM.blocks["pane2-api"].frameQueue.add(function(){t.updateInfoPanel()}),this},_onFullscreenEnter:function(){this.isFullscreen=!0,this.trigger("fullscreen:enter")},_onFullscreenExit:function(){this.isFullscreen=!1,BEM.blocks["pane2-api"].frameQueue.add(this.selectCurrentItem.bind(this)).run(),this.trigger("fullscreen:exit")},_onSlideshowStart:function(){this.isSlideshowActive=!0,this.trigger("slideshow:start")},_onSlideshowStop:function(){this.isSlideshowActive=!1,this.trigger("slideshow:stop")},_onSlideshowNext:function(){this.trigger("next",{source:"slideshow"})},_onImageSourceClick:function(){this.trigger("image-source:click")},_onRimClick:function(t,e){var i=this.__self.getItem();e.params.parentPos=i.isRim?i.params.parentPos:i.params.pos,this.showImage(e),this.trigger("related:rim-click",e)},_onRimLoaded:function(t,e){this.trigger("related:rim-loaded",e)},_onResize:function(){var t=this._getPane();this.trigger("resize"),t.isMobile()&&t.isOrientationChanged()?t.toggleInfoPanel():this.isOpened&&this.updatePreviewSize()},_onInfoPanelOpened:function(){return this._getPane().updateInfoPanel(),this.updatePreviewSize(),this},_onInfoPanelClosed:function(){return this.updatePreviewSize(),this},updatePreviewSize:function(){return this.__self.currentDuplicate?(this._getPreview().updateWrapperSize().setThumbSize(this.__self.currentDuplicate),this):this},_onGalleryItemClicked:function(t,e){this.trigger("gallery:click",e)},_onPreviewDupLoaded:function(t,e){this.trigger("preview:loaded",e)},_onPreviewNotfound:function(t,e){this.trigger("preview:notfound",e)},_onPreviewTimeout:function(t,e){this.trigger("preview:timeout",e)},_onPreviewError:function(){this.trigger("preview:error")},_onArrowClick:function(t,e){this._getGallery().isScrolling()||(this.hasMod(e.data.domElem,"side","right")?this.trigger("next",{source:"arrow"}):this.trigger("prev",{source:"arrow"}))},_onThumbClick:function(){this._getGallery().isScrolling()||this.trigger("thumb:click")},_onRightClick:function(){this.trigger("preview:rightClick")},_onListOut:function(t,e){this._getGallery().isSpinVisible(e)||this.trigger("gallery:listOut",this._getGallery().getPageNumByDirection(e))},_onPaneOpen:function(){this.trigger("pane:open")},_beforePaneOpen:function(){this.trigger("pane:beforeOpen")},_onPaneClose:function(t,e){this.isOpened=!1,this.unbindEvents(),this._getPreview().removeImageParams(),this.trigger("pane:close",e),this._getGallery().delSelected()},_beforePaneClose:function(){this.trigger("pane:beforeClose")},_onKeyNavigation:function(t,e){e.preventDefault(),this._getGallery().isScrolling()||("left"===t.type||"up"===t.type?this.trigger("prev",{source:"keyboard"}):this.trigger("next",{source:"keyboard"}))},_onTouchMove:function(t){t.target.classList&&t.target.classList.contains("gallery__item")||t.preventDefault()},_closeByKeyboard:function(t,e){e.isImmediatePropagationStopped()||(e.stopImmediatePropagation(),this.close("keyboard"))},_onKeyPress:function(t){var e=this.__self.getItemParams();switch(t.type){case"o":this._openURL(e.preview[0].url),this.trigger("open:image");break;case"v":this._openURL(e.snippet.url),this.trigger("open:site")}},_onTitleClick:function(t,e){this.trigger("title:click",e)},_onLinkClick:function(t,e){this.trigger("link:click",e)},_onQueryClick:function(t,e){this.trigger("query:click",e)},_onMarketSnippetClick:function(t,e){this.trigger(t.type,e)},_onMarketSnippetEvent:function(t,e){this.trigger(t.type,e)},_onDirectSnippetClick:function(t,e){this.trigger(t.type,e)},_openURL:function(t){window.open(t,"_blank")},_onMouseWheel:function(t){var e=this._getPane();if(!e.hasMod("scrollable",!0)||/gallery|carousel/.test(t.target.className)){var i,n=t.originalEvent;i=n.deltaY||5*n.detail,i&&(1===t.originalEvent.deltaMode&&(i*=16),this._getGallery().move(this._getGallery().getCurrentScrollPos()+i),t.preventDefault())}},_getWheelEvent:function(){return this.__self._getWheelEvent()},_getPreloader:function(){return this._batchPreloader||(this._batchPreloader=BEM.create({block:"i-preloader",mods:{batch:"yes",timeout:"yes","preview-speed":"yes"}},{checkImageSize:this.params.checkImageSize})),this._batchPreloader},_getPane:function(){return this.pane||(this.pane=this.findBlockOn("pane2"))},_getPreview:function(){return this.preview||(this.preview=this.findBlockInside("preview2"))},_getGallery:function(){return this.gallery||(this.gallery=this.findBlockInside("gallery"))},show:function(){this.isOpened&&this._getPane().setMod("visibility","visible")},hide:function(){this.isOpened&&this._getPane().setMod("visibility","hidden")},showImage:function(t){var e=this._getGallery();t.isRim&&(e&&e.blur(),this._getPane().hideShare()),this.trigger("show:image",t)}},{live:function(){return BEM.blocks.preview2.on("duplicate:loaded",this._onDuplicateLoaded,this),this.frameQueue=new window.rafQueue,!1},currentDuplicate:null,_onDuplicateLoaded:function(t,e){this.currentDuplicate=e,this.trigger("duplicate:loaded",e)},currentItem:null,getCurrentDuplicate:function(){return this.currentDuplicate},getDuplicateOriginUrl:function(t){var e=t||this.currentDuplicate;return e.origin&&e.origin.url||e.url||""},setItem:function(t){this.currentItem=t},getItem:function(){return this.currentItem},getItemParams:function(){return this.currentItem.params},_getWheelEvent:function(){return this._wheelEvent||(this._wheelEvent="onwheel"in document||document.documentMode>=9?"wheel":"mousewheel")},showImage:function(t){var e=this.getInstance();e&&(e.isOpened?e.showImage(t):e.open(t))},getInstance:function(){return this._instance}}),BEM.DOM.decl("i-keyrouter",{onSetMod:{js:function(){this.bindToDoc("keydown",function(t){return this.__self.instance=this,document.activeElement&&/(INPUT|TEXTAREA)/.test(document.activeElement.nodeName)?void 0:this._onKeydown(t)})}},_onKeydown:function(t){switch(t.keyCode){case 37:case 65:case 72:this.__self.isSpecialKey(t)&&this.trigger("left",t);break;case 39:case 68:case 76:this.__self.isSpecialKey(t)&&this.trigger("right",t);break;case 32:this.trigger("space",t);break;case 70:this.trigger("f",t);break;case 79:this.trigger("o",t);break;case 86:this.trigger("v",t);break;case 34:this.trigger("pagedown",t);break;case 33:this.trigger("pageup",t);break;case 13:this.trigger("enter",t);break;case 27:this.trigger("esc",t),t.stopImmediatePropagation();break;case 8:this.trigger("backspace",t);break;case 38:case 87:case 75:this.__self.isSpecialKey(t)&&this.trigger("up",t);break;case 40:case 83:case 74:this.__self.isSpecialKey(t)&&this.trigger("down",t)}return!t.isImmediatePropagationStopped()}},{get:function(){return this.instance},isSpecialKey:function(t){return!(t.ctrlKey||t.altKey||t.metaKey||t.shiftKey)}}),BEM.DOM.decl("preview2",{onSetMod:{js:{inited:function(){this.findBlocks().bindEvents().updateWrapperSize()}}},findBlocks:function(){return this._preloader=BEM.create({block:"i-preloader",mods:{timeout:"yes","preview-speed":"yes"}},{checkImageSize:this.params.checkImageSize}),this.thumb=this.elem("thumb"),BEM.blocks["i-global"].getFlag("images_big_thumbs")&&(this.visibleThumb=this.elem("thumb","visible","yes"),this.overlayThumb=this.elem("thumb","overlay","yes")),this._arrowPrev=this.findElem(this.elem("arrow","side","left"),"arrow-image"),this._arrowNext=this.findElem(this.elem("arrow","side","right"),"arrow-image"),this._spin=this.findBlockOn(this.elem("spin"),"spin2"),this._store=window.Ya.Images.ThumbsStore,this},bindEvents:function(){return this.bindTo("wrapper","pointerclick",this._onThumbClick).bindTo("thumb","contextmenu",this._onRightClick).bindTo("arrow","pointerclick",this._onArrowClick).bindTo("image-arrow","pointerclick",this._onArrowClick),this._preloader.on("success",this._onPreloaderSuccess,this).on("notfound",this._onPreloaderNotfound,this).on("timeout",this._onPreloaderTimeout,this).on("error",this._onPreloaderError,this),this},destruct:function(){this._preloader.un("success",this._onPreloaderSuccess,this).un("notfound",this._onPreloaderNotfound,this).un("timeout",this._onPreloaderTimeout,this).un("error",this._onPreloaderError,this),this.__base.apply(this,arguments)},_setOriginImageInOverlay:function(t){return this.overlayThumb.attr("src",this.currentImageOriginUrl),this},load:function(){var t=BEM.blocks["pane2-api"].getItemParams(),e=t.thumb&&t.thumb.url,i=t.images,n=this;if(_.isEmpty(i))return this;var s=this._preloader.getSuccessfulDup(i);if(this._preloader.stop(),s)BEM.blocks["pane2-api"].frameQueue.add(function(){n.hideSpin().setLoadedDup(s)._dupLoaded(s)._setPreview(s,e)._anyLoaded(s)});else{s=i[0];var o={width:s.w,height:s.h,url:e};s.isMixedImage&&(o.isMixedImage=s.isMixedImage,o.origin=s.origin),this.hideSpin().showSpin()._setPreview(o)._anyLoaded(o),BEM.blocks["pane2-api"].frameQueue.add(function(){n._preloader.load(i)})}},setLoadedDup:function(t){return this._loadedDup=t,this},getLoadedDup:function(){return this._loadedDup},_anyLoaded:function(t){this.trigger("duplicate:loaded",t)},_setMaxThumbSize:function(t){return this.elem("thumb").css({"max-width":t.width,"max-height":t.height}),this},_setPreview:function(t,e){return e&&this._setPreviewSrc(e)._setArrowSrc(e),BEM.blocks["i-global"].getFlag("images_big_thumbs")&&this._updateOverlay(t),this._setPreviewSrc(t.url,t.isMixedImage)._setArrowSrc(t.url).setThumbSize(t),this},_updateOverlay:function(t){return t.isMixedImage?(this._showOverlay(),this.currentImageOriginUrl=BEM.blocks["pane2-api"].getDuplicateOriginUrl(t),this):(this._hideOverlay(),this.currentImageOriginUrl="",this)},_hideOverlay:function(){return this.setMod(this.overlayThumb,"hidden","yes")},_showOverlay:function(){return this.delMod(this.overlayThumb,"hidden")},_setPreviewSrc:function(t,e){return BEM.blocks["i-global"].getFlag("images_big_thumbs")?(this.visibleThumb.attr("src",t),this._setOverlaySrc(t,e)):this.thumb.attr("src",t),window.opera&&BEM.blocks["b-page"].forceOperaRepaint(),this},_setOverlaySrc:function(t,e){return e?BEM.blocks["i-ua"].isFirefox?(this._setOriginImageInOverlay(),this):(this.overlayThumb.attr("src",t),this):(this.overlayThumb.attr("src",""),this)},_setArrowSrc:function(t){return this._arrowPrev.attr("src",t),this._arrowNext.attr("src",t),this},_getMaxSquareDiffPercent:function(){return BEM.blocks["i-global"].getFlag("images_viewer_square_diff_percent")||this.__self.MAX_SQUARE_DIFF_PERCENT},setThumbSize:function(t){var e,i={width:t.width||t.w,height:t.height||t.h},n={width:this._wrapper.width,height:this._wrapper.height},s=i,o=n.width/n.height,r=i.width/i.height,a=r>o?"width":"height";return BEM.blocks.pane2.isFullscreen()&&(e=this._getMaxSquareDiffPercent(),BEM.blocks["i-ua"].objectFit&&BEM.blocks["viewer-utils"].isImageCloseToViewport(i,n,e)&&(a="cover",s={width:"100%",height:"100%"})),this.setMod(this.thumb,"fit",a)._setMaxThumbSize(s),this},updateWrapperSize:function(){return this._wrapper={width:this.elem("wrapper").width(),height:this.elem("wrapper").height()},this},_onThumbClick:function(t){this.trigger("thumbClick",t)},_onRightClick:function(t){this.trigger("rightClick",t)},_onArrowClick:function(t){this.trigger("arrowClick",t)},_onPreloaderSuccess:function(t,e){this.hideError().trigger("success",e).hideSpin()._dupLoaded(e)._setPreview(e)._anyLoaded(e)},_onPreloaderNotfound:function(t,e){this.trigger("notfound",e)},_onPreloaderTimeout:function(t,e){this.trigger("timeout",e)},_onPreloaderError:function(){var t=BEM.blocks["pane2-api"].getItemParams().thumb,e={url:t.url,width:t.size.width,height:t.size.height};this.trigger("error",e),this.hideSpin().updateErrorLink().showError()._setPreview(e)._anyLoaded(e)},updateErrorLink:function(){var t=BEM.blocks["pane2-api"].getItemParams();return this.elem("error-link").attr("href",t.snippet.url),this},showError:function(){return this.setMod("error","yes")},hideError:function(){return this.delMod("error")},_dupLoaded:function(t){return this.setLoadedDup(t),this.trigger("loaded",{image:t,stats:this._preloader._getImageStats(t.url)}),this},removeImageParams:function(){return this.elem("thumb").removeAttr("src style"),this},showSpin:function(){var t=this._spin;return this._spinnerTimer=setTimeout(function(){t.setMod("progress","yes")},1e3),this},hideSpin:function(){return clearTimeout(this._spinnerTimer),this._spin.delMod("progress"),this}},{live:function(){BEM.blocks["i-global"].getFlag("images_big_thumbs")&&!BEM.blocks["i-ua"].isFirefox&&this.liveBindTo({elem:"thumb",modName:"overlay",modVal:"yes"},"contextmenu",function(){this._setOriginImageInOverlay()})},MAX_SQUARE_DIFF_PERCENT:25}),BEM.decl("i-preloader",{onSetMod:{js:function(){var t="position: absolute;top: -9999px; left: -9999px;overflow: hidden;width: 10px; height: 10px;";this.__self._history||(this.__self._history=$('<div class="i-preloader__history" style="'+t+'" />').appendTo("body"))}},getDefaultParams:function(){return{checkImageSize:!1}},load:function(t){return t&&t.length?(this.stop(),this.duplicates=t.slice(0),this.preload(this.getNextDuplicate()),this):this},getSuccessfulDup:function(t){for(var e=0,i=t.length;i>e;e++)if("complete"===this.getState(t[e]))return t[e]},preload:function(t){switch(this.image=t,this.getState(t)){case"error":this._onError(t);break;case"complete":t.loadTime=0,this._onSuccess(t);break;default:this.startLoad(t)}},startLoad:function(t){return this.loadImage(t)},loadImage:function(t){return this.setState(t,"loading"),this._loader=this.createLoader(t),this._loader&&this._loader.complete&&this._loader.width>0&&this._loader.height>0&&this._onLoad(this._loader,t),this},stop:function(){return this.destroyLoader()},createLoader:function(t){var e,i=new Image,n=this;return i.onload=function(){this.loadTime=Date.now()-e,n._onLoad(this,t)},i.onerror=function(){n._onError(this,t)},e=Date.now(),i.src=t.url,i},destroyLoader:function(){return this._loader&&(this._loader.onload=this._loader.onerror=null,this._loader.src="",this._loader=null),this},_onLoad:function(t,e){var i=this.toObject(t,e);this.params.checkImageSize&&e&&!this._isSizeMatch(i,this.toObject(e))?(this._onError(i,e,{skipNotFound:!0}),this.trigger("wrongsize",i.url)):!e||e.isMixedImage||this._isFileSizeMatch(t,e)?this._onSuccess(i):(this._onError(i,e,{skipNotFound:!0}),this.trigger("wrongfilesize",i.url))},_onSuccess:function(t){this.stop(),"complete"!==this.getState(t)&&this.setState(t,"complete").saveImage(t),this.trigger("success",t)},_onError:function(t,e,i){var n=i&&i.skipNotFound;t=this.toObject(t,e),"loading"===this.getState(t)&&(this.setState(t,"error"),this.stop(),n||this.trigger("notfound",t.url)),this.duplicates&&this.duplicates.length?this.preload(this.getNextDuplicate()):this.hasMod("batch","yes")||this.trigger("error",t)},_isFileSizeMatch:function(t,e){var i,n,s=e.fileSizeInBytes;if(!s)return!0;if(!window.yandex)return!0;if(i=window.yandex.publicFeature,!i||!i.getImageOriginalSize||!i.getImageSize)return!0;try{n=i.getImageOriginalSize(t)}catch(o){try{n=i.getImageSize(t)}catch(o){return!0}}return n===s},_isSizeMatch:function(t,e){return t.width===e.width||t.height===e.height},setState:function(t,e){return this.__self._state[t.url]=e,this},getState:function(t){return this.__self._state[t.url]},saveImage:function(t){return this.__self._history.append('<img src="'+t.url+'" />'),this},getNextDuplicate:function(){return this.toObject(this.duplicates.shift())},toObject:function(t,e){var i={url:t.url||t.src,origin:e&&e.url,width:parseInt(t.w,10)||parseInt(t.width,10),height:parseInt(t.h,10)||parseInt(t.height,10),fileSizeInBytes:t.fileSizeInBytes,loadTime:t.loadTime};return(t.isMixedImage||e&&e.isMixedImage)&&(i.origin=e&&e.origin||t.origin,i.isMixedImage=!0),i}},{_state:{},_history:null}),BEM.decl("i-preloader",{onSetMod:{js:function(){this.__base.apply(this,arguments),this.on("wrongfilesize",this._onWrongFileSize).on("wrongsize",this._onWrongSize).on("notfound",this._onNotFound)}},_onWrongFileSize:function(t,e){window.Ya.Images.errcnt({src:e},73007)},_onWrongSize:function(t,e){window.Ya.Images.errcnt({src:e},72681)},_onNotFound:function(t,e){window.Ya.Images.errcnt({src:e},2055)}}),BEM.decl({block:"i-preloader",modName:"preview-speed",modVal:"yes"},{loadImage:function(t){return this._getImageStats(t.url)||this._setImageStats(t.url,{start:Number(new Date)}),this.__base.apply(this,arguments)},_onSuccess:function(t){var e=this._getImageStats(t.url);return e&&!e.latency&&(e.latency=Number(new Date)-e.start,this._setImageStats(t.url,e)),this.__base.apply(this,arguments)},_getImageStats:function(t){return this.__self._imagesLoadingStats[t]},_setImageStats:function(t,e){return this.__self._imagesLoadingStats[t]=e,this}},{_imagesLoadingStats:{}}),BEM.decl({block:"i-preloader",modName:"timeout",modVal:"yes"},{totalImages:0,totalTime:0,loadTimeout:15e3,createLoader:function(t){return this._timeout=setTimeout(function(){this._onError(t),this.trigger("timeout",t.url)}.bind(this),this.loadTimeout),this._loadStart=Number(new Date),this.__base.apply(this,arguments)},destroyLoader:function(){return clearTimeout(this._timeout),this._loader&&this._loader.complete&&(this._loadEnd=Number(new Date),this.totalImages++,this.totalTime+=this._loadEnd-this._loadStart,this.totalImages>10&&(this.loadTimeout=Math.max(4*Math.floor(this.totalTime/this.totalImages),6e3))),this.__base.apply(this,arguments)}}),BEM.DOM.decl({block:"i-preloader",modName:"batch",modVal:"yes"},{images:[],onSetMod:{js:function(){this.__base.apply(this,arguments),this.on("success error",this.batchLoad)}},batchLoad:function(){return this.load(this.images.shift()),this},setImages:function(t){return this.images=t,this}}),BEM.decl("viewer-utils",{},{_cacheMemoize:{},isImageCloseToViewport:function(t,e,i){var n,s,o,r=["isImageCloseToViewport",t.width,t.height,e.width,e.height,i].join("");return this._cacheMemoize[r]?this._cacheMemoize[r]:(n=t.width<e.width&&t.height<e.height?t:this.getCoveredImage(t,e),s=this.getSquareDiffPercent(n,e),o=i>=s,this._cacheMemoize[r]=o,o)},getCoveredImage:function(t,e){var i=["getCoveredImage",t.width,t.height,e.width,e.height].join(""),n=t.width/t.height,s={};return this._cacheMemoize[i]?this._cacheMemoize[i]:(t.width===t.height?s.width=s.height=Math.max(e.width,e.height):t.width<t.height?(s.width=e.width,s.height=Math.ceil(s.width/n)):(s.height=e.height,s.width=Math.ceil(s.height*n)),this._cacheMemoize[i]=s,s)},calcImageSizeForViewport:function(t,e){var i=["calcImageSizeForViewport",t.width,t.height,e.width,e.height].join(""),n=t.width/t.height,s=e.width/e.height,o={};return this._cacheMemoize[i]?this._cacheMemoize[i]:t.width<e.width&&t.height<e.height?t:(n>s?(o.width=e.width,o.height=Math.round(t.height*(e.width/t.width))):(o.width=Math.round(t.width*(e.height/t.height)),o.height=e.height),this._cacheMemoize[i]=o,o)},calcSquare:function(t){return t.width*t.height},getSquareDiffPercent:function(t,e){var i=this.calcSquare(t),n=this.calcSquare(e),s=Math.min(i,n),o=Math.max(i,n);return o/s*100-100}}),BEM.DOM.decl("crop-objects",{show:function(){return this.setMod("visibility","visible")},hide:function(){return this.delMod("visibility")},update:function(t){var e=this.domElem.width(),i=this.domElem.height(),n=1e3/e,s=1e3/i,o=t.map(function(t){return{block:"crop-objects",elem:"object",js:t,attrs:{style:["top: "+(t.position.y+t.size.height/2-s)+"%","left: "+(t.position.x+t.size.width/2-n)+"%"].join(";")}}});return BEM.DOM.update(this.domElem,BEMHTML.apply(o)),this},getActiveParams:function(){var t=this.findElem("object","active","yes");return t.length>0?this.elemParams(t):null},resetActive:function(){return this.delMod(this.findElem("object","active","yes"),"active")},_setActive:function(t){return this.setMod(t,"active","yes")},_onObjectClick:function(t){var e=t.data.domElem;this.trigger("click",this.elemParams(e)).resetActive()._setActive(e)}},{live:function(){this.liveBindTo("object","pointerclick",function(t){this._onObjectClick(t)})}}),BEM.DOM.decl("slideshow-controls",{STATE_STOPPED:"stopped",STATE_STARTED:"started",onSetMod:{js:{inited:function(){this._action=this.elem("action"),this._setState(this.STATE_STOPPED)}},hidden:{"":function(){this.delMod("transition")}}},_onActionButtonClick:function(){this._getState()===this.STATE_STOPPED?this.trigger("start"):this.trigger("stop")},_onCloseButtonClick:function(){this.setMod("transition","no"),this.trigger("close")},update:function(t){var e=t.snippet,i=e.redirUrl||e.url;return this.elem("domain").attr("href",i).text(e.domain),this.elem("title").attr("href",i).html(e.title),this},_getState:function(){return this._state},_setState:function(t){this._state=t},hide:function(t){return clearTimeout(this._hideDelayTimeout),t?this._hideDelayTimeout=setTimeout(function(){this.setMod("hidden","yes")}.bind(this),t):this.setMod("hidden","yes"),this},show:function(){return clearTimeout(this._hideDelayTimeout),this.delMod("hidden"),this},play:function(){return this.setMod(this._action,"state","stop"),this._action.attr("aria-label",BEM.I18N("slideshow-controls","",{context:"         "})),this._setState(this.STATE_STARTED),
this},stop:function(){return clearTimeout(this._hideDelayTimeout),this._action.attr("aria-label",BEM.I18N("slideshow-controls","",{context:"         "})),this.setMod(this._action,"state","play"),this._setState(this.STATE_STOPPED),this}},{live:function(){this.liveInitOnBlockInsideEvent("click","button2",function(t){var e=t.target.domElem;this._action.is(e)?this._onActionButtonClick(t):this.elem("close").is(e)&&this._onCloseButtonClick(t)})}}),BEM.DOM.decl("slideshow-controls",{_triggerOnMiddleClick:function(t,e){1===e.button&&this.trigger(t+":click",e.target)}},{live:function(){this.__base.apply(this,arguments),this.liveBindTo("title","pointerclick contextmenu",function(t){this.trigger("title:click",t.target)}).liveBindTo("domain","pointerclick contextmenu",function(t){this.trigger("link:click",t.target)}).liveBindTo("title","click",function(t){this._triggerOnMiddleClick("title",t)}).liveBindTo("domain","click",function(t){this._triggerOnMiddleClick("link",t)})}}),BEM.DOM.decl("gallery",{getDefaultParams:function(){return{animationTime:100,thumbsMargin:10,pages:[],minPage:-1,maxPage:-1}},init:function(){return this},selectItem:function(t){var e=this.findElem("item","selected","yes");return this.delMod(e,"selected").unblur().setMod(t,"selected","yes"),_.isEmpty(e)||window.opera?this._scrollTo(t,e):this._animatedScrollTo(t,e),this},selectItemByID:function(t){this.selectItem(this._getItemBySerpItemId(t))},isSpinVisible:function(t){return Boolean(this.hasMod(this._getSpinner(t),"visibility","visible"))},showSpin:function(t){var e=this._getSpinner(t);return e&&(this._moveSpinner(t),this.setMod(e,"visibility","visible"),this._getSpin2(t).setMod("progress","yes")),this},delSelected:function(){this.delMod(this.findElem("item","selected","yes"),"selected")},_moveSpinner:function(t){var e=this._getSpinner(t),i=this.getCarousel().getList();return"left"===t?e.prependTo(i):e.appendTo(i),this},_getSpinner:function(t){return this.spinner||(this.spinner={}),this.spinner[t]||(this.setContent(BEMHTML.apply({block:this.__self.getName(),elem:"spinner",elemMods:{direction:t},content:{block:"spin2",mods:{size:"m"}}}),t),this.spinner[t]=this.findElem("spinner","direction",t)),this.spinner[t]},_getSpin2:function(t){var e=this._getSpinner(t);return this._spin2||(this._spin2={}),this._spin2[t]||(this._spin2[t]=this.findBlockInside(e,"spin2")),this._spin2[t]},hideSpin:function(t){return this._getSpin2(t).delMod("progress"),this.delMod(this._getSpinner(t),"visibility","visible")},_scrollTo:function(t,e){this.move(this.getScrollPos(t,e))},_animatedScrollTo:function(t,e){this.move(this.getScrollPos(t,e),!0)},getScrollPos:function(t,e){if(_.isEmpty(e))return t.position().left+(this._getItemWidth()+this.params.thumbsMargin)/2;var i=this.getCurrentScrollPos(),n=e.index()<t.index();return this.itemClickOffsetX?this._calcScrollPosByMouseClick(t,e,{isNext:n,currentScrollPos:i}):n?this.isItemLeftFromCenter(t)?i:this.calcItemCenterPos(t):this.isItemRightFromCenter(t)?i:this.calcItemCenterPos(t)},_calcScrollPosByMouseClick:function(t,e,i){var n=this._getItemWidth(),s=this.itemClickOffsetX,o=this.params.thumbsMargin+n/2;return o=i.isNext?n-s+o:-s-o,this.itemClickOffsetX=null,i.currentScrollPos+o},isItemLeftFromCenter:function(t){return t.position().left<this.calcCenterPos()},isItemRightFromCenter:function(t){return t.position().left>this.calcCenterPos()},calcCenterPos:function(){return Math.round(this.getCurrentScrollPos()-this._getItemWidth()/2)},calcItemCenterPos:function(t){return Math.round(t.position().left+this._getItemWidth()/2)},getCurrentScrollPos:function(){return this.getCarouselWrap().scrollLeft()},_getItemWidth:function(){return this._itemWidth||(this._itemWidth=this.elem("item").width())},clear:function(){return this.params.maxPage=-1,this.params.minPage=-1,this.params.pages=[],this.spinner={},this._spin2={},this._uniqIds={},this.getCarousel().elem("list").empty(),this},move:function(t,e){var i=this.getCarouselWrap();return e?(this.hasMod("scrolling")&&i.stop(),this.setMod("scrolling","yes"),void i.animate({scrollLeft:t},{queue:!1,easing:"linear",duration:this.params.animationTime,complete:function(){this.delMod("scrolling"),i.stop()}.bind(this)})):void i.scrollLeft(t)},_onItemClick:function(t){var e,i=t.data.domElem;t.preventDefault(),this.hasMod(i,"selected","yes")||(this.itemClickOffsetX=t.offsetX,e=this._getSerpItemId(i),this.trigger("click",e),$("#"+e).bem("serp-item").sendClickCounter({click_source:"preview"}))},_getSerpItemId:function(t){return t.attr("id").replace("gallery-","")},getDirectionByNum:function(t){var e="direct",i=this.params.maxPage,n=this.params.minPage;return-1===i&&-1===n?e="direct":t>i?e="right":n>t&&(e="left"),e},savePageNum:function(t){return-1===this.params.maxPage&&-1===this.params.minPage?(this.params.maxPage=t,this.params.minPage=t):t>this.params.maxPage?this.params.maxPage=t:t<this.params.minPage&&(this.params.minPage=t),this.params.pages.push(t),this},needAddList:function(t){return-1===_.indexOf(this.params.pages,t)},getPageNumByDirection:function(t){var e;return"left"===t?e=this.params.minPage-1:"right"===t&&(e=this.params.maxPage+1),e},setContent:function(t,e){var i=this.getCarousel();switch(e){case"left":i.prependItemsInListWithInit(t);break;case"right":i.appendItemsInListWithInit(t);break;default:i.setItemsInListWithInit(t)}return window.inNextFrame(i.setScrollMod,i),this},addList:function(t,e){t=$("<div>").append(t),this._removeDuplicates(t);var i=this.prepareItems(t.contents());return this.setContent(i,e),i.length},prepareItems:function(t){return t},_getItemBySerpItemId:function(t){return $("#gallery-"+t)},getCarousel:function(){return this.carousel||(this.carousel=this.findBlockInside("carousel"))},getCarouselWrap:function(){return this.carouselWrap||(this.carouselWrap=this.getCarousel().elem("wrap"))},isScrolling:function(){return this.hasMod("scrolling","yes")},setBase64FromSerpList:function(t){var e=this;return _.forEach(t.getIds(),function(t){var i=e._getItemBySerpItemId(t).find(".gallery__thumb"),n=$("#"+t).find("img").attr("src");i.attr("src",n)}),this},_removeDuplicates:function(t){this._uniqIds||(this._uniqIds={});var e=this;_.forEach(t.find(".gallery__item"),function(t){e._uniqIds[t.id]?$(t).remove():e._uniqIds[t.id]=!0})},insertAfterThumb:function(t,e){this.getCarousel().insertAfterThumb(t,e)},insertBeforeAllThumbs:function(t){this.getCarousel().insertBeforeAllThumbs(t)},blur:function(){this.setMod(this.findElem("item","selected","yes"),"blur",!0)},unblur:function(){return this.delMod(this.findElem("item","selected","yes"),!0),this}},{live:function(){this.liveBindTo("item","pointerclick",function(t){this._onItemClick(t)})}}),BEM.DOM.decl({block:"gallery",modName:"lazy-thumbs",modVal:"yes"},{init:function(){return this.__base.apply(this,arguments),this.findElem("item").each(this._initThumbSrc.bind(this)),this},prepareItems:function(t){return t=this.__base.apply(this,arguments),t.each(this._initThumbSrc.bind(this)),t},_initThumbSrc:function(t,e){var i=e.firstChild,n=i.getAttribute("data-src");if(n){var s=window.Ya.Images.ThumbsStore.get(e.id.substr(8),"fittedItem.newThumbSrc");s&&(n=s),i.src=n,i.removeAttribute("data-src")}}}),BEM.DOM.decl({block:"gallery",modName:"direct-inside-gallery",modVal:"yes"},{_calcScrollPosByMouseClick:function(t,e,i){var n,s,o=this.__base.apply(this,arguments);return i.isNext?(n=t.next().hasClass("direct")?t.next().width()+this.params.thumbsMargin:0,o+=n):(s=t.prev().hasClass("direct")?t.prev().width()+this.params.thumbsMargin:0,o-=s),o}}),BEM.DOM.decl("snippet2",{show:function(){this.delMod("hidden")},hide:function(){this.setMod("hidden","yes")},update:function(t){this.__base.apply(this,arguments);var e=t.snippet,i=e.domain,n=BEM.blocks["i-global"].param("isPumpkin")?e.url:e.redirUrl;return this.elem("link").attr("href",n).text(i),this.elem("title").attr("href",n).html(e.title),this.elem("text").html(e.text),this.trigger("updated"),this},_triggerOnMiddleClick:function(t,e){1===e.button&&this.trigger(t+":click",e.target)}},{live:function(){this.liveBindTo("title","pointerclick contextmenu",function(t){this.trigger("title:click",t.target)}).liveBindTo("link","pointerclick contextmenu",function(t){this.trigger("link:click",t.target)}).liveBindTo("title","click",function(t){this._triggerOnMiddleClick("title",t)}).liveBindTo("link","click",function(t){this._triggerOnMiddleClick("link",t)})}}),BEM.DOM.decl({block:"pane2",modName:"ajax-direct",modVal:"yes"},{open:function(){var t,e=this.__base.apply(this,arguments),i=this.blockInside("direct-updater");return BEM.blocks["i-global"].getFlag("images_doge_ajax_direct_force_bottom")||!i?e:(t=i.getCommercialThreshold(),BEM.blocks["i-global"].param("cm2")>=t?this.setMod("direct-position","top"):this.delMod("direct-position"),e)},updateCommercial:function(t){return this.blockInside("direct-updater").update(t).then(this._onDirectShow.bind(this)).fail(this._onDirectHide.bind(this))},_onDirectShow:function(t){return this.showDirect(),t},_onDirectHide:function(){this.hideDirect()},showDirect:function(){(this.hasMod("direct-position","top")||this.hasMod("market","yes"))&&this.setMod(this.elem("delimiter","direct"),"visible",!0)},hideDirect:function(){this.delMod(this.elem("delimiter","direct"),"visible")}}),BEM.DOM.decl({block:"pane2",modName:"ie-fix",modVal:!0},{updateInfoPanel:function(){var t=this.__base.apply(this,arguments),e=this.blockInside("market-snippet2"),i=this.blockInside("snippet2");return this.afterCurrentEvent(function(){e&&this._updateElemStyleHeight(e.elem("title"))._updateElemStyleHeight(e.elem("content"))._updateElemStyleHeight(e.elem("foot")),i&&this._updateElemStyleHeight(i.elem("title"))}.bind(this)),t},_updateElemStyleHeight:function(t){return t.removeAttr("style"),t.height(t.height()),this}}),BEM.DOM.decl("related2",{ANIMATION_TIMEOUT:20,onSetMod:{js:{inited:function(){this.bindEvents()}}},destruct:function(){this.unbindEvents(),this.__base.apply(this,arguments)},bindEvents:$.noop,unbindEvents:$.noop,load:function(t){return this.currentRimId=t.rimId,this._updateRim(t)},show:function(){this.setMod("visible",!0),this.hasMod("animation")&&setTimeout(function(){this.setMod("animation","done")}.bind(this),this.ANIMATION_TIMEOUT)},transparent:function(){this.setMod("visible","transparent")},hide:function(){this.delMod("visible"),this.hasMod("animation")&&this.setMod("animation","idle")},_getRimContentBEMJSON:function(t){return{block:"tiled-images",mods:{preload:this._getRimLoader().hasPreloader()?"yes":"",wide:!0},mix:{block:this.__self.getName(),elem:"tiled-images"},js:this._getRimParams(),content:{elem:"items",content:t.map(function(t){return{elem:"item",placeHolderColor:BEM.blocks["i-global"].getFlag("images_rim_thumb_placeholder_color"),url:t.thumb.url,width:t.thumb.size.width,height:t.thumb.size.height}})}}},_getRimParams:function(){for(var t,e=window.innerHeight,i=this.params.config,n=0;n<i.length;n++)if(t=i[n],e>t.minHeight&&(!t.maxHeight||e<t.maxHeight))return t;return i[0]},_getRimLoader:function(){return this._rimLoader||(this._rimLoader=BEM.create({block:"rim-data"})),this._rimLoader},_startLoadRim:function(){if(this._getRimLoader().hasPreloader()){var t=this.findBlockInside("tiled-images");t&&t.startLoad().then(function(){this.trigger("rim-loaded",this._getVisibleRimImages())}.bind(this))}},setContent:function(t,e){var i=this.findElem(t);i.length&&BEM.DOM.update(i,e)},_updateRim:function(t){this._dfd&&this._dfd.reject(),this._dfd=$.Deferred();var e=t.rimId;return this._getRimLoader().get(e).then(function(t){return this.currentRimId!==e?void this._dfd.reject():(this._rimSimilar=t,this.transparent(),void this.setContent("content",BEMHTML.apply(this._getRimContentBEMJSON(t))))}.bind(this)).fail(function(t){this.currentRimId===e&&(404===t.status&&this.trigger("rim-not-found"),this._rimSimilar=[],this.setContent("content",""),this.hide(),this._dfd.reject())}.bind(this)),this._dfd.promise()},_onRelatedFitted:function(){this.hide(),this._dfd.resolve(this),setTimeout(function(){this._startLoadRim()}.bind(this),BEM.blocks["i-global"].getFlag("images_rim_thumb_preload_delay")||0)},_getVisibleRimImages:function(){var t=this.findBlockInside("tiled-images");if(t)return this._getRimLoader().getImagesForCounter(this._rimSimilar,t.getVisibleThumbUrls())},_onThumbClick:function(t){var e={params:this._rimSimilar[t.index],isRim:!0};this.trigger("rim-click",e)}},{live:function(){this.liveInitOnBlockInsideEvent("thumb-click","tiled-images",function(t,e){this._onThumbClick(e)}),this.liveInitOnBlockInsideEvent("images-fitted","tiled-images",function(){this._onRelatedFitted()})}}),BEM.DOM.decl({block:"related2",modName:"preload-data",modVal:!0},{bindEvents:function(){this.__base.apply(this,arguments),this._getRimLoader().on("loaded error",this._onRimLoadComplete,this)},unbindEvents:function(){this._getRimLoader().un("loaded error",this._onRimLoadComplete,this),this.__base.apply(this,arguments)},load:function(t,e){this._dfd&&this._dfd.reject(),this._dfd=$.Deferred();var i=this._getLoadedRim(t.rimId);return this.preloadRim(t,e),i&&this._updateRim(i),this._dfd.promise()},_getLoadedRim:function(t){return this._getRimLoader().getLoaded(t)},_noRimData:function(t){return!this._getLoadedRim(t.rimId)},preloadRim:function(t,e){var i=e.filter(this._noRimData.bind(this)).map(function(t){return{id:t.rimId}});this._getRimLoader().batchLoad(i)},_updateRim:function(t){var e=t&&t.data;return e?(this._rimSimilar=e,this.transparent(),void this.setContent("content",BEMHTML.apply(this._getRimContentBEMJSON(e)))):(this.hide(),void this._dfd.reject())},_onRimLoadComplete:function(t,e){e.id===BEM.blocks["pane2-api"].getItemParams().rimId&&this._updateRim(e)}}),BEM.decl({block:"rim-data",baseBlock:"batch-data-loader"},{getDefaultParams:function(){return{path:"rim"}},_getConfig:function(){return this._config||(this._config=BEM.blocks["i-global"].param("rimConfig")),this._config},hasPreloader:function(){return this._getConfig().thumb.preload},get:function(t){return BEM.blocks["i-global"].getFlag("gemini")?$.Deferred().reject({}):this._getRequest({id:t}).then(function(t){var e=this._convert(t);return this.trigger("load",e),e}.bind(this))},getImagesForCounter:function(t,e){for(var i,n,s=[],o=0;o<t.length;o++)i=t[o],n=this.getImageUrl(i),e[i.thumb.url]&&s.push(this._prepareImageIdUrlPair(i.id,n));return s},_prepareImageIdUrlPair:function(t,e){return t+":"+encodeURIComponent(e).replace(/\*/g,"%2A")},_buildThumbUrl:function(t,e){var i=this._getConfig(),n=this._getThumbHostNum(t,i),s=i.thumb.hosts[n],o=e||i.thumb.params;return"https://"+s+"/i?id="+t+"&"+$.param(o)},_getThumbHostNum:function(t,e){var i=e.thumb.hostNumPriority;return i&&i>0&&i<=e.thumb.hosts.length?i-1:parseInt(t,16)%e.thumb.hosts.length},_load:function(){return BEM.blocks["i-global"].getFlag("gemini")?$.Deferred().reject({}):this.__base.apply(this,arguments)},_getRequest:function(t){var e=t.id,i=this._getConfig(),n={docid:e,lang:i.rim.lang},s="https://"+i.rim.host+"/"+this.params.path;return i.rim.urlParams&&(n=$.extend(n,i.rim.urlParams)),$.ajax({url:s,data:n,type:"GET",timeout:3e4})},getImageUrl:$.noop,_convert:$.noop}),BEM.decl("rim-data",{getImageUrl:function(t){return t.preview[0].url},_convert:function(t){return t.rld.map(function(t,e){var i=t.s[0],n=t.s[0],s=t.bid?[{w:t.btw,h:t.bth,url:this._buildThumbUrl(t.bid,{n:13}),origin:{w:n.iw,h:n.ih,url:n.iu},isMixedImage:!0}]:null;return{id:t.id,rimId:t.id,pos:e,docid:t.zid,thumb:{size:{width:t.tw,height:t.th},url:this._buildThumbUrl(t.tid)},preview:s||t.s.map(function(t){return{w:t.iw,h:t.ih,url:t.iu}}),dups:[],snippet:{text:"",title:i.t,url:i.pu,redirUrl:i.pu,domain:i.ph,hasTitle:!0}}},this)}}),BEM.DOM.decl("tiled-images",{onSetMod:{js:{inited:function(){this.fitImages().bindEvents()}}},getDefaultParams:function(){return{rowsNumber:2,baseRowHeight:60}},bindEvents:function(){return this.bindToWin("orientchange",this._onOrientChange),this},_onOrientChange:function(){this.fitImages()},fitImages:function(){var t=this;return setTimeout(function(){if(t.domElem){var e=t.elem("items")[0];e.style.width="",BEM.blocks.justifier.fitImages({container:e,containerWidth:e.offsetWidth,itemSelector:".tiled-images__item",linkSelector:".tiled-images__link",baseRowHeight:t.params.baseRowHeight,rowsNumber:t.params.rowsNumber,isReduceNesting:!0}),t.trigger("images-fitted")}},0),this},_onThumbClick:function(t,e){var i,n=this.elem("thumb").index(e.target);0>n||(i=this.elem("item")[n],this.delMod(this.elem("item","selected",!0),"selected"),this.setMod($(i),"selected",!0),this.trigger("thumb-click",{index:n,href:e.target.src}))},_onButtonClick:function(t,e){this.trigger("button-click",{href:e.target.href})},getVisibleThumbUrls:function(){var t={};return this.domElem?(this.findElem("thumb").filter("[src]:visible").map(function(e,i){t[i.src]=!0}),t):t}},{live:function(){return this.liveInitOnBlockInsideEvent("click","link",function(t,e){var i=t.target.domElem;this.elem("items").is(i)?this._onThumbClick(t,e.domEvent):this.elem("button").is(i)&&this._onButtonClick(t,e.domEvent)}),!1}}),BEM.DOM.decl({block:"tiled-images",modName:"preload",modVal:"yes"},{destruct:function(){this._images=null,this._dfd=null,this.__base.apply(this,arguments)},startLoad:function(){return this._dfd&&this._dfd.reject(),this._dfd=$.Deferred(),setTimeout(function(){this.domElem&&this._loadVisibleImages()}.bind(this),0),this._dfd},_loadVisibleImages:function(){var t;this._images=this.elem("thumb").filter("[data-url]:visible").map(function(t,e){var i=new Image,n=e.getAttribute("data-url");return{image:i,src:n,thumb:e}}).toArray(),t=this.calcChunkSize(this._images.length,this.params.rowsNumber,this.params.chunkSize),this._loadImages(this._images,t)},calcChunkSize:function(t,e,i){return i?"row-count"===i?Math.ceil(t/e):(i=parseInt(i),i||t):t},_loadImages:function(t,e){if(t.length){var i=this._chunks(t,e),n=this;i.reduce(function(t,e,s){return t=t?t.then(function(){return n._loadChunk(e)}):n._loadChunk(e),s===i.length-1&&(t=t.then(function(){n._dfd&&n._dfd.resolve()})),t},null)}},_chunks:function(t,e){for(var i=[],n=0,s=e;n<t.length;)i.push(t.slice(n,s)),n=s,s+=e;return i},_loadChunk:function(t){var e=this._onLoad.bind(this),i=t.map(function(t){var i=$.Deferred();return t.image.onload=function(){e(t.image,t.thumb),i.resolve()},t.image.src=t.src,i});return $.when.apply($,i)},stopLoad:function(){this._images&&(this._dfd&&(this._dfd.reject(),this._dfd=null),this._images.forEach(function(t){t.src="",t.onload=null}),this._images=null)},_onLoad:function(t,e){this._images&&(e.src=t.src,e.removeAttribute("data-url"))},_onOrientChange:function(){this.__base.apply(this,arguments),this.afterCurrentEvent(this.startLoad)}}),BEM.DOM.decl("sizes",{onSetMod:{js:{inited:function(){this._store=window.Ya.Images.ThumbsStore,this.bindEvents()}}},bindEvents:function(){this.getDropdown().on("beforeOpen",this._onPopupShow,this),this.getDownload().bindTo({contextmenu:this._onClick.bind(this),click:this._onClick.bind(this)}),BEM.blocks["pane2-api"].on("pane:close",this._onPaneClose,this)},unbindEvents:function(){return this.getDropdown().un("beforeOpen",this._onPopupShow,this),BEM.blocks["pane2-api"].un("pane:close",this._onPaneClose),this},destruct:function(){this.unbindEvents(),this.__base.apply(this,arguments)},_onPopupShow:function(){this._updateLinks()},_onClick:function(){this.trigger("download")},_onPaneClose:function(){this.getDropdown().hasMod("opened","yes")&&this.getDropdown().delMod("opened")},getDropdown:function(){return this._dropdown||(this._dropdown=this.findBlockOn("dropdown","dropdown2"))},getDownload:function(){return this._downloadButton||(this._downloadButton=this.findBlockOn("download","button2")),this._downloadButton},getDownloadSwitcher:function(){return this._downloadSwitcher||(this._downloadSwitcher=this.findBlockOn("download","button2"))},getDownloadDOMNode:function(){return this.elem("download")[0]},_updateButton:function(t){var e=this.getDownload(),i=t;return this.__self.isSameImages(this._image,t)?void 0:(t.origin&&(i=t.origin),this.elem("width").text(i.w),this.elem("height").text(i.h),e.setUrl(i.url),this._image=t,this)},_updateLinks:function(){var t,e=BEM.blocks["pane2-api"].getItemParams(),i=_.filter(e.dups,this._isDupSuccessful.bind(this)),n=e.reqid;this.getDropdown().getPopup().setContent(BEMHTML.apply({block:"menu",mods:{type:"navigation",theme:"normal",size:"m",width:"max"},items:i.map(function(i,s){t=i.origin||i;var o=BEM.blocks["i-global"].getFlag("delegate_counters"),r={dtype:"iweb",path:"/image/new/preview/duplicates/image/othersize/p"+(s+1),vars:"-pos="+e.pos,reqid:n};return{url:t.url,"data-counter":o?JSON.stringify(["hit",r]):null,counter:o?null:"c.hit("+JSON.stringify(r)+")",target:"_blank",text:t.w+""+t.h}})}))},_isDupSuccessful:function(t){var e=BEM.blocks["pane2-controller"]._encodeUrlForStore(t.url);return!this._store.get(BEM.blocks["pane2-api"].getItemParams().id,"dups.broken."+e)},update:function(t){return this._toggleDropdownButton()._updateButton(t)},_toggleDropdownButton:function(){var t=BEM.blocks["pane2-api"].getItemParams();return t.dups.length<=1?this._hideDropdown():this._showDropdown(),this},_showDropdown:function(){this.delMod("hide-dropdown")},_hideDropdown:function(){this.setMod("hide-dropdown","yes")},setButtonTheme:function(t){this.getDownload().setMod("theme",t),this.getDownloadSwitcher().setMod("theme",t)}},{isSameImages:function(t,e){var i,n;return t&&e?(i=t.origin||t,n=e.origin||e,i.url===n.url&&i.w===n.w&&i.h===n.h):void 0}}),BEM.DOM.decl({block:"popup2",modName:"target",modVal:"position"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._position=null}},visible:{yes:function(){this.__base.apply(this,arguments)}}},setPosition:function(t,e){return this._position={left:t,top:e},this._setVisible(),this.redraw()},_calcTargetDimensions:function(){var t=this._position;return{left:t.left,top:t.top,width:0,height:0}}}),BEM.DOM.decl({block:"popup2",modName:"key-closable",modVal:"yes"},{onSetMod:{visible:{yes:function(){this.afterCurrentEvent(function(){this.domElem&&this.bindToDoc("keydown",this._onDocKeyPress)}),this.__base.apply(this,arguments)},"":function(){this.unbindFromDoc("keydown",this._onDocKeyPress).__base.apply(this,arguments)}}},_onDocKeyPress:function(t){BEM.blocks.keycodes.is(t.keyCode,this.__self._navigationKeys)&&this.delMod("visible")}},{_navigationKeys:["SPACE","LEFT","RIGHT","UP","DOWN"]}),BEM.DOM.decl({block:"dropdown2",modName:"switcher",modVal:"button2"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._tickerIcon=this.findBlockOn("arrow","icon")}},opened:function(t,e){this.__base.apply(this,arguments),this.hasMod("has-tick")&&this._tickerIcon.toggleMod("direction","top","bottom",Boolean(e))}}},{live:function(){return this.liveInitOnBlockInsideEvent("click","button2",function(t){this._onSwitcherClick(t)}),this.__base()}}),BEM.DOM.decl("disk-button",{getDefaultParams:function(){return{i18n:{notEnoughSpace:BEM.I18N("disk-button","   {br}  .{br}",{br:"<br />",context:"        https://nda.ya.ru/3R7FTd"}),increaseSpace:BEM.I18N("disk-button","   ",{context:"        https://nda.ya.ru/3R7FTd"}),somethingWrong:BEM.I18N("disk-button","! -   .{br}  {br}  .",{br:"<br />",context:"        https://nda.ya.ru/3R7FTi"}),socialAuth:BEM.I18N("disk-button","{authorize}   {br},  {br}  .",{context:" :     ,     .",br:"<br />",authorize:BEMHTML.apply({block:"link",mods:{theme:"normal"},mix:[{block:"disk-button",elem:"auth-link"}],url:"#",content:BEM.I18N("disk-button","",{context:" ,  :     ,     ."})})})},hideTimeout:3e3}},onSetMod:{js:{inited:function(){BEM.blocks.button2.on(this.domElem,"click",this._onClick,this)}}},destruct:function(){BEM.blocks.button2.un(this.domElem,"click",this._onClick,this),this.__base.apply(this,arguments)},disable:function(){return this._getButton().setMod("disabled","yes")},enable:function(){return this._getButton().delMod("disabled")},setSaved:function(){this.setMod("saved","yes"),this._changeIcon("disk","check"),this.disable()},setNotSaved:function(){this.delMod("saved"),this._changeIcon("check","disk"),this.enable()},showError:function(t){var e=this.params.i18n;switch(t){case"not-enough-space":this._showPopup("not-enough-space",[e.notEnoughSpace,{block:"link",mods:{theme:"normal"},url:"https://disk.yandex."+BEM.blocks["i-global"].param("tld")+"/tuning?source=save_images",target:"_blank",content:e.increaseSpace}]);break;case"social-auth":this._showPopup("social-auth",e.socialAuth);break;default:this._showPopup("something-wrong",e.somethingWrong)}return this},hidePopups:function(){return _.forEach(this._popup,function(t){t&&t.hide()}),this},_changeIcon:function(t,e){var i=this.findBlockInside({block:"icon",modName:"type",modVal:t});i&&i.setMod("type",e)},_bindPopupEvents:function(t){return"social-auth"===t&&this.bindTo("auth-link","pointerclick",this._onAuthLinkClick.bind(this)),this},_onClick:function(t){var e=BEM.blocks["serp-item"].getCurrent();t.preventDefault(),this.trigger("click"),c.hit({dtype:"stred",pid:40,cid:72947,path:"preview.disk.save",vars:"-pos="+e.params.pos},e.domElem)},_onAuthLinkClick:function(t){t.preventDefault(),this.trigger("auth:click"),this._getPopup("social-auth").hide()},_showPopup:function(t,e,i){var n=this._getPopup(t,e,i);return n&&n.show(this.domElem),-1!==["not-enough-space","something-wrong"].indexOf(t)&&this._hidePopupsTimeout(),this},_getPopup:function(t,e,i){return this._popup||(this._popup={}),this._popup[t]||this._createPopup(e,i)._bindPopupEvents(t),this._popup[t]||(this._popup[t]=this.findBlockOn("popup","popup"))},_createPopup:function(t,e){return BEM.DOM.append(this.domElem,BEMHTML.apply({block:"disk-button",elem:"popup",content:t,paranja:e})),this},_getButton:function(){return this._button||(this._button=this.findBlockOn("button","button2"))},_hidePopupsTimeout:function(){return setTimeout(this.hidePopups.bind(this),this.params.hideTimeout),this}},{live:function(){this.liveInitOnEvent("pointerclick")}}),BEM.DOM.decl("search-by-image",{onSetMod:{js:{inited:function(){this._button=this.findBlockInside("button2"),this._button.on("click",this._onButtonClick,this)}}},destruct:function(){this._button.un("click",this._onButtonClick,this),this.__base.apply(this,arguments)},_onButtonClick:function(){this.trigger("click",{url:this._currentImgUrl})},update:function(t){return this._currentImgUrl=t,this._button.setUrl(this._getViewUrl(t)),this},getCroppedViewUrl:function(t,e){var i=this._getViewParams(t);return e&&(i.crop=e),i.rpt="imagelike",this._buildViewUrl(i)},_getViewUrl:function(t){return this._buildViewUrl(this._getViewParams(t))},_buildViewUrl:function(t){return BEM.blocks.uri.buildRelativeUrl(BEM.blocks["i-global"].param("router").search,t)},_getViewParams:function(t){return{text:BEM.blocks["i-global"].param("query"),rpt:"imageview",url:t}}}),BEM.DOM.decl("open-image",{update:function(t){var e=t.preview[0];this.domElem.attr("href",e.url),this.findBlockOn("button").elem("sizes").html(" "+e.width+""+e.height)}}),BEM.DOM.decl("share",{YA_SHARE_URL:"//yastatic.net/share2/share.js",onSetMod:{js:{inited:function(){this.on("loaded",this._onLoaded,this)}}},update:function(t){return t?(this._updateCurrentLinkParams(t),this._updater.apply(this,arguments)):void 0},updateLinks:$.noop,updateLink:$.noop,destruct:function(){this.un("loaded",this._onLoaded,this),this._destroyYaShareInstances(),this.__base.apply(this,arguments)},_load:function(){if(window.Ya.share2)return $.Deferred().resolve().promise();var t=this;return $.ajax({dataType:"script",cache:!0,url:this.YA_SHARE_URL}).done(function(){t._checkScriptInited().done(function(){t.trigger("loaded")})})},_checkScriptInited:function(){var t,e=$.Deferred(),i=10,n=0,s=50;return t=setInterval(function(){n++,n===i?(clearInterval(t),e.reject()):window.Ya.share2&&(clearInterval(t),e.resolve())},s),e.promise()},_initYaShareInstance:function(t,e){var i=this;return e=e||{},window.Ya.share2(t,{content:e.content,hooks:{onshare:function(t){i._onServiceShare(t)}}})},_onServiceShare:function(t){var e=this.params.serviceStredParams,i={};e&&(i.path=e.path.replace("${service}",t),i.cid=e.cid,i.pid=e.pid,cp(i,this))},_updateLinks:function(t,e){t&&t.updateContent(e)},_updateLink:function(t,e,i){var n={};return n[e]=i,t&&t.updateContentByService(n),this},_updateCurrentLinkParams:function(t){t&&(this._currentLinkParams=this._buildLinkParams(t))},_destroyYaShareInstances:$.noop,_updater:$.noop,_onLoaded:$.noop,_buildLinkParams:$.noop}),BEM.DOM.decl("share",{_buildLinkParams:function(t){var e=BEM.blocks["b-page"].getInstance().getSeo(),i=t.description?$.clearText(t.description)+" #yandeximages":"#yandeximages",n=BEM.blocks.location.getInstance().getState().url;return{description:i,title:e.shareTitle.replace(" - ","  "),image:t.bestShareDup?_.get(t.bestShareDup,"origin.url")||t.bestShareDup.url:"",url:n+(n.indexOf("?")>-1?"&":"?")+"ts="+String((new Date).getTime())}}}),function(t){t.clearText=function(t){var e=document.createElement("div");return e.innerHTML=t,e.textContent}}(jQuery),BEM.DOM.decl({block:"share",modName:"type",modVal:"dropdown"},{updateLinks:function(t){this._updateLinks(this._YaShareInstance,t)},updateLink:function(t,e){return this._updateLink(this._YaShareInstance,t,e)},_updater:function(){this.updateLinks(this._currentLinkParams)},_onLoaded:function(){var t=this._getDropDown();this._YaShareInstance=this._initYaShareInstance(this.elem("share-services").get(0)),t.on("beforeOpen",function(){this.trigger("beforeOpen")},this),this.trigger("beforeOpen"),t.getPopup().redraw()},_getDropDown:function(){return this._dropdown||(this._dropdown=this.findBlockInside("dropdown2"))},_onServiceShare:function(){this.__base.apply(this,arguments),this._getDropDown().getPopup().delMod("visible")},_destroyYaShareInstances:function(){this._YaShareInstance&&this._YaShareInstance.destroy()}},{live:function(){this.liveInitOnBlockInsideEvent("init","dropdown2",function(){this.elem("share-services"),this._load()})}}),BEM.DOM.decl("similar-offers",{getDefaultParams:function(){return{renderConfig:{plain:[{minHeight:0,maxHeight:650,count:0},{minHeight:650,maxHeight:800,count:2},{minHeight:800,count:4}],market:[{minHeight:0,maxHeight:845,count:0},{minHeight:845,maxHeight:1030,count:2},{minHeight:1030,count:4}]}}},show:function(t){var e=this._getShownSimilarOffersCount(t);return this.setMod("visible",!0),e>0&&this._triggerShown(e),this},hide:function(){return this.delMod("visible").clear()},isVisible:function(){return this.hasMod("visible",!0)},getConfig:function(t){for(var e,i=window.innerHeight,n=this.params.renderConfig[t||"plain"],s=0;s<n.length;s++)if(e=n[s],i>=e.minHeight&&(!e.maxHeight||i<e.maxHeight))return e;return n[0]},render:function(t){var e={block:"similar-offers",elem:"items",items:t};return t.length&&(this._similarOffersCount=t.length),this._render(e)},clear:function(){return this._render("")},_render:function(t){var e=BEMHTML.apply(t);return BEM.DOM.update(this.elem("wrapper"),e),this},_triggerShown:function(t){this.trigger("show",{count:t})},_getShownSimilarOffersCount:function(t){var e=this.getConfig(t);return Math.min(e.count,this._similarOffersCount)}},{live:function(){this.liveInitOnBlockInsideEvent("click","similar-offers-item",function(t,e){this.trigger("click",e)})}}),BEM.DOM.decl("similar-offers-item",{_onClick:function(t){this.trigger("click",{type:t,pos:this.getMod("pos")})}},{live:function(){this.liveBindTo("image-link","pointerclick",function(){this._onClick("thumb");
}).liveBindTo("title","pointerclick",function(){this._onClick("title")}).liveBindTo("domain","pointerclick",function(){this._onClick("greenurl")})}}),BEM.DOM.decl({block:"similar-offers",modName:"theme",modVal:"for-scroll"},{_getShownSimilarOffersCount:function(){return Math.min(4,this._similarOffersCount)},_render:function(t){return t&&(t.itemMods={theme:"for-scroll"}),this.__base.apply(this,[t])}}),BEM.DOM.decl("image-source",{show:function(){this.delMod("hidden")},hide:function(){this.setMod("hidden","yes")},update:function(t,e){var i=BEM.I18N("image-source","   {domain}",{domain:t,context:"domain -      "});return BEM.DOM.update(this.domElem,BEMHTML.apply({block:"link",theme:"normal",target:"_blank",url:e,content:i,mix:{block:"image-source",elem:"link"}})),this}},{live:function(){this.liveBindTo("pointerclick",function(){this.trigger("click")})}}),BEM.DOM.decl("market-snippet",{updateMod:function(t){return"direct"===t.source?(this.delMod("market"),this.setMod("direct","yes")):(this.delMod("direct"),this.setMod("market","yes")),this},update:function(t,e,i,n){return this.setCurrent(t)._updateTitle(t)._updateText(t.text)._updateImageUrl(t.image_url)._updateImageHref(t.url)._updateOffers(i,t,n),t.domain&&t.money_id&&this._hitSnippetShownCounter(t),this},setCurrent:function(t){return this._snippet=t,this},getCurrent:function(){return this._snippet},_hitSnippetShownCounter:function(t){c.hitDelayed({dtype:"iweb",path:"/image/new/preview/commercial/show/"+t.source,domain:encodeURIComponent(t.domain),money_id:t.money_id})},_updateImageUrl:function(t){return this._hasBindedToImgLoad||(this.bindTo(this.elem("img"),"load",this._imgLoaded),this._hasBindedToImgLoad=!0),t?this.elem("img").attr("src",t):(this.elem("img").attr("src",""),this.setMod(this.elem("preview"),"hidden","yes")),this},_updateTitle:function(t){var e=this.elem("title");return e.html(t.title),this.hasMod(e,"type","organic")&&e.attr("href",t.url),this},_updateImageHref:function(t){return this.elem("image-wrapper").attr("href",t),this},_updateText:function(t){var e=this.elem("text");return _.isEmpty(e)||_.isEmpty(t)?(this.setMod("text-empty","yes"),this):(e.html(t),this.delMod("text-empty").setMod("text-short",this._isShortText(t.length)?"yes":""),this)},_updatePrice:function(t){return t.price?(this.findElem("price-value").text(t.visiblePrice),t.oldPrice?(this.elem("old-price-value").text(t.visibleOldPrice),this.delMod(this.elem("old-price"),"visibility")):this.setMod(this.elem("old-price"),"visibility","hidden"),t.discount?(this.elem("discount-percent").text(t.discount+"%"),this.delMod(this.elem("discount"),"visibility")):this.setMod(this.elem("discount"),"visibility","hidden"),this.delMod(this.elem("money"),"visibility")):this.setMod(this.elem("money"),"visibility","hidden"),this},getOfferPos:function(t){return this.getMod(t,"pos")},getLinkType:function(t){return this.getMod(t,"link-type").replace("-","_")},isEnabled:function(t){return Boolean(t&&t.length)}},{live:function(){this.__base.apply(this,arguments),this.liveBindTo("title","pointerclick",function(t){this.trigger("market:title:click",t.target)}),this.liveBindTo("image-wrapper","pointerclick",function(t){this.trigger("market:thumb:click",t.target)}),this.liveBindTo("greenurl","pointerclick",function(t){this.trigger("market:link:click",t.target)}),this.liveBindTo("shopping-button","pointerclick",function(t){this.trigger("market:button:click",t.data.domElem[0])})}}),BEM.DOM.decl({block:"market-snippet",modName:"market",modVal:"yes"},{_hasBindedToImgLoad:!1,update:function(t,e,i,n){this.__base.apply(this,arguments);var s=Boolean(t.url.indexOf("market.yandex.ru")+1);return this._setTexts(s),this},_isShortText:function(t){return 32>t},_setTexts:function(t){this.elem("advertising-label").text(BEM.I18N("market-snippet",".",{context:"     .     "}));var e=t?BEM.I18N("market-snippet","  .",{context:"     .   ,  "}):BEM.I18N("market-snippet","   ",{context:"     .   ,  "});return this.findElem("button-text").text(e),this},_getMarketContentBEMJSON:function(t,e,i){return[{block:"market-snippet",elem:"single-offer",item:e,url:i.url},{block:"market-snippet",elem:"shopping-button",elemMods:{text:"price","link-type":i.type},text:[{elem:"button-price",mix:{elem:"money"}},{elem:"button-text"}],more:{url:e.url},content:{block:"market-icon"}}]},_updateOffers:function(t,e,i){return BEM.DOM.update(this.elem("market-offers-wrapper"),BEMHTML.apply(this._getMarketContentBEMJSON(t,e,i))),this._updatePrice(e),this},_imgLoaded:function(t){this.toggleMod(this.elem("preview"),"hidden","yes",1===t.target.height)},_prepareOffers:function(t){for(var e=[],i=1;i<t.length;i++)t[i].url=t[i].url||t[i].market_url||"",e.push(t[i]);return e}},{}),BEM.DOM.decl({block:"market-snippet",modName:"direct",modVal:"yes"},{update:function(t,e){return this.__base.apply(this,arguments),t.link_head&&t.link_tail&&this._hitDisplayCounterForDirect(e,t.link_head,t.link_tail),this._setTexts()._updatePrice(t),BEM.blocks["i-global"].getFlag("images_market_snippet_greenurl_after_title")&&this._updateGreenurlText(t),this},_updateGreenurlText:function(t){return this.elem("greenurl").text(t.domain),this},_hitDisplayCounterForDirect:function(t,e,i){var n=window.Ya.Images.ThumbsStore.get(t,"isDirectCounterSent");return n||$.ajax({url:e+i,dataType:"script",cache:!0,async:!0,success:function(){window.Ya.Images.ThumbsStore.set(t,"isDirectCounterSent",!0)}}),this},_setTexts:function(){return this.elem("advertising-label").text(""),this.elem("label").text("  "),this},_getContentBEMJSON:function(t){return[{block:"market-snippet",elem:"single-offer",item:t,flag:!1,url:t.model_url},{block:"market-snippet",elem:"shopping-button",elemMods:{text:"price"},text:"  ",more:{url:t.url},content:{block:"market-icon"}}]},_updateOffers:function(t,e){return BEM.DOM.update(this.elem("market-offers-wrapper"),BEMHTML.apply(this._getContentBEMJSON(e))),t&&1===t.length&&this._updatePrice(e),this}}),BEM.DOM.decl({block:"market-snippet",modName:"button",modVal:"compact"},{update:function(t,e,i,n){return this.__base.apply(this,arguments),this._setGreenUrlHref(t,n),this},_setGreenUrlHref:function(t,e){var i=this.hasMod("market","yes")?e.url:t.url;return this.elem("greenurl").attr("href",i),this},_getMarketContentBEMJSON:function(t,e,i){var n=this.__base.apply(this,arguments);return n&&n.length?("single-offer"===n[0].elem&&(n=this._getContentBEMJSON(e),n&&n.length&&(n[0].elemMods["link-type"]=i.type,n[0].text.unshift({elem:"button-price",mix:{elem:"money"}}))),n):null},_getContentBEMJSON:function(t){return t.shop_rating&&t.price&&!this.hasMod("direct","yes")?[{block:"market-snippet",elem:"shopping-button",elemMods:{text:"price"},text:[{block:"market-snippet",mods:{button:"compact"},elem:"link",content:{elem:"domain",domain:t.domain}},{block:"market-snippet",mods:{button:"compact"},elem:"rating",rating:t.shop_rating}],more:{url:t.url}}]:[]},_setTexts:function(){return this.hasMod("direct")?this.__base.apply(this,arguments):(this.elem("greenurl").text(BEM.I18N("market-snippet",".",{context:"     .     "})),this.findElem("button-text").text(BEM.I18N("market-snippet","   ",{context:"     .   ,  "})),this)}}),BEM.DOM.decl("market-snippet2",{update:function(t){return t?(this._bindPreviewLoadEvent(),this.toggleMod("empty-text",!0,!t.text),this.toggleMod("empty-preview",!0,!t.imageUrl),t.moneyId&&this.trigger("market:show",{domElem:this.domElem,snippet:t}),this._setCurrent(t)._updateTitle(t.title,t.url)._updateGreenurl(t.domain,t.url)._updatePreview(t.imageUrl,t.url)._updateText(t.text)._updateRating(t.rating)._updateShopButton(t.price,t.url),this):void 0},show:function(){return this.delMod("hidden"),this},hide:function(){return this.setMod("hidden","yes"),this},_setCurrent:function(t){return this._snippet=t,this},_getCurrent:function(){return this._snippet},_updateTitle:function(t,e){return this.elem("title").html(t),this.elem("title").attr("href",e),this},_updateGreenurl:function(t,e){return this.elem("greenurl").html(t),this.elem("greenurl").attr("href",e),this},_updateText:function(t){return this.elem("text").html(t||""),this},_updatePreview:function(t,e){return this.elem("img").attr("src",t||""),this.elem("preview").attr("href",e||""),this},_onPreviewLoaded:function(t){this.toggleMod("empty-preview",1===t.target.height)},_updateRating:function(t){return BEM.DOM.update(this.elem("rating"),BEMHTML.apply({block:"rating2",mods:{size:"m",type:"extended"},value:t,base:5})),this},_bindPreviewLoadEvent:function(){this.unbindFrom("img","load",this._onPreviewLoaded),this.bindTo("img","load",this._onPreviewLoaded)},_updateShopButton:function(t,e){var i=BEM.I18N("market-snippet2","{price}   ",{context:"3750   ",price:BEMHTML.apply({block:this.__self.getName(),elem:"price",tag:"span",content:[t,{block:"rub",tag:"span",content:""}]})});return BEM.DOM.update(this.elem("shop-button"),i),this.elem("shop-button").attr("href",e||""),this}},{live:function(){this.__base.apply(this,arguments),this.liveBindTo("title","pointerclick",function(t){this.trigger("market:title:click",{domElem:t.target,snippet:this._getCurrent()})}).liveBindTo("preview","pointerclick",function(t){this.trigger("market:thumb:click",{domElem:t.target,snippet:this._getCurrent()})}).liveBindTo("greenurl","pointerclick",function(t){this.trigger("market:link:click",{domElem:t.target,snippet:this._getCurrent()})}).liveBindTo("shop-button","pointerclick",function(t){this.trigger("market:button:click",{domElem:t.data.domElem[0],snippet:this._getCurrent()})})}}),BEM.DOM.decl("dropdown-more",{onSetMod:{js:{inited:function(){this._findBlockInsidePopup("share").init(),this.bindEvents()}}},bindEvents:function(){var t=this._findBlockInsidePopup("share-copy");BEM.blocks["share-copy"].on(t.domElem,"copied",this._onLinkCopied,this),BEM.blocks.dropdown2.on(this.domElem,"beforeOpen",this._onOpen,this),BEM.blocks.dropdown2.on(this.domElem,"beforeClose",this._onClose,this)},unbindEvents:function(){var t=this._findBlockInsidePopup("share-copy");BEM.blocks["share-copy"].un(t.domElem,"copied",this._onLinkCopied,this),BEM.blocks.dropdown2.un(this.domElem,"beforeOpen",this._onOpen,this),BEM.blocks.dropdown2.un(this.domElem,"beforeClose",this._onClose,this)},destruct:function(){this.unbindEvents(),this.__base.apply(this,arguments)},close:function(){this._getDropdown().delMod("opened")},update:function(t){var e=window.location.href;this._findBlockInsidePopup("share").update(t),this._findBlockInsidePopup("share-copy").update(e),this._findBlockInsidePopup("share-copy-fallback").update(e)},_getDropdown:function(){return this._dropdown||(this._dropdown=this.findBlockOn("dropdown2"))},_getPopup:function(){if(!this._popup){var t=this._getDropdown();t&&(this._popup=t.getPopup())}return this._popup},_findBlockInsidePopup:function(t){if(!this[t]){var e=this._getPopup();e&&(this[t]=e.findBlockInside(t))}return this[t]},_onOpen:function(){this.trigger("beforeOpen")},_onClose:function(){this._findBlockInsidePopup("share-copy").reset(),this._findBlockInsidePopup("share-copy-fallback").reset()},_onLinkCopied:function(t,e){e.isSuccessful||(this._findBlockInsidePopup("share-copy").hide(),this._findBlockInsidePopup("share-copy-fallback").show())}},{live:function(){this.liveInitOnEvent("pointerclick",function(){this._onOpen()})}}),BEM.DOM.decl({block:"share",modName:"type",modVal:"list"},{_destroyYaShareInstances:function(){this._yaShareInstance&&this._yaShareInstance.destroy()},init:function(){this._load()},updateLinks:function(t){this._yaShareInstance&&this._updateLinks(this._yaShareInstance,t)},updateLink:function(t,e){return this._updateLink(this._yaShareInstance,t,e)},_updater:function(){this.updateLinks(this._currentLinkParams)},_onLoaded:function(){this.__base.apply(this,arguments),this._yaShareInstance=this._initYaShareInstance(this.elem("share-services").get(0)),this._updater()},_onUpdate:function(t){this.update(t)}},{live:function(){this.__base.apply(this,arguments),this.liveInitOnChannelEvent("share","update",function(t,e){this._onUpdate(e)})}}),BEM.DOM.decl("share-copy",{copy:function(){var t=!1;if(this.isCopySupported()){var e=this.elem("copy-text")[0],i=document.createRange();i.selectNodeContents(e),window.getSelection().removeAllRanges(),window.getSelection().addRange(i);try{t=document.execCommand("copy",!0,null)}catch(n){t=!1}}this._isCopySupported=t,this.trigger("copied",{isSuccessful:t})},isCopySupported:function(){return"undefined"==typeof this._isCopySupported&&(this._isCopySupported="getSelection"in window&&"queryCommandSupported"in document&&"execCommand"in document&&document.queryCommandSupported("copy")),this._isCopySupported},sendCounter:function(){this.params.counter&&cp(this.params.counter,this)}},{live:function(){this.liveBindTo("pointerclick",function(t){t.preventDefault(),this.copy(),this.sendCounter()})}}),BEM.DOM.decl({block:"share-copy",modName:"theme",modVal:"dynamic"},{hide:function(){this.setMod("visible","no")},update:function(t){BEM.DOM.update(this.elem("copy-text"),BEMHTML.apply(t))},reset:function(){this.delMod("visible"),this._changeIcon("check","share2");var t=this._getButton();t&&t.delMod("disabled"),this.delMod("disabled")},copy:function(){this.__base.apply(this,arguments),this._changeIcon("share2","check");var t=this._getButton();t&&t.setMod("disabled","yes"),this.setMod("disabled")},_getButton:function(){return this.findBlockOn("button2")},_changeIcon:function(t,e){var i=this.findBlockInside({block:"icon",modName:"type",modVal:t});i&&i.setMod("type",e)}}),BEM.DOM.decl("share-copy-fallback",{show:function(){this.setMod("visible","yes"),this._select()},update:function(t){this._setUrl(t)},reset:function(){this.delMod("visible")},_getInput:function(){return this._input||(this._input=this.findBlockInside("input"))},_select:function(){var t=this._getInput().elem("control");t.select()},_setUrl:function(t){var e=this._getInput().elem("control");e.val(t)},_onFocus:function(){this._select()}},{live:function(){this.liveInitOnBlockInsideEvent("focus","input",function(){this._onFocus()})}}),BEM.DOM.decl("pane2-controller",{_viewParams:["img_url","rpt","pos"],_relatedRequest:null,getDefaultParams:function(){return{directUpdateTime:1e4}},onSetMod:{js:{inited:function(){this.findBlocks().bindEvents(),this._throttledUpdateDirect=$.throttle(this._tryUpdateDirect,this.params.directUpdateTime,this),this.loadInitialItem(),this._addInitialItemsToGallery()}}},findBlocks:function(){return this.location=BEM.blocks.location.getInstance(),this._store=window.Ya.Images.ThumbsStore,this.changeUrlDebounced||(this.changeUrlDebounced=$.debounce(this.changeUrl,700,this)),this},bindEvents:function(){return BEM.blocks["b-page"].on("change",this._onPageChanged,this),BEM.blocks["serp-controller"].on("galleryLoaded",this._onGalleryLoaded,this),BEM.blocks["serp-item"].on("clicked",$.throttle(this._onSerpItemClicked.bind(this),100),this),this},unbindEvents:function(){BEM.blocks["b-page"].un("change",this._onPageChanged,this),BEM.blocks["serp-controller"].un("galleryLoaded",this._onGalleryLoaded,this),BEM.blocks["serp-item"].un(this.domElem,"open-pane2",this._onSerpItemClicked,this),this.unbindPane2Events()},destruct:function(){this.unbindEvents(),clearTimeout(this._locationTimeout),this.__base.apply(this,arguments)},bindPane2Events:function(){BEM.blocks["i-global"].param("isPumpkin")||BEM.blocks["pane2-api"].on("gallery:listOut",this._onGalleryListOut,this),BEM.blocks["pane2-api"].on("pane:open",this._onPaneOpen,this),BEM.blocks["pane2-api"].on("pane:close",this._onPaneClose,this),BEM.blocks["pane2-api"].on("gallery:click",this._onGalleryItemClicked,this),BEM.blocks["pane2-api"].on("preview:rightClick",this._onRightClick,this),BEM.blocks["pane2-api"].on("preview:loaded",this._onPreviewDupLoaded,this),BEM.blocks["pane2-api"].on("preview:notfound",this._onPreviewNotfound,this),BEM.blocks["pane2-api"].on("preview:timeout",this._onPreviewTimeout,this),BEM.blocks["pane2-api"].on("preview:error",this._onPreviewError,this),BEM.blocks["pane2-api"].on("thumb:click",this._onThumbClick,this),BEM.blocks["pane2-api"].on("title:click",this._onTitleClick,this),BEM.blocks["pane2-api"].on("link:click",this._onLinkClick,this),BEM.blocks["pane2-api"].on("query:click",this._onQueryClick,this),BEM.blocks["pane2-api"].on("image-source:click",this._onLinkClick,this),BEM.blocks["pane2-api"].on("market:button:click market:link:click market:title:click market:thumb:click",this._onMarketSnippetClick,this),BEM.blocks["pane2-api"].on("direct:link:click direct:title:click",this._onDirectSnippetClick,this),BEM.blocks["pane2-api"].on("next prev",this._onImageSwitch,this),BEM.blocks.sizes.on("download",this._onDownloadClick,this),BEM.blocks["pane2-api"].on("open:image",this._onDownloadClick,this),BEM.blocks["pane2-api"].on("slideshow:start",this._onSlideshowStart,this),BEM.blocks["pane2-api"].on("slideshow:stop",this._onSlideshowStop,this),BEM.blocks["pane2-api"].on("fullscreen:exit",this._onFullscreenExit,this),BEM.blocks.pane2.on({"share:click":this._onShareClick,"similar:click":this._onSimilarClick},this),BEM.blocks["pane2-api"].on("show:image",this._onShowImage,this),BEM.blocks["pane2-api"].on("related:rim-click",this._onRimClick,this),BEM.blocks["pane2-api"].on("related:rim-loaded",this._onRimLoaded,this)},unbindPane2Events:function(){BEM.blocks["i-global"].param("isPumpkin")||BEM.blocks["pane2-api"].un("gallery:listOut",this._onGalleryListOut,this),BEM.blocks["pane2-api"].un("pane:open",this._onPaneOpen,this),BEM.blocks["pane2-api"].un("pane:close",this._onPaneClose,this),BEM.blocks["pane2-api"].un("gallery:click",this._onGalleryItemClicked,this),BEM.blocks["pane2-api"].un("preview:rightClick",this._onRightClick,this),BEM.blocks["pane2-api"].un("preview:loaded",this._onPreviewDupLoaded,this),BEM.blocks["pane2-api"].un("preview:notfound",this._onPreviewNotfound,this),BEM.blocks["pane2-api"].un("preview:timeout",this._onPreviewTimeout,this),BEM.blocks["pane2-api"].un("preview:error",this._onPreviewError,this),BEM.blocks["pane2-api"].un("thumb:click",this._onThumbClick,this),BEM.blocks["pane2-api"].un("title:click",this._onTitleClick,this),BEM.blocks["pane2-api"].un("link:click",this._onLinkClick,this),BEM.blocks["pane2-api"].un("query:click",this._onQueryClick,this),BEM.blocks["pane2-api"].un("image-source:click",this._onLinkClick,this),BEM.blocks["pane2-api"].un("market:button:click market:link:click market:title:click market:thumb:click",this._onMarketSnippetClick,this),BEM.blocks["pane2-api"].un("direct:link:click direct:title:click",this._onDirectSnippetClick,this),BEM.blocks["pane2-api"].un("next prev",this._onImageSwitch,this),BEM.blocks.sizes.un("download",this._onDownloadClick,this),BEM.blocks["pane2-api"].un("open:image",this._onDownloadClick,this),BEM.blocks["pane2-api"].un("slideshow:start",this._onSlideshowStart,this),BEM.blocks["pane2-api"].un("slideshow:stop",this._onSlideshowStop,this),BEM.blocks["pane2-api"].un("fullscreen:exit",this._onFullscreenExit,this),BEM.blocks.pane2.on({"share:click":this._onShareClick,"similar:click":this._onSimilarClick},this),BEM.blocks["pane2-api"].un("show:image",this._onShowImage,this),BEM.blocks["pane2-api"].un("related:rim-click",this._onRimClick,this),BEM.blocks["pane2-api"].un("related:rim-loaded",this._onRimLoaded,this)},_getPane2API:function(){return this._pane2api||(this._pane2api=this.findBlockInside("pane2-api"))},_getPane:function(){return this._pane||(this._pane=this.findBlockInside("pane2"))},_getGallery:function(){return this._gallery||(this._gallery=this.findBlockInside("gallery"))},_getDirect:function(){return this._direct||(this._direct=this._getPane2API().findBlockInside({block:"direct",modName:"type",modVal:this._getDirectType()}))},_getDirectType:function(){return"stripe"},_getSizes:function(){return this.sizes||(this.sizes=this.findBlockInside("sizes"))},_onRimClick:function(t,e){var i=this._getVars(e);this._hitPreviewCounter("rim/thumb",{},{vars:i.join(",")})},_onRimLoaded:function(t,e){var i=BEM.blocks["pane2-api"].getItem(),n=this._getVars(i).concat(["-images="+e.join(";")]);this._hitPreviewCounter("rim/is_visible",{href:BEM.blocks["pane2-api"].getDuplicateOriginUrl()},{vars:n.join(",")})},_onShowImage:function(t,e){this.loadItem(e)},_onGalleryListOut:function(t,e){if(this.isPageExists(e)){var i=this._getPane2API();i.showSpin(e),this.trigger("listOut",i.getDirectionByPageNum(e))}},isPageExists:function(t){return t>=0&&t<=BEM.blocks["serp-controller"].get().getLastPage()},_onGalleryItemClicked:function(t,e){this.getItemById(e).click("mouse")},_onImageSwitch:function(t,e){var i=t.type;this[i](e.source)},_onThumbClick:function(){var t=BEM.blocks["serp-controller"].get(),e=t.getNearItem(t.getCurrentItem(),1),i=e&&BEM.DOM.extractParams(e[0])["serp-item"],n=_.get(i,"preview[0].url","");this.next("mouse"),this._hitPreviewCounter("imgclick",i?{href:n}:{},i?{vars:"-pos="+i.pos}:{})},_onRightClick:function(){this._hitPreviewCounter("save")},_onTitleClick:function(t,e){var i=BEM.blocks["pane2-api"].getItem(),n=this._getVars(i),s=i.params,o=this._isMarketIncut(s)?"/commercial/"+s.marketSnippet.source:"";this._hitPreviewCounter("site"+o,e,{pos:o&&s.pos,vars:n.join(",")})},_onLinkClick:function(t,e){var i=BEM.blocks["pane2-api"].getItem(),n=this._getVars(i),s=i.params,o=this._isMarketIncut(s)?"/commercial/"+s.marketSnippet.source:"";"image-source:click"===t.type&&n.push("-type=bottom_link"),this._hitPreviewCounter("duplicates/url"+o,e,{pos:o&&s.pos,vars:n.join(",")})},_onQueryClick:function(t,e){var i=BEM.blocks["pane2-api"].getItem(),n=this._getVars(i),s=i.params;n.push("-querypos=p"+e.pos),n.push("-text="+e.query),this._hitPreviewCounter("querysearch",null,{pos:s.pos,vars:n.join(",")})},_getMarketSnippet:function(){return this._marketSnippet||(this._marketSnippet=this._getPane().findBlockInside("market-snippet"))},_onDirectSnippetClick:function(t,e){var i=BEM.blocks["pane2-api"].getItemParams(),n=t.type.match(/direct:(link|title):click/)[1];this._hitPreviewCounter("commercial/"+n+"/direct",e.domElem,{pos:i.pos,domain:e.snippet.domain,vars:"-pos="+i.pos})},_onMarketSnippetClick:function(t,e){var i=BEM.blocks["pane2-api"].getItem(),n=this._getVars(i),s=i.params,o=t.type.match(/market:(button|link|title|thumb):click/)[1],r=this._getMarketSnippet(),a=r.getCurrent();switch(o){case"link":n.push("-offer_pos="+r.getOfferPos($(e)));break;case"button":n.push("-link_type="+r.getLinkType($(e)))}this._hitPreviewCounter("commercial/"+o+"/"+a.source,e,{pos:s.pos,domain:a.domain,money_id:a.money_id,vars:n.join(",")})},_getVars:function(t){var e=t.params;return t.isRim?["-pos="+e.parentPos,"-rim_id="+e.rimId,"-rim_index="+e.pos]:["-pos="+e.pos]},_onDownloadClick:function(){var t=BEM.blocks["pane2-api"].getItem(),e=this._getVars(t);this._hitPreviewCounter("duplicates/image",this._getSizes().getDownloadDOMNode(),{vars:e.join(",")})},_onSlideshowStart:function(){this._hitPreviewCounter("slideshow/play")},_onSlideshowStop:function(){this._hitPreviewCounter("slideshow/stop")},_onPageChanged:function(){this._getPane2API().close("ajax"),this._addInitialItemsToGallery()},_onPaneOpen:function(){this.hasMod("scrollable",!0)&&BEM.blocks["b-page"].getInstance().disableScroll(),this._hitPreviewCounter("open")},_onPaneClose:function(t,e){clearTimeout(this._locationTimeout),this.hasMod("scrollable",!0)&&BEM.blocks["b-page"].getInstance().enableScroll(),"mouse"!==e&&"keyboard"!==e||(this._hitPreviewCounter("close"),this.delViewParams()),"ajax"!==e&&BEM.blocks["navigation-controller"].get().scroll("down"),this.unbindPane2Events()},_onPreviewDupLoaded:function(t,e){this._countPreview(e)},_onPreviewError:function(){window.Ya.Images.errcnt(null,2104)},_onPreviewNotfound:function(t,e){this._excludeDup(e)},_onPreviewTimeout:function(t,e){this._excludeDup(e)},_excludeDup:function(t){var e=this.__self._encodeUrlForStore(t);return this._store.set(BEM.blocks["pane2-api"].getItemParams().id,"dups.broken."+e,!0),this},_isMarketIncut:function(t){return Boolean(t.isMarketIncut)},_hitPreviewCounter:function(t,e,i){return c.hitDelayed(this._previewCounterParams(t,i),e),this},_hitPreviewCounterImmediate:function(t,e,i){return c.hit(this._previewCounterParams(t,i),e),this},_previewCounterParams:function(t,e){var i=BEM.blocks["pane2-api"].getItemParams();return e||(e={}),e.vars||(e.vars="-pos="+i.pos),_.assign({dtype:"iweb",path:"/image/new/preview/"+t,reqid:i.reqid},e)},loadItem:function(t){var e,i=this._getPane2API(),n=!i.isOpened,s=this;return this._startLoadTime=Date.now(),BEM.blocks["i-global"].getFlag("images_thumbs_fullsize")&&(e=window.Ya.Images.ThumbsStore.get(t.params.id,"fittedItem.newThumbSrc"),e&&(t.params.thumb.url=e)),t.params.reqid||this._addReqId(t),t.params.images=this.getActualImages(t.params),n?(this.bindPane2Events(),BEM.blocks["pane2-api"].frameQueue.add(function(){i.open(t)})):BEM.blocks["pane2-api"].frameQueue.add(function(){i.loadItem(t)}),this.params.batchPreloadCount&&BEM.blocks["pane2-api"].frameQueue.add(function(){i.preloadItems(s.getNextImages(t.params.pos))}),BEM.blocks["pane2-api"].frameQueue.add(function(){s.checkListOut(t)}),!i.isFullscreen&&BEM.blocks["pane2-api"].frameQueue.add(function(){s._shouldUpdateDirect()&&s._throttledUpdateDirect(t)}),BEM.blocks["pane2-api"].frameQueue.add(function(){s.changeUrlDebounced(s.getImageURL(t),n)}),BEM.blocks["pane2-api"].frameQueue.run(),this},_tryUpdateDirect:function(t){var e=this._getDirect(),i=this;e&&BEM.blocks["pane2-api"].frameQueue.add(function(){e&&e.update(i.getDirectGrab(t))})},_shouldUpdateDirect:function(){var t=this._getDirect();return t&&(!t.isExists()||this.params.directUpdateTime>0)},getDirectGrab:function(t){var e=t.params.snippet.grab;return 0===t.params.pos?BEM.blocks["i-global"].param("query")+" - "+e:e||BEM.blocks["i-global"].param("query")},_addReqId:function(t){return t.params.reqid=c.getReqId(t.domElem)||!1,this},changeUrl:function(t,e){this.addViewParams(t,e)},_onSerpItemClicked:function(t,e){"search"===e.getMod("type")&&this.loadItem(e)._countSelected(e)},move:function(t,e){BEM.blocks["navigation-controller"].get().goTo(t,!1,e)},next:function(t){this.move("right",t)},prev:function(t){this.move("left",t)},addViewParams:function(t,e){return window.screenfull&&window.screenfull.isFullscreen||this.location.change({url:t,trigger:!1,history:Boolean(e)}),this},delViewParams:function(t){return t=t||location.href,this.location.change({url:BEM.blocks.uri.delParams(t,this._viewParams),trigger:!1,history:!1}),this},getImageURL:function(t){var e=t.params.detail_url;return this.updateLinkParams?this.updateLinkParams(e):e},updateLinkParams:function(t){return BEM.blocks.uri.setParams(t,{source:void 0})},getItemById:function(t){var e=$("#"+t);return e.length?e.bem("serp-item"):void 0},hasInitialItem:function(){return Boolean(this.params.item&&this.params.item.selected)},getInitialItem:function(){return this.hasInitialItem()?this.getItemById(this.params.item.selected):!1},loadInitialItem:function(){var t=this.getInitialItem();return t&&(BEM.blocks["serp-item"].setCurrent(t),this.loadItem(t),this.trigger("initialLoading",t)),this},_onFullscreenExit:function(){var t=BEM.blocks["serp-controller"].get().getCurrentItem();this.changeUrl(this.getImageURL(t),!1)},_onShareClick:function(){this._hitPreviewCounter("share")},_onSimilarClick:function(t,e){BEM.blocks["b-statcounter"].hit({params:{query:{cbir:"view"}}}),this._hitPreviewCounterImmediate("othersize",{href:e.url})},_addInitialItemsToGallery:function(){var t,e=this.findBlockInside("serp-list");_.isEmpty(e)||(t=this.findElem("gallery-list").contents(),this._getGallery().clear(),this._getPane2API().loadGallery(t,e.getCurrentPageNumber()),BEM.blocks["i-global"].param("isPumpkin")&&this._getGallery().setBase64FromSerpList(e))},_onGalleryLoaded:function(t,e){return this._getPane2API().loadGallery(e.html,e.params.pageNum),this},_countSelected:function(t){var e=t.params,i=t.eventSource,n=t.eventParams,s=this._isMarketIncut(e),o="right"===n?"next":"prev",r=s?e.marketSnippet||e.market:{},a=r.source||"market",h=s?"commercial/"+a:e.freshness,l="-pos="+e.pos+("keyboard"===i&&n?",-direction="+o:"");return"keyboard"!==i&&"slideshow"!==i||c.hitDelayed({dtype:"iweb",path:"/image/new/serp/results/"+i+"/"+h,pos:e.pos,vars:l},_.assign(t.domElem,{href:e.preview[0].url})),"arrow"===i&&this._hitPreviewCounter(o+"/mouse"+(s?"/commercial/"+a:""),{href:e.preview[0].url},{vars:l}),this},_countPreview:function(t){var e=BEM.blocks["pane2-api"].getItem(),i=t.image,n=i.url,s=t.stats,o=this._getVars(e).concat(["-width="+i.width,"-height="+i.height,s&&s.latency?"-time="+s.latency:void 0,"-usertime="+(Date.now()-this._startLoadTime)]);return i.isMixedImage&&i.origin&&(n=i.origin.url,o.splice(o.length,0,"-id="+BEM.blocks.uri.getParamValue(i.url,"id"),"-origin_w="+i.origin.w,"-origin_h="+i.origin.h)),this._hitPreviewCounter("image/show",{href:n},{vars:o.join(",")}),this}},{_encodeUrlForStore:function(t){return t.replace(/[.\[\]]/g,"##")}}),BEM.DOM.decl("pane2-controller",{getItemById:function(t){var e=$("#"+t);return e.length?e.bem("serp-item"):void 0},getItemByPos:function(t){return $(".serp-item_pos_"+t+":eq(0)")},checkListOut:function(t){var e=Boolean(this.getItemByPos(Number(t.params.pos)+5).length);return e||this.trigger("listOut","right"),this},_getActualImages:function(t){if(!t)return[];var e=[];return e=this._getPane2API().isFullscreen?t.dups.concat(t.preview):t.preview.concat(t.dups),t.useProxy&&e.forEach(function(t){t.url=(t.proxy_url.indexOf("http")?location.protocol:"")+t.proxy_url}),e},getActualImages:function(t){var e=this._store.get(t.id,"images");return e||(e=this._getActualImages(t),this._store.set(t.id,"images",e)),e}}),BEM.DOM.decl({block:"pane2-controller",modName:"preload",modVal:"yes"},{getNextImages:function(t){for(var e=this.params.batchPreloadCount,i=5,n=[],s=document.querySelector(".serp-item_pos_"+t),o=0;null!==s&&n.length<e&&e+i>o;)s=s.nextSibling,s&&s.classList.contains("serp-item")&&n.push(JSON.parse(s.getAttribute("data-bem"))["serp-item"]),++o;return _.map(n,this.getActualImages.bind(this))}}),BEM.DOM.decl({block:"pane2-controller",modName:"crop",modVal:"yes"},{bindPane2Events:function(){this.__base.apply(this,arguments),BEM.blocks.pane2.on("crop:click",this._onCropButtonClick,this),BEM.blocks["pane2-api"].on("resize",this._onPaneResize,this),BEM.blocks["trimmer-controller"].on({show:this._onTrimmerShow,hide:this._onTrimmerHide,cancel:this._onTrimmerCancel,search:this._onTrimmerSearch,change:this._onTrimmerChange,"crop-object:click":this._onCropObjectClick,"crop-object:loaded":this._onCropObjectsLoaded},this)},unbindPane2Events:function(){this.__base.apply(this,arguments),BEM.blocks.pane2.on("crop:click",this._onCropButtonClick,this),BEM.blocks["pane2-api"].un("resize",this._onPaneResize,this),BEM.blocks["trimmer-controller"].un({show:this._onTrimmerShow,hide:this._onTrimmerHide,cancel:this._onTrimmerCancel,search:this._onTrimmerSearch,change:this._onTrimmerChange,"crop-object:click":this._onCropObjectClick,"crop-object:loaded":this._onCropObjectsLoaded},this)},_onPaneResize:function(){this.blockInside("trimmer-controller").hide()},_onTrimmerShow:function(){this._trimmerChangedParams=null,this._getPane().showTrimmer(),this._countSimilar()},_onTrimmerHide:function(){this._getPane().hideTrimmer()},_onTrimmerCancel:function(){this._countSimilar("cancel")},_onTrimmerSearch:function(){this._setCroppedLink(),this._countSimilar("crop",{crop:this._trimmerChangedParams||""}),this.blockInside("trimmer-controller").hide()},_onCropButtonClick:function(){
var t=this._getPane().getLoadedDup();this.blockInside("trimmer-controller").show({url:t&&t.url})},_onTrimmerChange:function(t,e){this._trimmerChangedParams=this._formatCropParams(e.crop),this._countSimilar(e.type,{crop:this._trimmerChangedParams||""})},_onCropObjectsLoaded:function(t,e){e.objects&&this._countSimilar("point",{crop:this._getObjectsCoords(e.objects)})},_getObjectsCoords:function(t){return Array.isArray(t)?"["+t.map(function(t){return"["+t.origin+"]"})+"]":void 0},_onCropObjectClick:function(t,e){var i=e.join(";");this._trimmerChangedParams=i,this._countSimilar("point/click",{crop:i})},_formatCropParams:function(t){var e=t.point1,i=t.point2;return[e.x,e.y,i.x,i.y].join(";")},_setCroppedLink:function(){var t=this._trimmerChangedParams||"",e=this._getPane(),i=e.getLoadedDup(),n=e.getCroppedViewUrl(i.url,t);this.blockInside("trimmer-controller").setSearchUrl(n)},_countSimilar:function(t,e){var i=BEM.blocks["pane2-api"].getItemParams(),n=this._getPane().getLoadedDup(),s=["-pos="+i.pos];n&&(e&&e.crop&&s.push("-crop="+encodeURIComponent(e.crop)),t=t?"/"+t:"",this._hitPreviewCounter("similar"+t,{href:n.url},{vars:s.join(",")}))},_onImageSwitch:function(){this.blockInside("trimmer-controller").isVisible()||this.__base.apply(this,arguments)},_onThumbClick:function(){this.blockInside("trimmer-controller").isVisible()||this.__base.apply(this,arguments)},_onPaneClose:function(){this.blockInside("trimmer-controller").isVisible()&&(this.blockInside("trimmer-controller").hide(),this._countSimilar("cancel")),this.__base.apply(this,arguments)}}),BEM.DOM.decl("pane2",{showTrimmer:function(){this.getPreview().showTrimmer(),this.setMod("crop","yes")},hideTrimmer:function(){this.getPreview().hideTrimmer(),this.delMod("crop")}},{live:function(){return this.liveInitOnBlockInsideEvent("click","button2",function(t){this.elem("crop-button").is(t.block.domElem)&&this.trigger("crop:click")}),this.__base.apply(this,arguments)}}),BEM.DOM.decl("preview2",{showTrimmer:function(){return this.setMod(this.elem("trimmer-wrapper"),"visible","yes"),this.updateTrimmerSize(),this},hideTrimmer:function(){return this.delMod(this.elem("trimmer-wrapper"),"visible")},updateTrimmerSize:function(){var t,e=this.elem("trimmer-wrapper");e&&(t=this.visibleThumb||this.thumb,e.css({width:t.width(),height:t.height()}))}}),BEM.DOM.decl("trimmer-controller",{getDefaultParams:function(){return{size:{width:70,height:70},position:{x:15,y:15}}},show:function(t){this._show(t),this._fireEvent("show"),this._isVisible=!0,this.blockInside("trimmer-controls").show()},hide:function(){this._isVisible=!1,this._fireEvent("hide"),this.blockInside("trimmer").hide(),this.blockInside("trimmer-controls").hide()},isVisible:function(){return this._isVisible},setSearchUrl:function(t){this.blockInside("trimmer-controls").setSearchUrl(t)},_show:function(t){var e=this.params.size,i=this.params.position;t&&(e=t.size||e,i=t.position||i),this.blockInside("trimmer").setSize(e.width,e.height).setPosition(i.x,i.y).show()},_fireEvent:function(t,e){this.trigger(t,e),BEM.channel(this.__self.getName()).trigger(t,e)},_onSizeChange:function(t){this._fireEvent("change",{type:t,crop:this.blockInside("trimmer").getArea()})},_onCancel:function(){this.hide(),this._fireEvent("cancel")},_onSearch:function(){this._fireEvent("search")}},{live:function(){this.liveInitOnBlockInsideEvent("drag size","trimmer",function(t){this._onSizeChange(t.type)}).liveInitOnBlockInsideEvent("cancel","trimmer-controls",function(){this._onCancel()}).liveInitOnBlockInsideEvent("search","trimmer-controls",function(){this._onSearch()})}}),BEM.DOM.decl({block:"trimmer-controller",modName:"objects",modVal:"yes"},{show:function(t){this.__base.apply(this,arguments),this._loadCropsObjects(t.url)},hide:function(){this.__base.apply(this,arguments),this.blockInside("crop-objects").hide()},_loadCropsObjects:function(t){var e=BEM.blocks.uri.buildRelativeUrl(BEM.blocks["i-global"].param("router").search,this._getCropObjectsParams(t));BEM.create("i-request_type_bem",{url:e}).block({block:"crop-objects",mods:{ajax:"yes"}},this._onLoadSuccess.bind(this)).get()},_getCropObjectsParams:function(t){return{rpt:"cv",url:t}},_isTrimmerChanged:function(){var t=this.blockInside("crop-objects").getActiveParams();if(!t)return!1;var e=t.size,i=t.position,n=this.blockInside("trimmer").getSize(),s=this.blockInside("trimmer").getPosition();return Boolean(Math.abs(e.height-n.height)>this.__self.SHIFT_ERROR||Math.abs(e.width-n.width)>this.__self.SHIFT_ERROR||Math.abs(i.x-s.x)>this.__self.SHIFT_ERROR||Math.abs(i.y-s.y)>this.__self.SHIFT_ERROR)},_onSizeChange:function(){this.__base.apply(this,arguments),this._isTrimmerChanged()&&this.blockInside("crop-objects").resetActive()},_onLoadSuccess:function(t){var e=t.params.objects;(e||0!==e.length)&&(this.blockInside("crop-objects").update(e).show(),e.length>0&&this._fireEvent("crop-object:loaded",{objects:e}))},_onCropObjectsClick:function(t){this._show({position:t.position,size:t.size}),this._fireEvent("crop-object:click",t.origin)}},{SHIFT_ERROR:1,live:function(){this.__base.apply(this,arguments),this.liveInitOnBlockInsideEvent("click","crop-objects",function(t,e){this._onCropObjectsClick(e)})}}),BEM.DOM.decl("trimmer-controls",{show:function(){return this.setMod("visible","yes")},hide:function(){return this.delMod("visible")},setSearchUrl:function(t){this._getSearchButton().setUrl(t)},_onSearchClick:function(){this.trigger("search")},_onCancelClick:function(){this.trigger("cancel")},_getSearchButton:function(){return this._searchButton||(this._searchButton=this.findBlockOn("search","button2")),this._searchButton}},{live:function(){this.liveInitOnBlockInsideEvent("click","button2",function(t){var e=t.block.domElem;this.elem("search").is(e)?this._onSearchClick(t):this.elem("cancel").is(e)&&this._onCancelClick(t)})}}),BEM.DOM.decl({block:"pane2-controller",modName:"market",modVal:"yes"},{bindPane2Events:function(){this.__base.apply(this,arguments),BEM.blocks["pane2-api"].on("market:show market:button:click market:link:click market:title:click market:thumb:click",this._onMarketSnippetEvent,this)},unbindPane2Events:function(){BEM.blocks["pane2-api"].un("market:show market:button:click market:link:click market:title:click market:thumb:click",this._onMarketSnippetEvent,this),this.__base.apply(this,arguments)},_onMarketSnippetClick:$.noop,_onMarketSnippetEvent:function(t,e){var i=BEM.blocks["pane2-api"].getItem(),n=this._getVars(i),s=i.params,o=e.snippet,r=e.domElem,a=t.type.match(/market:(show|button|link|title|thumb)(:click)?/)[1];this._hitPreviewCounter("commercial/"+a+"/market",r,{pos:s.pos,domain:encodeURIComponent(o.domain),money_id:o.moneyId,vars:n.join(",")})}}),BEM.DOM.decl({block:"pane2-controller",modName:"load",modVal:"info-serial"},{bindPane2Events:function(){this.__base.apply(this,arguments),this._getPane().on("update-info",this._onUpdateInfo,this)},unbindPane2Events:function(){this.__base.apply(this,arguments),this._getPane().un("update-info",this._onUpdateInfo,this)},_getOrderedBlocksUpdate:function(){var t;return this._loadOrder||(t=this._getPane(),this._loadOrder=[t.updateMarket.bind(t),t.updateDirectAjax.bind(t),t.updateSimilarOffers.bind(t),t.updateRelated.bind(t)]),this._loadOrder},_showIfHeightAvailable:function(t,e){var i,n;t&&(i=t.domElem.outerHeight(),n=this._getPane().getAwailableHieght(),n>=i&&(e?e():t.show()))},_getShowIfHeightAvailableBinded:function(){return this._showIfHeightAvailableBinded||(this._showIfHeightAvailableBinded=this._showIfHeightAvailable.bind(this))},_onUpdateInfo:function(){var t=this._getShowIfHeightAvailableBinded(),e=BEM.blocks["pane2-api"].getItem();this._hideInfoBlocks(e),e.isRim||this._getOrderedBlocksUpdate().reduce(function(e,i){return e.then(function(e,n){return t(e,n),i()},function(){return i()})},$.Deferred().resolve()).then(t)},_hideInfoBlocks:function(t){var e=this._getPane();e.hideDirect(),e._getSimilarOffers()&&e._getSimilarOffers().hide(),t.isRim?e.updateMarket():e.hideRelated()}}),function(){"use strict";var t="undefined"!=typeof module&&module.exports,e="undefined"!=typeof Element&&"ALLOW_KEYBOARD_INPUT"in Element,i=function(){for(var t,e,i=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],n=0,s=i.length,o={};s>n;n++)if(t=i[n],t&&t[1]in document){for(n=0,e=t.length;e>n;n++)o[i[0][n]]=t[n];return o}return!1}(),n={request:function(t){var n=i.requestFullscreen;t=t||document.documentElement,/5\.1[\.\d]* Safari/.test(navigator.userAgent)?t[n]():t[n](e&&Element.ALLOW_KEYBOARD_INPUT)},exit:function(){document[i.exitFullscreen]()},toggle:function(t){this.isFullscreen?this.exit():this.request(t)},raw:i};return i?(Object.defineProperties(n,{isFullscreen:{get:function(){return!!document[i.fullscreenElement]}},element:{enumerable:!0,get:function(){return document[i.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return!!document[i.fullscreenEnabled]}}}),void(t?module.exports=n:window.screenfull=n)):void(t?module.exports=!1:window.screenfull=!1)}(),function(t){t.fn.animateRaf=function(t,e){function i(t,e){for(var i=0;i<e.length;i++)n(t,e[i])}function n(t,e){var i,n,a=e.duration,l=r(e.timing,a),u=function(){n||(n=Date.now()),i=o(e.from,e.to,n,a,l),t.css(s(e.property,i)),i!==e.to?h(u):c()};h(u)}function s(t,e){var i={},n=t,s=e;return"translateY"===t&&(n="transform",s="translateY("+e+"px)"),i[n]=s,i}function o(t,e,i,n,s){return(e-t)*s((Date.now()-i)/n)+t}function r(t,e){var i,n=1e3/60/e/4;switch(t){case"ease":i=a(.25,.1,.25,1,n);break;default:i=a(.08,.39,.25,1,n)}return i}function a(t,e,i,n,s){var o=function(e){var n=1-e;return 3*n*n*e*t+3*n*e*e*i+e*e*e},r=function(t){var i=1-t;return 3*i*i*t*e+3*i*t*t*n+t*t*t},a=function(e){var n=1-e;return 3*(2*(e-1)*e+n*n)*t+3*(-e*e*e+2*n*e)*i};return function(t){var e,i,n,c,h,l,u=t;for(n=u,l=0;8>l;l++){if(c=o(n)-u,Math.abs(c)<s)return r(n);if(h=a(n),Math.abs(h)<1e-6)break;n-=c/h}if(e=0,i=1,n=u,e>n)return r(e);if(n>i)return r(i);for(;i>e;){if(c=o(n),Math.abs(c-u)<s)return r(n);u>c?e=n:i=n,n=.5*(i-e)+e}return r(n)}}function c(){++l===t.length&&e&&h(e)}var h=window.requestAnimationFrame,l=0;return i(this,t),this}}(jQuery),function(t){t.fn.animateRaf=function(t,e){function i(t,e){for(var i=0;i<e.length;i++)n(t,e[i])}function n(t,e){var i,n,a=e.duration,l=r(e.timing,a),u=function(){n||(n=Date.now()),i=o(e.from,e.to,n,a,l),t.css(s(e.property,i)),i!==e.to?h(u):c()};h(u)}function s(t,e){var i={},n=t,s=e;return"translateY"===t&&(n="transform",s="translateY("+e+"px)"),i[n]=s,i}function o(t,e,i,n,s){return(e-t)*s((Date.now()-i)/n)+t}function r(t,e){var i,n=1e3/60/e/4;switch(t){case"ease":i=a(.25,.1,.25,1,n);break;default:i=a(.08,.39,.25,1,n)}return i}function a(t,e,i,n,s){var o=function(e){var n=1-e;return 3*n*n*e*t+3*n*e*e*i+e*e*e},r=function(t){var i=1-t;return 3*i*i*t*e+3*i*t*t*n+t*t*t},a=function(e){var n=1-e;return 3*(2*(e-1)*e+n*n)*t+3*(-e*e*e+2*n*e)*i};return function(t){var e,i,n,c,h,l,u=t;for(n=u,l=0;8>l;l++){if(c=o(n)-u,Math.abs(c)<s)return r(n);if(h=a(n),Math.abs(h)<1e-6)break;n-=c/h}if(e=0,i=1,n=u,e>n)return r(e);if(n>i)return r(i);for(;i>e;){if(c=o(n),Math.abs(c-u)<s)return r(n);u>c?e=n:i=n,n=.5*(i-e)+e}return r(n)}}function c(){++l===t.length&&h(e)}var h=window.requestAnimationFrame,l=0;return i(this,t),this}}(jQuery),BEM.DOM.decl("incut-controller",{onSetMod:{js:{inited:function(){BEM.blocks["b-page"].on("change",this._syncState,this),BEM.blocks["serp-controller"].on("loaded",this._onListLoaded,this),this._syncState()}}},destruct:function(){BEM.blocks["b-page"].un("change",this._syncState,this),BEM.blocks["serp-controller"].un("loaded",this._onListLoaded,this),this.__base.apply(this,arguments)},_syncState:function(){this._serpList=void 0,this._tryInitIncuts()},_onListLoaded:function(t,e){this._tryInitIncuts(e&&e.direction)},_tryInitIncuts:function(t){if(this._shouldNotShowIncuts())return this;if(this.incuts=this.findBlocksInside("incut"),!this.incuts)return this;for(var e,i=0;i<this.incuts.length;i++)e=this.incuts[i],this._shouldShowIncut(e)&&this.initIncut(e,t);return this},_shouldNotShowIncuts:function(){var t=this._getSerpList();return BEM.blocks["i-global"].param("isPornoQuery")||!(t&&t.getLastPageNumber()>=0)},_shouldShowIncut:function(t){if(this._isIncutInserted(t))return!1;var e=this._getSerpController(),i=this._getSerpList(),n=t.params,s=n.position,o=!1;switch(n.positionType){case"line":o=i&&i.isRowVisible(s-1);break;case"middle":o=e.getListCount()%e.getScrollPagesCount()===s;break;case"page":o=e.getListCount()%(s-e.getInitialPageNum())===0;break;case"bottom":o=e.isCurrentPageLast()||e.getListCount()%e.getScrollPagesCount()===0;break;case"top":o=!0}return o},_isIncutInserted:function(t){return t.hasMod("inserted","yes")&&"middle"!==t.getPositionType()},initIncut:function(t,e){var i=this._getSerpList(),n=t.domElem,s=t.params;switch(s.positionType){case"line":i.appendToRow(s.position,n);break;case"middle":case"page":"prev"===e?i.prependIncutElem(n):i.appendIncutElem(n);break;case"bottom":break;case"top":i.prependIncutElem(n)}return t.show().setShown()},_getSerpList:function(){return this._serpList||(this._serpList=this.findBlockInside("serp-list"))},_getSerpController:function(){return this._serpController||(this._serpController=this.findBlockOn("serp-controller"))}}),BEM.DOM.decl("distro",{destruct:function(){this._onResizeSubscribed&&BEM.blocks["b-page"].un("resize",this._onResize,this),this.__base.apply(this,arguments)},_onItemClick:function(t){t.preventDefault();var e=this.elemParams("item"),i=e.counter,n=e.url;BEM.create("chrome-webstore-item",{url:n}).on({installed:function(){c.hit({dtype:"iweb",path:i+"install",vars:"-app_url="+n})},installationFailed:function(t,e){c.hit({dtype:"iweb",path:i+"error",vars:"-app_url="+n+",-error_code="+e.errorCode})},installationCancelled:function(){c.hit({dtype:"iweb",path:i+"popup_close",vars:"-app_url="+n})}}).install()},show:function(){this.delMod("hidden"),this.setMod("shown","yes"),this._hitCounter(),this.notShownItems=this._getNotShownItems(this._initItems()),this.notShownItems.length>0&&(BEM.blocks["b-page"].on("resize",this._onResize,this),this._onResizeSubscribed=!0)},hide:function(){this.delMod("shown"),this.setMod("hidden","yes")},_getNotShownItems:function(t){return t.filter(function(t,e){var i=BEM.blocks["scroll-spy"].getElemVisibility(e).visible;return i&&this._countItemShown(e),!i}.bind(this))},_countItemShown:function(t){var e=BEM.DOM.extractParams(t[0]),i=e.link&&e.link.counterData;i&&cp({pid:i.pid,cid:i.cid,path:i.show.path,vars:i.show.vars})},_initItems:function(){return this.elem("item").map(function(t,e){return this.elemify(e,"item")}.bind(this))},_onResize:function(){this.notShownItems.length>0?this.notShownItems=this._getNotShownItems(this.notShownItems):(this._onResizeSubscribed=!1,BEM.blocks["b-page"].un("resize",this._onResize,this))},_hitCounter:function(){c.cpHitDelayed({pid:40,cid:72921,path:"image.serp.footer.show"})},_onLinkClick:function(t){var e=$(t),i=e.parents(this.buildSelector("link")),n=i.bem("link").params.counterData;cp({pid:n.pid,cid:n.cid,path:n.click.path,vars:n.click.vars})}},{live:function(){return this.liveBindTo({elem:"item",modName:"inline",modVal:"yes"},"click",function(t){this._onItemClick(t)}),this.liveBindTo("link","click",function(t){this._onLinkClick(t.target)}),!1}}),BEM.decl("chrome-webstore-item",{onSetMod:{js:function(){this.url=this.params.url}},install:function(){this.addLink(),chrome.webstore.install(this.url,this.onInstalled.bind(this),this.onInstallationFailed.bind(this))},addLink:function(){this.linkAdded||($(document.head).append($("<link />").attr({rel:"chrome-webstore-item",href:this.url})),this.linkAdded=!0)},onInstalled:function(){this.trigger("installed")},onInstallationFailed:function(t,e){var i="userCancelled"===e?"installationCancelled":"installationFailed";this.trigger(i,{errorMessage:t,errorCode:e})}}),BEM.DOM.decl({block:"cbir-counter"},{_isPageCbir:function(){var t=this.findBlockOn("page-layout");return t.hasMod("page","search-by-image")},_statcounterHit:function(t){BEM.blocks["b-statcounter"].hit({params:{query:{cbir:t}}})}},{live:function(){this.liveInitOnBlockInsideEvent("more-click","tags",function(){this._isPageCbir()&&this._statcounterHit({tags:"more"})}).liveInitOnBlockInsideEvent("tag-click","tags",function(t,e){this._isPageCbir()&&(this._statcounterHit({tags:"item"}),c.hit({dtype:"iweb",path:"/image/new/cbir/tags/item",reqid:BEM.blocks["i-global"].param("reqid")},e))})}}),BEM.DOM.decl({block:"serp-counter"},{_isSearchPage:function(){var t=this.findBlockOn("page-layout");return t.hasMod("page","search")},_isPane2Opened:function(){var t=BEM.DOM.blocks["pane2-api"].getInstance();return t.isOpened},_onTagClick:function(t){this._isSearchPage()&&!this._isPane2Opened()&&c.hit({dtype:"iweb",path:"/images/new/serp/tags",reqid:BEM.blocks["i-global"].param("reqid"),vars:["-pos=p"+t.pos,"-text="+t.query].join(",")},t)}},{live:function(){this.liveInitOnBlockInsideEvent("tag-click","tags",function(t,e){this._onTagClick(e)})}}),BEM.DOM.decl({block:"serp-user",modName:"type",modVal:"enter"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments);var t=this.findBlockOn("login-popup","popup"),e=this.findBlockInside("promo-popup","popup2");t?this._initLoginPopup(t):e&&this._initPromoPopup(e),this.bindTo("login-link","pointerclick",this._updateLoginUrl)}}},_initLoginPopup:function(t){var e=BEM.blocks["i-cookie"].get(),i=Math.round(new Date/1e3)+86400;e.yp("ln_pp")||(e.yp("ln_pp",!0,i),t.bindTo("close","click",function(){var t=(this.elemParams("login-popup").counters||{}).close;t&&window.Ya.counter.w(null,t),e.yp("ln_pp",!0,7*i)}.bind(this)),t.show({top:14,right:14}))},_initPromoPopup:$.noop,_updateLoginUrl:function(){var t=BEM.blocks.utils.getPassportUrl(),e=this.findBlockOn("login-link","button2");e&&(this.params.origin&&(t=BEM.blocks.uri.setParam(t,"origin",this.params.origin)),e.setUrl(t))}},{live:function(){return this.__base.apply(this,arguments),this.liveBindTo("login-link","pointerclick",this._updateLoginUrl),!1}}),BEM.DOM.decl({block:"popup",modName:"type",modVal:"modal"},{getDefaultParams:function(){var t=this.__base();return t.top="50%",t.left="50%",t},_isPercentVal:function(t){return"string"==typeof t&&t.indexOf("%")>0},show:function(t){return this._moveToContainer(),this.setMod("visibility","outside").setMod("adaptive","no"),this.repaint(t),this},repaint:function(t){this._moveToContainer(),t||(t={left:this.params.left,top:this.params.top});var e=this.getPopupSize();return this._isPercentVal(t.left)&&!t.marginLeft&&(t.marginLeft=e.width/(-100/parseInt(t.left,10))),this._isPercentVal(t.top)&&!t.marginTop&&(t.marginTop=e.height/(-100/parseInt(t.top,10))),this._show(t),this}}),BEM.DOM.decl("user",{redraw:function(){return this}},{getLogoutUrl:function(){var t=BEM.blocks["i-global"],e=t.param("retpath"),i=t.param("yandexuid");return[t.param("passport-host"),"/passport?mode=logout",i?"&yu="+i:"",e?"&retpath="+encodeURIComponent(e):""].join("")}}),BEM.DOM.decl("user",{_onClick:function(){this._updateRetpath(),this.__base.apply(this,arguments)},_updateRetpath:function(){BEM.blocks["i-global"].setParams({retpath:this._getRetPath()}),this.redraw()},_getRetPath:function(){return BEM.blocks.location.getInstance().getUri().replaceParam("ncrnd",Math.floor(1e4*Math.random())).toString()}}),BEM.DOM.decl("unread-letters-updater",{onSetMod:{js:function(){this._noticeRequest(this._noticeCheck.bind(this),function(){})}},_noticeCheck:function(t){t&&BEM.channel("unread-letters-count").trigger("update",parseInt(t.counters.unread,10))},_disableNotice:function(){var t=BEM.blocks["i-ua"].ie,e=Boolean(t);return e&&10>t||!this.params.hasMailBox},_noticeRequest:function(t,e){this._disableNotice()||BEM.create("i-request_type_ajax",{url:"https://mail.yandex."+BEM.blocks["i-global"].param("tld")+"/api/v2/serp/counters?silent",dataType:"json",xhrFields:{withCredentials:!0},paramsToSettings:["xhrFields"]}).get({},t,e)}}),BEM.DOM.decl("user",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._isRetina=BEM.blocks["i-ua"].hiDpi,this.updateIcon(),this.setMod(this.elem("icon"),"loaded","yes")}}},_getIconPath:function(t){var e=this.params.avatarHost,i=this._getIconSize(),n=(this._isRetina?"/islands-retina-":"/islands-")+i;return[e,"/get-yapic/",t,n].join("")},_setIconBackground:function(t){var e=this.elem("icon");e&&e.css("background-image","url("+t+")")},updateIcon:function(){this.elem("icon").length&&this._setIconBackground(this._getIconPath(this.elemParams("icon").avatarId))},getDefaultParams:function(){return $.extend(this.__base(),{avatarHost:"//avatars.mds.yandex.net"})}}),BEM.DOM.decl("user",{_getIconSize:function(){return"middle"}}),BEM.DOM.decl("user",{_getIconPath:function(t){var e=this.params.avatarHost,i=this._getIconSize(),n=(this._isRetina?"/islands-retina-":"/islands-")+i;return[e,"/get-yapic/",t,n].join("")},updateIcon:function(){if(this.elem("icon").length){var t=this.params.avatarId||this.elemParams("icon").avatarId;this._setIconBackground(this._getIconPath(t))}},getDefaultParams:function(){var t=this.__base.apply(this,arguments);return t.avatarHost="//avatars.mds.yandex.net",t}}),BEM.decl("i-common__string",{},{cleverSubstring:function(){var t="";return function(e,i,n){return e.length>i+n?e.substring(0,i-1)+t:e}}(),escapeHTML:function(){var t={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"};return function(e){return String(e).replace(/&(?!\w+;)|[<>"']/g,function(e){return t[e]||e})}}(),escapeRegExp:function(t){return t.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}}),BEM.DOM.decl("user",{onSetMod:{js:{inited:function(){if(this.__base.apply(this,arguments),this.elem("name").length){var t=this,e=t.elemParams("name");e.isUglyUserName&&BEM.blocks["i-user-services"].get(function(i){var n=BEM.blocks["i-common__string"].cleverSubstring,s=BEM.blocks["i-common__string"].escapeHTML,o=Object(i.displayName).name||i.login,r=n(o,e.maxLength,e.maxLengthRelative);r='<span class="user__first-letter">'+s(r.charAt(0))+"</span>"+s(r.slice(1)),t.elem("name").html(r),t.trigger("update-name")})}}}},toggleCollapsed:function(t){return this.toggleMod("hide-name","yes","",t)}}),BEM.decl("i-user-services",{},{get:function(t){this._data?t(this._data):this._get(t)},getApiUrl:function(){return BEM.blocks["i-global"].param("pass-host")+"/services?callback=?"},_callbacks:[],_get:function(t){var e=this;e._callbacks.push(t),1===e._callbacks.length&&$.getJSON(e.getApiUrl(),{locale:BEM.blocks["i-global"].param("lang"),login:"yes","current-login":BEM.blocks["i-global"].param("login"),yu:$.cookie("yandexuid")},function(t){e._data=t,$.each(e._callbacks,function(){this(t)}),e._callbacks.length=0})}}),BEM.DOM.decl("ticker",{onSetMod:{js:{inited:function(){this._count=this.params.count}}},show:function(){return this.setMod("state","normal")},hide:function(){return this.setMod("state","empty")},val:function(t){if(!arguments.length)return this._count;var e=this.params.maxCount;return this._count=t,this.elem("value").attr("title",t).text(t>e?e:t),t?this.show():this.hide(),this}}),BEM.DOM.decl("ticker",{onSetMod:{js:function(){this.__base.apply(this,arguments),BEM.channel("unread-letters-count").on("update",this._onUnreadLettersCountUpdate.bind(this))}},_onUnreadLettersCountUpdate:function(t,e){e>=0&&this.val(e)}}),BEM.DOM.decl({block:"user",modName:"menu",modVal:"multiauth"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._dropdown=this.findBlockOutside("dropdown-menu"),this._dropdown&&this._dropdown.on("show",this._onPopupShow,this).on("hide",this._onPopupHide,this),this._dataProvider=BEM.create(this.params.dataProvider,{url:this.params.accountsUrl,timeout:this.params.getAccountsTimeout})}}},getDefaultParams:function(){return $.extend(this.__base(),{accountsUrl:BEM.blocks["i-global"].param("pass-host")+"/accounts",getAccountsTimeout:5e3,dataProvider:"i-request_type_ajax"})},destruct:function(){this._dropdown&&this._dropdown.domElem&&this._dropdown.destruct(),this.__base.apply(this,arguments)},_onPopupShow:function(){this.redraw(),this.domElem.attr("aria-expanded",!0),this._getAccounts()},_onPopupHide:function(){this.domElem.attr("aria-expanded",!1)},_onClick:function(t){t.preventDefault(),this.__base.apply(this,arguments),this._dropdown&&this._dropdown.toggle(this.elem("icon").length?this.elem("icon"):this.elem("name"))},redraw:function(){if(this.__base.apply(this,arguments),!this._dropdown)return this;var t=BEM.blocks["i-global"].param("retpath")||"",e=this._dropdown.getPopup().domElem,i=e.find(this.buildSelector("logout")),n=e.find(this.buildSelector("add")),s=e.find(this.buildSelector("edit-list"));return[i,n,s].forEach(function(e){var i=e.attr("href");i=i.replace(/&retpath=.*$/,"&retpath="+encodeURIComponent(t)),e.attr("href",i)}),this},_getAccounts:function(){this._accountsInited||(this._accountsInited=!0,this._dataProvider.get({yu:BEM.blocks["i-global"].param("yandexuid")},this._addAccounts.bind(this)))},_addAccounts:function(t){if((t&&t.accounts||[]).length>1){var e=0,i=this._dropdown.getPopup().domElem,n=i.find(this.buildSelector("accounts")).parent();t.accounts.forEach(function(i){if(i&&i.uid!==t.default_uid&&i.displayName){var s=BEM.blocks["i-global"],o=$(BEMHTML.apply([{block:"i-global",params:{uid:i.uid,displayName:i.displayName,"passport-host":s.param("passport-host"),login:void 0}},{block:"b-menu-vert",elem:"item",elemMods:{theme:"grey"},type:"account",mix:{block:"user",elem:"account"},content:{block:"user",js:{pos:e++},mix:[{block:"link"},{block:"user",elem:"account-link"}],content:[{elem:"icon"},{elem:"name",js:!1}]}},""]));n.after(o),n=o}},this),this._dropdown.getPopup().findBlocksInside("user"),this.setMod(i.find(this.buildSelector("edit-list")),"visible","yes"),t["can-add-more"]||this.setMod(i.find(this.buildSelector("add")),"hidden","yes")}}},{live:function(){if(!this._menu){this._menu=!0;var t=BEM.blocks.keycodes.SPACE,e=function(t){return t.shiftKey||t.ctrlKey||t.altKey||t.metaKey};this.liveBindTo("pointerclick",function(t){this._onClick(t)}).liveBindTo("keydown",function(i){e(i)||i.which===t&&i.preventDefault()}).liveBindTo("keyup",function(i){e(i)||i.which===t&&this._dropdown&&this.domElem.click()})}return this.liveBindTo("account-link","pointerclick",function(t){var e=this.findBlockOutside($(t.target),"user");e.params&&(t.preventDefault(),this.__self.setMainAccount(e.params.uid))}),this.__base(),!1},setMainAccount:function(t){var e=BEM.blocks["i-global"],i=e.param("passport-host")+"/passport?mode=embeddedauth";$('<form method="POST" action="'+i+'"><input type="hidden" name="uid" value="'+t+'"><input type="hidden" name="action" value="change_default"><input type="hidden" name="retpath" value="'+e.param("retpath")+'"><input type="hidden" name="yu" value="'+e.param("yandexuid")+'"></form>').appendTo("body").submit()}}),BEM.DOM.decl({block:"dropdown-menu",baseBlock:"dropdown"}),BEM.DOM.decl("i-menu",{onElemSetMod:{item:{state:{current:function(t,e,i,n){if("disabled"===n)return!1;var s=this.elem("item","state","current");this.delMod(s,"state").trigger("current",{prev:s,current:t})}}}},onItemSelectorClick:function(t){var e=this._getItemByEvent(t);this.setMod(e,"state","current")},_getItemByEvent:function(t){return t.data.domElem.closest(this.buildSelector("item"))}},{live:function(){this.liveBindTo("item-selector","pointerclick",function(t){this.onItemSelectorClick(t)})}}),BEM.DOM.decl({block:"b-menu-vert",baseBlock:"i-menu"}),BEM.DOM.decl({name:"b-menu-horiz",baseBlock:"i-menu"}),BEM.DOM.decl("user-menu-update",{onSetMod:{js:{inited:function(){this.updateInformer(this.onUpdateSuccess,this.onUpdateError)}}},updateInformer:function(t,e){this._getExporter().get({},function(i){i&&i.counters&&void 0!==i.counters.unread?t.call(this,i.counters):e&&e.call(this)},e)},onUpdateSuccess:function(t){var e=t.unread,i=this.params.unreadMax;e&&i&&e>i&&(e=i+"+");var n=e?e+" ":"";BEM.DOM.update(this.domElem,n+BEM.I18N("user","letter",{count:e}))},onUpdateError:function(){},_getExporter:function(){return this._exporter||(this._exporter=BEM.create("i-request_type_ajax",{url:this.__self.getExportApiUrl(this.params.caller),cache:!1,xhrFields:{withCredentials:!0},dataType:"json",callbackCtx:this}))},getDefaultParams:function(){return{unreadMax:99}}},{getExportApiUrl:function(t){return"https://mail.yandex."+BEM.blocks["i-global"].param("tld")+"/api/v2/"+(t?t+"/":"")+"counters?silent"}}),BEM.DOM.decl({block:"user",modName:"menu",modVal:"yes"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments);var t=60;this._dropdown=this.findBlockOutside("dropdown-menu"),this._dropdown&&this._dropdown.on("show",function(){this.bindToWin("scroll",$.throttle(this._hide,t,this)).redraw().domElem.attr("aria-expanded",!0)}.bind(this)).on("hide",function(){this.unbindFromWin("scroll").domElem.attr("aria-expanded",!1)}.bind(this))}}},_hide:function(){this._dropdown&&this._dropdown.hide()},_onClick:function(t){t.preventDefault(),this.__base.apply(this,arguments),this._dropdown&&this._dropdown.toggle(this.elem("icon").length?this.elem("icon"):this.elem("name"))},redraw:function(){if(this.__base.apply(this,arguments),!this._dropdown)return this;var t=this.__self.getLogoutUrl();return this._dropdown._popup.findBlockInside("user").elem("logout").attr("href",t),this},destruct:function(){this._dropdown&&this._dropdown.domElem&&this._dropdown.destruct(),this.__base.apply(this,arguments)}},{live:function(){if(!this._menu){this._menu=!0;var t=BEM.blocks.keycodes.SPACE,e=function(t){return t.shiftKey||t.ctrlKey||t.altKey||t.metaKey};this.liveBindTo("pointerclick",function(t){this._onClick(t)}).liveBindTo("keydown",function(i){e(i)||i.which===t&&this._dropdown&&i.preventDefault()}).liveBindTo("keyup",function(i){e(i)||i.which===t&&this.domElem.click()})}return this.__base(),!1}}),BEM.DOM.decl("mobile-suggest",{onSetMod:{js:function(){this.findBlocks().bindEvents(),this.header.setMod("mobile-suggest","yes"),this.fade.setMod("mobile-suggest","yes")}},findBlocks:function(){return this.rejectButton=this.findBlockInside({block:"button",modName:"action",modVal:"reject"}),this.acceptButton=this.findBlockInside({block:"button",modName:"accept",modVal:"yes"}),this.page=this.findBlockOutside("b-page"),this.header=this.page.findBlockInside("header"),this.fade=this.page.findBlockInside({block:"fade",modName:"region",modVal:"main"}),this},bindEvents:function(){return this.rejectButton.on("click",this._onReject,this),BEM.blocks["b-page"].on("scroll",this._onPageScroll,this).on("change",this._onPageChange,this),this},destruct:function(){this.rejectButton.un("click",this._onReject,this),BEM.blocks["b-page"].un("scroll",this._onPageScroll,this).un("change",this._onPageChange,this),this.__base.apply(this,arguments)},_onReject:function(){var t=this.params,e=t.today,i=$.cookie("nmb")?"2":"1:"+e;this.fold(),$.cookie("nmb",i,{expires:365,path:"/"+t.service})},_onPageScroll:function(){this.domElem.css("left",BEM.DOM.win.scrollLeft())},fold:function(){this.header.delMod("mobile-suggest"),this.fade.delMod("mobile-suggest"),this.destruct()},_onPageChange:function(){this.updateMobileLink()},updateMobileLink:function(){var t=this.acceptButton.domElem.attr("href"),e=BEM.blocks.uri.getParamValue(t,"retpath"),i=BEM.blocks.uri.getParamValue("text"),n=BEM.blocks.uri.parse(e),s=_.isEmpty(i)?n.getRoot():n.getRoot()+"/search?text="+encodeURIComponent(i);this.acceptButton.domElem.attr("href",BEM.blocks.uri.setParam(t,"retpath",s));
}}),BEM.DOM.decl("cookies",{onSetMod:{js:function(){this.__self.save(this.params.cookies)}}},{save:function(t){_.forEach(t,function(t){document.cookie=t})}}),BEM.DOM.decl("i-device-info",{onSetMod:{js:{inited:function(){var t=this.params.forcedSzm;t?this.setSzmCookie(decodeURIComponent(t)):this.updateSzmCookie()}}},getScreenSize:function(){return this.validateScreenSize({w:screen.width,h:screen.height})},getViewportSize:function(){return{w:window.innerWidth,h:window.innerHeight}},getDevicePixelRatio:function(){return window.devicePixelRatio||1},getScreenParams:function(){return{screenSize:this.getScreenSize(),viewportSize:this.getViewportSize(),devicePixelRatio:this.getDevicePixelRatio()}},updateSzmCookie:function(){var t=this.getScreenParams(),e=this.parseSzmCookie(this.getSzmCookie());this.isSzmEqual(e,t)||this.setSzmCookie(this.stringifySzmCookie(t))},setSzmCookie:function(t){return BEM.blocks["i-cookie"].get().yp({name:"szm",value:t,encode:!1})},getSzmCookie:function(){return BEM.blocks["i-cookie"].get().yp("szm")},isSzmEqual:function(t,e){function i(t,e){return t.w===e.w&&t.h===e.h}return t&&e?t.devicePixelRatio!==e.devicePixelRatio?!1:i(t.screenSize,e.screenSize)?!!i(t.viewportSize,e.viewportSize):!1:!1},validateScreenSize:function(t){return t},formatSzmSizeToString:function(t){return t?[t.w,t.h].join("x"):void 0},formatSzmSizeToObject:function(t){return t?(t=t.split("x"),{w:Number(t[0]),h:Number(t[1])}):void 0},stringifySzmCookie:function(t){return[String(t.devicePixelRatio).replace(".","_"),this.formatSzmSizeToString(t.screenSize),this.formatSzmSizeToString(t.viewportSize)].join(":")},parseSzmCookie:function(t){if(t){t=t.split(":");var e=t[0],i=t[1],n=t[2]||t[1];return{devicePixelRatio:Number(e.replace("_",".")),screenSize:this.formatSzmSizeToObject(i),viewportSize:this.formatSzmSizeToObject(n)}}}}),function(t){t.decl("i-userinfo",{resolutions:[{width:240,height:320,ratio:{width:3,height:4}},{width:320,height:480,ratio:{width:2,height:3}},{width:480,height:800,ratio:{width:3,height:5}},{width:640,height:960,ratio:{width:2,height:3}},{width:600,height:1024,ratio:{width:3,height:5}},{width:768,height:1024,ratio:{width:3,height:4}},{width:1920,height:1080,ratio:{width:16,height:9}},{width:1680,height:1050,ratio:{width:16,height:10}},{width:1600,height:900,ratio:{width:16,height:9}},{width:1440,height:900,ratio:{width:16,height:10}},{width:1280,height:1024,ratio:{width:5,height:4}},{width:1366,height:768,ratio:{width:16,height:9}},{width:1280,height:800,ratio:{width:16,height:10}},{width:1152,height:864,ratio:{width:4,height:3}},{width:1024,height:768,ratio:{width:4,height:3}},{width:1200,height:800,ratio:{width:3,height:2}},{width:1280,height:720,ratio:{width:16,height:9}},{width:1280,height:768,ratio:{width:5,height:3}},{width:1280,height:960,ratio:{width:4,height:3}},{width:1366,height:768,ratio:{width:16,height:9}},{width:1400,height:1050,ratio:{width:4,height:3}},{width:1600,height:1200,ratio:{width:4,height:3}},{width:1680,height:945,ratio:{width:16,height:9}},{width:1920,height:1200,ratio:{width:16,height:10}},{width:2048,height:1152,ratio:{width:16,height:9}},{width:2048,height:1536,ratio:{width:4,height:3}},{width:2560,height:1440,ratio:{width:16,height:9}},{width:2560,height:1600,ratio:{width:16,height:10}}],getScreenSize:function(t){var e=this.getDefaultResolution(this.getDeviceInfo(t));if(!t)return e;var i=t.userInfo||{},n={width:i.sw||e.width,height:i.sh||e.height};return n.ratio=this.getRatio(n),n},getWindowSize:function(t){var e,i=this.getDefaultResolution(this.getDeviceInfo(t));return t?(e=t.userInfo||{},{width:e.ww||i.width,height:e.wh||i.height}):i},getScreenResolution:function(t){var e=this.getScreenSize(t),i=this.getPixelDensity(t);return{width:Math.floor(e.width*i),height:Math.floor(e.height*i)}},getDeviceInfo:function(t){return{isTablet:t.isTablet,isMobile:t.isMobile,iOS7:t.iOS7,iOS:t.iOS,wp:t.isWindowsPhone}},getDefaultResolution:function(t){var e={width:1366,height:768};return t?(t.isTablet?e={width:1024,height:768}:t.isMobile&&(e={width:640,height:960}),e):e},getRatio:function(t){return{1.25:{width:5,height:4},1.33:{width:4,height:3},1.56:{width:3,height:2},1.6:{width:16,height:10},1.66:{width:5,height:3},1.77:{width:16,height:9},1:{width:1,height:1},.6:{width:3,height:5},.66:{width:2,height:3},.67:{width:2,height:3},.75:{width:3,height:4},.58:{width:3,height:5},.56:{width:9,height:16}}[this.calcRatio(t)]||{width:16,height:9}},getPixelDensity:function(t){return Number((t.userInfo||{}).pd)||1},isRetinaDisplay:function(t){return this.getPixelDensity(t)>1.5},parseResolution:function(t){var e=t.split("x");return{width:parseInt(e[0],10),height:parseInt(e[1],10)}},extendedScreenSize:function(t){var e=this.getDeviceInfo(t),i=this.getScreenResolution(t),n=i.width,s=i.height,o=e.isTablet,r=e.isMobile,a=e.iOS7,c=e.iOS,h=e.wp;return o&&a?n=s=2448:r&&a?(n=1040,s=1536):r&&!c&&!h||o?n=s=Math.max(n,s):c&&!a&&(n=640,s=1136),{width:n,height:s}},findAppropriateResolution:function(t,e,i){var n;return e||(e=this.resolutions),n=e.map(function(e){return this.calcResolutionDelta(e,t)},this),n.sort(this.compare),i?this.getResolutions(n,i):n[0].resolution},getResolutions:function(t,e){for(var i=new Array(e),n=0;e>n;n++)i[n]=t[n].resolution;return i},compare:function(t,e){var i=Math.abs(t.square),n=Math.abs(e.square);return t.ratio===e.ratio?t.square>=0&&e.square>=0?t.square<=e.square?-1:1:Math.min(i,n)<1e5?n>i?-1:1:t.square>e.square?-1:1:i===n?t.ratio<e.ratio?-1:1:i*t.ratio<=n*e.ratio?-1:1},calcResolutionDelta:function(t,e){var i=t.ratio||t;return{ratio:Math.abs(this.calcRatio(i)-this.calcRatio(e)),square:this.calcSquare(t)-this.calcSquare(e),resolution:t}},calcRatio:function(t){return Math.floor((t.width||t.w)/(t.height||t.h)*100)/100},calcSquare:function(t){return(t.width||t.w)*(t.height||t.h)}})}("undefined"!=typeof BEMPRIV?BEMPRIV:BEM),BEM.decl("i-userinfo",{getDefaultParams:function(){return{separator:"-"}},getScreenSize:function(){var t,e=this.getDeviceInfo(),i=window.screen,n={width:i.width,height:i.height,ratio:this.getRatio(i)};return e&&e.isTablet&&n.width<n.height&&(t=n.width,n.width=n.height,n.height=t),n},getDeviceInfo:function(){var t,e,i=BEM.blocks["i-global"],n=BEM.blocks["i-ua"];return n.ios&&(t=n.ios.match(/([0-9]+)/g),e=t&&t[0]),{isTablet:i.param("tablet"),isMobile:i.param("mobile"),iOS:n.ios,iOS7:parseInt(n.ios,10)>=7,wp:n.wp}},getUserInfo:function(){var t=this.params.separator,e=this.getScreenSize(),i=this.getWindowSize();return[["sw",e.width].join(t),["sh",e.height].join(t),["ww",i.width].join(t),["wh",i.height].join(t),["pd",this.getPixelDensity()].join(t),["wp",this.getWP()].join(t)].join(t)},getWindowSize:function(){return{width:window.innerWidth,height:window.innerHeight}},getPixelDensity:function(){return BEM.DOM.win[0].devicePixelRatio||1},getWP:function(){var t=this.getScreenInfo();return t.ratio.width+"x"+t.ratio.height+"_"+t.width+"x"+t.height},getScreenInfo:function(){if(this._screen)return this._screen;var t=this.getScreenResolution(),e=this.findAppropriateResolution(t);return this._screen={width:e.width,height:e.height,ratio:e.ratio},this._screen}},{_instance:null,get:function(){return this._instance||(this._instance=BEM.create("i-userinfo"))}}),BEM.DOM.decl("b-page",{bindEvents:function(){return this.__base.apply(this,arguments),BEM.blocks["pane2-api"].on("fullscreen:enter",this._onFullscreenEnter,this).on("fullscreen:exit",this._onFullscreenExit,this),this},destruct:function(){BEM.blocks["pane2-api"].un("fullscreen:enter",this._onFullscreenEnter,this).un("fullscreen:exit",this._onFullscreenExit,this),this.__base.apply(this,arguments)},_onFullscreenEnter:function(){this.setMod("fullscreen","yes")},_onFullscreenExit:function(){this.setMod("fullscreen","no")}}),BEM.DOM.decl("b-page",{bindEvents:function(){return this.__base.apply(this,arguments),this._location.on("b-page_type_search-by-image",this._onCbirSearch,this),this},_onCbirSearch:function(t,e){this.checkCacheKey()&&this.loadPage(e,"search-by-image"),BEM.blocks.header.getSearch().updateCbirPage()}}),BEM.DOM.decl({block:"b-page",modName:"type",modVal:"search-by-image"},{buildCacheKey:function(){var t=this._location.getState();return[t.block?t.block:"",t.type?t.type:"",BEM.blocks.uri.delParams(t.url,_.without(this._getFilterParams(),"img_url"))].join("_")}}),BEM.DOM.decl("b-page",{bindEvents:function(){return this.__base.apply(this,arguments),this._location.on("b-page_type_similar",this._onPageSimilar,this),this},_onPageSimilar:function(t,e){this.checkCacheKey()&&this.loadPage(e,"similar"),BEM.blocks.header.getSearch().updateCbirPage()}}),BEM.DOM.decl("disk-controller",{getDefaultParams:function(){return{pendingKey:"pendingSave"}},onSetMod:{js:function(){this.__self._instance=this,this._uploadedState={},this._setDiskAPIURL(),this.bindEvents()}},bindEvents:function(){BEM.blocks["pane2-api"].on("duplicate:loaded",this._onDuplicateLoaded,this),BEM.blocks["disk-button"].on("click",this._onSaveClick,this),BEM.blocks.disk.on("firstUpload",this._onFirstUpload,this),BEM.blocks.disk.on("upload",this._onUpload,this),BEM.blocks.disk.on("error",this._onError,this)},destruct:function(){BEM.blocks["pane2-api"].un("duplicate:loaded",this._onDuplicateLoaded,this),BEM.blocks["disk-button"].un("click",this._onSaveClick,this),BEM.blocks.disk.un("firstUpload",this._onFirstUpload,this),BEM.blocks.disk.un("upload",this._onUpload,this),BEM.blocks.disk.un("error",this._onError,this),this.__base.apply(this,arguments)},_onSaveClick:function(){this.saveFile()},_onFirstUpload:function(){this.showFirstUploadPopup()},_onUpload:function(t,e){this.addUploaded(e.file.id),this._getLogo().bounce(),this.updateButton()},_onError:function(t,e){this.getCurrentItemParams().id===e.file.id&&this._getSaveButton().showError(e.error).enable()},_onDuplicateLoaded:function(){!this.isThumbLoaded()&&this.getPending()&&this.checkPending(this.getFileData())},showFirstUploadPopup:function(){var t=BEM.blocks["i-global"].param("tablet");this._getLogo().showPopup(t&&this._getSaveButton().domElem)},updateButton:function(){var t=this._getSaveButton();t.hidePopups(),this.isUploaded()?t.setSaved():t.setNotSaved()},getCurrentItemParams:function(){return BEM.blocks["pane2-api"].getItemParams()},getCurrentDuplicate:function(){return BEM.blocks["pane2-api"].getCurrentDuplicate()},getPending:function(){return this._getStorage().get(this.params.pendingKey)},setPending:function(t){this._getStorage().set(this.params.pendingKey,t.id)},delPending:function(){this._getStorage().del(this.params.pendingKey)},checkPending:function(t){t.id!==this.getPending()||this.hasMod("unauthorized","yes")||(this.saveFile(),this.delPending())},saveFile:function(){var t=this.getFileData();this._getSaveButton().disable(),this.isThumbLoaded()?this.setPending(t):this._getDisk().saveFile(t)},isThumbLoaded:function(){var t=this.getCurrentItemParams(),e=this.getCurrentDuplicate();return t.thumb.url===e.url},getFileData:function(){var t=this.getCurrentItemParams(),e=this.getCurrentDuplicate();return{id:t.id,url:this._getOriginalUrlFromDup(e),meta:{page_url:t.snippet.url,yaimages_search_url:location.origin+t.detail_url,yaimages_search_request:BEM.blocks["i-global"].param("query")}}},_getOriginalUrlFromDup:function(t){return t.origin?"string"==typeof t.origin?t.origin:"object"==typeof t.origin?t.origin.url:void 0:t.url},addUploaded:function(t){this._uploadedState[t]=!0},isUploaded:function(){return this._uploadedState[this.getCurrentItemParams().id]},_setDiskAPIURL:function(){var t=BEM.blocks["i-global"].param("tld");"ru"!==t&&BEM.blocks["disk-api"].setAPIURL("https://cloud-api.yandex."+t+"/images/v1/disk")},_getStorage:function(){return BEM.blocks.localstorage.getInstance()},_getDisk:function(){return this._disk||(this._disk=BEM.create("disk",{dirName:this.params.dirName}))},_getLogo:function(){return this._logo||(this._logo=this.findBlockInside("disk-logo"))},_getSaveButton:function(){return this._saveButton||(this._saveButton=this.findBlockInside("disk-button"))}},{_instance:null,get:function(){return this._instance}}),BEM.decl("disk",{getDefaultParams:function(){return{maxPollingRequests:2,pollingTimeout:300,filename:"Image.jpg",dirName:"Images"}},checkDir:function(){var t=this.params.dirName,e=$.Deferred(),i=this;return this._isDirExists?e.resolve():this._getAPI().isPathExists(t).then(function(){i._isDirExists=!0})},saveFile:function(t){var e=this;t.dir=this.params.dirName,t.count=0,t.name||(t.name=this._getFileName(t.url)),this._checkOrCreateDir(t.dir).then(function(){e._saveFile(t)}).fail(function(i){e._triggerError(i,t)})},_getFileName:function(t){var e=t.substring(t.lastIndexOf("/")+1,t.length),i=e.indexOf("#"),n=e.indexOf("?");-1!==n?e=e.substring(0,n):-1!==i&&(e=e.substring(0,i));try{e=decodeURIComponent(e)}catch(s){}return e.length>250&&(e=e.substr(0,250)),e=e.replace(/(\*|\||\\|:|"|<|>)/gi,"-"),e||this.params.filename},_checkOrCreateDir:function(t){var e=$.Deferred(),i=this;return this.checkDir().then(function(){e.resolve()}).fail(function(n){return n&&404===n.status?void i._getAPI().mkdir(t).then(function(){e.resolve()}).fail(function(t){e.reject(t)}):void e.reject(n)}),e.promise()},_saveFile:function(t){var e=t.dir+"/"+this._buildUniqFilename(t),i=this;this._getAPI().upload(e,t.url).then(function(n){i._waitAndSetMeta(e,t,n.href)}).fail(function(e){409===e.status?(t.count++,i._saveFile(t)):i._triggerError(e,t)})},_waitAndSetMeta:function(t,e,i){var n=this;this._waitForUpload(e,i).then(function(){n._getAPI().setMeta(t,e.meta),n._triggerSuccess(e)}).fail(function(t){n._triggerError(t,e)})},_buildUniqFilename:function(t){var e=t.name,i=t.count,n=e.lastIndexOf("."),s="";return n>=0&&(s=e.substring(n),e=e.substring(n,-1)),e+(i>0?" ("+i+")":"")+s},_triggerSuccess:function(t){this.trigger("upload",{file:t}),this.__self.isImgLoaded()||(this.__self.setImgLoaded(),this.trigger("firstUpload"))},_triggerError:function(t,e){var i={file:e,result:this._parseResponse(t),error:t&&507===t.status?"not-enough-space":""};this.trigger("error",i)},_waitForUpload:function(t,e){var i=$.Deferred();return this._pollingRequestsCount=0,this._polling(i,t,e),i.promise()},_polling:function(t,e,i){var n=this;this._getAPI().status(i).then(function(s,o,r){return s&&"failed"!==s.status?void("success"===s.status?t.resolve(s):n._resumePolling(t,e,i)):void t.reject(r)}).fail(function(s){n._pollingRequestsCount<n.params.maxPollingRequests?(n._pollingRequestsCount++,n._resumePolling(t,e,i)):t.reject(s)})},_resumePolling:function(t,e,i){var n=this;setTimeout(function(){n._polling(t,e,i)},this.params.pollingTimeout)},_parseResponse:function(t){var e;try{e=t.responseText&&JSON.parse(t.responseText)}catch(i){}return e},_getAPI:function(){return this._api||(this._api=BEM.blocks["disk-api"])}}),BEM.decl("disk",{onSetMod:{js:function(){this.bindEvents(),this.__base.apply(this,arguments)}},bindEvents:function(){return this.on("error",this._onError,this),this},unbindEvents:function(){return this.on("error",this._onError,this),this},_onError:function(t,e){var i=e.error;return c.hit({dtype:"stred",pid:40,cid:72947,path:"disk.api.error",vars:i?"status="+i:""}),this},destruct:function(){this.unbindEvents(),this.__base.apply(this,arguments)}}),BEM.decl("disk",{},{isImgLoaded:function(){return this._getLoadedState()},setImgLoaded:function(){this._setCookie(1)},_getLoadedState:function(){var t=this._getCookie(),e=this._parseState(t);return t.length>1&&this._setCookie(e),e},_parseState:function(t){return Number(t.replace(/\d+\./,""))||0},_getCookie:function(){return $.cookie("dps")||""},_setCookie:function(t){$.cookie("dps",t,{expires:3650,path:BEM.blocks["i-global"].param("router").index})}}),BEM.decl("disk-api",{},{API_URL:"https://cloud-api.yandex.ru/images/v1/disk",PATHS:{info:"/",resources:"/resources/",operations:"/operations/",upload:"/resources/upload/"},info:function(){return this._req("get",{method:"info"})},setAPIURL:function(t){this.API_URL=t},setMeta:function(t,e){return this._req("patch",{method:"resources",query:{path:t},data:{custom_properties:e}})},status:function(t){return this._req("get",{url:t})},upload:function(t,e){return this._req("post",{method:"upload",query:{url:e,path:t,disable_redirects:!0}})},isPathExists:function(t){return this._req("get",{method:"resources",query:{path:t,limit:1}})},mkdir:function(t){return this._req("put",{method:"resources",query:{path:t}})},_getURL:function(t,e){return this.API_URL+this.PATHS[t]+(e?"?"+$.param(e):"")},_req:function(t,e){var i=e.data;return $.ajax({url:e.url||this._getURL(e.method,e.query),data:i&&JSON.stringify(i),processData:!1,contentType:"application/json",dataType:"json",type:t,cache:!1,xhrFields:{withCredentials:!0}})}}),BEM.DOM.decl("disk-domik",{onSetMod:{js:{inited:function(){this.findBlocks(),BEM.blocks.popup.on(this.elem("popup"),"show",this._onPopupShow,this).on(this.elem("popup"),"hide",this._onPopupHide,this)}}},destruct:function(){BEM.blocks.popup.un(this.elem("popup"),"show",this._onPopupShow,this).un(this.elem("popup"),"hide",this._onPopupHide,this),this.__base.apply(this,arguments)},findBlocks:function(){this._auth=this.findBlockOn("auth","auth"),this._popup=this.findBlockOn("popup","popup")},show:function(){this._getPopup().show()},_onPopupShow:function(){this.hasMod("focus","no")||this._focusUsername(),this.trigger("show")},_focusUsername:function(){this._getAuth().getUsernameBlock().elem("control").focus()},_onPopupHide:function(){this.trigger("hide")},_getPopup:function(){return this._popup},_getAuth:function(){return this._auth}},{live:!0}),BEM.DOM.decl("auth",{onSetMod:{js:{inited:function(){this._username=this.findBlockInside("username","input"),this._password=this.findBlockInside("password","input"),this._button=this.findBlockInside("button","button2"),this._register=this.findBlockInside("register","button2"),this._remember=this.findBlockInside("remember","button2"),this._error=null,this._errorOwner=null,this._username.on("change",this._onInputChange,this),this._password.on("change",this._onInputChange,this),this.bindTo("submit",this._onBeforeSubmit),this.redraw()}}},_checkInput:function(t){var e=this,i=this.__self._getValidators(e,e._username.val(),e._password.val(),{checkEmpty:t}),n=i.every(function(t){var i=t();return Array.isArray(i)?(e.showError(i[0],BEM.I18N("auth",i[1])),i[0].elem("control").attr("aria-invalid",!0),!1):!0});return n&&(this.hideError(),this._username.elem("control").removeAttr("aria-invalid"),this._password.elem("control").removeAttr("aria-invalid")),n},_onInputChange:function(t){this._checkInput(!1)},enableButton:function(){return this._button.delMod("disabled"),this},disableButton:function(){return this._button.setMod("disabled","yes"),this},_onBeforeSubmit:function(t){return this._username.val(this._username.val().trim()),this._checkInput(!0)?(this._onSubmit(t),void this.trigger("submit",t)):!1},_onSubmit:function(t){this.disableButton(),this.elem("timestamp").val((new Date).getTime())},_getError:function(){if(this._error)return this._error;var t=$(BEMHTML.apply(this.__self._buildError()));return BEM.DOM.append(this.domElem,t),this._error=this.findBlockOn(t,"popup"),this._errorMsg=this.findElem(t,"error"),this._error.on("hide",function(){this._errorOwner=null},this),this._error},showError:function(t,e){var i=this._getError();return this._curErrorMsg!==e&&(this._errorMsg.text(e),this._curErrorMsg=e),this._errorOwner!==t&&(this._errorOwner=t,i.hide().show(t)),this},hideError:function(){return this._error&&this._error.hide(),this},getUsernameBlock:function(){return this._username},getPasswordBlock:function(){return this._password},getHaunterBlock:function(){return this._haunter||(this._haunter=this.findBlockInside("haunter","checkbox")),this._haunter},submit:function(){return this.domElem.submit(),this},redraw:function(){return this._onInputChange(),this._register&&this._register.setUrl(this.getRegisterURL()),this._remember&&this._remember.setUrl(this.getRememberURL()),this},setRetpath:function(t){return this.elem("retpath").val(t),this},getRetpath:function(){return this.elem("retpath").val()},getRegisterURL:function(){return this._getPassportURL("registration")},getRememberURL:function(){return this._getPassportURL("restoration")},_getPassportURL:function(t){return this.params.passport+"/"+t+"?"+$.param({from:this.elem("from").val(),origin:this.elem("origin").val(),retpath:this.getRetpath()})},destruct:function(){this._error&&this._error.destruct(),this.__base.apply(this,arguments)},getDefaultParams:function(){return{passport:BEM.blocks["i-global"].param("passport-host")}}},{_isUsernameValid:function(t,e){return this._isUsernameEmailValid(t)||this._isUsernameLoginValid(t)||this._isUsernamePhoneValid(t,e)},_isUsernameEmailValid:function(t){return/^\s*[^@\s]+@[^@\s]+\s*$/.test(t)},_isUsernameLoginValid:function(t){return/^\s*[---A-Za-z0-9.]+\s*$/.test(t)},_isUsernamePhoneValid:function(t,e){return e?(t=t.trim(),t=t.replace(/-\)/,"+)"),t=t.replace(/(\d)-/g,"$1"),t=t.replace(/\((\d+)\)/,"$1"),t=t.replace(/(^|\d+)\(/,"$1"),t=t.replace(/^\+/,""),/^\d*$/.test(t)):/^\+?[-0-9]*(?:\([-0-9]+\))?[-0-9]+$/.test(t)},_isPasswordValid:function(t){return!/[^\-a-zA-Z0-9`!@#$%^&*()_=+\[\]{};:"\|\\,.<>\/?]/.test(t)},_buildError:function(){return{block:"popup",mods:{autoclosable:"no"},js:{directions:["right","left"]},attrs:{role:"alert","aria-live":"assertive","aria-atomic":!0},content:[{elem:"tail"},{elem:"content",mix:[{block:"auth",elem:"error"}]}]}},_getValidators:function(t,e,i,n){var s=n.checkEmpty,o=this;return[function(){return s&&0===e.length?[t._username,"fill-input"]:!0},function(){return s&&0===i.length?[t._password,"fill-input"]:!0},function(){return/[--]/.test(i)?[t._password,"wrong-keyboard-layout"]:!0},function(){return o._isUsernameValid(e,!s)?!0:[t._username,"wrong-characters"]},function(){return o._isPasswordValid(i)?!0:[t._password,"wrong-characters"]},function(){return i&&i===e?[t._password,"wrong-password"]:!0}]}}),BEM.DOM.decl("auth",{_onBeforeSubmit:function(){return this.setRetpath(BEM.blocks.location.getInstance().getState().url),this.__base.apply(this,arguments)}}),BEM.DOM.decl("auth",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._socialDropdown=null,this._socialBroker=null,this._initSocialProviders()}}},_initSocialProviders:function(){var t=BEM.blocks["i-global"],e=t.param("social-providers"),i=this;if(e)i._createSocial(e);else{var n=t.param("social-host");if(!n)return;i._getSocialProviders(n,function(t){i._createSocial(t)})}},_getSocialProviders:function(t,e){$.getJSON(this.__self._getProvidersURL(t),function(t){e(t.providers)})},_createSocial:function(t){return t.length?(BEM.DOM.update(this.elem("social"),BEMHTML.apply(this.__self._buildSocial(t,this._uniqId))),void(this._socialDropdown=this.findBlockInside("social","dropdown"))):(this.elem("social").remove(),void this.dropElemCache("social"))},_onSocialClick:function(t){var e=this;t.preventDefault(),this._socialDropdown&&this._socialDropdown.hide(),this._socialBroker&&this._socialBroker.destruct(),this._socialBroker=BEM.create("social-broker"),this._socialBroker.start(function(){var t=e.getRetpath(),i=this.__self._getTopWindow().location;t&&i.href!==t?i.href=t:i.reload()}.bind(this),$.noop,{provider:this.elemParams(t.data.domElem).provider})}},{live:function(){return this.liveBindTo("social-link","pointerclick",function(t){this._onSocialClick(t)}).liveBindTo("social-link","keyup",function(t){var e=t.keyCode===BEM.blocks.keycodes.SPACE;!e||t.shiftKey||t.ctrlKey||t.altKey||t.metaKey||this._onSocialClick(t)}),this.__base(),!1},_getProvidersURL:function(t){return t+"/providers2.jsonp?callback=?"},_buildSocial:function(t,e){var i,n,s,o=[];return t=t.filter(function(t){return t.enabled}),n=this._buildSocialPrimary(t),o=o.concat(n),s=this._buildSocialSecondary(t),i=this._buildSocialMore(n,s,e,t),i&&o.push(i),o},_buildSocialPrimary:function(t){return t.filter(function(t){return t.primary}).map(function(t){return{block:"link",mods:{theme:"normal"},mix:{block:"auth",elem:"social-link",js:{provider:t.code}},title:t.display_name,icon:{block:"auth",elem:"social-icon",elemMods:{code:t.code}}}})},_buildSocialSecondary:function(t){return t.map(function(t){return{block:"link",mods:{theme:"normal"},mix:{block:"auth",elem:"social-link",js:{provider:t.code}},title:t.display_name,icon:{block:"auth",elem:"social-icon",elemMods:{code:t.code}},text:{mix:{block:"auth",elem:"social-text"},content:BEM.blocks["i-common__string"].escapeHTML(t.display_name)}}})},_buildSocialMore:function(t,e,i,n){if(t.length>=n.length)return!1;var s=BEM.I18N("auth","more");return{block:"dropdown",js:!0,content:[{block:"button",mods:{pseudo:"yes",theme:"pseudo",size:"s"},mix:[{block:"dropdown",elem:"switcher"}],attrs:{title:s,"aria-label":s},content:"  "},{elem:"popup",content:{block:"auth",elem:"social-popup",mix:[{block:"auth",js:{uniqId:i}}],content:e}}]}},_getTopWindow:function(){return window.top}}),BEM.decl("social-broker",{_windowWidth:500,_windowHeight:280,onSetMod:{js:{inited:function(){this._window=null,this._timer=0,this._salt=0}}},start:function(t,e,i){var n,s,o,r=this;if(this._onSuccess=t,this._onFailure=e,!this._hasLocalStorage())return void this.onFailure({status:"error"});this._cleanup(),i=$.extend({},r._getDefaultParams(),i),n=i.startUrl+"?",o=i.popupName,delete i.startUrl,delete i.popupName,s=i.display,this._salt=Math.floor(1e9*Math.random()).toString(16);var a=o+"_"+this._salt;return s&&"popup"!==s&&(i.retpath=i.retnopopup||i.retpath||window.location.href,delete i.retnopopup),i.retpath+=(-1!==i.retpath.indexOf("?")?"&":"?")+"social-broker_seed="+encodeURIComponent(a),n+=Object.keys(i).reduce(function(t,e){return t.push(encodeURIComponent(e)+"="+encodeURIComponent(i[e])),t},[]).join("&"),s&&"popup"!==s?void this._navigate(n):(this._lsLoginStatusKey="login_status_from_"+a,this._window=window.open(n,a,this._getPopupParams(),!1),this._window?(this._window.focus(),clearInterval(this._timer),void(this._timer=setInterval(function(){var t;try{t=window.localStorage.getItem(r._lsLoginStatusKey)}catch(e){}if(r.isClosed()&&(clearInterval(r._timer),!t))return void r.onFailure({status:"error"});if(t){var i=r._deserialize(t);r._handleStatus(i)===!1&&r.onFailure({status:"error"})}},500))):void this.onFailure({status:"error"}))},_hasLocalStorage:function(){return Boolean(window.localStorage)},_deserialize:function(t){var e;try{e=JSON.parse(t)}catch(i){e={raw:t}}return e},_handleStatus:function(t){return"ok"===t.status?(this.onSuccess(t),!0):"error"===t.status?(this.onFailure(t),!0):!1},isClosed:function(){return this._window?this._window.closed:!0},_navigate:function(t){window.location.href=t},_getDefaultParams:function(){var t=BEM.blocks["i-global"],e=t.param("id");return{startUrl:t.param("social-startUrl")||t.param("social-host")+"/broker/start",retpath:t.param("social-retpath")||[location.protocol,"//",location.host,t.param("lego-path"),"/common.blocks/social-broker/__closer/social-broker__closer.html"].join(""),retnopopup:t.param("social-retnopopup")||!1,consumer:e||"morda",popupName:"social_"+(e||"morda"),action_if_anonymous:"authorize",result_location:"fragment"}},_getPositionedParams:function(t,e,i,n){return["scrollbars=yes, resizable=1, menubar=0, toolbar=0, status=0, location=0, directories=0",", left=",e,", top=",t,", width=",i,", height=",n].join("")},_getPopupParams:function(){var t,e,i=this._windowWidth,n=this._windowHeight;return window.opera?(t=(screen.availWidth-i)/2,e=(screen.availHeight-n)/2):(t=(window.innerWidth-i)/2,e=(window.innerHeight-n)/2),t=Math.round(t),e=Math.round(e),this._getPositionedParams(e,t,i,n)},_cleanup:function(){if(clearInterval(this._timer),this._lsLoginStatusKey)try{window.localStorage.removeItem(this._lsLoginStatusKey)}catch(t){}this.isClosed()||this._window.close(),this._window=null},onSuccess:function(t){this._cleanup(),this._onSuccess&&this._onSuccess(t)},onFailure:function(t){this._cleanup(),this._onFailure&&this._onFailure(t)},destruct:function(){this._cleanup(),this.__base.apply(this,arguments)}}),BEM.DOM.decl({name:"button",modName:"pseudo",modVal:"yes"},{_onClick:function(t){this.__base.apply(this,arguments),this._href&&t.preventDefault()}}),BEM.DOM.decl("i-ua",{},{placeholder:"placeholder"in document.createElement("input")}),BEM.DOM.decl("input",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),(this._hasHint=Boolean(this.elem("hint")[0]))&&this.on("change",this._updateHint)._updateHint()}},focused:function(){return this.__base.apply(this,arguments)===!1?!1:void(this._hasHint&&this._updateHint())}},_updateHint:function(){this.toggleMod(this.elem("hint"),"visibility","visible",!this.val())}}),BEM.decl("localstorage",{onSetMod:{js:{inited:function(){this._service=BEM.blocks["i-global"].param("id"),this._enabled=!1;try{if("localStorage"in window){var t="test"+Number(new Date);localStorage.setItem(t,t),localStorage.removeItem(t),this._enabled=!0,this._convertDeprecatedData()}}catch(e){}}}},_convertDeprecatedData:function(){var t=JSON.parse(localStorage.getItem(this._service));t&&(_.forOwn(t,function(t,e){this.set(e,t)}.bind(this)),localStorage.removeItem(this._service))},get:function(t,e){var i;try{if(this._enabled)return i=localStorage.getItem(this._getItemName(t)),null!==i||"undefined"==typeof e?JSON.parse(i):e}catch(n){}return e||null},set:function(t,e){try{if(this._enabled)return localStorage.setItem(this._getItemName(t),JSON.stringify(e)),!0}catch(i){}return!1},del:function(t){try{this._enabled&&localStorage.removeItem(this._getItemName(t))}catch(e){}},_getItemName:function(t){return this._service+"."+t}},{getInstance:function(){return this.instance||(this.instance=BEM.create("localstorage"))}}),BEM.DOM.decl({block:"disk-controller",modName:"unauthorized",modVal:"yes"},{bindEvents:function(){this.__base.apply(this,arguments),BEM.blocks["disk-logo"].on("click",this._onLogoClick,this),BEM.blocks["disk-domik"].on("hide",this._onDomikHide,this),BEM.blocks["disk-button"].on("auth:click",this._onAuthLinkClick,this)},destruct:function(){BEM.blocks["disk-logo"].un("click",this._onLogoClick,this),BEM.blocks["disk-domik"].un("hide",this._onDomikHide,this),BEM.blocks["disk-button"].un("auth:click",this._onAuthLinkClick,this),this.__base.apply(this,arguments)},showDomik:function(t){t&&this.setPending(this.getCurrentItemParams()),this.blockInside("disk-domik").show()},_onSaveClick:function(){this.hasMod("social-auth","yes")?this._getSaveButton().showError("social-auth"):this.showDomik(!0)},_onAuthLinkClick:function(){this.showDomik(!0)},_onLogoClick:function(){this.hasMod("social-auth","yes")||this.showDomik()},_onDomikHide:function(){this.delPending()}}),BEM.DOM.decl({block:"disk-controller",modName:"no-save",modVal:"yes"},{_onSaveClick:function(){this._getSaveButton().setSaved()}}),BEM.DOM.decl("feedback",{externalData:{},onSetMod:{js:function(){this.checkboxes=this.findBlocksInside("checkbox"),this.submit=this.findBlockInside({block:"button",modName:"type",modVal:"submit"}).on("press",this.submitFeedback,this),this.findBlockInside({block:"button",modName:"type",modVal:"close"}).on("press",function(){this.popup.hide()},this),this.popup=this.findBlockInside("popup").on("show",this.onShowPopup,this).on("hide",this.onHidePopup,this),this.popup.params.top=this.popup.params.top||"50%",this.setCheckboxEvent(),this._ajax=BEM.create("i-request_type_ajax",{url:this.params.abuseLink,cache:!1,dataType:"script",type:"POST"}),this.channel("feedback").on("show",this.showFeedback,this)}},showFeedback:function(t,e){this.externalData=e,this.resetPopup(),this.popup.toggle()},resetPopup:function(){this.checkboxes.forEach(function(t){t.delMod("checked")}),this.popup.findBlockInside("radiobox").val("no"),this.popup.delMod("thanks"),this.popup.findElem("result").hide(),this.popup.findElem("complaint").show()},setCheckboxEvent:function(){var t=this.findBlocksInside("checkbox"),e=this;t&&t.map(function(t){t.on("change",e.checkboxChanged,e)})},checkboxChanged:function(){this.submit.setMod("disabled",this.hasCheckedItems()?"":"yes");
},hasCheckedItems:function(){return this.checkboxes.filter(function(t){return t.isChecked()}).length>0},submitFeedback:function(){var t=this;this._ajax.params.url=this.externalData.abuseLink,this._ajax.get(t.getLogParams(),this.onSuccess),setTimeout(function(){t.popup.setMod("thanks","yes"),t.popup.findElem("result").show(),t.popup.findElem("complaint").hide()},200)},defaultParams:function(){var t=this.popup.findBlocksInside("checkbox").filter(function(t){return t.isChecked()}).map(function(t){return t.val()}).toString(),e=this.popup.findBlockInside("radiobox").val(),i=this.params&&this.params.request,n={"complaint-query":e,"reason-complaint":t};return i&&$.extend(n,i),n},getLogParams:function(){return this.defaultParams()},onShowPopup:function(){},onHidePopup:function(){var t=this.popup;t.setMod("modal","hide"),setTimeout(function(){t.delMod("visibility"),t.delMod("modal")},150)},onSuccess:function(){}}),BEM.DOM.decl("feedback",{onSetMod:{js:function(){this.__base.apply(this,arguments),this.findBlockInside({blockName:"button",modName:"type",modVal:"submit"}).domElem.attr("onmousedown",this.params.submitCounter)}},getLogParams:function(){return $.extend({},this.__base.apply(this,arguments),{query:BEM.blocks["i-global"].param("query"),lr:this.params.lr,service:[BEM.blocks["i-global"].param("id"),"yandex",BEM.blocks["i-global"].param("tld")].join("."),"url-complaint":this.externalData.url,reqid:BEM.blocks["i-global"].param("serpid")})}}),BEM.DOM.decl("feedback",{getLogParams:function(){var t=this.__base.apply(this,arguments),e=this.getExternalData();return this.clearUndefinedValues(_.assign(t,e))},clearUndefinedValues:function(t){return _.reduce(t,function(t,e,i){return"undefined"!=typeof e&&(t[i]=e),t},{})},getExternalData:function(){return{"shows-urls":BEM.blocks["serp-list"].getUrls().join(";"),"shows-related-images":this.externalData["shows-related-images"],"shows-related-queries":this.externalData["shows-related-queries"],"related-query-complaint":this.externalData["related-query-complaint"],"related-image-complaint":this.externalData["related-image-complaint"],reqid:BEM.blocks["i-global"].param("reqid")}}},{showPopup:function(t){BEM.channel("feedback").trigger("show",{url:BEM.blocks["serp-item"].getUrls(t).join(";"),timeQuery:t.params.timeQuery,abuseLink:BEM.blocks["i-global"].param("abuseLink")})}}),BEM.DOM.decl("head-filter",{getDefaultParams:function(){return{reloadParams:["p","img_url","rpt","pos"],pagesToFilter:{"search-by-image":["rpt","img_url"],similar:["rpt","img_url"]},popupDelay:1e3}},onSetMod:{js:{inited:function(){this.hasMod("disabled","yes")||this.findBlocks().bindEvents()}},hovered:function(t,e){"yes"===e?this.setColorIcon():this.setBlackIcon()},menu:{hidden:function(){this.setBlackIcon(),BEM.blocks["i-keyrouter"]&&BEM.blocks["i-keyrouter"].un("esc",this._onEsc,this)},visible:function(){this.setBlackIcon(),this.bindTo("item","keypress",this._onItemSelect),BEM.blocks["i-keyrouter"]&&BEM.blocks["i-keyrouter"].on("esc",this._onEsc,this)}},type:function(t,e){this.params.selected=e,this.trigger("saved"),this.updatePage().updateTooltip().updateMenu().closeMenu()},disabled:function(t,e){this.button.setMod("disabled",e)}},destruct:function(){this.unbindEvents(),this.__base.apply(this,arguments)},findBlocks:function(){return this.infoPopup=this.findBlockInside({block:"popup",modName:"type",modVal:"info"}),this.dropdown=this.findBlockOn("dropdown-menu"),this.button=this.dropdown.findBlockInside("button2"),this.filterPopup=this.findBlockOn("menu","popup"),this.menu=this.filterPopup.findBlockInside("b-menu-vert"),this.elem("item"),this},bindEvents:function(){return this.filterPopup.on("show",this._onMenuShow,this).on("hide",this._onMenuHide,this),this.infoPopup.on("show",this._onInfoShow,this).on("hide",this._onInfoHide,this),BEM.blocks["b-page"].on("warning",this._onWarning,this),BEM.blocks.notice&&BEM.blocks.notice.on({"safe-search:turn-off":this.reloadPage},this),this.bindTo("mouseover mouseout",this._onMouseMove),this.menu.bindTo(this.menu.elem("item"),"click",this.changeThis(this._onItemClick)),this},unbindEvents:function(){this.filterPopup.un("show",this._onMenuShow,this).un("hide",this._onMenuHide,this),this.infoPopup.un("show",this._onInfoShow,this).un("hide",this._onInfoHide,this),BEM.blocks["b-page"].un("warning",this._onWarning,this),BEM.blocks.notice&&BEM.blocks.notice.un({"safe-search:turn-off":this.reloadPage},this)},_onItemSelect:function(t){this.selectItem($(t.target))},_onEsc:function(){this.filterPopup.hide(),this.domElem.focus()},_onWarning:function(t,e){this.params.warning=e.pornoWarning,e.onlyFamily?this.setMod("type","family").setMod("disabled","yes"):this.delMod("disabled")},_onMouseMove:function(t){this.hasMod("disabled","yes")||this.setMod("hovered","mouseover"===t.type?"yes":"")},_onItemClick:function(t){return this.selectItem($(t.target)),!1},_onMenuShow:function(){this.infoPopup.isShown()&&this.infoPopup.hide(),this.setMod("menu","visible")},_onMenuHide:function(){this.setMod("menu","hidden")},_onInfoShow:function(){this.closeMenu().setColorIcon().setMod("info","visible")},_onInfoHide:function(){this.delMod("info").setBlackIcon()},selectItem:function(t){var e=this.elemParams(t).value;e&&this.setMod("type",e),BEM.blocks["b-statcounter"].hit({params:{query:{safe:e}}})},updateMenu:function(){var t=this.getFilterData(this.params.selected),e=this.menu;return e.delMod(e.elem("item","selected","yes"),"selected").setMod(e.elem("item","type",t.type),"selected","yes"),this},updateTooltip:function(){var t=this.getFilterData(this.params.selected),e=this.findBlockOn("tooltip-owner");return e&&e.setContent(t.tooltip),this},updatePage:function(){var t=this.params,e=this.getFilterData(t.selected),i=BEM.blocks["i-global"],n=BEM.blocks.location.getInstance().getState(),s=n.url.replace("/images/images/","/images/"),o=BEM.blocks.uri.delParams(s,this.getFilteredParams(i.param("page")));return this.saveFilter({save:1,retpath:t.needRefresh?o:t.retpath,yandexuid:i.param("yandexuid"),family:e.value}),this},saveFilter:function(t){var e=this.params,i=e.saveUrl;e.needRefresh?location.href=i+BEM.blocks.uri.buildRelativeUrl("",t):BEM.create("i-request_type_ajax",{url:i,type:"iframe",cache:!1,dataType:"html"}).get(t,this.reloadPage.bind(this),this.reloadPage.bind(this))},reloadPage:function(){var t=BEM.blocks["i-global"].param("page");return BEM.blocks.location.getInstance().change({url:BEM.blocks.uri.delParams(this.getFilteredParams(t)),params:{ncrnd:Math.floor(1e4*Math.random())},history:!1}),this.checkInfoMessage(!0)},checkInfoMessage:function(t){var e=this.params,i=this.getFilterData(e.selected).type;return this.infoPopup?(t&&"unlimited"===i&&this.showInfo(),this):this},showInfo:function(){return this.prepareInfo(),setTimeout(this.changeThis(this.showInfoPopup),this.params.popupDelay),this},prepareInfo:function(){var t=this.getFilterData(this.params.selected),e=this.infoPopup;return e.setMod("filter",t.type),e.elem("content-wrap").html(t.info),this},showInfoPopup:function(){var t=this.infoPopup;return t.show(this.elem("icon")),this.setMod("info","visible")},closeMenu:function(){return this.filterPopup.isShown()&&this.filterPopup.hide(),this},getFilteredParams:function(t){var e={},i=this.params.reloadParams||[],n=this.params.pagesToFilter[t]||[];return n.forEach(function(t){e[t]=!0}),i.filter(function(t){return!e.hasOwnProperty(t)})},getFilterData:function(t){for(var e=this.params.filters,i=0,n=e.length;n>i;i++)if(e[i].type===t)return e[i]},setColorIcon:function(){return this.setMod("color","yes")},setBlackIcon:function(){return setTimeout(this.changeThis(function(){this.isActive()||this.setMod("color","no")}),150),this},isActive:function(){return this.hasMod("hovered","yes")||this.hasMod("menu","visible")||this.hasMod("info","visible")}}),BEM.DOM.decl("i-cbir-initer",{onSetMod:{js:{inited:function(){this.bindEvents()}}},bindEvents:function(){return this.bindToDoc("drag dragstart dragover drop",this._onFirstDragEvent),BEM.blocks.search2.onFirst("search:submit",this._onSearchSubmit,this),BEM.blocks["cbir-logo"].onFirst("showPanel",this._onLogoClick,this),BEM.blocks.input.onFirst("cbir:click",this._onLogoClick,this),BEM.blocks["cbir-error"].onFirst("showParanja",this.cbirControllerShowParanja,this).onFirst("hideParanja",this.cbirControllerHideParanja,this),this},destruct:function(){this._unbindControllerEvents(),this.__base.apply(this,arguments)},_onLogoClick:function(){this.getController().showPanel(!BEM.blocks["i-global"].param("mobile"))},cbirControllerShowParanja:function(){this.getController().showParanja()},cbirControllerHideParanja:function(){this.getController().hideParanja()},_onSearchSubmit:function(t,e){this.getController().processSubmitEvent(e.event,e.data)},_onFirstDragEvent:function(t){var e=this.getPanel();return e&&e.isDragSupported()?e.processDragEvent(t):void 0},_unbindControllerEvents:function(){return BEM.blocks.search2.un("search:submit",this._onSearchSubmit,this),BEM.blocks["cbir-logo"].un("showPanel",this._onLogoClick,this),BEM.blocks.input.un("cbir:click",this._onLogoClick,this),BEM.blocks["cbir-error"].un("showParanja",this.cbirControllerShowParanja,this).un("hideParanja",this.cbirControllerHideParanja,this),this.unbindFromDoc("drag dragstart dragover drop",this._onFirstDragEvent)},getPanel:function(){return this._unbindControllerEvents().findBlockInside("cbir-panel")},getController:function(){return this._unbindControllerEvents().findBlockOn("i-cbir-controller")}}),window.Ya=window.Ya||{},Ya.AppsApi=Ya.AppsApi||{},Ya.AppsApi.BackendBridge=Ya.AppsApi.BackendBridge||{MAX_POLLING_TIME:2e3,TICK_TIMEOUT:50,setExpected:function(t){this._backendExpected=Boolean(t)},ensureInited:function(){"inited"!==this._serviceState&&("undefined"!=typeof this._backendExpected&&null!==this._backendExpected||(this._backendExpected=!0),this._yesQueue=[],this._noQueue=[],this._serviceState="inited",this._pollingStage="not started",this._pickUpBackend())},reset:function(){this._serviceState="not inited",this._pollingStage="not started",this._yesQueue=[],this._noQueue=[],this._backend=null,this._backendExpected=null},get:function(t,e){return this.ensureInited(),this._backend?t(this._backend):this._backendExpected&&"finished"!==this._pollingStage?(this._yesQueue.push(t),void(e&&this._noQueue.push(e))):e&&e()},_pickUpBackend:function(){this._pollingStart=Date.now(),this._pollingStage="in progress",setTimeout(this._checkApiBackend.bind(this),0)},_checkApiBackend:function(){var t=this._getRawBackend();if(t){for(this._pollingStage="finished",this._backend=t;this._yesQueue.length;)this._yesQueue.shift()(this._backend);return void(this._noQueue=[])}if(Date.now()-this._pollingStart<this.MAX_POLLING_TIME)return setTimeout(this._checkApiBackend.bind(this),this.TICK_TIMEOUT);for(this._pollingStage="finished";this._noQueue.length;)this._noQueue.shift()();this._yesQueue=[]},_getRawBackend:function(){return window.YandexApplicationsAPIBackend}},window.Ya=window.Ya||{},Ya.AppsApi=Ya.AppsApi||{},Ya.AppsApi.init=function(t){if(Ya.AppsApi.__frontend)throw new Error("Ya.AppsApi already inited");Ya.AppsApi.__listeners={},Ya.AppsApi.BackendBridge.setExpected(t||"undefined"==typeof t);var e=Ya.AppsApi.__frontend=Ya.AppsApi.createFrontend();Ya.AppsApi.whenAvailable=e.whenAvailable.bind(e),Ya.AppsApi.whenUnavailable=e.whenUnavailable.bind(e),e.init()},Ya.AppsApi.destroy=function(){Ya.AppsApi.__listeners={},Ya.AppsApi.__frontend.destroy(),Ya.AppsApi.__frontend=null,Ya.AppsApi.whenAvailable=null,Ya.AppsApi.whenUnavailable=null,Ya.AppsApi.BackendBridge.reset()},Ya.AppsApi.createFrontend=function(){return new Ya.AppsApi.Frontend},Ya.AppsApi.Frontend=$.inherit({__constructor:function(){this._api=null,this._apiWaitersQueue=[],this._noApiWaitersQueue=[],this._instanceNumber=this.__self._instanceCounter++,this._eventNamespace="i"+this._instanceNumber,this._listeners=Ya.AppsApi.__listeners[this._eventNamespace]={},this._listenerPath="Ya.AppsApi.__listeners."+this._eventNamespace+"."},destroy:function(){this._apiWaitersQueue=[],this._noApiWaitersQueue=[],delete Ya.AppsApi.__listeners[this._eventNamespace]},init:function(){Ya.AppsApi.BackendBridge.get(this._onBackend.bind(this),this._onNoBackend.bind(this))},whenAvailable:function(t,e,i){$.isFunction(t)&&(i=e,e=t,t=null),t=[].concat(t||[]);var n=function(){var n=[];t.forEach(function(t){this._api[t]&&n.push(this._api[t])},this),n.length===t.length&&(n.push(this._api),e.apply(i,n))}.bind(this);this._api?n():this._apiWaitersQueue.push(n)},whenUnavailable:function(t,e){var i=t.bind(e);return this._noBackend?i():void this._noApiWaitersQueue.push(i)},_onBackend:function(t){for(this._createApi(t);this._apiWaitersQueue.length;)this._apiWaitersQueue.shift()()},_onNoBackend:function(){for(this._noBackend=!0;this._noApiWaitersQueue.length;)this._noApiWaitersQueue.shift()()},_createApi:function(t){var e=this._api=new $.observable;if(this._backend=e.__backend=t,["freeze","unfreeze"].forEach(function(t){this._bindToBackend(t,e,t)},this),t.openSplitView&&(e.splitView=new $.observable,this._bindToBackend("openSplitView",e.splitView,"open"),this._bindToBackend("closeSplitView",e.splitView,"close"),e.splitView.open=function(e){return t.openSplitView(e),this},e.splitView.close=function(e){return t.closeSplitView(e),this}),t.openFullScreen){var i=0;e.fullScreen=new $.observable,this._bindToBackend("openFullScreen",e.fullScreen,"open"),this._bindToBackend("closeFullScreen",e.fullScreen,"close"),e.fullScreen.open=function(){return 0===i&&t.openFullScreen(),i++,this},e.fullScreen.close=function(){return i--,0===i&&t.closeFullScreen&&t.closeFullScreen(),i=Math.max(i,0),this}}t.openVertService&&(e.verticalServices=new $.observable,e.verticalServices.open=function(e,i,n){return t.openVertService(e,i,n),this}),t.setQueryText&&(e.query=new $.observable,e.query.setText=function(e){return t.setQueryText(e),this}),t.voiceAnswer&&(e.voice=new $.observable,e.voice.answer=function(e){return e=e||{},e.lang=e.lang||"ru",t.voiceAnswer(JSON.stringify(e)),this}),t.log&&(e.log=function(e){return e=[].concat(e),t.log(e),this}),t.logTimingEvent&&(e.logTimingEvent=function(e,i){return t.logTimingEvent(e,i),this}),t.capturePointer&&t.releasePointer&&(e.pointer=new $.observable,e.pointer.capture=function(){return t.capturePointer(),this},e.pointer.release=function(){return t.releasePointer(),this}),t.onAjaxSuccess&&(e.ajax=new $.observable,this._bindToBackend("ajaxNavigate",e.ajax,"navigate"),e.ajax.updateTabs=function(e,i,n){return t.ajaxUpdateTabs(e,i,n),this},e.ajax.success=function(e,i){return t.onAjaxSuccess(e,i),this},e.ajax.error=function(e,i,n,s){return t.onAjaxError(e,i,n,s),this},e.ajax.ready=function(e){return t.onAjaxReady(e),this},e.ajax.unload=function(e){return t.onAjaxUnload(e),this},e.ajax.changeLocation=function(e){return t.ajaxChangeLocation(e),this}),t.isPageVisible&&(e.pageVisibility=new $.observable,this._bindToBackend("pageVisibilityChange",e.pageVisibility,"change"),e.pageVisibility.isVisible=function(){return t.isPageVisible()}),t.openSideBlock&&(e.sideBlock=new $.observable,this._bindToBackend("openSideBlock",e.sideBlock,"open"),this._bindToBackend("closeSideBlock",e.sideBlock,"close"),e.sideBlock.open=function(e){return t.openSideBlock(e),this},e.sideBlock.close=function(){return t.closeSideBlock(),this}),t.openRelatedQuery&&(e.openRelatedQuery=function(){return t.openRelatedQuery.apply(t,arguments),this})},_bindToBackend:function(t,e,i){this._listeners[t]=function(t){e.trigger(i,t)},this._backend.on(t,this._listenerPath+t)}},{_instanceCounter:0}),function(){window.__enableFakeYandexApplicationsAPI&&Ya.AppsApi.enableSimulator(),Ya.AppsApi.init(Boolean(Ya.AppsApiEnabled))}(),Ya.AppsApi.whenAvailable(function(){parseFloat(BEM.blocks["i-ua"].android)<4.4&&(BEM.DOM.scope.scrollTop(1),BEM.DOM.scope.scrollTop(0))});var engine=new bemhtml({production:!0});engine.compile(function(){block("incut").attrs()(function(){var t={},e=this.ctx.js;return e.position>=0&&e.positionType&&(t["data-position"]=e.position,t["data-position-type"]=e.positionType),t}),block("dropdown")(js()(!0),mix()(function(){return[{mods:{action:"closed"}}]}),elem("popup").replace()(function(){var t=this.ctx,e=[{block:"dropdown",elem:"popup"}];return t.mix&&(e=e.concat(t.mix)),{block:"popup",mix:e,mods:this.elemMods,underMods:t.underMods,attrs:t.attrs,js:t.js,content:[{elem:"tail"},{elem:"content",content:t.content}]}})),block("dropdown")(elem("text").tag()("span"),elem("switcher-text").tag()("span")),block("popup")(def().match(function(){return!this._popupDefaults})(function(){var t=this.ctx,e=this.mods;if(e.hasOwnProperty("theme")||(e.theme="ffffff"),e.hasOwnProperty("autoclosable")||(e.autoclosable="yes"),e.hasOwnProperty("adaptive")||(e.adaptive="yes"),e.hasOwnProperty("animate")||(e.animate="yes"),t.zIndex){var i=t.attrs||(t.attrs={});i.style=(i.style||"")+";z-index:"+t.zIndex+";"}return apply("default",{_popupDefaults:!0})}),content()(function(){return delete this._popupDefaults,[{elem:"under",elemMods:this.ctx.underMods},this.ctx.content]})),oninit(function(t){var e=t.BEMContext.prototype,i=t["i-global"]=e["i-global"]=e.extend({lang:"ru",tld:"ru","content-region":"ru","click-host":"//clck.yandex.ru","passport-host":"https://passport.yandex.ru","pass-host":"https://pass.yandex.ru","social-host":"https://social.yandex.ru","export-host":"https://export.yandex.ru",login:"","lego-static-host":"https://yastatic.net/lego/2.10-142"},e["i-global"]);i._public={id:!0,lang:!0,tld:!0,"content-region":!0,"user-region":!0,login:!0,displayName:!0,index:!0,yandexuid:!0,"passport-host":!0,"pass-host":!0,"passport-msg":!0,"static-host":!0,"lego-static-host":!0,"social-host":!0,clck:!0,"click-host":!0,"export-host":!0,"i-host":!0,"social-retpath":!0,"lego-path":!0,sid:!0,retpath:!0,uid:!0},i.makePublic=function(t,n){return"object"==typeof t?void(i._public=e.extend(i._public,t)):("undefined"==typeof n&&(n=!0),void(i._public[t]=n))},i.isPublic=function(t){return Boolean(i._public[t])},i.setTld=function(t){var e="tr"===t?"yandex.com.tr":"yandex."+t,n=-1!==["ua","by","kz"].indexOf(t)?"yandex.ru":e;i.tld=t,i["content-region"]=t,i["click-host"]="//clck."+n,i["passport-host"]="https://passport."+n,i["pass-host"]="https://pass."+e,i["social-host"]="https://social."+e,i["export-host"]="https://export."+e},e._iGlobalBackup={_backup:null,exists:function(){return Boolean(this._backup)},save:function(){this._backup=e.extend({},i)},restore:function(){var t;for(t in i)delete i[t];for(t in this._backup)i[t]=this._backup[t]}}}),block("i-global")(tag()(""),def()(function(){var t=this.ctx.params||{},e=this["i-global"];this._iGlobalBackup.exists()?this.ctx.reset!==!1&&this._iGlobalBackup.restore():this._iGlobalBackup.save(),t.tld&&t.tld!==e.tld&&e.setTld(t.tld);for(var i in t)e[i]=t[i];return""})),oninit(function(t){var e=t["i-global"];["serpid","reqid","query","searchInputText","project","page","pageCounterPath","mobile","isYandexApp","tablet","counterDebug","seo","router","isOldBrowser","showRelevance","uid","ncrnd","isYandexNet","isPumpkin","isSpok","testId","serviceName","expFlags","clck","abuseLink","pushbundle","is500pxAvailable","cm2","isCbirEnabled","lags","isPornoQuery","incutPosition","rimConfig","resizer","lr"].forEach(function(t){e.makePublic(t)})}),block("i-ua")(bem()(!1),tag()("script"),attrs()(function(){return{nonce:this.ctx.nonce||this["i-global"].nonce}}),content()(function(){var t=[";(function(d,e,c,r){","e=d.documentElement;",'c="className";','r="replace";','e[c]=e[c][r]("i-ua_js_no","i-ua_js_yes");','if(d.compatMode!="CSS1Compat")','e[c]=e[c][r]("i-ua_css_standart","i-ua_css_quirks")',"})(document);"].join("");return[{html:t}]})),block("i-ua").content()(function(){var t=[";(function(d,e,c,n,w,v,f){","e=d.documentElement;",'c="className";','n="createElementNS";','f="firstChild";','w="http://www.w3.org/2000/svg";','e[c]+=" i-ua_svg_"+(!!d[n]&&!!d[n](w,"svg").createSVGRect?"yes":"no");','v=d.createElement("div");','v.innerHTML="<svg/>";','e[c]+=" i-ua_inlinesvg_"+((v[f]&&v[f].namespaceURI)==w?"yes":"no");',"})(document);"].join("");return[].concat(applyNext(),{html:t})}),block("i-ua").content()(function(){var t=[";(function(d,e,s,o,p){","e=d.documentElement;","s=e.style;",'o="object-fit";','p="OObjectFit";','e.className+=(o in s||p in s)?"":" i-ua_"+o+"_no"',"})(document);"].join("");return[].concat(applyNext(),{html:t})}),block("i-ua").content()(function(){var t=[";(function(w,e,s,c,x,l,p,d){",'c="className";','x="deviceXDPI";','l="logicalXDPI";','p="devicePixelRatio";',"d=x in s&&l in s&&s[x]/s[l]||p in w&&w[p];",'d>1&&(e[c]+=" i-ua_retina_yes")',"})(window,document.documentElement,screen);"].join("");return[].concat(applyNext(),{html:t})}),block("popup").elem("tail").tag()("i"),block("dropdown").mod("advanced","yes")(elem("hidden-value")(tag()("input"),attrs()(function(){return{type:"hidden",name:this.ctx.name,value:this.ctx.value||""}})),elem("title-text")(tag()("span"))),block("suggest2").elem("items").tag()("ul"),block("suggest2-item")(tag()("li"),js()(!0),elem("text")(tag()(function(){return this.ctx.tag||"span"}),content()(function(){return this.ctx.text?Array.isArray(this.ctx.text)?this.ctx.text.map(function(t){return"string"==typeof t?t?{html:this.xmlEscape(t)}:"":t},this):this.ctx.text?{html:this.xmlEscape(this.ctx.text)}:"":Array.isArray(this.ctx.content)?this.ctx.content.map(function(t){return"string"==typeof t?t?{html:this.xmlEscape(t)}:"":t},this):this.ctx.content?{html:this.xmlEscape(this.ctx.content)}:""})),elem("fact").tag()("span")),block("suggest2-item")(elem("thumb").match(function(){return!this.ctx.content}).content()(function(){return{elem:"thumb-wrapper",attrs:{style:this.ctx.bgColor?"background-color: "+this.ctx.bgColor+";border: none;":""},content:{elem:"thumb-img",attrs:{src:this.ctx.src,alt:this.ctx.alt}}}}),elem("thumb-img").tag()("img")),block("suggest2-item").elem("img").def()(function(){var t=this.ctx.attrs||{};return this.ctx.src&&(t.style="background-image: url('"+this.ctx.src+"');"+(t.style||"")),applyNext({"ctx.attrs":t})}),block("suggest2-item").elem("text").elemMod("type","title-url").tag()("div"),block("suggest2-item").elem("text").elemMod("type","green-url").tag()("div"),block("suggest2-item").elem("bullet")(tag()("span"),attrs()({"aria-hidden":!0})),block("suggest2-item").elem("icon")(def()(function(){var t=BEM.blocks&&BEM.blocks["suggest2-detect"]&&BEM.blocks["suggest2-detect"],e=t&&t.isSupportInlineSVG(),i=e?"svg":"png";this.ctx.autoType&&(this.ctx[i]="//yastatic.net/suggest-flag-icons/icon."+this.ctx.autoType+i);var n=this.ctx.png&&this.ctx.svg?this.ctx[i]:this.ctx.svg||this.ctx.png;return n&&(this.ctx.attrs=this.extend(Object(this.ctx.attrs),{style:'background-image:url("'+n+'");'+(Object(this.ctx.attrs).style||"")})),applyNext()}),tag()("span")),block("i-bem").elem("i18n").def()(function(){if(!this.ctx)return"";var t=this.ctx,e=t.keyset,i=t.key,n=t.params||{};return e||i?(t.content&&(n.content=this.reapply(t.content)),BEM.I18N(e,i,n)):""}),oninit(function(){!function(t,e){if(!e.I18N){t.BEM=e;var i=e.I18N=function(t,e){return e};i.keyset=function(){return i},i.key=function(t){return t},i.lang=function(){}}}(this,"undefined"==typeof BEM?{}:BEM)}),block("button2")(def()(function(){return void 0===this.mods.view&&(this.mods.view="classic"),void 0===this.ctx.tabindex&&(this.ctx.tabindex="0"),applyNext()}),match(function(){return void 0===this.ctx.tag}).tag()("button"),js()(function(){return{_tabindex:this.mods.disabled?this.ctx.tabindex:void 0}}),attrs()(function(){var t=this.ctx,e=Boolean(this.mods.disabled);return{type:"button",autocomplete:"off",id:t.id,title:t.title,name:t.name,value:t.val,tabindex:e?void 0:t.tabindex,disabled:e,"aria-disabled":e&&"true"}}),match(function(){return!this.ctx.content}).content()(function(){var t=this.ctx;return[t.icon&&{elem:"icon",icon:t.icon},t.iconLeft&&{elem:"icon",elemMods:{side:"left"},icon:t.iconLeft},t.iconRight&&{elem:"icon",elemMods:{side:"right"},icon:t.iconRight},void 0!==t.text&&(this.isSimple(t.text)?{elem:"text",content:{html:this.xmlEscape(t.text)}}:this.extend(t.text,{elem:"text"}))].filter(Boolean)})),block("button2")(attrs()(function(){var t=applyNext()||{};return this.ctx["data-counter"]?t["data-counter"]=this.ctx["data-counter"]:this.ctx.counter&&(t.onmousedown=this.ctx.counter),t})),block("button2").elem("text").tag()("span"),block("suggest2-item").elem("highlight")(tag()("b"),bem()(!1),content()(function(){return this.xmlEscape(this.ctx.content)})),block("suggest2").elem("title").content()(function(){return[{elem:"a11y",content:BEM.I18N("suggest2","group")+": "},this.ctx.content]}),block("suggest2").elem("a11y").tag()("span"),block("suggest2-item").elem("fact")(match(function(){return this.ctx.color}).def()(function(){return this.ctx.attrs=this.extend(Object(this.ctx.attrs),{style:";color:"+this.ctx.color+";"+(Object(this.ctx.attrs).style||"")}),applyNext()}),content()(function(){return[{block:"suggest2",elem:"a11y",content:BEM.I18N("suggest2-item","quick-answer")+": "},this.ctx.content?{html:this.xmlEscape(this.ctx.content)}:""]})),block("suggest2-item").mod("type","nav").elem("fact").content()(function(){return this.xmlEscape(this.ctx.content)}),block("suggest2-item").mod("interact","link")(content()(function(){return{elem:"link",url:this.ctx.url,target:this.ctx.target||"_blank",content:this.ctx.content}}),match(function(){return"nav"===this.mods.type||"icon"===this.mods.type}).elem("text").mix()({elemMods:{type:"url"}})),block("suggest2-item").elem("link")(tag()("a"),attrs()(function(){return{href:this.ctx.url,target:this.ctx.target}})),block("suggest2-item").elem("icon").match(function(){return this.elemMods.traffic}).def()(function(){return applyNext({"ctx.autoType":"traffic."+this.elemMods.traffic+"."})}),block("suggest2-item").elem("icon").match(function(){return this.elemMods.weather}).def()(function(){var t=this.elemMods.weather.replace("-","minus-").replace("+","plus-").replace(/_/g,"-");return applyNext({"ctx.autoType":"weather."+t+".","elemMods.weather":t})}),block("tiled-images").js()(!0),block("tiled-images").elem("item")(attrs()(function(){return{"data-size":"["+this.ctx.width+","+this.ctx.height+"]"}}),content()(function(){return{elem:"link",content:{elem:"thumb",attrs:{src:this.ctx.url}}}})),block("tiled-images").elem("thumb").tag()("img"),block("tiled-images").elem("items").wrap()(function(){return this.ctx.fullWidth?this.ctx:{elem:"container",content:this.ctx}}),block("tiled-images").elem("items")(tag()("a"),mix()(function(){var t={block:"link",mods:{theme:"normal"}};return this.ctx.isAjax?(t.mods.ajax="yes",t.js=!0):t.mods.pseudo="yes",t}),attrs()(function(){return{href:this.ctx.url,style:"visibility: hidden;"}})),block("tiled-images").elem("more").content()(function(){var t=[{block:"tiled-images",elem:"button"}];return this.ctx.isAjax&&t.push({block:"link",mods:{theme:"normal",ajax:"yes"},js:!0}),{block:"button2",mix:t,mods:{size:"l",theme:this.ctx.theme,type:"link"},url:this.ctx.url,content:this.ctx.content}}),block("tiled-images").mod("type","list-item").tag()("li"),oninit(function(t){t.BEMContext.prototype.util||(t.BEMContext.prototype.util={})}),oninit(function(t){function e(t){return"object"==typeof t&&"[object Object]"===s.call(t)}function i(t,n,s){var o,r;t=Object(t),n=Object(n);for(o in n)r=s&&s(t[o],n[o],o),void 0!==r?t[o]=r:e(t[o])&&e(n[o])?t[o]=i(t[o],n[o],s):t[o]=n[o];return t}function n(t,e){return i(t,e,function(t,e,i){return"mix"===i?[].concat(t,e):void 0})}var s=Object.prototype.toString;t.BEMContext.prototype.util.merge=i,t.BEMContext.prototype.util.mergeBemjson=n}),block("link")(def()(function(){var t=(this.mods,this.ctx.url);return void 0===this.ctx.tabindex&&(this.ctx.tabindex="0"),this._url=this.isSimple(t)?t:this.reapply(t),applyNext()}),tag()(function(){return void 0!==this._url?"a":"span"}),js()(function(){return{_tabindex:this.mods.disabled?this.ctx.tabindex:void 0,_url:this.mods.disabled?this._url:void 0}}),match(function(){return"_blank"===this.ctx.target}).attrs()(function(){var t=this.ctx,e=t.attrs,i=void 0!==Object(e).rel,n=i?String(e.rel):"";return n&&-1===n.indexOf("noopener")&&(e.rel=n+" noopener"),this.extend(applyNext(),{rel:"noopener"})}),attrs()(function(){var t=this.ctx,e=this._url,i=void 0!==e,n=Boolean(this.mods.disabled),s=n?i&&-1:t.tabindex;return this.extend(applyNext(),{id:t.id,name:t.name,title:t.title,target:t.target,tabindex:s,href:i&&!n?e:void 0,role:i?void 0:"button","aria-disabled":n?"true":void 0})}),match(function(){return void 0===this.ctx.content}).content()(function(){var t=this.ctx,e=Boolean(t.text),i=Boolean(t.icon),n=function(t){return function(e){return"string"==typeof e?{html:t(e)}:e}}(this.xmlEscape);return[i&&this.util.mergeBemjson({block:"icon",mix:{block:"link",elem:"icon"}},t.icon),e&&(this.isSimple(t.text)?i?{elem:"inner",content:n(t.text)}:n(t.text):t.text.block?this.util.mergeBemjson({mix:{block:"link",elem:"inner"}},t.text):this.extend({block:"link",elem:"inner"},t.text))]}),elem("inner").tag()("span")),block("link")(attrs()(function(){var t=applyNext()||{};return this.ctx["data-counter"]?t["data-counter"]=this.ctx["data-counter"]:this.ctx.counter&&(t.onmousedown=this.ctx.counter),t})),block("link").mod("pseudo","yes")(content().match(function(){return!this.mods.inner})(function(){return{elem:"inner",content:applyNext()}})),block("tiled-images").mod("preload","yes")(elem("item")(attrs()(function(){var t=applyNext()||{};return this.ctx.placeHolderColor&&(t.style="background: #"+this.ctx.placeHolderColor+";"),t}),content()(function(){return{elem:"link",content:{elem:"thumb",attrs:{"data-url":this.ctx.url}}}}))),block("dropdown-menu")(js()(!0),def()(function(){var t=this.mods;return void 0!==t.size||(t.size="m"),void 0!==t.theme||(t.theme="ffffff"),this.dropdownMenuSize=t.size,this._inDropdownMenu=!0,applyNext()})),block("dropdown-menu").elem("menu").def()(function(){var t=this.ctx,e=t.type||"vert",i=this.elemMods;return i.theme||(i.theme="ffffff"),applyCtx({block:"b-menu-"+e,mix:(t.mix||[]).concat({block:"dropdown-menu",elem:"menu",elemMods:i}),title:t.title,content:t.content})}),block("b-menu-vert").match(function(){return this._inDropdownMenu})(attrs()(function(){return{role:"menu"}}),elem("item").attrs()(function(){return{role:"menuitem"}})),block("b-menu-horiz").match(function(){return this._inDropdownMenu})(attrs()(function(){return{role:"menu"}}),elem("item").attrs()(function(){return{role:"menuitem"}})),block("b-menu-vert")(content()(function(){return[this.ctx.title,{elem:"layout",content:this.ctx.content}]}),elem("layout").tag()("ul"),elem("item").match(function(){return!this._inItemContent}).wrap()(function(){return this.position--,{elem:"layout-unit",content:[this.ctx,this.ctx["item-content"]]}}),elem("item-content").def()(function(){return applyNext({_inItemContent:!0})}),elem("layout-unit")(tag()("li"),mix()(function(){var t=[];return this.isFirst()&&t.push({elemMods:{position:"first"}}),this.isLast()&&t.push({elemMods:{position:"last"}}),t})),elem("item-selector").tag()("span"),elem("submenu").tag()("ul")),block("b-menu-horiz")(js()(!0),elem("item").wrap()(function(){return this.position--,{elem:"layout-unit",content:this.ctx}}),elem("layout-unit").mix()(function(){var t=[];return this.isFirst()&&t.push({elemMods:{position:"first"}}),this.isLast()&&t.push({elemMods:{position:"last"}}),t}),elem("item-selector").tag()("span")),block("menu")(mode("tabindex")(void 0),def()(function(){var t=this.ctx,e=void 0!==t.tabindex?t.tabindex:apply("tabindex");return t.val=void 0!==t.val?[].concat(t.val):[],void 0===this.mods.view&&(this.mods.view="classic"),-1!==["radio","radiocheck"].indexOf(this.mods.type)&&(t.val=t.val.slice(0,1)),applyNext({_tabindex:e})}),js()(function(){return{_tabindex:null!==this._tabindex&&this.mods.disabled?this._tabindex:void 0}}),attrs()(function(){return{tabindex:this.mods.disabled?void 0:null===this._tabindex?void 0:this._tabindex,"aria-disabled":this.mods.disabled?"true":!1}}),match(function(){return!this.ctx.content}).content()(function(){
return(this.ctx.items||[]).map(function t(e){return e!==!1&&null!==e&&void 0!==e?(this.isSimple(e)&&(e={text:e}),e.items?(e.elem="group",e.content||(e.content=e.items.map(t,this))):(e.elem="item",-1!==["check","radio","radiocheck"].indexOf(this.mods.type)?e.elemMods=this.extend({type:"option",checked:-1!==this.ctx.val.indexOf(e.val)?"yes":void 0},e.elemMods):"navigation"===this.mods.type&&(e.elemMods=this.extend({type:"link"},e.elemMods))),e):void 0},this)})),block("menu").elem("item")(match(function(){return this._inMenuTypeNavigation}).wrap()(function(){return{elem:"list-item",content:this.ctx}}),js()(function(){return{val:this.ctx.val}}),attrs()(function(){return{title:this.ctx.title,"aria-disabled":this.elemMods.disabled?"true":!1,"aria-selected":this.elemMods.checked?"true":!1}}),match(function(){return!this.ctx.content}).content()(function(){return[this.ctx.icon&&{elem:"icon",icon:this.ctx.icon},void 0!==this.ctx.text&&{elem:"text",content:{html:this.isSimple(this.ctx.text)?this.xmlEscape(this.ctx.text):this.reapply(this.ctx.text)}}].filter(Boolean)})),block("menu").elem("list-item").tag()("li"),block("menu").mod("type","navigation")(tag()("ul"),def()(function(){return applyNext({_inMenuTypeNavigation:!0})})),block("menu").elem("text").tag()("span"),block("menu").elem("group")(match(function(){return this._inMenuTypeNavigation}).tag()("ul"),attrs()(function(){return{role:"group"}}),match(function(){return this.ctx.title})(attrs()(function(){return this.extend(applyNext(),{"aria-labelledby":this.generateId()})}),content()(function(){var t=this.ctx.title;return[{elem:"title",attrs:{id:this.generateId(),"aria-hidden":"true"},content:{html:this.isSimple(t)?this.xmlEscape(t):this.reapply(t)}},applyNext()]}))),block("menu").elem("item").elemMod("type","option").attrs()(function(){return this.extend(applyNext(),{role:"option"})}),block("menu").elem("item").elemMod("type","link")(tag()("a"),attrs()(function(){return this.extend(applyNext(),{role:"link",href:this.ctx.url,target:this.ctx.target})})),block("menu").elem("item").elemMod("type","link")(attrs()(function(){var t=applyNext();return this.ctx["data-counter"]?t["data-counter"]=this.ctx["data-counter"]:t.onmousedown=this.ctx.counter?this.ctx.counter:null,t})),block("disk-button").replace()(function(){var t={theme:"normal",pin:"brick-brick",size:"m"};if(this.ctx.button2&&this.ctx.button2.mods){var e=this.ctx.button2.mods;for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}return{block:"button2",mix:(this.ctx.mix||[]).concat([{block:"disk-button",elem:"button"},{block:"disk-button",mods:this.mods}]),mods:t,content:[{block:"disk-button",elem:"icon",mix:[{block:"button2",elem:"icon",elemMods:{side:"left"}},{block:"icon",mods:{type:"disk"}}],tag:"span"},{block:"disk-button",elem:"text",elemMods:{saved:"no"},tag:"span",content:this.ctx.textSave?this.ctx.textSave:BEM.I18N("disk-button","",{context:"        https://yadi.sk/i/pzsKjVQIkZj7Q"})},{block:"disk-button",elem:"text",elemMods:{saved:"yes"},tag:"span",content:this.ctx.textSaved?this.ctx.textSaved:BEM.I18N("disk-button","",{context:"        https://yadi.sk/i/KSqGeu55kZjDy"})}]}}),block("disk-button").elem("popup").replace()(function(){return{block:"popup",mods:{hoverable:"yes",position:"fixed","has-close":"yes"},underMods:{type:this.ctx.paranja?"paranja":""},js:{directions:{to:"bottom",offset:{top:-14}}},mix:[{block:"disk-button",elem:"popup"}],content:[{elem:"tail"},{elem:"content",content:this.ctx.content}]}}),block("icon")(tag()("span"),attrs()(function(){var t=this.ctx,e=void 0!==t.url,i=void 0!==Object(t.attrs).style,n=(i?t.attrs.style:"")+(e?";background-image:url('"+t.url+"');":"");return i&&(t.attrs.style=n),{style:n||void 0}})),block("similar-offers").content()(function(){return[this.ctx.hasTitle?{elem:"title",content:" "}:"",{elem:"wrapper",mix:{block:"clearfix"}}]}),block("similar-offers").elem("items").content()(function(){var t=this.ctx.itemMods;return(this.ctx.items||[]).map(function(e,i){var n={pos:i};for(var s in t)t.hasOwnProperty(s)&&(n[s]=t[s]);return{block:"similar-offers-item",mods:n,item:e}})}),block("similar-offers-item")(js()(!0),content()(function(){return[apply("image-link"),apply("title"),apply("domain"),apply("price")]}),mode("image-link")(function(){var t=this.ctx.item;return{block:"link",target:"_blank",url:t.link,mods:{theme:"normal"},mix:{block:"similar-offers-item",elem:"image-link"},content:apply("image")}}),mode("title")(function(){var t=this.ctx.item;return{block:"link",target:"_blank",url:t.link,mods:{theme:"normal"},mix:{block:"similar-offers-item",elem:"title"},title:t.title,content:t.title}}),mode("domain")(function(){var t=this.ctx.item;return{block:"link",target:"_blank",url:t.link,mods:{theme:"outer"},mix:{block:"similar-offers-item",elem:"domain"},title:t.domain,content:t.domain}}),mode("price")(function(){var t=this.ctx.item;return{block:"similar-offers-item",elem:"price",attrs:{title:t.price},content:[t.price,{block:"rub",mods:{space:"yes"}}]}}),mode("image")(function(){var t,e,i=this.ctx.item.image;return i.w>i.h&&(t=100/i.w,e=Math.round((100-i.h*t)/2)),{block:"similar-offers-item",elem:"image",tag:"img",attrs:{src:i.url,style:e?"margin-top:"+e+"px;":""}}})),block("rub")(tag()("span"),content()("")),block("rub").mod("space","yes")(tag()("span"),content()("&thinsp;")),block("similar-offers-item").mod("theme","for-scroll")(content()(function(){return[{elem:"image-container",content:apply("image-link")},{elem:"description",content:[apply("title"),apply("price"),{elem:"market-info",content:[apply("domain"),apply("stars")]}]}]}),mode("stars")(function(){var t=this.ctx.item;return{block:"star-rating",mix:{block:"similar-offers-item",elem:"stars"},mods:{size:"s",visible:t.rating}}}),mode("image")(function(){var t=this.ctx.item.image;return{block:"similar-offers-item",elem:"image",tag:"img",attrs:{src:t.url}}})),block("market-snippet").elem("title").elemMod("type","organic")(tag()("a"),mix()(function(){return[{block:"link",mods:{theme:"normal"}}]}),attrs()({target:"_blank",href:""})),block("market-snippet").elem("domain")(function(){var t=this.ctx.domain.replace(/^www\./,"");return t.charAt(0).toUpperCase()+t.substring(1)}),block("market-snippet").elem("greenurl")(tag()("a"),mix()(function(){return[{block:"link",mods:{theme:"outer"}}]}),attrs()(function(){return{target:"_blank",href:this.ctx.href||""}})),block("market-snippet").elem("price")(tag()("span"),content()(function(){return[{elem:"price-value",tag:"span",content:this.ctx.price||""},{block:"rub",mods:{space:"yes"}}]})),block("market-snippet").elem("money")(tag()("p"),content()([{elem:"old-price",tag:"span",content:[{elem:"old-price-value",tag:"span"},{block:"rub",mods:{space:"yes"}}]},{elem:"price"},{elem:"discount",tag:"span",content:[{elem:"discount-title",tag:"span",content:" "},{elem:"discount-percent",tag:"span",content:""}]}])),block("market-snippet").elem("button-price")(tag()("p"),content()({elem:"price",elemMods:{theme:"button"}})),block("market-snippet").elem("shopping-button").replace()(function(){return{block:"button2",mods:{theme:"action",size:"m",type:"link"},mix:[{block:"market-snippet",elem:"shopping-button",elemMods:this.ctx.elemMods||{}},this.ctx.mix||""],url:this.ctx.more.url,target:"_blank",content:[this.ctx.content,{block:"market-snippet",elem:"label",content:this.ctx.text}]}}),block("market-snippet").elem("preview").content()(function(){return{block:"link",mods:{theme:"normal"},url:"#",target:"_blank",mix:{block:"market-snippet",elem:"image-wrapper"},content:{block:"market-snippet",elem:"img",tag:"img",alt:""}}}),block("market-snippet").elem("single-offer")(content()(function(){var t=this.ctx.item;return t?[{elem:"greenurl",elemMods:{pos:1},content:{elem:"domain",domain:t.domain},href:t.url},{elem:"rating",rating:t.shop_rating}]:""})),block("market-snippet").elem("offers-divider")(mix()({elem:"offers-divider",elemMods:{text:"others"}}),attrs()(function(){return this.ctx.info?{"data-label":this.ctx.info.content||"","aria-label":this.ctx.info.description||""}:{}})),block("market-snippet").elem("offers-list")(content()(function(){var t=this.ctx.items||[];return t.length?t.map(function(t,e){return{elem:"offer-item",item:t,pos:e+2}}):""})),block("market-snippet").elem("offer-item")(content()(function(){var t=this.ctx.item;return t?[{elem:"cell",elemMods:{type:"domain"},content:{elem:"greenurl",elemMods:{pos:this.ctx.pos},content:{elem:"domain",domain:t.domain},href:t.url}},{elem:"cell",elemMods:{type:"rating"},content:{block:"star-rating",mods:{size:"s",visible:t.rating||t.shop_rating||"no"}}},{elem:"cell",elemMods:{type:"price"},content:{elem:"price",elemMods:{theme:"hint"},price:t.visiblePrice||t.price}}]:""})),block("market-snippet").elem("rating")(mix()(function(){return{block:"star-rating",mods:{size:"s",visible:this.ctx.rating||"no"}}})),block("button2").mod("type","link")(def()(function(){var t=this.ctx.url;return this._url=this.isSimple(t)?t:this.reapply(t),applyNext()}),tag()("a"),match(function(){return"_blank"===this.ctx.target}).attrs()(function(){var t=this.ctx,e=t.attrs,i=void 0!==Object(e).rel,n=i?String(e.rel):"";return n&&-1===n.indexOf("noopener")&&(e.rel=n+" noopener"),this.extend(applyNext(),{rel:"noopener"})}),attrs()(function(){var t=void 0!==this._url,e=Boolean(this.mods.disabled),i=e?t&&-1:this.ctx.tabindex;return this.extend(applyNext(),{target:this.ctx.target,href:this.mods.disabled?void 0:this.ctx.url,autocomplete:void 0,type:void 0,disabled:void 0,tabindex:i})}),js()(function(){return this.extend(applyNext(),{_url:this.mods.disabled?this.ctx.url:void 0})})),block("market-icon")(mix()([{block:"button2",elem:"icon"}]),tag()("i")),block("rating2")(tag()("span"),mode("stars")(function(){var t=this.ctx.mods,e=t.size||"m",i={s:12,m:16,l:26}[e],n=this.ctx.base,s=Math.min(this.ctx.value,n),o=10*Math.round(10*s/n),r=o/10%2===1,a=5*i+4,c=Math.round(a/100*o),h=i/2,l=a-c-(r?h:0);return[c>0&&{elem:"stars",attrs:{style:"width:"+c+"px"}},r&&{elem:"half"},80>=o&&{elem:"rest",attrs:{style:"width:"+l+"px"}}]}),content()(function(){return[apply("stars"),apply("extendedContent"),apply("description")]}),elem("delimiter")(tag()("span"),content()("/")),elem("stars").tag()("span"),elem("half").tag()("span"),elem("rest").tag()("span"),elem("value").tag()("span"),elem("base").tag()("span")),block("rating2").mod("type","extended")(mode("extendedContent")(function(){return[applyNext(),"",{elem:"value",content:String(this.ctx.value).replace(".",",")},{elem:"delimiter"},{elem:"base",content:String(this.ctx.base).replace(".",",")}]})),block("user")(def()(function(){var t=this.ctx.js||{},e=t.uid||this.ctx.uid||this["i-global"].uid,i=this.ctx.login,n=i||this["i-global"].login||(this["i-global"].displayName||{}).name;return applyNext({_uid:e,_login:i,_hasDisplayName:n})}),tag()("a"),js()(function(){return this.extend({uid:this._uid,login:this._login||this["i-global"].login},applyNext())}),attrs()(function(){var t=this["i-global"],e=this._login||t.login,i=e&&/^uid-/.test(e),n={href:i?t["social-host"]:t["passport-host"]+"/passport?mode=passport"},s=this.ctx.counter||(this.ctx.counters||{}).user;return s&&(n.onmousedown=s),n}),content()(function(){return this._hasDisplayName?[this.ctx.content]:{elem:"enter"}})),oninit(function(t){var e=t["i-services"]=t.BEMContext.prototype["i-services"]={},i=t["i-global"];e.serviceName=function(t){return BEM.I18N("i-services",t||i.id)},e.serviceUrl=function(t,n){var s=i;return t||(t=s.id),n||(n=s["content-region"]),e._data[t](n)}}),block("i-services").def()(elem("name")(function(){return applyCtx(this["i-services"].serviceName(this.ctx.id))}),elem("url")(function(){return applyCtx(this["i-services"].serviceUrl(this.ctx.id,this.ctx.region))})),oninit(function(t){t["i-services"]._data={404:function(t){switch(t){case"ua":return"http://404.yandex.ua";case"by":return"http://404.yandex.by";case"kz":return"http://404.yandex.kz";case"com":return"http://404.yandex.com";case"tr":return"http://404.yandex.com.tr";default:return"http://404.yandex.ru"}},adresa:function(){return"http://adresa.yandex.ru"},advertising:function(t){switch(t){case"ua":return"https://advertising.yandex.ua";case"by":return"https://advertising.yandex.by";case"kz":return"https://advertising.yandex.kz";case"com":return"https://advertising.yandex.com";default:return"https://advertising.yandex.ru"}},afisha:function(t){switch(t){case"ua":return"https://afisha.yandex.ua";case"by":return"https://afisha.yandex.by";case"kz":return"https://afisha.yandex.kz";default:return"https://afisha.yandex.ru"}},all:function(t){switch(t){case"ua":return"//yandex.ua/all";case"by":return"//yandex.by/all";case"kz":return"//yandex.kz/all";case"com":return"//yandex.com/all";case"tr":return"//yandex.com.tr/all";default:return"//yandex.ru/all"}},api:function(t){switch(t){case"com":return"http://api.yandex.com";default:return"http://api.yandex.ru"}},appmetrica:function(t){switch(t){case"ua":return"https://appmetrica.yandex.ua";case"by":return"https://appmetrica.yandex.by";case"kz":return"https://appmetrica.yandex.kz";case"com":return"https://appmetrica.yandex.com";case"tr":return"https://appmetrica.yandex.com.tr";default:return"https://appmetrica.yandex.ru"}},appsearch:function(){return"//appsearch.yandex.ru"},auto:function(t){switch(t){case"ua":return"https://auto.yandex.ua";default:return"https://auto.yandex.ru"}},autoru:function(){return"https://auto.ru"},avia:function(t){switch(t){case"ua":return"https://avia.yandex.ua";default:return"https://avia.yandex.ru"}},aziada:function(){return"http://aziada2011.yandex.kz"},ba:function(t){switch(t){case"ua":return"https://ba.yandex.ua";case"by":return"https://ba.yandex.by";case"kz":return"https://ba.yandex.kz";case"com":return"https://ba.yandex.com";default:return"https://ba.yandex.ru"}},backapv:function(){return"http://backapv.yandex.ru"},balance:function(){return"https://balance.yandex.ru"},bar:function(t){switch(t){case"ua":return"http://bar.yandex.ua";case"by":return"http://bar.yandex.by";case"kz":return"http://bar.yandex.kz";case"tr":return"http://bar.yandex.com.tr";default:return"http://bar.yandex.ru"}},"bar-ie":function(t){switch(t){case"ua":return"http://bar.yandex.ua/ie";case"by":return"http://bar.yandex.by/ie";case"kz":return"http://bar.yandex.kz/ie";case"com":return"http://bar.yandex.com/ie";case"tr":return"http://bar.yandex.com.tr/ie";default:return"http://bar.yandex.ru/ie"}},"bar-ie9":function(t){switch(t){case"ua":return"http://bar.yandex.ua/ie";case"by":return"http://bar.yandex.by/ie";case"kz":return"http://bar.yandex.kz/ie";case"com":return"http://bar.yandex.com/ie";case"tr":return"http://bar.yandex.com.tr/ie";default:return"http://bar.yandex.ru/ie"}},bayan:function(){return"http://bayan.yandex.ru"},blogs:function(t){switch(t){case"ua":return"https://blogs.yandex.ua";case"by":return"https://blogs.yandex.by";case"kz":return"https://blogs.yandex.kz";default:return"https://blogs.yandex.ru"}},books:function(){return"http://books.yandex.ru"},browser:function(t){switch(t){case"ua":return"https://browser.yandex.ua";case"by":return"https://browser.yandex.by";case"kz":return"https://browser.yandex.kz";case"com":return"https://browser.yandex.com";case"tr":return"https://browser.yandex.com.tr";default:return"https://browser.yandex.ru"}},calendar:function(){return"https://calendar.yandex.ru"},catalogwdgt:function(){return"https://www.yandex.ru/catalog"},chrome:function(){return"http://chrome.yandex.ru"},city:function(t){switch(t){case"ua":return"https://gorod.yandex.ua";case"by":return"https://gorod.yandex.by";case"kz":return"https://gorod.yandex.kz";case"com":return"https://city.yandex.com";case"tr":return"https://city.yandex.com.tr";default:return"https://gorod.yandex.ru"}},cityday:function(){return"http://cityday.yandex.ru"},collection:function(){return"https://collection.yandex.ru"},company:function(t){switch(t){case"com":return"https://company.yandex.com";case"tr":return"https://company.yandex.com.tr";default:return"https://company.yandex.ru"}},contest:function(t){switch(t){case"com":return"https://contest.yandex.com";default:return"https://contest.yandex.ru"}},delivery:function(){return"https://delivery.yandex.ru"},desktop:function(){return"http://desktop.yandex.ru"},direct:function(t){switch(t){case"ua":return"https://direct.yandex.ua";case"by":return"https://direct.yandex.by";case"kz":return"https://direct.yandex.kz";case"com":return"https://direct.yandex.com";default:return"https://direct.yandex.ru"}},"direct.market":function(){return"https://partner.market.yandex.ru/yandex.market/"},disk:function(t){switch(t){case"ua":return"https://disk.yandex.ua";case"by":return"https://disk.yandex.by";case"kz":return"https://disk.yandex.kz";case"com":return"https://disk.yandex.com";case"tr":return"https://disk.yandex.com.tr";case"az":return"https://disk.yandex.az";case"il":return"https://disk.yandex.co.il";case"am":return"https://disk.yandex.com.am";case"ge":return"https://disk.yandex.com.ge";case"ee":return"https://disk.yandex.ee";case"fr":return"https://disk.yandex.fr";case"kg":return"https://disk.yandex.kg";case"lt":return"https://disk.yandex.lt";case"lv":return"https://disk.yandex.lv";case"md":return"https://disk.yandex.md";case"tj":return"https://disk.yandex.tj";case"tm":return"https://disk.yandex.tm";case"uz":return"https://disk.yandex.uz";default:return"https://disk.yandex.ru"}},display:function(t){switch(t){case"tr":return"https://display.yandex.com.tr";default:return"https://display.yandex.ru"}},ege:function(t){switch(t){case"ua":return"https://zno.yandex.ua";default:return"https://ege.yandex.ru"}},expert:function(){return"http://expert.yandex.ru"},feedback:function(t){switch(t){case"ua":return"http://feedback.yandex.ua";case"by":return"http://feedback.yandex.by";case"kz":return"http://feedback.yandex.kz";case"com":return"http://feedback.yandex.com";case"tr":return"http://contact.yandex.com.tr";default:return"http://feedback.yandex.ru"}},feedback2:function(t){switch(t){case"ua":return"//feedback2.yandex.ua";case"by":return"//feedback2.yandex.by";case"kz":return"//feedback2.yandex.kz";case"com":return"//feedback2.yandex.com";case"tr":return"//contact2.yandex.com.tr";default:return"//feedback2.yandex.ru"}},ff:function(){return"http://ff.yandex.ru"},fotki:function(){return"https://fotki.yandex.ru"},fresh:function(t){switch(t){case"ua":return"https://yandex.ua";case"by":return"https://yandex.by";case"kz":return"https://yandex.kz";case"com":return"https://yandex.com";case"tr":return"https://yandex.com.tr";default:return"https://yandex.ru"}},fx:function(t){switch(t){case"ua":return"https://fx.yandex.ua";case"tr":return"https://fx.yandex.com.tr";default:return"https://fx.yandex.ru"}},games:function(){return"http://games.yandex.ru"},geocontext:function(){return"https://geocontext.yandex.ru"},goroda:function(){return"http://goroda.yandex.ru"},help:function(t){switch(t){case"ua":return"https://help.yandex.ua";case"com":return"https://help.yandex.com";case"tr":return"https://yardim.yandex.com.tr";default:return"https://help.yandex.ru"}},i:function(){return"http://i.yandex.ru"},ie:function(t){switch(t){case"ua":return"https://ie.yandex.ua";case"tr":return"https://ie.yandex.com.tr";default:return"https://ie.yandex.ru"}},images:function(t){switch(t){case"ua":return"https://yandex.ua/images/";case"by":return"https://yandex.by/images/";case"kz":return"https://yandex.kz/images/";case"com":return"https://yandex.com/images/";case"tr":return"https://yandex.com.tr/gorsel/";case"az":return"https://yandex.az/images/";case"il":return"https://yandex.co.il/images/";case"am":return"https://yandex.com.am/images/";case"ge":return"https://yandex.com.ge/images/";case"ee":return"https://yandex.ee/images/";case"fr":return"https://yandex.fr/images/";case"kg":return"https://yandex.kg/images/";case"lt":return"https://yandex.lt/images/";case"lv":return"https://yandex.lv/images/";case"md":return"https://yandex.md/images/";case"tj":return"https://yandex.tj/images/";case"tm":return"https://yandex.tm/images/";case"uz":return"https://yandex.uz/images/";default:return"https://yandex.ru/images/"}},"images-com":function(){return"https://yandex.com/images/"},interests:function(){return"http://interests.yandex.ru"},internet:function(t){switch(t){case"com":return"//internet.yandex.com";case"tr":return"//internet.yandex.com.tr";default:return"//internet.yandex.ru"}},kassa:function(){return"https://kassa.yandex.ru"},keyboard:function(){return"http://www.yandex.ru/index_engl_qwerty.html"},kraski:function(){return"http://kraski.yandex.ru"},kuda:function(){return"http://kuda.yandex.ru"},large:function(){return"http://large.yandex.ru"},legal:function(t){switch(t){case"ua":return"https://yandex.ua/legal";case"com":return"https://yandex.com/legal";case"tr":return"https://yandex.com.tr/legal";default:return"https://yandex.ru/legal"}},lenta:function(){return"http://lenta.yandex.ru"},literacy:function(){return"https://literacy.yandex.ru"},local:function(){return"http://local.yandex.ru"},lost:function(){return"http://lost.yandex.ru"},love:function(){return"http://love.yandex.ru"},mail:function(t){switch(t){case"ua":return"https://mail.yandex.ua";case"by":return"https://mail.yandex.by";case"kz":return"https://mail.yandex.kz";case"com":return"https://mail.yandex.com";case"tr":return"https://mail.yandex.com.tr";case"az":return"https://mail.yandex.az";case"il":return"https://mail.yandex.co.il";case"am":return"https://mail.yandex.com.am";case"ge":return"https://mail.yandex.com.ge";case"ee":return"https://mail.yandex.ee";case"fr":return"https://mail.yandex.fr";case"kg":return"https://mail.yandex.kg";case"lt":return"https://mail.yandex.lt";case"lv":return"https://mail.yandex.lv";case"md":return"https://mail.yandex.md";case"tj":return"https://mail.yandex.tj";case"tm":return"https://mail.yandex.tm";case"uz":return"https://mail.yandex.uz";default:return"https://mail.yandex.ru"}},maps:function(t){switch(t){case"ua":return"https://yandex.ua/maps/";case"com":return"https://yandex.com/maps/";case"tr":return"https://yandex.com.tr/harita/";case"az":return"https://yandex.az/maps/";case"il":return"https://yandex.co.il/maps/";case"am":return"https://yandex.com.am/maps/";case"ge":return"https://yandex.com.ge/maps/";case"ee":return"https://yandex.ee/maps/";case"fr":return"https://yandex.fr/maps/";case"kg":return"https://yandex.kg/maps/";case"lt":return"https://yandex.lt/maps/";case"lv":return"https://yandex.lv/maps/";case"md":return"https://yandex.md/maps/";case"tj":return"https://yandex.tj/maps/";case"tm":return"https://yandex.tm/maps/";case"uz":return"https://yandex.uz/maps/";default:return"https://yandex.ru/maps/"}},"maps-com":function(){return"https://yandex.com/maps/"},"maps-wiki":function(){return"http://nk.yandex.ru"},market:function(t){switch(t){case"ua":return"https://market.yandex.ua";case"by":return"https://market.yandex.by";case"kz":return"https://market.yandex.kz";case"tr":return"https://market.yandex.com.tr";default:return"https://market.yandex.ru"}},"market.advertising":function(){return"https://welcome.advertising.yandex.ru/market/"},master:function(){return"https://master.yandex.ru"},metrika:function(t){switch(t){case"ua":return"https://metrika.yandex.ua";case"by":return"https://metrika.yandex.by";case"kz":return"https://metrika.yandex.kz";case"com":return"https://metrica.yandex.com";case"tr":return"https://metrica.yandex.com.tr";case"az":return"https://metrika.yandex.az";case"il":return"https://metrika.yandex.co.il";case"am":return"https://metrika.yandex.com.am";case"ge":return"https://metrika.yandex.com.ge";case"ee":return"https://metrika.yandex.ee";case"fr":return"https://metrika.yandex.fr";case"kg":return"https://metrika.yandex.kg";case"lt":return"https://metrika.yandex.lt";case"lv":return"https://metrika.yandex.lv";case"md":return"https://metrika.yandex.md";case"tj":return"https://metrika.yandex.tj";case"tm":return"https://metrika.yandex.tm";case"uz":return"https://metrika.yandex.uz";default:return"https://metrika.yandex.ru"}},metro:function(){return"https://metro.yandex.ru"},mobile:function(t){switch(t){case"ua":return"https://mobile.yandex.ua";case"tr":return"https://mobil.yandex.com.tr";default:return"https://mobile.yandex.ru"}},moikrug:function(){return"http://moikrug.ru"},money:function(){return"https://money.yandex.ru"},museums:function(){return"http://18.yandex.ru"},music:function(t){switch(t){case"ua":return"https://music.yandex.ua";case"by":return"https://music.yandex.by";case"kz":return"https://music.yandex.kz";default:return"https://music.yandex.ru"}},"music-partner":function(){return"http://music-partner.yandex.ru"},nahodki:function(t){switch(t){case"ua":return"https://nahodki.yandex.ua";case"kz":return"https://nahodki.yandex.kz";default:return"https://nahodki.yandex.ru"}},nano:function(){return"http://nano.yandex.ru"},news:function(t){switch(t){case"ua":return"https://news.yandex.ua";case"by":return"https://news.yandex.by";case"kz":return"https://news.yandex.kz";case"tr":return"https://haber.yandex.com.tr";case"az":return"https://news.yandex.az";case"il":return"https://news.yandex.co.il";case"am":return"https://news.yandex.com.am";case"ge":return"https://news.yandex.com.ge";case"ee":return"https://news.yandex.ee";case"fr":return"https://news.yandex.fr";case"kg":return"https://news.yandex.kg";case"lt":return"https://news.yandex.lt";case"lv":return"https://news.yandex.lv";case"md":return"https://news.yandex.md";case"tj":return"https://news.yandex.tj";case"tm":return"https://news.yandex.tm";case"uz":return"https://news.yandex.uz";default:return"https://news.yandex.ru"}},"news-com":function(){return"https://news.yandex.com"},notifications:function(t){switch(t){case"ua":return"https://notifications.yandex.ua";case"by":return"https://notifications.yandex.by";case"kz":return"https://notifications.yandex.kz";case"com":return"https://notifications.yandex.com";case"tr":return"https://notifications.yandex.com.tr";default:return"https://notifications.yandex.ru"}},oauth:function(t){switch(t){case"com":return"https://oauth.yandex.com";default:return"https://oauth.yandex.ru"}},online:function(){return"http://online.yandex.ru"},openid:function(){return"http://openid.yandex.ru"},opera:function(t){switch(t){case"tr":return"https://opera.yandex.com.tr";default:return"https://opera.yandex.ru"}},opinion:function(){return"http://opinion.yandex.ru"},partners:function(t){switch(t){case"ua":return"http://partner.yandex.ua";case"by":return"http://partner.yandex.by";case"kz":return"http://partner.yandex.kz";case"com":return"http://partner.yandex.com";default:return"http://partner.yandex.ru"}},partnersearch:function(){return"http://yandex.ru"},pass:function(t){switch(t){case"ua":return"https://pass.yandex.ua";case"by":return"https://pass.yandex.by";case"kz":return"https://pass.yandex.kz";case"com":return"https://pass.yandex.com";case"tr":return"https://pass.yandex.com.tr";case"az":return"https://pass.yandex.az";case"il":return"https://pass.yandex.co.il";case"am":return"https://pass.yandex.com.am";case"ge":return"https://pass.yandex.com.ge";case"ee":return"https://pass.yandex.ee";case"fr":return"https://pass.yandex.fr";case"kg":return"https://pass.yandex.kg";case"lt":return"https://pass.yandex.lt";case"lv":return"https://pass.yandex.lv";case"md":return"https://pass.yandex.md";case"tj":return"https://pass.yandex.tj";case"tm":return"https://pass.yandex.tm";case"uz":return"https://pass.yandex.uz";default:return"https://pass.yandex.ru"}},passport:function(t){switch(t){case"ua":return"https://passport.yandex.ua";case"by":return"https://passport.yandex.by";case"kz":return"https://passport.yandex.kz";case"com":return"https://passport.yandex.com";case"tr":return"https://passport.yandex.com.tr";case"az":return"https://passport.yandex.az";case"il":return"https://passport.yandex.co.il";case"am":return"https://passport.yandex.com.am";case"ge":return"https://passport.yandex.com.ge";case"ee":return"https://passport.yandex.ee";case"fr":return"https://passport.yandex.fr";case"kg":return"https://passport.yandex.kg";case"lt":return"https://passport.yandex.lt";case"lv":return"https://passport.yandex.lv";case"md":return"https://passport.yandex.md";case"tj":return"https://passport.yandex.tj";case"tm":return"https://passport.yandex.tm";case"uz":return"https://passport.yandex.uz";default:return"https://passport.yandex.ru"}},pdd:function(){return"https://pdd.yandex.ru"},peoplesearch:function(t){switch(t){case"ua":return"http://people.yandex.ua";default:return"http://people.yandex.ru"}},perevod:function(){return"https://perevod.yandex.ru"},probki:function(t){switch(t){case"ua":return"http://probki.yandex.ua";default:return"http://probki.yandex.ru"}},pulse:function(t){switch(t){case"ua":return"http://blogs.yandex.ua/pulse";case"by":return"http://blogs.yandex.by/pulse";case"kz":return"http://blogs.yandex.kz/pulse";default:return"http://blogs.yandex.ru/pulse"}},punto:function(){return"https://punto.yandex.ru"},pvo:function(){return"http://ask.yandex.ru"},rabota:function(t){switch(t){case"ua":return"https://rabota.yandex.ua";case"by":return"https://rabota.yandex.by";case"kz":return"https://rabota.yandex.kz";default:return"https://rabota.yandex.ru"}},rasp:function(t){switch(t){case"ua":return"https://rasp.yandex.ua";case"by":return"https://rasp.yandex.by";case"kz":return"https://rasp.yandex.kz";case"tr":return"https://seferler.yandex.com.tr";default:return"https://rasp.yandex.ru"}},realty:function(t){switch(t){case"ua":return"https://realty.yandex.ua";case"by":return"https://realty.yandex.by";case"kz":return"https://realty.yandex.kz";default:return"https://realty.yandex.ru"}},referats:function(){return"https://referats.yandex.ru"},review:function(t){switch(t){case"ua":return"https://yandex.ua";case"by":return"https://yandex.by";case"kz":return"https://yandex.kz";case"com":return"https://yandex.com";case"tr":return"https://yandex.com.tr";default:return"https://yandex.ru"}},rk:function(){return"http://rk.yandex.ru"},root:function(){return"https://root.yandex.ru"},school:function(){return"http://school.yandex.ru"},search:function(t){switch(t){case"ua":return"https://yandex.ua";case"by":return"https://yandex.by";case"kz":return"https://yandex.kz";case"com":return"https://yandex.com";case"tr":return"https://yandex.com.tr";case"az":return"https://yandex.az";case"il":return"https://yandex.co.il";case"am":return"https://yandex.com.am";case"ge":return"https://yandex.com.ge";case"ee":return"https://yandex.ee";case"fr":return"https://yandex.fr";case"kg":return"https://yandex.kg";case"lt":return"https://yandex.lt";case"lv":return"https://yandex.lv";case"md":return"https://yandex.md";case"tj":return"https://yandex.tj";case"tm":return"https://yandex.tm";case"uz":return"https://yandex.uz";default:return"https://yandex.ru"}},serp:function(t){switch(t){case"ua":return"https://yandex.ua";case"by":return"https://yandex.by";case"kz":return"https://yandex.kz";case"com":return"https://yandex.com";case"tr":return"https://yandex.com.tr";case"az":return"https://yandex.az";case"il":return"https://yandex.co.il";case"am":return"https://yandex.com.am";case"ge":return"https://yandex.com.ge";case"ee":return"https://yandex.ee";case"fr":return"https://yandex.fr";case"kg":return"https://yandex.kg";case"lt":return"https://yandex.lt";case"lv":return"https://yandex.lv";case"md":return"https://yandex.md";case"tj":return"https://yandex.tj";case"tm":return"https://yandex.tm";case"uz":return"https://yandex.uz";default:return"https://yandex.ru"}},server:function(){return"http://company.yandex.ru/technology/server/"},shtrafi:function(){return"https://money.yandex.net/debts"},site:function(t){switch(t){case"ua":return"https://site.yandex.ua";case"tr":return"https://ozel.yandex.com.tr";default:return"https://site.yandex.ru"}},slovari:function(t){switch(t){case"ua":return"https://slovari.yandex.ua";case"by":return"https://slovari.yandex.by";case"kz":return"https://slovari.yandex.kz";
default:return"https://slovari.yandex.ru"}},so:function(){return"http://so.yandex.ru"},social:function(t){switch(t){case"ua":return"https://social.yandex.ua";case"by":return"https://social.yandex.by";case"kz":return"https://social.yandex.kz";case"com":return"https://social.yandex.ru";case"tr":return"https://social.yandex.com.tr";default:return"https://social.yandex.ru"}},soft:function(t){switch(t){case"ua":return"https://soft.yandex.ua";case"tr":return"https://soft.yandex.com.tr";default:return"https://soft.yandex.ru"}},sport:function(t){switch(t){case"ua":return"http://sport.yandex.ua";case"by":return"http://sport.yandex.by";case"kz":return"http://sport.yandex.kz";case"tr":return"http://spor.yandex.com.tr";default:return"http://sport.yandex.ru"}},sprav:function(t){switch(t){case"ua":return"https://sprav.yandex.ua";case"by":return"https://sprav.yandex.by";case"kz":return"https://sprav.yandex.kz";case"tr":return"https://rehber.yandex.com.tr";default:return"https://sprav.yandex.ru"}},start:function(t){switch(t){case"ua":return"https://help.yandex.ua/start/";case"com":return"https://help.yandex.com/start/";case"tr":return"https://yardim.yandex.com.tr/start";default:return"https://help.yandex.ru/start/"}},stat:function(t){switch(t){case"ua":return"https://stat.yandex.ua";case"by":return"https://stat.yandex.by";default:return"https://stat.yandex.ru"}},subs:function(){return"https://subs.yandex.ru"},support:function(t){switch(t){case"ua":return"https://yandex.ua/support/";case"by":return"https://yandex.by/support/";case"kz":return"https://yandex.kz/support/";case"com":return"https://yandex.com/support/";case"tr":return"https://yandex.com.tr/support/";default:return"https://yandex.ru/support/"}},taxi:function(){return"https://taxi.yandex.ru"},terms:function(){return"http://terms.yandex.ru"},tests:function(){return"http://tests.yandex.ru"},ticket:function(){return"http://ticket.yandex.ru"},time:function(t){switch(t){case"ua":return"https://time.yandex.ua";case"by":return"https://time.yandex.by";case"kz":return"https://time.yandex.kz";case"com":return"https://time.yandex.com";case"tr":return"https://saat.yandex.com.tr";default:return"https://time.yandex.ru"}},toloka:function(t){switch(t){case"com":return"https://toloka.yandex.com";case"tr":return"https://toloka.yandex.com.tr";default:return"https://toloka.yandex.ru"}},toster:function(){return"http://toster.yandex.ru"},translate:function(t){switch(t){case"ua":return"https://translate.yandex.ua";case"by":return"https://translate.yandex.by";case"kz":return"https://translate.yandex.kz";case"com":return"https://translate.yandex.com";case"tr":return"https://ceviri.yandex.com.tr";case"az":return"https://translate.yandex.az";case"il":return"https://translate.yandex.co.il";case"am":return"https://translate.yandex.com.am";case"ge":return"https://translate.yandex.com.ge";case"ee":return"https://translate.yandex.ee";case"fr":return"https://translate.yandex.fr";case"kg":return"https://translate.yandex.kg";case"lt":return"https://translate.yandex.lt";case"lv":return"https://translate.yandex.lv";case"md":return"https://translate.yandex.md";case"tj":return"https://translate.yandex.tj";case"tm":return"https://translate.yandex.tm";case"uz":return"https://translate.yandex.uz";default:return"https://translate.yandex.ru"}},tune:function(t){switch(t){case"ua":return"https://tune.yandex.ua";case"by":return"https://tune.yandex.by";case"kz":return"https://tune.yandex.kz";case"com":return"https://tune.yandex.com";case"tr":return"https://tune.yandex.com.tr";default:return"https://tune.yandex.ru"}},tv:function(t){switch(t){case"ua":return"https://tv.yandex.ua";case"by":return"https://tv.yandex.by";case"kz":return"https://tv.yandex.kz";default:return"https://tv.yandex.ru"}},uslugi:function(){return"http://uslugi.yandex.ru"},video:function(t){switch(t){case"ua":return"http://yandex.ua/video/";case"by":return"http://yandex.by/video/";case"kz":return"http://yandex.kz/video/";case"com":return"https://yandex.com/video/";case"tr":return"http://yandex.com.tr/video/";case"az":return"https://yandex.az/video/";case"il":return"https://yandex.co.il/video/";case"am":return"https://yandex.com.am/video/";case"ge":return"https://yandex.com.ge/video/";case"ee":return"https://yandex.ee/video/";case"fr":return"https://yandex.fr/video/";case"kg":return"https://yandex.kg/video/";case"lt":return"https://yandex.lt/video/";case"lv":return"https://yandex.lv/video/";case"md":return"https://yandex.md/video/";case"tj":return"https://yandex.tj/video/";case"tm":return"https://yandex.tm/video/";case"uz":return"https://yandex.uz/video/";default:return"http://yandex.ru/video/"}},"video-com":function(){return"https://yandex.com/video/"},vno:function(){return"https://zno.yandex.ua"},wdgt:function(t){switch(t){case"ua":return"https://wdgt.yandex.ua";case"by":return"https://wdgt.yandex.by";case"kz":return"https://wdgt.yandex.kz";case"tr":return"https://wdgt.yandex.com.tr";default:return"https://wdgt.yandex.ru"}},weather:function(t){switch(t){case"ua":return"https://pogoda.yandex.ua";case"by":return"https://pogoda.yandex.by";case"kz":return"https://pogoda.yandex.kz";case"tr":return"https://hava.yandex.com.tr";case"az":return"https://pogoda.yandex.az";case"il":return"https://pogoda.yandex.co.il";case"am":return"https://pogoda.yandex.com.am";case"ge":return"https://pogoda.yandex.com.ge";case"ee":return"https://pogoda.yandex.ee";case"fr":return"https://pogoda.yandex.fr";case"kg":return"https://pogoda.yandex.kg";case"lt":return"https://pogoda.yandex.lt";case"lv":return"https://pogoda.yandex.lv";case"md":return"https://pogoda.yandex.md";case"tj":return"https://pogoda.yandex.tj";case"tm":return"https://pogoda.yandex.tm";case"uz":return"https://pogoda.yandex.uz";default:return"https://pogoda.yandex.ru"}},webmaster:function(t){switch(t){case"ua":return"https://webmaster.yandex.ua";case"com":return"https://webmaster.yandex.com";case"tr":return"https://webmaster.yandex.com.tr";default:return"https://webmaster.yandex.ru"}},"webmaster-api":function(t){switch(t){case"com":return"https://tech.yandex.com/webmaster/";case"tr":return"https://tech.yandex.com/webmaster/";default:return"https://tech.yandex.ru/webmaster/"}},widgets:function(t){switch(t){case"ua":return"https://widgets.yandex.ua";case"by":return"https://widgets.yandex.by";case"kz":return"https://widgets.yandex.kz";case"tr":return"https://widgets.yandex.com.tr";default:return"https://widgets.yandex.ru"}},wordstat:function(){return"https://wordstat.yandex.ru"},wow:function(){return"http://my.ya.ru"},www:function(t){switch(t){case"ua":return"https://yandex.ua";case"by":return"https://yandex.by";case"kz":return"https://yandex.kz";case"com":return"https://yandex.com";case"tr":return"https://yandex.com.tr";case"az":return"https://yandex.az";case"il":return"https://yandex.co.il";case"am":return"https://yandex.com.am";case"ge":return"https://yandex.com.ge";case"ee":return"https://yandex.ee";case"fr":return"https://yandex.fr";case"kg":return"https://yandex.kg";case"lt":return"https://yandex.lt";case"lv":return"https://yandex.lv";case"md":return"https://yandex.md";case"tj":return"https://yandex.tj";case"tm":return"https://yandex.tm";case"uz":return"https://yandex.uz";default:return"https://yandex.ru"}},xmlsearch:function(t){switch(t){case"ua":return"https://xml.yandex.ua";case"by":return"https://xml.yandex.by";case"kz":return"https://xml.yandex.kz";case"com":return"https://xml.yandex.com";case"tr":return"https://xml.yandex.com.tr";default:return"https://xml.yandex.ru"}},yaca:function(t){switch(t){case"ua":return"https://yaca.yandex.ua";case"by":return"https://yaca.yandex.by";default:return"https://yaca.yandex.ru"}},yamb:function(){return"https://yamb.yandex.ru"},zakladki:function(){return"http://zakladki.yandex.ru"}}}),oninit(function(t){var e=t["i-services"]._data;e.images=function(t){return"tr"===t?"/gorsel/":"/images/"},e["images-com"]=function(){return"/images/"},e.video=function(){return"/video/"},e["video-com"]=function(){return"/video/"}}),block("user").mod("menu","multiauth")(match(function(){return this["i-global"].login}).wrap()(function(){var t=apply("user-menu");return{block:"dropdown-menu",mods:{theme:"ffffff",size:"m",user:"yes"},content:[this.ctx,{elem:"popup",elemMods:{user:"yes"},mix:[{block:"popup",mods:{"fade-out":"no","watch-scroll":"no"}},{block:"user",elem:"multiauth-popup"}],js:{directions:"bottom-right"},content:t}]}}),attrs()(function(){var t=applyNext()||{};return t.role="button",t.tabindex=0,t["aria-haspopup"]="true",t["aria-expanded"]="false",t}),mode("exit-url")(function(){var t=this["i-global"],e="/passport?mode=embeddedauth&action=logout";return e+="&yu="+(t.yandexuid||""),e+="&uid="+t.uid,e+="&retpath="+encodeURIComponent(t.retpath||""),t["passport-host"]+e}),mode("user-menu")(function(){var t=apply("exit-url"),e=this["i-global"]["passport-host"],i=encodeURIComponent(this["i-global"].retpath||"");return[{elem:"item",type:"mail",content:{block:"link",mods:{theme:"normal"},url:this["i-services"].serviceUrl("mail"),content:[{elem:"text",tag:"span",mix:[{block:"user-menu-update",js:{caller:this.ctx.mailCallerId}}],content:function(){var t=this.ctx.js&&this.ctx.js.mail||0,e=t?t+" ":"";return e+BEM.I18N("user","letter",{count:t})}.call(this)}]}},{elem:"item",type:"mailCompose",content:{block:"link",mods:{theme:"normal"},content:BEM.I18N("user","letter_compose"),url:this["i-services"].serviceUrl("mail")+"/compose"}},{elem:"item",type:"disk",content:{block:"link",mods:{theme:"normal"},url:this["i-services"].serviceUrl("disk")+"?source=main-loginmenu",content:[{elem:"text",tag:"span",content:BEM.I18N("user","upload_files")}]}},{elem:"item",elemMods:{separator:"yes"}},{elem:"item",type:"tune",content:{block:"link",mods:{theme:"normal"},content:BEM.I18N("user","tune"),url:this["i-services"].serviceUrl("tune")}},{elem:"item",type:"passport",elemMods:{theme:"separator"},mix:[{block:"user",elem:"accounts"}],content:{block:"link",mods:{theme:"normal"},content:BEM.I18N("user","passport"),url:this["i-services"].serviceUrl("passport")}},{elem:"item",elemMods:{theme:"grey"},type:"add-account",content:{block:"link",mods:{theme:"normal"},url:e+"/auth?mode=add-user&retpath="+i,mix:[{block:"user",elem:"add"},{block:"user",elem:"account-link"},{block:"user",mods:{js:"inited"}}],content:[{block:"user",elem:"icon"},{block:"user",elem:"account-text",content:BEM.I18N("user_menu_multiauth","add-user")}]}},{elem:"item",elemMods:{separator:"yes",theme:"grey"}},{elem:"item",elemMods:{theme:"grey"},type:"edit",content:{block:"link",mods:{theme:"normal"},mix:{block:"user",elem:"edit-list"},url:e+"/auth?mode=edit&retpath="+i,content:[{elem:"text",tag:"span",content:BEM.I18N("user_menu_multiauth","edit-list")}]}},{elem:"item",type:"logout",elemMods:{theme:"grey"},content:{block:"link",mods:{theme:"normal"},mix:[{block:"user",js:{_uniqId:"user__logout"}},{block:"user",elem:"logout"}],content:BEM.I18N("user","exit"),url:t}}]})),block("user").elem("icon").match(function(){return this._uid})(def()(function(){var t=this.ctx.avatarId||(this["i-global"].displayName||{}).default_avatar;return applyNext({_avatarId:t})}),tag()("span"),mode("host")("//avatars.mds.yandex.net"),js()(function(){return{avatarId:this._avatarId}})),block("user").elem("icon").mode("iconSize")("middle"),block("dropdown-menu").elem("popup").def()(function(){var t=this.ctx;return applyCtx({block:"dropdown",elem:"popup",js:this.ctx.js,mix:(t.mix||[]).concat({block:"dropdown-menu",elem:"popup",elemMods:this.extend({size:this.dropdownMenuSize},this.elemMods)}),attrs:t.attrs,content:{block:"dropdown-menu",elem:"menu",title:t.menuTitle,type:t.type,elemMods:t.menuMods,mix:t.menuMix,content:t.content}})}),block("user-menu-update").js()(!0),oninit(function(t){t.BEMContext.prototype.cleverSubstring=function(t,e,i){return t.length>e+i?t.substring(0,e-1)+"":t}}),block("user").elem("name")(tag()("span"),def()(function(){var t=this.ctx,e=this["i-global"],i=t.content||t.login||this._login||(e.displayName||{}).name,n=!1;return i||(/^uid-/.test(e.login)?(i="",n=!0):i=e.login),applyNext({_maxLength:void 0!==t.maxLength?t.maxLength:16,_maxLengthRelative:void 0!==t.maxLengthRelative?t.maxLengthRelative:3,_userName:i,_isUglyUserName:t.isUglyUserName||n})}),mode("pre-content")(function(){var t=this.ctx;return[{elem:"first-letter",tag:"span",content:{html:this.xmlEscape(t.charAt(0))}},{html:this.xmlEscape(t.slice(1))}]}),content()(function(){return apply("pre-content",{ctx:this.cleverSubstring(this._userName,this._maxLength,this._maxLengthRelative)})}),js()(function(){return{maxLength:this._maxLength,maxLengthRelative:this._maxLengthRelative,isUglyUserName:this._isUglyUserName}})),block("auth")(def()(function(){var t=this.ctx,e=function(t,e){return t?BEM.blocks["i-global"].param(e):this["i-global"][e]}.bind(this,BEM&&BEM.blocks);return void 0===t.retpath&&(t.retpath=e("retpath")),void 0===t.from&&(t.from=e("passport-msg")),applyNext({_passportHost:e("passport-host")})}),tag()("form"),js()(!0),attrs()(function(){return{method:"post",action:this.ctx.url||this._passportHost+"/auth",role:"form","aria-label":BEM.I18N("auth","auth")}}),mode("auto-content")([]),content()(function(){var t=this.ctx;return[t.content||apply("auto-content"),["retpath","from","origin","timestamp"].map(function(e){return{elem:"hidden",mix:{elem:e},name:e,val:t[e]}})]})),block("auth").elem("hidden")(tag()("input"),attrs()(function(){return{type:"hidden",name:this.ctx.name,value:this.ctx.val}})),block("auth").elem("social-icon")(tag()("i"),content()("")),block("button")(def()(function(){this.mods;return applyNext()}),tag()("button"),match(function(){return this.ctx.url}).tag()("a"),js()(!0),attrs()(match(function(){return!0})(function(){var t=this.ctx,e={};return e.tabindex=t.tabindex,e}),match(function(){return this.ctx.url})(function(){var t=this.ctx,e=t.attrs,i=applyNext(),n={href:t.url,target:t.target},s=void 0!==Object(e).rel,o=s?String(e.rel):"",r="_blank"===n.target;return r&&(n.rel="noopener",o&&-1===o.indexOf("noopener")&&(e.rel=o+" noopener")),this.extend(i,n)}),match(function(){return!this.ctx.url})(function(){var t=this.ctx,e=applyNext(),i={type:t.type||"button",autocomplete:"off",name:t.name,value:t.value};return this.extend(e,i)})),content()(function(){return{elem:"text",tag:"span",content:this.ctx.content}})),block("button").mod("disabled","yes").attrs()(function(){var t=this.ctx,e={};return t.url?e["aria-disabled"]="true":e.disabled=!0,this.extend(applyNext(),e)})});var BEMHTML={};engine.exportApply(BEMHTML),function(t,e,i){function n(){m&&f&&console.log.apply(console,arguments)}function s(t){return"string"==typeof t&&(t={block:t}),t.block+(t.elem?l+t.elem:"")+(t.modName?h+t.modName+h+t.modVal:"")}function o(t){var e={};return t.split(l).forEach(function(t,i){var n=[i?"elem":"block","mod","val"];t.split(h).forEach(function(t,i){e[n[i]]=t})}),e}function r(t){return t?p.push(t):!1}function a(){return p.length&&p.pop()}function c(){this._lang="",this._prj="lego",this._keyset="",this._key=""}if("function"==typeof e.I18N&&e.I18N._proto)return e.I18N;"undefined"==typeof i18n&&(i18n={}),BEM=e;var h="_",l="__",u="ru",d={},p=[],m=!1,f="undefined"!=typeof console&&"function"==typeof console.log;c.prototype={lang:function(t){return this._lang=t,this},project:function(t){return this._prj=t,this},keyset:function(t,e){return e&&r(this._keyset),this._keyset=s(t),this},key:function(t){return this._key=t,this},decl:function(t){var e=o(this._keyset),i="i-tanker"===e.block?"tanker":this._prj,n=e.elem||this._keyset,s=this._key;i=i18n[i]||(i18n[i]={}),n=i[n]||(i[n]={}),n[s]="function"==typeof t?t:function(e){return t};var r=d[this._lang]||(d[this._lang]={}),a=r[this._keyset]||(r[this._keyset]={});a[s]=t},val:function(t,e){var i=d[this._lang]&&d[this._lang][this._keyset],s="keyset: "+this._keyset+" key: "+this._key+" (lang: "+this._lang+")";if(!i)return n("[I18N_NO_KEYSET] %s",s),"";i=i[this._key];var o=typeof i;return"undefined"===o?(n("[I18N_NO_VALUE] %s",s),""):"string"===o?i:(e||(e=this),i.call(e,t))},_cache:function(){return d}},e.I18N=function(t){var e=function(t,i,n){return e.keyset(t).key(i,n)};return e._proto=t,e.project=function(t){return this._proto.project(t),this},e.keyset=function(t){return this._proto.keyset(t,!0),this},e.key=function(t,i){var n,s,o=this._proto;return o.lang(this._lang).key(t),n=o.val.call(o,i,e),s=a(),s&&o.keyset(s,!1),n},e.decl=function(t,e,i){var n,s=this._proto;i||(i={}),i.lang&&s.lang(i.lang),s.keyset(t);for(n in e)e.hasOwnProperty(n)&&s.key(n).decl(e[n]);return this},e.lang=function(t){return"undefined"!=typeof t&&(this._lang=t),this._lang},e.debug=function(t){m=!!t},e.lang(u),e}(new c)}(this,"undefined"==typeof BEM?{}:BEM),"undefined"!=typeof BEM&&BEM.I18N&&(BEM.I18N.decl("adv-label",{"":""},{lang:"ru"}),BEM.I18N.decl("advanced-search_spok_yes",{"":"","":"","":"","":""},{lang:"ru"}),BEM.I18N.decl("advertising-label",{"":""},{lang:"ru"}),BEM.I18N.decl("auth",{auth:"","fill-input":"  ",login:"",logon:"",more:"",password:"",register:"",remember:" ","social-log-in":"    ",temporary:" ","wrong-characters":" ","wrong-keyboard-layout":" ","wrong-password":"     "},{lang:"ru"}),BEM.I18N.decl("auto-wizard",{" ":" ","  ":"  "},{lang:"ru"}),BEM.I18N.decl("b-statcounter__metrika",{JSERR_incorrectID:"Incorrect ID has been passed."},{lang:"ru"}),BEM.I18N.decl("boards",{" <br>  .":" <br>  ."},{lang:"ru"}),BEM.I18N.decl("cbir-error_spok_yes",{"":"","  ,   .":"  ,   .","":"","   .    .":"   .    .","      ,    .":"      ,    .","  ,    .":"  ,    ."},{lang:"ru"}),BEM.I18N.decl("cbir-intent_spok_yes",{" ":" "," ":" ","":""},{lang:"ru"}),BEM.I18N.decl("cbir-no-results_spok_yes",{"    ":"    "},{lang:"ru"}),BEM.I18N.decl("cbir-panel_spok_yes",{"  ":"  "," ":" ","":"","   ":"   "},{lang:"ru"}),BEM.I18N.decl("cbir-tags_spok_yes",{" ":" ","":""},{lang:"ru"}),BEM.I18N.decl("competitors",{" {query}    :":function(t){return" "+t.query+"    :"},"    ,     ":"    ,     "},{lang:"ru"}),BEM.I18N.decl("complain2",{"":"","  ":"  "},{lang:"ru"}),BEM.I18N.decl("copyright",{link:function(t){return" "+t.content+""},yandex:""},{lang:"ru"}),BEM.I18N.decl("custom-site_spok_yes",{" ":" "," ":" ","":"","   ":"   "},{lang:"ru"}),BEM.I18N.decl("disk-button",{" ":" ","":"","":"","  ":"  ","{authorize}   {br},  {br}  .":function(t){return t.authorize+"   "+t.br+",  "+t.br+"  ."},"":"","   {br}  .{br}":function(t){return"   "+t.br+"  ."+t.br},"! -   .{br}  {br}  .":function(t){return"! -   ."+t.br+"  "+t.br+"  ."},"   ":"   "},{lang:"ru"}),BEM.I18N.decl("dropdown-more",{"":""},{lang:"ru"}),BEM.I18N.decl("feedback",{"     .":"     .","  ":"  ","  ":"  ","  ":"  "," ":" ","":"","":""," ":" ",",     !":",     !","   ":"   "},{lang:"ru"}),BEM.I18N.decl("feedback_spok_yes",{"     .":"     .","  ":"  ","  ":"  ","  ":"  "," ":" ","":"","":""," ":" ",",     !":",     !","   ":"   "},{lang:"ru"}),BEM.I18N.decl("footer",{about:" ","about-url":"//company.yandex.ru",advert:"","advert-url":"//advertising.yandex.ru/kupislova.xml?advertising",apps:" ","apps-url":"//mobile.yandex.ru",stat:"",termsofuse:"  ","termsofuse-url":"//legal.yandex.ru/termsofuse/"},{lang:"ru"}),BEM.I18N.decl("i-services",{404:"404",adresa:"",advertising:"",afisha:"",all:"",api:"API",appmetrica:"AppMetrica",appsearch:"",auto:"",autoru:".",avia:"",aziada:"",ba:"",backapv:" .",balance:"",bar:"","bar-ie":"","bar-ie9":"9",bayan:" ",blogs:"",books:"",browser:"",calendar:"",captcha:"...",catalogwdgt:" ",chrome:"   ",city:"",cityday:" ",collection:"",company:"",contest:"Contest",delivery:"",desktop:" ",direct:"","direct.market":"",disk:"",display:"",ege:"",expert:"",feedback:" ",feedback2:" ",ff:"  ",fotki:"",fresh:"",games:"",geocontext:"",goroda:"",help:"",i:"",ie:"  ",images:"","images-com":"",interests:"",internet:"",kassa:"",keyboard:"",kraski:"",kuda:"",large:"  ",legal:" ",lenta:"",libra:"",literacy:"   ",local:"",lost:"",love:"13",mail:"",maps:"","maps-wiki":" ",market:"","market.advertising":"",master:"",metrika:"",metro:"",mobile:"",moikrug:"",money:"",museums:"",music:"","music-partner":": ",nahodki:"",nano:"",newhire:"",news:"",notifications:" ",oauth:"",online:"",openid:"OpenID",opera:"Opera Software",opinion:"",partners:"",partnersearch:"  ",passport:"",pdd:"  ",peoplesearch:"",perevod:"",probki:"",pulse:": ",punto:"Puntoswitcher",pvo:"",rabota:"",ramazan:"",rasp:"",realty:"",referats:"",rk:"?",root:".  Unix ",school:"",search:"",server:"",shtrafi:"",site:"",slovari:"",so:"",social:"",soft:"",sport:"",sprav:"",start:" ",stat:"",subs:"",taxi:"",terms:"",tests:"  ",tickets:"",time:".",toloka:".",toster:"",translate:"",tune:"",tv:"",uslugi:"",video:"","video-com":"",vno:"",wdgt:"",weather:"",webmaster:"","webmaster-api":"API ",widgets:"",wordstat:"",wow:".",www:"",xmlsearch:"XML",yaca:"",yamb:" ",zakladki:""},{lang:"ru"}),BEM.I18N.decl("i-tanker__dynamic",{gender:function(t){return function(t){return t[t.gender]}.call(this,t)},plural:function(t){return function(t){var e=isNaN(parseInt(t.count))?0:t.count,i=e%10,n=e%100;return 1==i&&11!=n?t.one:i>1&&5>i&&(10>n||n>20)?t.some:t.many}.call(this,t)},plural_adv:function(t){return function(t){var e=isNaN(parseInt(t.count))?0:t.count;return 0===e?t.none:this.keyset("i-tanker__dynamic").key("plural",{count:t.count,one:t.one,some:t.some,many:t.many})}.call(this,t)},toggle:function(t){return function(t){return Boolean(t.condition)?t["true"]:t["false"]}.call(this,t)}},{lang:"ru"}),BEM.I18N.decl("image-source",{"   {domain}":function(t){return"   "+t.domain}},{lang:"ru"}),BEM.I18N.decl("lang-switcher",{all:""},{lang:"ru"}),BEM.I18N.decl("logo_type_link",{yandex:""},{lang:"ru"}),BEM.I18N.decl("market-snippet",{"  .":"  .","   ":"   ",".":"."},{lang:"ru"}),BEM.I18N.decl("market-snippet2",{".":".","{price}   ":function(t){return t.price+"   "}},{lang:"ru"}),BEM.I18N.decl("misspell",{"   ":"   "},{lang:"ru"}),BEM.I18N.decl("other-sites_spok_yes",{",   ":",   "},{lang:"ru"}),BEM.I18N.decl("other-sizes_spok_yes",{"":"","":"","":"","":"","    ":"    "},{lang:"ru"}),BEM.I18N.decl("pane2_spok_yes",{"":""},{lang:"ru"}),BEM.I18N.decl("popup",{add:"",cancel:"",revert:"",apply:""},{lang:"ru"}),BEM.I18N.decl("preview2_spok_yes",{"":"","":""},{lang:"ru"}),BEM.I18N.decl("related2_spok_yes",{" ":" "},{lang:"ru"}),BEM.I18N.decl("related_spok_yes",{" ":" "},{lang:"ru"}),BEM.I18N.decl("search-by-image_spok_yes",{"   ":"   "},{lang:"ru"}),BEM.I18N.decl("search2",{"search-button-text":"","search-input-label":"","search-service-label":"  ","search-web-label":"  "},{lang:"ru"}),BEM.I18N.decl("search2_spok_yes",{"":""},{lang:"ru"}),BEM.I18N.decl("serp-controller_spok_yes",{" ":" "},{lang:"ru"}),BEM.I18N.decl("serp-item",{"{price}   ":function(t){return t.price+"   "},"":""},{lang:"ru"}),BEM.I18N.decl("serp-url_spok_yes",{"  ":"  "},{lang:"ru"}),BEM.I18N.decl("serp-user_spok_yes",{"{login},  ?":function(t){return t.login+",  ?"},"":"","    ":"    ",", ":", "," ":" "," ":" "},{lang:"ru"}),BEM.I18N.decl("share",{"  ,   ":"  ,   ","   :":"   :","":"","  :":"  :"," ":" "},{lang:"ru"}),BEM.I18N.decl("share-copy",{"":""," ":" "," ":" "},{lang:"ru"}),BEM.I18N.decl("similar_spok_yes",{" ":" "},{lang:"ru"}),BEM.I18N.decl("sizes_spok_yes",{"  ":"  ","":""," ":" "},{lang:"ru"}),BEM.I18N.decl("slideshow-controls",{"":"","":"","":""},{lang:"ru"}),BEM.I18N.decl("suggest2",{fact:"",group:" ",nah:" ",nav:"",text:"",traffic:"",weather:""},{lang:"ru"}),BEM.I18N.decl("suggest2-item",{"quick-answer":" "},{lang:"ru"}),BEM.I18N.decl("ticker__text",{notifications:""},{lang:"ru"}),BEM.I18N.decl("trimmer-controls_spok_yes",{"":"","":"","      ":"      "},{lang:"ru"}),BEM.I18N.decl("user",{enter:"",exit:"",letter:function(t){return this.keyset("i-tanker__dynamic").key("plural_adv",{count:t.count,one:" ",some:" ",many:" ",none:"  "})},letter_compose:" ",passport:"",tune:"",upload_files:" "},{lang:"ru"}),BEM.I18N.decl("user_menu_multiauth",{"add-user":" ","edit-list":" "},{lang:"ru"}),BEM.I18N.decl("video-wizard",{"   ":"   "},{lang:"ru"}),BEM.I18N.lang("ru"));